{"version":3,"sources":["meteor://ðŸ’»app/packages/cultofcoders:grapher/main.server.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/aggregate.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/compose.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/createQuery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/db.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/exposure.config.schema.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/exposure.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/lib/cleanBody.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/lib/cleanSelectors.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/lib/enforceMaxDepth.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/lib/enforceMaxLimit.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/lib/restrictFields.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/exposure/lib/restrictLinks.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/graphql/index.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/graphql/lib/astToBody.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/graphql/lib/astToQuery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/graphql/lib/defaults.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/config.schema.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/constants.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linker.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/lib/createSearchFilters.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/base.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkMany.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkManyMeta.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkOne.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/linkOneMeta.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/links/linkTypes/lib/smartArguments.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.base.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.client.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/namedQuery.server.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/store.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/cache/BaseResultCacher.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/expose/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/expose/schema.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/namedQuery/expose/lib/mergeDeep.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.base.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.client.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/query.server.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/collection.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/constants.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/countSubscription.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/createFauxSubscription.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/counts/genEndpoint.server.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/aggregateSearchFilters.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/assembleAggregateResults.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/assembler.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/buildAggregatePipeline.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/constants.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/hypernova.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/storeHypernovaResults.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/lib/cleanObjectForMetaFilters.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/hypernova/lib/snapBackDottedFields.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/applyProps.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/callWithPromise.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/createGraph.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/dotize.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/intersectDeep.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/prepareForDelivery.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/prepareForProcess.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/recursiveCompose.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/lib/recursiveFetch.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/nodes/collectionNode.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/nodes/fieldNode.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/nodes/reducerNode.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/extension.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/addFieldMap.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/applyReducers.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/cleanReducerLeftovers.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/createReducers.js","meteor://ðŸ’»app/packages/cultofcoders:grapher/lib/query/reducers/lib/embedReducerWithLink.js"],"names":["module","export","NamedQueryStore","LinkConstants","link","default","v","Promise","Mongo","Collection","prototype","aggregate","pipelines","options","coll","rawCollection","result","Meteor","wrapAsync","Array","isArray","await","toArray","deepExtend","exportDefault","args","Query","NamedQuery","name","body","_","isFunction","createNamedQuery","entryPointName","first","keys","collection","get","Error","isDevelopment","console","warn","params","createNormalQuery","namedQuery","query","add","clone","db","Proxy","obj","prop","extend","createQuery","ExposureDefaults","ExposureSchema","validateBody","createGraph","Match","blocking","method","publication","firewall","Maybe","OneOf","Function","maxLimit","Integer","maxDepth","Boolean","Object","restrictedFields","String","restrictLinks","e","toString","Exposure","genCountEndpoint","recursiveCompose","hypernova","enforceMaxDepth","enforceMaxLimit","cleanBody","deepClone","restrictFieldsFn","check","globalConfig","setConfig","config","assign","getConfig","restrictFields","constructor","__isExposedForGrapher","__exposure","_name","_validateAndClean","initSecurity","initPublication","initMethod","initCountMethod","initCountPublication","getTransformedBody","userId","processedBody","getBody","call","bind","publishComposite","transformedBody","rootNode","bypassFirewalls","methodBody","unblock","methods","find","$filters","count","getCursor","session","filters","fields","_id","getSession","findOne","undefined","_callFirewall","arguments","length","forEach","fire","expose","isServer","cleanFilters","cleanOptions","dotize","main","second","object","$options","getFields","each","secondValue","key","value","isObject","convert","fieldExists","ensureFields","pick","sort","deepFilterFieldsArray","deepFilterFieldsObject","special","contains","field","element","i","indexOf","getDepth","node","depth","collectionNodes","max","map","limit","cleanObject","restrictedField","matching","subfield","slice","getLinks","parentNode","restrictedLinks","collectionNode","linkName","remove","exposure","configRestrictLinks","astToQuery","setAstToQueryDefaults","Symbols","astToBody","ARGUMENTS","Symbol","ast","fieldNodes","extractSelectionSet","selectionSet","set","selections","el","argumentMap","arg","getMaxDepth","deny","clearEmptyObjects","createGetArgs","defaults","intersectDeep","Errors","MAX_DEPTH","embody","Number","intersect","currentMaxDepth","getArgs","depths","push","Math","parts","split","accessor","shift","shouldDelete","path","stopped","DenormalizeSchema","LinkConfigDefaults","LinkConfigSchema","bypassSchema","type","Where","_collection","metadata","inversedBy","index","unique","autoremove","denormalize","ObjectIncluding","LINK_STORAGE","Linker","addLinks","data","linkConfig","linker","getLinker","hasLink","getLink","objectOrId","linkData","isVirtual","linkStorageField","createLink","LinkMany","LinkManyMeta","LinkOne","LinkOneMeta","smartArguments","dot","access","mainCollection","_initAutoremove","_initDenormalization","_handleReferenceRemovalForVirtualLinks","_initIndex","oneTypes","strategy","isMany","relatedLinker","getLinkedCollection","isSingle","isMeta","isOneResult","helperClass","_getHelperClass","collectionName","_prepareVirtual","_generateFieldName","startup","_setupVirtualConfig","virtualLinkConfig","cleanedCollectionName","replace","defaultFieldPrefix","after","doc","fetchAsArray","linkedObj","unset","_ensureIndex","sparse","$in","getIds","ids","fetch","item","packageExists","Package","cacheConfig","referenceFieldSuffix","inversedLink","referenceField","cacheField","cache","isDenormalized","isSubBodyDenormalized","cacheBody","cacheBodyFields","bodyFields","omit","difference","createSearchFilters","createOne","createOneVirtual","createOneMeta","createOneMetaVirtual","createMany","createManyVirtual","createManyMeta","createManyMetaVirtual","sift","fieldStorage","metaFilters","pluck","$elemMatch","Link","SmartArgs","linkedCollection","$metaFilters","$meta","searchFilters","appliedFilters","others","clean","identifyId","what","saveToDatabase","getId","identifyIds","_validateIds","validIds","join","_virtualAction","action","reversedLink","elementId","insert","_ids","union","modifier","$addToSet","$each","update","filter","$pullAll","metadatas","localMetadata","extendMetadata","existingMetadata","subfieldUpdate","$set","$pull","subWhat","NamedQueryBase","isNamedQuery","queryName","resolver","subscriptionHandle","isExposed","isResolver","setParams","doValidateParams","validateParams","_validate","validationError","error","newParams","cacher","exposeConfig","validator","CountSubscription","recursiveFetch","prepareForProcess","callWithPromise","Base","LocalCollection","subscribe","callback","subscribeCount","_counter","unsubscribe","stop","unsubscribeCount","fetchSync","fetchOneSync","callbackOrOptions","_fetchStatic","_fetchReactive","fetchOne","err","res","getCountSync","getCount","$body","allowSkip","skip","scoped","NamedQueryClient","NamedQueryServer","MemoryResultCacher","context","_performSecurityChecks","_fetchResolverData","doEmbodimentIfItApplies","cacheId","generateQueryId","countCursor","getCursorForCounting","cacheResults","resolve","fn","self","storage","getAll","BaseResultCacher","EJSON","stringify","fetchData","cloneDeep","DEFAULT_TTL","store","cacheData","storeData","ttl","setTimeout","ExposeSchema","ExposeDefaults","mergeDeep","_initNormalQuery","_initMethod","_initPublication","_initCountMethod","_initCountPublication","_unblockIfNecessary","isScoped","enableScope","target","source","QueryBase","isGlobalQuery","QueryClient","QueryServer","COUNTS_COLLECTION_CLIENT","ReactiveVar","Tracker","Counts","createFauxSubscription","accessToken","fauxHandle","equals","lastArgs","token","_markedForUnsubscribe","disconnectComputation","autorun","handleDisconnect","id","status","connected","_markedForResume","isSubscribed","countManager","ready","paramsOrBody","sessionId","JSON","existingSession","publish","request","parse","cursor","isReady","handle","observe","added","changed","removed","onStop","AggregateFilters","parentObjects","parent","results","create","uniq","eligibleObjects","storages","arrayOfIds","isValid","cleanObjectForMetaFilters","childCollectionNode","aggregateResults","allResults","metaFiltersTest","parentResult","eligibleAggregateResults","aggregateResult","datas","comparator","childLinkName","parentResults","resultsByKeyId","groupBy","filterAssembledData","SAFE_DOTTED_FIELD_REPLACEMENT","containsDottedFields","pipeline","$match","$sort","dataPush","safeField","$group","$push","$slice","$project","hypernovaInit","applyProps","prepareForDelivery","storeHypernovaResults","userIdToPass","assemble","assembleAggregateResults","buildAggregatePipeline","snapBackDottedFields","aggregateFilters","filteredOptions","aggregationResult","document","RegExp","restrictOptions","props","applyFields","myParameters","reject","reason","specialFields","createNodes","addFieldNode","getNodeNamespace","CollectionNode","FieldNode","ReducerNode","createReducers","root","fieldName","addProp","handleDenormalized","subroot","reducer","getReducer","reducerNode","isProjectionOperatorExpression","dotted","fieldNode","n","reverse","snapCache","prefix","newObj","recurse","o","p","isArrayItem","f","isEmptyArray","getFieldName","isEmptyObj","isNumber","isNaN","parseInt","hasOwnProperty","allowedBody","clientBody","allowedBodyDot","clientBodyDot","intersection","build","intersectedField","applyPostFilters","applyPostOptions","getResultsArray","removeLinkStorages","storeOneResults","assembleMetadata","applyReducers","cleanReducerLeftovers","Minimongo","snapBackCaches","cloneMetaChildren","applyPostFilter","postFilters","$postFilters","$postOptions","sorter","Sorter","getComparator","start","end","$postFilter","isUndefined","sameLevelResults","removeStorageField","shouldCleanStorage","childResults","childResult","storeMetadata","parentElement","$metadata","storageItem","isEmpty","snapCaches","snapCachesSingles","shoudStoreLinkStorage","defaultFilterFunction","applyFilterRecursive","isRoot","$filter","applyPagination","_params","_body","patchCursor","ns","originalObserve","callbacks","newCallbacks","compose","children","parentObject","fetchOptions","scopeQuery","$exists","collectionNodeResults","runFieldSanityChecks","nodes","scheduledForDeletion","reducers","reducerNodes","_shouldCleanStorage","_node","hasAddedAnyField","projectionOperator","has","hasField","checkNested","reduce","acc","last","getField","hasCollectionNode","hasReducerNode","getReducerNode","getCollectionNode","getName","subLinkName","isProjectionOperator","reduceFunction","dependencies","compute","addFieldMap","addReducers","reducerConfig","reducerName","dbField","processedReducers","reducersQueue","allDependenciesComputed","all","dep","includes","flatten","cleanNestedFields","snapCacheField","handleAddElement","handleAddReducer","handleAddLink","handleAddField","embedReducerWithLink","childReducerNode","dots","addFieldIfRequired","nestedFields","startsWith","every","reducerBody"],"mappings":"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","file":"/packages/cultofcoders_grapher.js","sourcesContent":["import './lib/extension.js';\nimport './lib/aggregate';\nimport './lib/exposure/extension.js';\nimport './lib/links/extension.js';\nimport './lib/query/reducers/extension.js';\nimport './lib/namedQuery/expose/extension.js';\nimport NamedQueryStore from './lib/namedQuery/store';\nimport LinkConstants from './lib/links/constants';\n\nexport { NamedQueryStore, LinkConstants };\n\nexport { default as createQuery } from './lib/createQuery.js';\n\nexport { default as Exposure } from './lib/exposure/exposure.js';\n\nexport {\n    default as MemoryResultCacher,\n} from './lib/namedQuery/cache/MemoryResultCacher';\n\nexport {\n    default as BaseResultCacher,\n} from './lib/namedQuery/cache/BaseResultCacher';\n\nexport { default as compose } from './lib/compose';\n\nexport * from './lib/graphql';\nexport { default as db } from './lib/db';\n","import { Promise } from 'meteor/promise';\n\nMongo.Collection.prototype.aggregate = function(pipelines, options = {}) {\n    const coll = this.rawCollection();\n\n    let result = Meteor.wrapAsync(coll.aggregate, coll)(pipelines, options);\n\n    // We need to check If it's an AggregationCursor\n    // The reason we do this was because of the upgrade to 1.7 which involved a mongodb driver update\n    if (Array.isArray(result)) {\n        return result;\n    } else {\n        return Promise.await(result.toArray());\n    }\n};\n","import deepExtend from 'deep-extend';\n\nexport default function (...args) {\n    return deepExtend({}, ...args);\n}","import Query from './query/query.js';\nimport NamedQuery from './namedQuery/namedQuery.js';\nimport NamedQueryStore from './namedQuery/store.js';\n\n/**\n * This is a polymorphic function, it allows you to create a query as an object\n * or it also allows you to re-use an existing query if it's a named one\n *\n * @param args\n * @returns {*}\n */\nexport default (...args) => {\n    if (typeof args[0] === 'string') {\n        let [name, body, options] = args;\n        options = options || {};\n\n        // It's a resolver query\n        if (_.isFunction(body)) {\n            return createNamedQuery(name, null, body, options);\n        }\n\n        const entryPointName = _.first(_.keys(body));\n        const collection = Mongo.Collection.get(entryPointName);\n\n        if (!collection) {\n            throw new Meteor.Error('invalid-name', `We could not find any collection with the name \"${entryPointName}\". Make sure it is imported prior to using this`)\n        }\n\n        return createNamedQuery(name, collection, body[entryPointName], options);\n    } else {\n        // Query Creation, it can have an endpoint as collection or as a NamedQuery\n        let [body, options] = args;\n        options = options || {};\n\n        const entryPointName = _.first(_.keys(body));\n        const collection = Mongo.Collection.get(entryPointName);\n\n        if (!collection) {\n            if (Meteor.isDevelopment && !NamedQueryStore.get(entryPointName)) {\n                console.warn(`You are creating a query with the entry point \"${entryPointName}\", but there was no collection found for it (maybe you forgot to import it client-side?). It's assumed that it's referencing a NamedQuery.`)\n            }\n\n            return createNamedQuery(entryPointName, null, {}, {params: body[entryPointName]});\n        } else {\n            return createNormalQuery(collection, body[entryPointName], options);\n        }\n    }\n}\n\nfunction createNamedQuery(name, collection, body, options = {}) {\n    // if it exists already, we re-use it\n    const namedQuery = NamedQueryStore.get(name);\n    let query;\n\n    if (!namedQuery) {\n        query = new NamedQuery(name, collection, body, options);\n        NamedQueryStore.add(name, query);\n    } else {\n        query = namedQuery.clone(options.params);\n    }\n\n    return query;\n}\n\nfunction createNormalQuery(collection, body, options)  {\n    return new Query(collection, body, options);\n}\n","import { Mongo } from 'meteor/mongo';\nimport { Meteor } from 'meteor/meteor';\n\nconst db = new Proxy(\n  {},\n  {\n    get: function(obj, prop) {\n      if (typeof prop === 'symbol') {\n        return obj[prop];\n      }\n\n      const collection = Mongo.Collection.get(prop);\n\n      if (!collection) {\n        return obj[prop];\n      }\n\n      return collection;\n    },\n  }\n);\n\nexport default db;\n","import Query from './query/query.js';\nimport NamedQuery from './namedQuery/namedQuery.js';\nimport NamedQueryStore from './namedQuery/store.js';\n\n_.extend(Mongo.Collection.prototype, {\n    createQuery(...args) {\n        if (typeof args[0] === 'string') {\n            //NamedQuery\n            const [name, body, options] = args;\n            const query = new NamedQuery(name, this, body, options);\n            NamedQueryStore.add(name, query);\n\n            return query;\n        } else {\n            const [body, options] = args;\n\n            return new Query(this, body, options);\n        }\n    },\n});\n","import createGraph from '../query/lib/createGraph.js';\nimport {Match} from 'meteor/check';\n\nexport const ExposureDefaults = {\n    blocking: false,\n    method: true,\n    publication: true,\n};\n\nexport const ExposureSchema = {\n    firewall: Match.Maybe(\n        Match.OneOf(Function, [Function])\n    ),\n    maxLimit: Match.Maybe(Match.Integer),\n    maxDepth: Match.Maybe(Match.Integer),\n    publication: Match.Maybe(Boolean),\n    method: Match.Maybe(Boolean),\n    blocking: Match.Maybe(Boolean),\n    body: Match.Maybe(Object),\n    restrictedFields: Match.Maybe([String]),\n    restrictLinks: Match.Maybe(\n        Match.OneOf(Function, [String])\n    ),\n};\n\nexport function validateBody(collection, body) {\n    try {\n        createGraph(collection, body);\n    } catch (e) {\n        throw new Meteor.Error('invalid-body', 'We could not build a valid graph when trying to create your exposure: ' + e.toString())\n    }\n}","import genCountEndpoint from '../query/counts/genEndpoint.server.js';\nimport createGraph from '../query/lib/createGraph.js';\nimport recursiveCompose from '../query/lib/recursiveCompose.js';\nimport hypernova from '../query/hypernova/hypernova.js';\nimport {\n    ExposureSchema,\n    ExposureDefaults,\n    validateBody,\n} from './exposure.config.schema.js';\nimport enforceMaxDepth from './lib/enforceMaxDepth.js';\nimport enforceMaxLimit from './lib/enforceMaxLimit.js';\nimport cleanBody from './lib/cleanBody.js';\nimport deepClone from 'lodash.clonedeep';\nimport restrictFieldsFn from './lib/restrictFields.js';\nimport restrictLinks from './lib/restrictLinks.js';\nimport { check } from 'meteor/check';\n\nlet globalConfig = {};\n\nexport default class Exposure {\n    static setConfig(config) {\n        Object.assign(globalConfig, config);\n    }\n\n    static getConfig() {\n        return globalConfig;\n    }\n\n    static restrictFields(...args) {\n        return restrictFieldsFn(...args);\n    }\n\n    constructor(collection, config = {}) {\n        collection.__isExposedForGrapher = true;\n        collection.__exposure = this;\n\n        this.collection = collection;\n        this.name = `exposure_${collection._name}`;\n\n        this.config = config;\n        this._validateAndClean();\n\n        this.initSecurity();\n\n        if (this.config.publication) {\n            this.initPublication();\n        }\n\n        if (this.config.method) {\n            this.initMethod();\n        }\n\n        if (!this.config.method && !this.config.publication) {\n            throw new Meteor.Error(\n                'weird',\n                'If you want to expose your collection you need to specify at least one of [\"method\", \"publication\"] options to true'\n            );\n        }\n\n        this.initCountMethod();\n        this.initCountPublication();\n    }\n\n    _validateAndClean() {\n        if (typeof this.config === 'function') {\n            const firewall = this.config;\n            this.config = { firewall };\n        }\n\n        this.config = Object.assign(\n            {},\n            ExposureDefaults,\n            Exposure.getConfig(),\n            this.config\n        );\n        check(this.config, ExposureSchema);\n\n        if (this.config.body) {\n            validateBody(this.collection, this.config.body);\n        }\n    }\n\n    /**\n     * Takes the body and intersects it with the exposure body, if it exists.\n     *\n     * @param body\n     * @param userId\n     * @returns {*}\n     */\n    getTransformedBody(body, userId) {\n        if (!this.config.body) {\n            return body;\n        }\n\n        const processedBody = this.getBody(userId);\n\n        if (processedBody === true) {\n            return;\n        }\n\n        return cleanBody(processedBody, body);\n    }\n\n    /**\n     * Gets the exposure body\n     */\n    getBody(userId) {\n        if (!this.config.body) {\n            throw new Meteor.Error(\n                'missing-body',\n                'Cannot get exposure body because it was not defined.'\n            );\n        }\n\n        let body;\n        if (_.isFunction(this.config.body)) {\n            body = this.config.body.call(this, userId);\n        } else {\n            body = this.config.body;\n        }\n\n        // it means we allow everything, no need for cloning.\n        if (body === true) {\n            return true;\n        }\n\n        return deepClone(body, userId);\n    }\n\n    /**\n     * Initializing the publication for reactive query fetching\n     */\n    initPublication() {\n        const collection = this.collection;\n        const config = this.config;\n        const getTransformedBody = this.getTransformedBody.bind(this);\n\n        Meteor.publishComposite(this.name, function(body) {\n            let transformedBody = getTransformedBody(body);\n\n            const rootNode = createGraph(collection, transformedBody);\n\n            enforceMaxDepth(rootNode, config.maxDepth);\n            restrictLinks(rootNode, this.userId);\n\n            return recursiveCompose(rootNode, this.userId, {\n                bypassFirewalls: !!config.body,\n            });\n        });\n    }\n\n    /**\n     * Initializez the method to retrieve the data via Meteor.call\n     */\n    initMethod() {\n        const collection = this.collection;\n        const config = this.config;\n        const getTransformedBody = this.getTransformedBody.bind(this);\n\n        const methodBody = function(body) {\n            if (!config.blocking) {\n                this.unblock();\n            }\n\n            let transformedBody = getTransformedBody(body);\n\n            const rootNode = createGraph(collection, transformedBody);\n\n            enforceMaxDepth(rootNode, config.maxDepth);\n            restrictLinks(rootNode, this.userId);\n\n            // if there is no exposure body defined, then we need to apply firewalls\n            return hypernova(rootNode, this.userId, {\n                bypassFirewalls: !!config.body,\n            });\n        };\n\n        Meteor.methods({\n            [this.name]: methodBody,\n        });\n    }\n\n    /**\n     * Initializes the method to retrieve the count of the data via Meteor.call\n     * @returns {*}\n     */\n    initCountMethod() {\n        const collection = this.collection;\n\n        Meteor.methods({\n            [this.name + '.count'](body) {\n                this.unblock();\n\n                return collection\n                    .find(body.$filters || {}, {}, this.userId)\n                    .count();\n            },\n        });\n    }\n\n    /**\n     * Initializes the reactive endpoint to retrieve the count of the data.\n     */\n    initCountPublication() {\n        const collection = this.collection;\n\n        genCountEndpoint(this.name, {\n            getCursor({ session }) {\n                return collection.find(\n                    session.filters,\n                    {\n                        fields: { _id: 1 },\n                    },\n                    this.userId\n                );\n            },\n\n            getSession(body) {\n                return { filters: body.$filters || {} };\n            },\n        });\n    }\n\n    /**\n     * Initializes security enforcement\n     * THINK: Maybe instead of overriding .find, I could store this data of security inside the collection object.\n     */\n    initSecurity() {\n        const collection = this.collection;\n        const { firewall, maxLimit, restrictedFields } = this.config;\n        const find = collection.find.bind(collection);\n        const findOne = collection.findOne.bind(collection);\n\n        collection.firewall = (filters, options, userId) => {\n            if (userId !== undefined) {\n                this._callFirewall(\n                    { collection: collection },\n                    filters,\n                    options,\n                    userId\n                );\n\n                enforceMaxLimit(options, maxLimit);\n\n                if (restrictedFields) {\n                    Exposure.restrictFields(filters, options, restrictedFields);\n                }\n            }\n        };\n\n        collection.find = function(filters, options = {}, userId = undefined) {\n            if (arguments.length == 0) {\n                filters = {};\n            }\n\n            // If filters is undefined it should return an empty item\n            if (arguments.length > 0 && filters === undefined) {\n                return find(undefined, options);\n            }\n\n            collection.firewall(filters, options, userId);\n\n            return find(filters, options);\n        };\n\n        collection.findOne = function(\n            filters,\n            options = {},\n            userId = undefined\n        ) {\n            // If filters is undefined it should return an empty item\n            if (arguments.length > 0 && filters === undefined) {\n                return null;\n            }\n\n            if (typeof filters === 'string') {\n                filters = { _id: filters };\n            }\n\n            collection.firewall(filters, options, userId);\n\n            return findOne(filters, options);\n        };\n    }\n\n    /**\n     * @private\n     */\n    _callFirewall(...args) {\n        const { firewall } = this.config;\n        if (!firewall) {\n            return;\n        }\n\n        if (_.isArray(firewall)) {\n            firewall.forEach(fire => {\n                fire.call(...args);\n            });\n        } else {\n            firewall.call(...args);\n        }\n    }\n}\n","import Exposure from './exposure.js';\n\nObject.assign(Mongo.Collection.prototype, {\n    expose(config) {\n        if (!Meteor.isServer) {\n            throw new Meteor.Error(\n                'not-allowed',\n                `You can only expose a collection server side. ${this._name}`\n            );\n        }\n\n        new Exposure(this, config);\n    },\n});\n","import deepClone from 'lodash.clonedeep';\nimport {cleanFilters, cleanOptions} from './cleanSelectors';\nimport dotize from '../../query/lib/dotize';\n\n/**\n * Deep Inter Computation\n */\nexport default function cleanBody(main, second, ...args) {\n    let object = {};\n\n    if (second.$filters || second.$options) {\n        const fields = getFields(main);\n\n        cleanFilters(second.$filters, fields);\n        cleanOptions(second.$options, fields);\n    }\n\n    _.each(second, (secondValue, key) => {\n        if (key === '$filters' || key === '$options') {\n            object[key] = secondValue;\n            return;\n        }\n\n        let value = main[key];\n\n        if (value === undefined) {\n            return;\n        }\n\n        // if the main value is a function, we run it.\n        if (_.isFunction(value)) {\n            value = value.call(null, ...args);\n        }\n\n        // if the main value is undefined or false, we skip the merge\n        if (value === undefined || value === false) {\n            return;\n        }\n\n        // we treat this specially, if the value is true\n        if (value === true) {\n            object[key] = _.isObject(secondValue) ? deepClone(secondValue) : value;\n            return;\n        }\n\n        // if the main value is an object\n        if (_.isObject(value)) {\n            if (_.isObject(secondValue)) {\n                // if the second one is an object as well we run recursively run the intersection\n                object[key] = cleanBody(value, secondValue, ...args);\n            }\n            // if it is not, then we will ignore it, because it won't make sense.\n            // to merge {a: 1} with 1.\n\n            return;\n        }\n\n        // if the main value is not an object, it should be a truthy value like 1\n        if (_.isObject(secondValue)) {\n            // if the second value is an object, then we will keep it.\n            // this won't cause problem with deep nesting because\n            // when you specify links you will have the main value as an object, otherwise it will fail\n            // this is used for things like when you have a hash object like profile with multiple nesting fields, you can allow the client to specify only what he needs\n\n            object[key] = deepClone(secondValue);\n        } else {\n            // if the second value is not an object, we just store the first value\n            object[key] = value;\n        }\n    });\n\n    return object;\n}\n\nfunction getFields(body) {\n    return _.keys(dotize.convert(body));\n}","export function cleanOptions(options, ensureFields) {\n    if (!options) {\n        return;\n    }\n\n    if (options.fields) {\n        options.fields = _.pick(options.fields, ...ensureFields);\n    }\n\n    if (options.sort) {\n        options.sort = _.pick(options.sort, ...ensureFields);\n    }\n}\n\nconst deepFilterFieldsArray = ['$and', '$or', '$nor'];\nconst deepFilterFieldsObject = ['$not'];\nconst special = [...deepFilterFieldsArray, ...deepFilterFieldsObject];\n\nexport function cleanFilters(filters, ensureFields) {\n    if (!filters) {\n        return;\n    }\n\n    _.each(filters, (value, key) => {\n        if (!_.contains(special, key)) {\n            if (!fieldExists(ensureFields, key)) {\n                delete filters[key];\n            }\n        }\n    });\n\n    deepFilterFieldsArray.forEach(field => {\n        if (filters[field]) {\n            filters[field].forEach(element => cleanFilters(element, ensureFields));\n        }\n    });\n\n    deepFilterFieldsObject.forEach(field => {\n        if (filters[field]) {\n            cleanFilters(filters[field], ensureFields);\n        }\n    });\n}\n\n/**\n * This will check if a field exists in a set of fields\n * If fields contains [\"profile\"], then \"profile.something\" will return true\n *\n * @param fields\n * @param key\n * @returns {boolean}\n */\nexport function fieldExists(fields, key) {\n    for (let i = 0; i < fields.length; i++) {\n        if (fields[i] === key || key.indexOf(fields[i] + '.') === 0) {\n            return true;\n        }\n    }\n\n    return false;\n}\n","export default function (node, maxDepth) {\n    if (maxDepth === undefined) {\n        return node;\n    }\n\n    const depth = getDepth(node);\n\n    if (depth > maxDepth) {\n        throw new Meteor.Error('too-deep', 'Your graph request is too deep and it is not allowed.')\n    }\n\n    return node;\n}\n\nexport function getDepth(node) {\n    if (node.collectionNodes.length === 0) {\n        return 1;\n    }\n\n    return 1 + _.max(\n        _.map(node.collectionNodes, getDepth)\n    );\n}","export default function (options, maxLimit) {\n    if (maxLimit === undefined) {\n        return;\n    }\n\n    if (options.limit) {\n        if (options.limit > maxLimit) {\n            options.limit = maxLimit;\n        }\n    } else {\n        options.limit = maxLimit;\n    }\n}","const deepFilterFieldsArray = ['$and', '$or', '$nor'];\nconst deepFilterFieldsObject = ['$not'];\n\n/**\n * This is used to restrict some fields to some users, by passing the fields as array in the exposure object\n * For example in an user exposure: restrictFields(options, ['services', 'createdAt'])\n *\n * @param filters Object\n * @param options Object\n * @param restrictedFields Array\n */\nexport default function restrictFields(filters, options, restrictedFields) {\n    if (!_.isArray(restrictedFields)) {\n        throw new Meteor.Error('invalid-parameters', 'Please specify an array of restricted fields.');\n    }\n\n    cleanFilters(filters, restrictedFields);\n    cleanOptions(options, restrictedFields)\n}\n\n/**\n * Deep cleans filters\n *\n * @param filters\n * @param restrictedFields\n */\nfunction cleanFilters(filters, restrictedFields) {\n    if (filters) {\n        cleanObject(filters, restrictedFields);\n    }\n\n    deepFilterFieldsArray.forEach(field => {\n        if (filters[field]) {\n            filters[field].forEach(element => cleanFilters(element, restrictedFields));\n        }\n    });\n\n    deepFilterFieldsObject.forEach(field => {\n        if (filters[field]) {\n            cleanFilters(filters[field], restrictedFields);\n        }\n    });\n}\n\n/**\n * Deeply cleans options\n *\n * @param options\n * @param restrictedFields\n */\nfunction cleanOptions(options, restrictedFields) {\n    if (options.fields) {\n        cleanObject(options.fields, restrictedFields);\n\n        if (_.keys(options.fields).length === 0) {\n            _.extend(options.fields, {_id: 1})\n        }\n    } else {\n        options.fields = {_id: 1};\n    }\n\n    if (options.sort) {\n        cleanObject(options.sort, restrictedFields);\n    }\n}\n\n/**\n * Cleans the object (not deeply)\n *\n * @param object\n * @param restrictedFields\n */\nfunction cleanObject(object, restrictedFields) {\n    _.each(object, (value, key) => {\n        restrictedFields.forEach((restrictedField) => {\n            if (matching(restrictedField, key)) {\n                delete object[key];\n            }\n        })\n    });\n}\n\n/**\n * Returns true if field == subfield or if `${field}.` INCLUDED in subfield\n * Example: \"profile\" and \"profile.firstName\" will be a matching field\n * @param field\n * @param subfield\n * @returns {boolean}\n */\nfunction matching(field, subfield) {\n    if (field === subfield) {\n        return true;\n    }\n\n    return subfield.slice(0, field.length + 1) === field + '.';\n}","export default function restrictLinks(parentNode, ...args) {\n    const restrictedLinks = getLinks(parentNode, ...args);\n\n    if (!restrictedLinks || restrictedLinks.length) {\n        return;\n    }\n\n    _.each(parentNode.collectionNodes, collectionNode => {\n        if (_.contains(restrictedLinks, collectionNode.linkName)) {\n            parentNode.remove(collectionNode);\n        }\n    });\n}\n\nexport function getLinks(node, ...args) {\n    if (node.collection && node.collection.__exposure) {\n        const exposure = node.collection.__exposure;\n\n        if (exposure.config.restrictLinks) {\n            const configRestrictLinks = exposure.config.restrictLinks;\n\n            if (_.isArray(configRestrictLinks)) {\n                return configRestrictLinks;\n            }\n\n            return configRestrictLinks(...args);\n        }\n    }\n}","import { Mongo } from 'meteor/mongo';\nimport astToQuery from './lib/astToQuery';\n\nexport { setAstToQueryDefaults } from './lib/defaults';\nexport { default as astToBody } from './lib/astToBody';\n\nObject.assign(Mongo.Collection.prototype, {\n  astToQuery,\n});\n\nexport { astToQuery };\n","export const Symbols = {\n  ARGUMENTS: Symbol('arguments'),\n};\n\nexport default function astToBody(ast) {\n  const fieldNodes = ast.fieldNodes;\n\n  const body = extractSelectionSet(ast.fieldNodes[0].selectionSet);\n\n  return body;\n}\n\nfunction extractSelectionSet(set) {\n  let body = {};\n  set.selections.forEach(el => {\n    if (!el.selectionSet) {\n      body[el.name.value] = 1;\n    } else {\n      body[el.name.value] = extractSelectionSet(el.selectionSet);\n      if (el.arguments.length) {\n        let argumentMap = {};\n        el.arguments.forEach(arg => {\n          argumentMap[arg.name.value] = arg.value.value;\n        });\n\n        body[el.name.value][Symbols.ARGUMENTS] = argumentMap;\n      }\n    }\n  });\n\n  return body;\n}\n","import { check, Match } from 'meteor/check';\nimport astToBody, { Symbols } from './astToBody';\nimport defaults from './defaults';\nimport intersectDeep from '../../query/lib/intersectDeep';\nimport enforceMaxLimit from '../../exposure/lib/enforceMaxLimit';\n\nconst Errors = {\n  MAX_DEPTH: 'The maximum depth of this request exceeds the depth allowed.',\n};\n\nexport default function astToQuery(ast, config = {}) {\n  const collection = this;\n\n  check(config, {\n    embody: Match.Maybe(Function),\n    $filters: Match.Maybe(Object),\n    $options: Match.Maybe(Object),\n    maxDepth: Match.Maybe(Number),\n    maxLimit: Match.Maybe(Number),\n    deny: Match.Maybe([String]),\n    intersect: Match.Maybe(Object),\n  });\n\n  config = Object.assign(\n    {\n      $options: {},\n      $filters: {},\n    },\n    defaults,\n    config\n  );\n\n  // get the body\n  let body = astToBody(ast);\n\n  // first we do the intersection\n  if (config.intersect) {\n    body = intersectDeep(config.intersect, body);\n  }\n\n  // enforce the maximum amount of data we allow to retrieve\n  if (config.maxLimit) {\n    enforceMaxLimit(config.$options, config.maxLimit);\n  }\n\n  // figure out depth based\n  if (config.maxDepth) {\n    const currentMaxDepth = getMaxDepth(body);\n    if (currentMaxDepth > config.maxDepth) {\n      throw Errors.MAX_DEPTH;\n    }\n  }\n\n  if (config.deny) {\n    deny(body, config.deny);\n  }\n\n  Object.assign(body, {\n    $filters: config.$filters,\n    $options: config.$options,\n  });\n\n  if (config.embody) {\n    const getArgs = createGetArgs(body);\n    config.embody.call(null, {\n      body,\n      getArgs,\n    });\n  }\n\n  // we return the query\n  return this.createQuery(body);\n}\n\nexport function getMaxDepth(body) {\n  let depths = [];\n  for (key in body) {\n    if (_.isObject(body[key])) {\n      depths.push(getMaxDepth(body[key]));\n    }\n  }\n\n  if (depths.length === 0) {\n    return 1;\n  }\n\n  return Math.max(...depths) + 1;\n}\n\nexport function deny(body, fields) {\n  fields.forEach(field => {\n    let parts = field.split('.');\n    let accessor = body;\n    while (parts.length != 0) {\n      if (parts.length === 1) {\n        delete accessor[parts[0]];\n      } else {\n        if (!_.isObject(accessor)) {\n          break;\n        }\n        accessor = accessor[parts[0]];\n      }\n      parts.shift();\n    }\n  });\n\n  return clearEmptyObjects(body);\n}\n\nexport function clearEmptyObjects(body) {\n  // clear empty nodes then back-propagate\n  for (let key in body) {\n    if (_.isObject(body[key])) {\n      const shouldDelete = clearEmptyObjects(body[key]);\n      if (shouldDelete) {\n        delete body[key];\n      }\n    }\n  }\n\n  return Object.keys(body).length === 0;\n}\n\nexport function createGetArgs(body) {\n  return function(path) {\n    const parts = path.split('.');\n    let stopped = false;\n    let accessor = body;\n    for (var i = 0; i < parts.length; i++) {\n      if (!accessor) {\n        stopped = true;\n        break;\n      }\n\n      if (accessor[parts[i]]) {\n        accessor = accessor[parts[i]];\n      }\n    }\n\n    if (stopped) {\n      return {};\n    }\n\n    if (accessor) {\n      return accessor[Symbols.ARGUMENTS] || {};\n    }\n  };\n}\n","let defaults = {};\n\nexport default defaults;\n\nexport function setAstToQueryDefaults(object) {\n  Object.assign(defaults, object);\n}\n","import {Match} from 'meteor/check';\nimport {Mongo} from 'meteor/mongo';\n\nexport const DenormalizeSchema = {\n    field: String,\n    body: Object,\n    bypassSchema: Match.Maybe(Boolean)\n};\n\nexport const LinkConfigDefaults = {\n    type: 'one',\n};\n\nexport const LinkConfigSchema = {\n    type: Match.Maybe(Match.OneOf('one', 'many', '1', '*')),\n    collection: Match.Maybe(\n        Match.Where(collection => {\n            // We do like this so it works with other types of collections \n            // like FS.Collection\n            return _.isObject(collection) && (\n                collection instanceof Mongo.Collection\n                || \n                !!collection._collection\n            );\n        })\n    ),\n    field: Match.Maybe(String),\n    metadata: Match.Maybe(Boolean),\n    inversedBy: Match.Maybe(String),\n    index: Match.Maybe(Boolean),\n    unique: Match.Maybe(Boolean),\n    autoremove: Match.Maybe(Boolean),\n    denormalize: Match.Maybe(Match.ObjectIncluding(DenormalizeSchema)),\n};","export const LINK_STORAGE = '__links';\n","import { Mongo } from 'meteor/mongo';\nimport { LINK_STORAGE } from './constants.js';\nimport Linker from './linker.js';\n\nObject.assign(Mongo.Collection.prototype, {\n    /**\n     * The data we add should be valid for config.schema.js\n     */\n    addLinks(data) {\n        if (!this[LINK_STORAGE]) {\n            this[LINK_STORAGE] = {};\n        }\n\n        _.each(data, (linkConfig, linkName) => {\n            if (this[LINK_STORAGE][linkName]) {\n                throw new Meteor.Error(\n                    `You cannot add the link with name: ${linkName} because it was already added to ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            const linker = new Linker(this, linkName, linkConfig);\n\n            _.extend(this[LINK_STORAGE], {\n                [linkName]: linker,\n            });\n        });\n    },\n\n    getLinks() {\n        return this[LINK_STORAGE];\n    },\n\n    getLinker(name) {\n        if (this[LINK_STORAGE]) {\n            return this[LINK_STORAGE][name];\n        }\n    },\n\n    hasLink(name) {\n        if (!this[LINK_STORAGE]) {\n            return false;\n        }\n\n        return !!this[LINK_STORAGE][name];\n    },\n\n    getLink(objectOrId, name) {\n        let linkData = this[LINK_STORAGE];\n\n        if (!linkData) {\n            throw new Meteor.Error(\n                `There are no links defined for collection: ${this._name}`\n            );\n        }\n\n        if (!linkData[name]) {\n            throw new Meteor.Error(\n                `There is no link ${name} for collection: ${this._name}`\n            );\n        }\n\n        const linker = linkData[name];\n        let object = objectOrId;\n        if (typeof objectOrId == 'string') {\n            if (!linker.isVirtual()) {\n                object = this.findOne(objectOrId, {\n                    fields: {\n                        [linker.linkStorageField]: 1,\n                    },\n                });\n            } else {\n                object = { _id: objectOrId };\n            }\n\n            if (!object) {\n                throw new Meteor.Error(\n                    `We could not find any object with _id: \"${objectOrId}\" within the collection: ${\n                        this._name\n                    }`\n                );\n            }\n        }\n\n        return linkData[name].createLink(object);\n    },\n});\n","import LinkMany from './linkTypes/linkMany.js';\nimport LinkManyMeta from './linkTypes/linkManyMeta.js';\nimport LinkOne from './linkTypes/linkOne.js';\nimport LinkOneMeta from './linkTypes/linkOneMeta.js';\nimport { LinkConfigSchema, LinkConfigDefaults } from './config.schema.js';\nimport smartArguments from './linkTypes/lib/smartArguments';\nimport dot from 'dot-object';\nimport { check } from 'meteor/check';\nimport { _ } from 'meteor/underscore';\nimport { access } from 'fs';\n\nexport default class Linker {\n    /**\n     * @param mainCollection\n     * @param linkName\n     * @param linkConfig\n     */\n    constructor(mainCollection, linkName, linkConfig) {\n        this.mainCollection = mainCollection;\n        this.linkConfig = Object.assign({}, LinkConfigDefaults, linkConfig);\n        this.linkName = linkName;\n\n        // check linkName must not exist in schema\n        this._validateAndClean();\n\n        // initialize cascade removal hooks.\n        this._initAutoremove();\n        this._initDenormalization();\n\n        if (this.isVirtual()) {\n            // if it's a virtual field make sure that when this is deleted, it will be removed from the references\n            if (!linkConfig.autoremove) {\n                this._handleReferenceRemovalForVirtualLinks();\n            }\n        } else {\n            this._initIndex();\n        }\n    }\n\n    /**\n     * Values which represent for the relation a single link\n     * @returns {string[]}\n     */\n    get oneTypes() {\n        return ['one', '1'];\n    }\n\n    /**\n     * Returns the strategies: one, many, one-meta, many-meta\n     * @returns {string}\n     */\n    get strategy() {\n        let strategy = this.isMany() ? 'many' : 'one';\n        if (this.linkConfig.metadata) {\n            strategy += '-meta';\n        }\n\n        return strategy;\n    }\n\n    /**\n     * Returns the field name in the document where the actual relationships are stored.\n     * @returns string\n     */\n    get linkStorageField() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.linkStorageField;\n        }\n\n        return this.linkConfig.field;\n    }\n\n    /**\n     * The collection that is linked with the current collection\n     * @returns Mongo.Collection\n     */\n    getLinkedCollection() {\n        return this.linkConfig.collection;\n    }\n\n    /**\n     * If the relationship for this link is of \"many\" type.\n     */\n    isMany() {\n        return !this.isSingle();\n    }\n\n    /**\n     * If the relationship for this link contains metadata\n     */\n    isMeta() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.isMeta();\n        }\n\n        return !!this.linkConfig.metadata;\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    isSingle() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.isSingle();\n        }\n\n        return _.contains(this.oneTypes, this.linkConfig.type);\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    isVirtual() {\n        return !!this.linkConfig.inversedBy;\n    }\n\n    /**\n     * Should return a single result.\n     */\n    isOneResult() {\n        return (\n            (this.isVirtual() &&\n                this.linkConfig.relatedLinker.linkConfig.unique) ||\n            (!this.isVirtual() && this.isSingle())\n        );\n    }\n\n    /**\n     * @param object\n     * @param collection To impersonate the getLinkedCollection() of the \"Linker\"\n     *\n     * @returns {LinkOne|LinkMany|LinkManyMeta|LinkOneMeta|LinkResolve}\n     */\n    createLink(object, collection = null) {\n        let helperClass = this._getHelperClass();\n\n        return new helperClass(this, object, collection);\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _validateAndClean() {\n        if (!this.linkConfig.collection) {\n            throw new Meteor.Error(\n                'invalid-config',\n                `For the link ${\n                    this.linkName\n                } you did not provide a collection.`\n            );\n        }\n\n        if (typeof this.linkConfig.collection === 'string') {\n            const collectionName = this.linkConfig.collection;\n            this.linkConfig.collection = Mongo.Collection.get(collectionName);\n\n            if (!this.linkConfig.collection) {\n                throw new Meteor.Error(\n                    'invalid-collection',\n                    `Could not find a collection with the name: ${collectionName}`\n                );\n            }\n        }\n\n        if (this.isVirtual()) {\n            return this._prepareVirtual();\n        } else {\n            if (!this.linkConfig.type) {\n                this.linkConfig.type = 'one';\n            }\n\n            if (!this.linkConfig.field) {\n                this.linkConfig.field = this._generateFieldName();\n            } else {\n                if (this.linkConfig.field == this.linkName) {\n                    throw new Meteor.Error(\n                        'invalid-config',\n                        `For the link ${\n                            this.linkName\n                        } you must not use the same name for the field, otherwise it will cause conflicts when fetching data`\n                    );\n                }\n            }\n        }\n\n        check(this.linkConfig, LinkConfigSchema);\n    }\n\n    /**\n     * We need to apply same type of rules in this case.\n     * @private\n     */\n    _prepareVirtual() {\n        const { collection, inversedBy } = this.linkConfig;\n        let linker = collection.getLinker(inversedBy);\n\n        if (!linker) {\n            // it is possible that the collection doesn't have a linker created yet.\n            // so we will create it on startup after all links have been defined\n            Meteor.startup(() => {\n                linker = collection.getLinker(inversedBy);\n                if (!linker) {\n                    throw new Meteor.Error(\n                        `You tried setting up an inversed link in \"${\n                            this.mainCollection._name\n                        }\" pointing to collection: \"${\n                            collection._name\n                        }\" link: \"${inversedBy}\", but no such link was found. Maybe a typo ?`\n                    );\n                } else {\n                    this._setupVirtualConfig(linker);\n                }\n            });\n        } else {\n            this._setupVirtualConfig(linker);\n        }\n    }\n\n    /**\n     * @param linker\n     * @private\n     */\n    _setupVirtualConfig(linker) {\n        const virtualLinkConfig = linker.linkConfig;\n\n        if (!virtualLinkConfig) {\n            throw new Meteor.Error(\n                `There is no link-config for the related collection on ${inversedBy}. Make sure you added the direct links before specifying virtual ones.`\n            );\n        }\n\n        _.extend(this.linkConfig, {\n            metadata: virtualLinkConfig.metadata,\n            relatedLinker: linker,\n        });\n    }\n\n    /**\n     * Depending on the strategy, we create the proper helper class\n     * @private\n     */\n    _getHelperClass() {\n        switch (this.strategy) {\n            case 'many-meta':\n                return LinkManyMeta;\n            case 'many':\n                return LinkMany;\n            case 'one-meta':\n                return LinkOneMeta;\n            case 'one':\n                return LinkOne;\n        }\n\n        throw new Meteor.Error(\n            'invalid-strategy',\n            `${this.strategy} is not a valid strategy`\n        );\n    }\n\n    /**\n     * If field name not present, we generate it.\n     * @private\n     */\n    _generateFieldName() {\n        let cleanedCollectionName = this.linkConfig.collection._name.replace(\n            /\\./g,\n            '_'\n        );\n        let defaultFieldPrefix = this.linkName + '_' + cleanedCollectionName;\n\n        switch (this.strategy) {\n            case 'many-meta':\n                return `${defaultFieldPrefix}_metas`;\n            case 'many':\n                return `${defaultFieldPrefix}_ids`;\n            case 'one-meta':\n                return `${defaultFieldPrefix}_meta`;\n            case 'one':\n                return `${defaultFieldPrefix}_id`;\n        }\n    }\n\n    /**\n     * When a link that is declared virtual is removed, the reference will be removed from every other link.\n     * @private\n     */\n    _handleReferenceRemovalForVirtualLinks() {\n        this.mainCollection.after.remove((userId, doc) => {\n            // this problem may occur when you do a .remove() before Meteor.startup()\n            if (!this.linkConfig.relatedLinker) {\n                console.warn(\n                    `There was an error finding the link for removal for collection: \"${\n                        this.mainCollection._name\n                    }\" with link: \"${\n                        this.linkName\n                    }\". This may occur when you do a .remove() before Meteor.startup()`\n                );\n                return;\n            }\n\n            const accessor = this.createLink(doc);\n\n            _.each(accessor.fetchAsArray(), linkedObj => {\n                const { relatedLinker } = this.linkConfig;\n                // We do this check, to avoid self-referencing hell when defining virtual links\n                // Virtual links if not found \"compile-time\", we will try again to reprocess them on Meteor.startup\n                // if a removal happens before Meteor.startup this may fail\n                if (relatedLinker) {\n                    let link = relatedLinker.createLink(linkedObj);\n\n                    if (relatedLinker.isSingle()) {\n                        link.unset();\n                    } else {\n                        link.remove(doc);\n                    }\n                }\n            });\n        });\n    }\n\n    _initIndex() {\n        if (Meteor.isServer) {\n            let field = this.linkConfig.field;\n            if (this.linkConfig.metadata) {\n                field = field + '._id';\n            }\n\n            if (this.linkConfig.index) {\n                if (this.isVirtual()) {\n                    throw new Meteor.Error(\n                        'You cannot set index on an inversed link.'\n                    );\n                }\n\n                let options;\n                if (this.linkConfig.unique) {\n                    options = { unique: true };\n                }\n\n                this.mainCollection._ensureIndex({ [field]: 1 }, options);\n            } else {\n                if (this.linkConfig.unique) {\n                    if (this.isVirtual()) {\n                        throw new Meteor.Error(\n                            'You cannot set unique property on an inversed link.'\n                        );\n                    }\n\n                    this.mainCollection._ensureIndex(\n                        {\n                            [field]: 1,\n                        },\n                        { unique: true, sparse: true }\n                    );\n                }\n            }\n        }\n    }\n\n    _initAutoremove() {\n        if (!this.linkConfig.autoremove) {\n            return;\n        }\n\n        if (!this.isVirtual()) {\n            this.mainCollection.after.remove((userId, doc) => {\n                this.getLinkedCollection().remove({\n                    _id: {\n                        $in: smartArguments.getIds(doc[this.linkStorageField]),\n                    },\n                });\n            });\n        } else {\n            this.mainCollection.after.remove((userId, doc) => {\n                const linker = this.mainCollection.getLink(doc, this.linkName);\n                const ids = linker\n                    .find({}, { fields: { _id: 1 } })\n                    .fetch()\n                    .map(item => item._id);\n\n                this.getLinkedCollection().remove({\n                    _id: { $in: ids },\n                });\n            });\n        }\n    }\n\n    /**\n     * Initializes denormalization using herteby:denormalize\n     * @private\n     */\n    _initDenormalization() {\n        if (!this.linkConfig.denormalize || !Meteor.isServer) {\n            return;\n        }\n\n        const packageExists = !!Package['herteby:denormalize'];\n        if (!packageExists) {\n            throw new Meteor.Error(\n                'missing-package',\n                `Please add the herteby:denormalize package to your Meteor application in order to make caching work`\n            );\n        }\n\n        const { field, body, bypassSchema } = this.linkConfig.denormalize;\n        let cacheConfig;\n\n        let referenceFieldSuffix = '';\n        if (this.isMeta()) {\n            referenceFieldSuffix = this.isSingle() ? '._id' : ':_id';\n        }\n\n        if (this.isVirtual()) {\n            let inversedLink = this.linkConfig.relatedLinker.linkConfig;\n\n            let type =\n                inversedLink.type == 'many' ? 'many-inverse' : 'inversed';\n\n            cacheConfig = {\n                type: type,\n                collection: this.linkConfig.collection,\n                fields: body,\n                referenceField: inversedLink.field + referenceFieldSuffix,\n                cacheField: field,\n                bypassSchema: !!bypassSchema,\n            };\n        } else {\n            cacheConfig = {\n                type: this.linkConfig.type,\n                collection: this.linkConfig.collection,\n                fields: body,\n                referenceField: this.linkConfig.field + referenceFieldSuffix,\n                cacheField: field,\n                bypassSchema: !!bypassSchema,\n            };\n        }\n\n        if (this.isVirtual()) {\n            Meteor.startup(() => {\n                this.mainCollection.cache(cacheConfig);\n            });\n        } else {\n            this.mainCollection.cache(cacheConfig);\n        }\n    }\n\n    /**\n     * Verifies if this linker is denormalized. It can be denormalized from the inverse side as well.\n     *\n     * @returns {boolean}\n     * @private\n     */\n    isDenormalized() {\n        return !!this.linkConfig.denormalize;\n    }\n\n    /**\n     * Verifies if the body of the linked element does not contain fields outside the cache body\n     *\n     * @param body\n     * @returns {boolean}\n     * @private\n     */\n    isSubBodyDenormalized(body) {\n        const cacheBody = this.linkConfig.denormalize.body;\n\n        const cacheBodyFields = _.keys(dot.dot(cacheBody));\n        const bodyFields = _.keys(dot.dot(_.omit(body, '_id')));\n\n        return _.difference(bodyFields, cacheBodyFields).length === 0;\n    }\n}\n","import sift from 'sift';\n\nexport default function createSearchFilters(object, fieldStorage, strategy, isVirtual, metaFilters) {\n    if (!isVirtual) {\n        switch (strategy) {\n            case 'one': return createOne(object, fieldStorage);\n            case 'one-meta': return createOneMeta(object, fieldStorage, metaFilters);\n            case 'many': return createMany(object, fieldStorage);\n            case 'many-meta': return createManyMeta(object, fieldStorage, metaFilters);\n            default:\n                throw new Meteor.Error(`Invalid linking strategy: ${strategy}`)\n        }\n    } else {\n        switch (strategy) {\n            case 'one': return createOneVirtual(object, fieldStorage);\n            case 'one-meta': return createOneMetaVirtual(object, fieldStorage, metaFilters);\n            case 'many': return createManyVirtual(object, fieldStorage);\n            case 'many-meta': return createManyMetaVirtual(object, fieldStorage, metaFilters);\n            default:\n                throw new Meteor.Error(`Invalid linking strategy: ${strategy}`)\n        }\n    }\n}\n\nexport function createOne(object, fieldStorage) {\n    return {\n        _id: object[fieldStorage]\n    };\n}\n\nexport function createOneVirtual(object, fieldStorage) {\n    return {\n        [fieldStorage]: object._id\n    };\n}\n\nexport function createOneMeta(object, fieldStorage, metaFilters) {\n    const value = object[fieldStorage];\n\n    if (metaFilters) {\n        if (!sift(metaFilters)(value)) {\n            return {_id: undefined};\n        }\n    }\n\n    return {\n        _id: value ? value._id : value\n    };\n}\n\nexport function createOneMetaVirtual(object, fieldStorage, metaFilters) {\n    let filters = {};\n    if (metaFilters) {\n        _.each(metaFilters, (value, key) => {\n            filters[fieldStorage + '.' + key] = value;\n        })\n    }\n\n    filters[fieldStorage + '._id'] = object._id;\n\n    return filters;\n}\n\nexport function createMany(object, fieldStorage) {\n    return {\n        _id: {\n            $in: object[fieldStorage] || []\n        }\n    };\n}\n\nexport function createManyVirtual(object, fieldStorage) {\n    return {\n        [fieldStorage]: object._id\n    };\n}\n\nexport function createManyMeta(object, fieldStorage, metaFilters) {\n    let value = object[fieldStorage];\n\n    if (metaFilters) {\n        value = sift(metaFilters, value)\n    }\n\n    return {\n        _id: {\n            $in: _.pluck(value, '_id') || []\n        }\n    };\n}\n\nexport function createManyMetaVirtual(object, fieldStorage, metaFilters) {\n    let filters = {};\n    if (metaFilters) {\n        _.each(metaFilters, (value, key) => {\n            filters[key] = value;\n        })\n    }\n\n    filters._id = object._id;\n\n    return {\n        [fieldStorage]: {$elemMatch: filters}\n    };\n}","import SmartArgs from './lib/smartArguments.js';\nimport createSearchFilters from '../lib/createSearchFilters';\n\nexport default class Link {\n    get config() { return this.linker.linkConfig; }\n\n    get isVirtual() { return this.linker.isVirtual() }\n\n    constructor(linker, object, collection) {\n        this.linker = linker;\n        this.object = object;\n        this.linkedCollection = (collection) ? collection : linker.getLinkedCollection();\n\n        if (this.linker.isVirtual()) {\n            this.linkStorageField = this.config.relatedLinker.linkConfig.field;\n        } else {\n            this.linkStorageField = this.config.field;\n        }\n    }\n\n    /**\n     * Gets the stored link information value\n     * @returns {*}\n     */\n    value() {\n        if (this.isVirtual) {\n            throw new Meteor.Error('You can only take the value from the main link.');\n        }\n\n        return this.object[this.linkStorageField];\n    }\n\n    /**\n     * Finds linked data.\n     *\n     * @param filters\n     * @param options\n     * @returns {*}\n     * @param userId\n     */\n    find(filters = {}, options = {}, userId = undefined) {\n        let linker = this.linker;\n        const linkedCollection = this.linkedCollection;\n\n        let $metaFilters;\n        if (filters.$meta) {\n            $metaFilters = filters.$meta;\n            delete filters.$meta;\n        }\n\n        const searchFilters = createSearchFilters(\n            this.object,\n            this.linkStorageField,\n            linker.strategy,\n            linker.isVirtual(),\n            $metaFilters\n        );\n\n        let appliedFilters = _.extend({}, filters, searchFilters);\n\n        // see https://github.com/cult-of-coders/grapher/issues/134\n        // happens due to recursive importing of modules\n        // TODO: find another way to do this\n        if (linkedCollection.find) {\n            return linkedCollection.find(appliedFilters, options, userId)\n        } else {\n            return linkedCollection.default.find(appliedFilters, options, userId);\n        }\n    }\n\n    /**\n     * @param filters\n     * @param options\n     * @param others\n     * @returns {*|{content}|any}\n     */\n    fetch(filters, options, ...others) {\n        let result = this.find(filters, options, ...others).fetch();\n\n        if (this.linker.isOneResult()) {\n            return _.first(result);\n        }\n\n        return result;\n    }\n\n    /**\n     * This is just like fetch() but forces to get an array even if it's single result\n     * \n     * @param {*} filters \n     * @param {*} options \n     * @param  {...any} others \n     */\n    fetchAsArray(filters, options, ...others) {\n        return this.find(filters, options, ...others).fetch()\n    }\n\n    /**\n     * When we are dealing with multiple type relationships, $in would require an array. If the field value is null, it will fail\n     * We use clean to make it an empty array by default.\n     */\n    clean() {}\n\n    /**\n     * Extracts a single id\n     */\n    identifyId(what, saveToDatabase) {\n        return SmartArgs.getId(what, {\n            saveToDatabase,\n            collection: this.linkedCollection\n        });\n    }\n\n    /**\n     * Extracts the ids of object(s) or strings and returns an array.\n     */\n    identifyIds(what, saveToDatabase) {\n        return SmartArgs.getIds(what, {\n            saveToDatabase,\n            collection: this.linkedCollection\n        });\n    }\n\n    /**\n     * Checks when linking data, if the ids are valid with the linked collection.\n     * @throws Meteor.Error\n     * @param ids\n     *\n     * @protected\n     */\n    _validateIds(ids) {\n        if (!_.isArray(ids)) {\n            ids = [ids];\n        }\n\n        const validIds = this.linkedCollection.find({\n            _id: {$in: ids}\n        }, {fields: {_id: 1}}).fetch().map(doc => doc._id);\n\n        if (validIds.length != ids.length) {\n            throw new Meteor.Error('not-found', `You tried to create links with non-existing id(s) inside \"${this.linkedCollection._name}\": ${_.difference(ids, validIds).join(', ')}`)\n        }\n    }\n\n    /**\n     * This is for allowing commands such as set/unset/add/remove/metadata from the virtual link.\n     *\n     * @param action\n     * @param what\n     * @param metadata\n     *\n     * @protected\n     */\n    _virtualAction(action, what, metadata) {\n        const linker = this.linker.linkConfig.relatedLinker;\n\n        // its an unset operation most likely.\n        if (what === undefined) {\n            const reversedLink = linker.createLink(this.fetch());\n            reversedLink.unset();\n\n            return;\n        }\n\n        if (!_.isArray(what)) {\n            what = [what];\n        }\n\n        what = _.map(what, element => {\n            if (!_.isObject(element)) {\n                return linker.mainCollection.findOne(element);\n            } else {\n                if (!element._id) {\n                    const elementId = linker.mainCollection.insert(element);\n                    _.extend(element, linker.mainCollection.findOne(elementId));\n                }\n\n                return element;\n            }\n        });\n\n        return _.map(what, element => {\n            const reversedLink = linker.createLink(element);\n\n            if (action == 'metadata') {\n                if (linker.isSingle()) {\n                    return reversedLink.metadata(metadata);\n                } else {\n                    return reversedLink.metadata(this.object, metadata);\n                }\n            } else if (action == 'add' || action == 'set') {\n                if (linker.isSingle()) {\n                    reversedLink.set(this.object, metadata);\n                } else {\n                    reversedLink.add(this.object, metadata);\n                }\n            } else {\n                if (linker.isSingle()) {\n                    reversedLink.unset();\n                } else {\n                    reversedLink.remove(this.object);\n                }\n            }\n        });\n    }\n}\n","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkMany extends Link {\n    clean() {\n        if (!this.object[this.linkStorageField]) {\n            this.object[this.linkStorageField] = [];\n        }\n    }\n\n    /**\n     * Ads the _ids to the object.\n     * @param what\n     */\n    add(what) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what);\n            return this;\n        }\n\n        //if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/remove operations must be done from the owning-link of the relationship');\n\n        this.clean();\n\n        const _ids = this.identifyIds(what, true);\n        this._validateIds(_ids);\n\n        const field = this.linkStorageField;\n\n        // update the field\n        this.object[field] = _.union(this.object[field], _ids);\n\n        // update the db\n        let modifier = {\n            $addToSet: {\n                [field]: {$each: _ids}\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    /**\n     * @param what\n     */\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/Remove operations should be done from the owner of the relationship');\n\n        this.clean();\n        const field = this.linkStorageField;\n\n        const _ids = this.identifyIds(what);\n\n        // update the field\n        this.object[field] = _.filter(this.object[field], _id => !_.contains(_ids, _id));\n\n        // update the db\n        let modifier = {\n            $pullAll: {\n                [field]: _ids\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    set(what) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    unset(what) {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkManyMeta extends Link {\n    clean() {\n        if (!this.object[this.linkStorageField]) {\n            this.object[this.linkStorageField] = [];\n        }\n    }\n\n    /**\n     * @param what\n     * @param metadata\n     */\n    add(what, metadata = {}) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what, metadata);\n            return this;\n        }\n\n        const _ids = this.identifyIds(what, true);\n        this._validateIds(_ids);\n\n        let field = this.linkStorageField;\n\n        this.object[field] = this.object[field] || [];\n        let metadatas = [];\n\n        _.each(_ids, _id => {\n            let localMetadata = _.clone(metadata);\n            localMetadata._id = _id;\n\n            this.object[field].push(localMetadata);\n            metadatas.push(localMetadata);\n        });\n\n        let modifier = {\n            $addToSet: {\n                [field]: {$each: metadatas}\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    /**\n     * @param what\n     * @param extendMetadata\n     */\n    metadata(what, extendMetadata) {\n        if (this.isVirtual) {\n            this._virtualAction('metadata', what, extendMetadata);\n\n            return this;\n        }\n\n        let field = this.linkStorageField;\n\n        if (what === undefined) {\n            return this.object[field];\n        }\n\n        if (_.isArray(what)) {\n            throw new Meteor.Error('not-allowed', 'Metadata updates should be made for one entity only, not multiple');\n        }\n\n        const _id = this.identifyId(what);\n\n        let existingMetadata = _.find(this.object[field], metadata => metadata._id == _id);\n        if (extendMetadata === undefined) {\n            return existingMetadata;\n        } else {\n            _.extend(existingMetadata, extendMetadata);\n            let subfield = field + '._id';\n            let subfieldUpdate = field + '.$';\n\n            this.linker.mainCollection.update({\n                _id: this.object._id,\n                [subfield]: _id\n            }, {\n               $set: {\n                   [subfieldUpdate]: existingMetadata\n               }\n            });\n        }\n\n        return this;\n    }\n\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        const _ids = this.identifyIds(what);\n        let field = this.linkStorageField;\n\n        this.object[field] = _.filter(this.object[field], link => !_.contains(_ids, link._id));\n\n        let modifier = {\n            $pull: {\n                [field]: {\n                    _id: {\n                        $in: _ids\n                    }\n                }\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    set(what, metadata) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what, metadata);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    unset(what) {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkOne extends Link {\n    set(what) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        const _id = this.identifyId(what, true);\n        this._validateIds([_id]);\n\n        this.object[field] = _id;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: _id\n            }\n        });\n\n        return this;\n    }\n\n    unset() {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        this.object[field] = null;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: null\n            }\n        });\n\n        return this;\n    }\n\n    add(what) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkOneMeta extends Link {\n    set(what, metadata = {}) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        metadata._id = this.identifyId(what, true);\n        this._validateIds([metadata._id]);\n\n        this.object[field] = metadata;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: metadata\n            }\n        });\n\n        return this;\n    }\n\n    metadata(extendMetadata) {\n        if (this.isVirtual) {\n            this._virtualAction('metadata', undefined, extendMetadata);\n\n            return this;\n        }\n\n        let field = this.linkStorageField;\n\n        if (!extendMetadata) {\n            return this.object[field];\n        } else {\n            _.extend(this.object[field], extendMetadata);\n\n            this.linker.mainCollection.update(this.object._id, {\n                $set: {\n                    [field]: this.object[field]\n                }\n            });\n        }\n\n        return this;\n    }\n\n    unset() {\n        if (this.isVirtual) {\n            this._virtualAction('unset');\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        this.object[field] = {};\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: {}\n            }\n        });\n\n        return this;\n    }\n\n    add(what, metadata) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what, metadata);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n}","/**\n * When you work with add/remove set/unset\n * You have the ability to pass strings, array of strings, objects, array of objects\n * If you are adding something and you want to save them in db, you can pass objects without ids.\n */\nexport default new class {\n    getIds(what, options) {\n        if (_.isArray(what)) {\n            return _.map(what, (subWhat) => {\n                return this.getId(subWhat, options)\n            })\n        } else {\n            return [this.getId(what, options)];\n        }\n\n        throw new Meteor.Error('invalid-type', `Unrecognized type: ${typeof what} for managing links`);\n    }\n\n    getId(what, options) {\n        if (typeof what === 'string') {\n            return what;\n        }\n\n        if (typeof what === 'object') {\n            if (!what._id && options.saveToDatabase) {\n                what._id = options.collection.insert(what);\n            }\n\n            return what._id\n        }\n    }\n}","import deepClone from 'lodash.clonedeep';\n\nexport default class NamedQueryBase {\n    isNamedQuery = true;\n\n    constructor(name, collection, body, options = {}) {\n        this.queryName = name;\n\n        if (_.isFunction(body)) {\n            this.resolver = body;\n        } else {\n            this.body = deepClone(body);\n        }\n\n        this.subscriptionHandle = null;\n        this.params = options.params || {};\n        this.options = options;\n        this.collection = collection;\n        this.isExposed = false;\n    }\n\n    get name() {\n        return `named_query_${this.queryName}`;\n    }\n\n    get isResolver() {\n        return !!this.resolver;\n    }\n\n    setParams(params) {\n        this.params = _.extend({}, this.params, params);\n\n        return this;\n    }\n\n    /**\n     * Validates the parameters\n     */\n    doValidateParams(params) {\n        params = params || this.params;\n\n        const {validateParams} = this.options;\n        if (!validateParams) return;\n\n        try {\n            this._validate(validateParams, params);\n        } catch (validationError) {\n            console.error(`Invalid parameters supplied to the query \"${this.queryName}\"\\n`, validationError);\n            throw validationError; // rethrow\n        }\n    }\n\n    clone(newParams) {\n        const params = _.extend({}, deepClone(this.params), newParams);\n\n        let clone = new this.constructor(\n            this.queryName,\n            this.collection,\n            this.isResolver ? this.resolver : deepClone(this.body),\n            {\n                ...this.options,\n                params,\n            }\n        );\n\n        clone.cacher = this.cacher;\n        if (this.exposeConfig) {\n            clone.exposeConfig = this.exposeConfig;\n        }\n\n        return clone;\n    }\n\n    /**\n     * @param {function|object} validator\n     * @param {object} params\n     * @private\n     */\n    _validate(validator, params) {\n        if (_.isFunction(validator)) {\n            validator.call(null, params)\n        } else {\n            check(params, validator)\n        }\n    }\n}","import CountSubscription from '../query/counts/countSubscription';\nimport createGraph from '../query/lib/createGraph.js';\nimport recursiveFetch from '../query/lib/recursiveFetch.js';\nimport prepareForProcess from '../query/lib/prepareForProcess.js';\nimport {_} from 'meteor/underscore';\nimport callWithPromise from '../query/lib/callWithPromise';\nimport Base from './namedQuery.base';\nimport {LocalCollection} from 'meteor/minimongo';\nimport intersectDeep from '../query/lib/intersectDeep';\n\nexport default class extends Base {\n    /**\n     * Subscribe\n     *\n     * @param callback\n     * @returns {null|any|*}\n     */\n    subscribe(callback) {\n        if (this.isResolver) {\n            throw new Meteor.Error('not-allowed', `You cannot subscribe to a resolver query`);\n        }\n\n        this.subscriptionHandle = Meteor.subscribe(\n            this.name,\n            this.params,\n            callback\n        );\n\n        return this.subscriptionHandle;\n    }\n\n    /**\n     * Subscribe to the counts for this query\n     *\n     * @param callback\n     * @returns {Object}\n     */\n    subscribeCount(callback) {\n        if (this.isResolver) {\n            throw new Meteor.Error('not-allowed', `You cannot subscribe to a resolver query`);\n        }\n\n        if (!this._counter) {\n            this._counter = new CountSubscription(this);\n        }\n\n        return this._counter.subscribe(this.params, callback);\n    }\n\n    /**\n     * Unsubscribe if an existing subscription exists\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.subscriptionHandle.stop();\n        }\n\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Unsubscribe to the counts if a subscription exists.\n     */\n    unsubscribeCount() {\n        if (this._counter) {\n            this._counter.unsubscribe();\n            this._counter = null;\n        }\n    }\n\n    /**\n     * Fetches elements in sync using promises\n     * @return {*}\n     */\n    async fetchSync() {\n        if (this.subscriptionHandle) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name, this.params);\n    }\n\n    /**\n     * Fetches one element in sync\n     * @return {*}\n     */\n    async fetchOneSync() {\n        return _.first(await this.fetchSync())\n    }\n\n    /**\n     * Retrieves the data.\n     * @param callbackOrOptions\n     * @returns {*}\n     */\n    fetch(callbackOrOptions) {\n        if (!this.subscriptionHandle) {\n            return this._fetchStatic(callbackOrOptions)\n        } else {\n            return this._fetchReactive(callbackOrOptions);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        if (!this.subscriptionHandle) {\n            const callback = args[0];\n            if (!_.isFunction(callback)) {\n                throw new Meteor.Error('You did not provide a valid callback');\n            }\n\n            this.fetch((err, res) => {\n                callback(err, res ? _.first(res) : null);\n            })\n        } else {\n            return _.first(this.fetch(...args));\n        }\n    }\n\n    /**\n     * Gets the count of matching elements in sync.\n     * @returns {any}\n     */\n    async getCountSync() {\n        if (this._counter) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name + '.count', this.params);\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @param callback\n     * @returns {any}\n     */\n    getCount(callback) {\n        if (this._counter) {\n            return this._counter.getCount();\n        } else {\n            if (!callback) {\n                throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n            } else {\n                return Meteor.call(this.name + '.count', this.params, callback);\n            }\n        }\n    }\n\n    /**\n     * Fetching non-reactive queries\n     * @param callback\n     * @private\n     */\n    _fetchStatic(callback) {\n        if (!callback) {\n            throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n        }\n\n        Meteor.call(this.name, this.params, callback);\n    }\n\n    /**\n     * Fetching when we've got an active publication\n     *\n     * @param options\n     * @returns {*}\n     * @private\n     */\n    _fetchReactive(options = {}) {\n        let body = this.body;\n        if (this.params.$body) {\n            body = intersectDeep(body, this.params.$body);\n        }\n\n        body = prepareForProcess(body, this.params);\n        if (!options.allowSkip && body.$options && body.$options.skip) {\n            delete body.$options.skip;\n        }\n\n        return recursiveFetch(\n            createGraph(this.collection, body),\n            undefined, {\n                scoped: this.options.scoped,\n                subscriptionHandle: this.subscriptionHandle\n            });\n    }\n}\n","import NamedQueryClient from './namedQuery.client';\nimport NamedQueryServer from './namedQuery.server';\n\nlet NamedQuery;\n\nif (Meteor.isServer) {\n    NamedQuery = NamedQueryServer;\n} else {\n    NamedQuery = NamedQueryClient;\n}\n\nexport default NamedQuery;","import prepareForProcess from '../query/lib/prepareForProcess.js';\nimport Base from './namedQuery.base';\nimport deepClone from 'lodash.clonedeep';\nimport MemoryResultCacher from './cache/MemoryResultCacher';\nimport intersectDeep from '../query/lib/intersectDeep';\n\nexport default class extends Base {\n    /**\n     * Retrieves the data.\n     * @returns {*}\n     */\n    fetch(context) {\n        this._performSecurityChecks(context, this.params);\n\n        if (this.isResolver) {\n            return this._fetchResolverData(context);\n        } else {\n            body = deepClone(this.body);\n            if (this.params.$body) {\n                body = intersectDeep(body, this.params.$body);\n            }\n            \n            // we must apply emobdyment here\n            this.doEmbodimentIfItApplies(body);\n\n            const query = this.collection.createQuery(\n                deepClone(body),\n                {\n                    params: deepClone(this.params)\n                }\n            );\n\n            if (this.cacher) {\n                const cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n                return this.cacher.fetch(cacheId, {query});\n            }\n\n            return query.fetch();\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        return _.first(this.fetch(...args));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     *\n     * @returns {any}\n     */\n    getCount(context) {\n        this._performSecurityChecks(context, this.params);\n\n        const countCursor = this.getCursorForCounting();\n\n        if (this.cacher) {\n            const cacheId = 'count::' + this.cacher.generateQueryId(this.queryName, this.params);\n\n            return this.cacher.fetch(cacheId, {countCursor});\n        }\n\n        return countCursor.count();\n    }\n\n    /**\n     * Returns the cursor for counting\n     * This is most likely used for counts cursor\n     */\n    getCursorForCounting() {\n        let body = deepClone(this.body);\n        this.doEmbodimentIfItApplies(body);\n        body = prepareForProcess(body, this.params);\n\n        return this.collection.find(body.$filters || {}, {fields: {_id: 1}});\n    }\n\n    /**\n     * @param cacher\n     */\n    cacheResults(cacher) {\n        if (!cacher) {\n            cacher = new MemoryResultCacher();\n        }\n\n        this.cacher = cacher;\n    }\n\n    /**\n     * Configure resolve. This doesn't actually call the resolver, it just sets it\n     * @param fn\n     */\n    resolve(fn) {\n        if (!this.isResolver) {\n            throw new Meteor.Error('invalid-call', `You cannot use resolve() on a non resolver NamedQuery`);\n        }\n\n        this.resolver = fn;\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _fetchResolverData(context) {\n        const resolver = this.resolver;\n        const self = this;\n        const query = {\n            fetch() {\n                return resolver.call(context, self.params);\n            }\n        };\n\n        if (this.cacher) {\n            const cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n            return this.cacher.fetch(cacheId, {query});\n        }\n\n        return query.fetch();\n    }\n\n    /**\n     * @param context Meteor method/publish context\n     * @param params\n     *\n     * @private\n     */\n    _performSecurityChecks(context, params) {\n        if (context && this.exposeConfig) {\n            this._callFirewall(context, context.userId, params);\n        }\n\n        this.doValidateParams(params);\n    }\n}","export default new class {\n    constructor() {\n        this.storage = {};\n    }\n\n    add(key, value) {\n        if (this.storage[key]) {\n            throw new Meteor.Error('invalid-name', `You have previously defined another namedQuery with the same name: \"${key}\". Named Query names should be unique.`);\n        }\n\n        this.storage[key] = value;\n    }\n\n    get(key) {\n        return this.storage[key];\n    }\n\n    getAll() {\n        return this.storage;\n    }\n}","import {EJSON} from 'meteor/ejson';\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class BaseResultCacher {\n    constructor(config = {}) {\n        this.config = config;\n    }\n\n    /**\n     * @param queryName\n     * @param params\n     * @returns {string}\n     */\n    generateQueryId(queryName, params) {\n        return `${queryName}::${EJSON.stringify(params)}`;\n    }\n\n    /**\n     * Dummy function\n     */\n    fetch(cacheId, {query, countCursor}) {\n        throw 'Not implemented';\n    }\n\n    /**\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    static fetchData({query, countCursor}) {\n        if (query) {\n            return query.fetch();\n        } else {\n            return countCursor.count();\n        }\n    }\n}\n","import {Meteor} from 'meteor/meteor';\nimport cloneDeep from 'lodash.clonedeep';\nimport BaseResultCacher from './BaseResultCacher';\n\nconst DEFAULT_TTL = 60000;\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class MemoryResultCacher extends BaseResultCacher {\n    constructor(config = {}) {\n        super(config);\n        this.store = {};\n    }\n\n    /**\n     * @param cacheId\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    fetch(cacheId, {query, countCursor}) {\n        const cacheData = this.store[cacheId];\n        if (cacheData !== undefined) {\n            return cloneDeep(cacheData);\n        }\n\n        const data = BaseResultCacher.fetchData({query, countCursor});\n        this.storeData(cacheId, data);\n\n        return data;\n    }\n\n\n    /**\n     * @param cacheId\n     * @param data\n     */\n    storeData(cacheId, data) {\n        const ttl = this.config.ttl || DEFAULT_TTL;\n        this.store[cacheId] = cloneDeep(data);\n\n        Meteor.setTimeout(() => {\n            delete this.store[cacheId];\n        }, ttl)\n    }\n}\n","import NamedQuery from '../namedQuery.js';\nimport { ExposeSchema, ExposeDefaults } from './schema.js';\nimport mergeDeep from './lib/mergeDeep.js';\nimport createGraph from '../../query/lib/createGraph.js';\nimport recursiveCompose from '../../query/lib/recursiveCompose.js';\nimport prepareForProcess from '../../query/lib/prepareForProcess.js';\nimport deepClone from 'lodash.clonedeep';\nimport intersectDeep from '../../query/lib/intersectDeep';\nimport genCountEndpoint from '../../query/counts/genEndpoint.server';\nimport { check } from 'meteor/check';\n\n_.extend(NamedQuery.prototype, {\n    /**\n     * @param config\n     */\n    expose(config = {}) {\n        if (!Meteor.isServer) {\n            throw new Meteor.Error(\n                'invalid-environment',\n                `You must run this in server-side code`\n            );\n        }\n\n        if (this.isExposed) {\n            throw new Meteor.Error(\n                'query-already-exposed',\n                `You have already exposed: \"${this.name}\" named query`\n            );\n        }\n\n        this.exposeConfig = Object.assign({}, ExposeDefaults, config);\n        check(this.exposeConfig, ExposeSchema);\n\n        if (this.exposeConfig.validateParams) {\n            this.options.validateParams = this.exposeConfig.validateParams;\n        }\n\n        if (!this.isResolver) {\n            this._initNormalQuery();\n        } else {\n            this._initMethod();\n        }\n\n        this.isExposed = true;\n    },\n\n    /**\n     * Initializes a normal NamedQuery (normal == not a resolver)\n     * @private\n     */\n    _initNormalQuery() {\n        const config = this.exposeConfig;\n        if (config.method) {\n            this._initMethod();\n        }\n\n        if (config.publication) {\n            this._initPublication();\n        }\n\n        if (!config.method && !config.publication) {\n            throw new Meteor.Error(\n                'weird',\n                'If you want to expose your named query you need to specify at least one of [\"method\", \"publication\"] options to true'\n            );\n        }\n\n        this._initCountMethod();\n        this._initCountPublication();\n    },\n\n    /**\n     * Returns the embodied body of the request\n     * @param {*} _embody\n     * @param {*} body\n     */\n    doEmbodimentIfItApplies(body) {\n        // query is not exposed yet, so it doesn't have embodiment logic\n        if (!this.exposeConfig) {\n            return;\n        }\n\n        const { embody } = this.exposeConfig;\n\n        if (!embody) {\n            return;\n        }\n\n        if (_.isFunction(embody)) {\n            embody.call(this, body, this.params);\n        } else {\n            mergeDeep(body, embody);\n        }\n    },\n\n    /**\n     * @private\n     */\n    _initMethod() {\n        const self = this;\n        Meteor.methods({\n            [this.name](newParams) {\n                self._unblockIfNecessary(this);\n\n                // security is done in the fetching because we provide a context\n                return self.clone(newParams).fetch(this);\n            },\n        });\n    },\n\n    /**\n     * @returns {void}\n     * @private\n     */\n    _initCountMethod() {\n        const self = this;\n\n        Meteor.methods({\n            [this.name + '.count'](newParams) {\n                self._unblockIfNecessary(this);\n\n                // security is done in the fetching because we provide a context\n                return self.clone(newParams).getCount(this);\n            },\n        });\n    },\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _initCountPublication() {\n        const self = this;\n\n        genCountEndpoint(self.name, {\n            getCursor({ session }) {\n                const query = self.clone(session.params);\n                return query.getCursorForCounting();\n            },\n\n            getSession(params) {\n                self.doValidateParams(params);\n                self._callFirewall(this, this.userId, params);\n\n                return { name: self.name, params, };\n            },\n        });\n    },\n\n    /**\n     * @private\n     */\n    _initPublication() {\n        const self = this;\n\n        Meteor.publishComposite(this.name, function(params = {}) {\n            const isScoped = !!self.options.scoped;\n\n            if (isScoped) {\n                this.enableScope();\n            }\n\n            self._unblockIfNecessary(this);\n            self.doValidateParams(params);\n            self._callFirewall(this, this.userId, params);\n\n            let body = deepClone(self.body);\n            if (params.$body) {\n                body = intersectDeep(body, params.$body);\n            }\n\n            self.doEmbodimentIfItApplies(body);\n            body = prepareForProcess(body, params);\n\n            const rootNode = createGraph(self.collection, body);\n\n            return recursiveCompose(rootNode, undefined, {scoped: isScoped});\n        });\n    },\n\n    /**\n     * @param context\n     * @param userId\n     * @param params\n     * @private\n     */\n    _callFirewall(context, userId, params) {\n        const { firewall } = this.exposeConfig;\n        if (!firewall) {\n            return;\n        }\n\n        if (_.isArray(firewall)) {\n            firewall.forEach(fire => {\n                fire.call(context, userId, params);\n            });\n        } else {\n            firewall.call(context, userId, params);\n        }\n    },\n\n    /**\n     * @param context\n     * @private\n     */\n    _unblockIfNecessary(context) {\n        if (this.exposeConfig.unblock) {\n            if (context.unblock) {\n                context.unblock();\n            }\n        }\n    },\n});\n","import {Match} from 'meteor/check';\n\nexport const ExposeDefaults = {\n    publication: true,\n    method: true,\n    unblock: true,\n};\n\nexport const ExposeSchema = {\n    firewall: Match.Maybe(\n        Match.OneOf(Function, [Function])\n    ),\n    publication: Match.Maybe(Boolean),\n    unblock: Match.Maybe(Boolean),\n    method: Match.Maybe(Boolean),\n    embody: Match.Maybe(\n        Match.OneOf(Object, Function)\n    ),\n    validateParams: Match.Maybe(\n        Match.OneOf(Object, Function)\n    )\n};\n","/**\n * Deep merge two objects.\n * @param target\n * @param source\n */\nexport default function mergeDeep(target, source) {\n    if (_.isObject(target) && _.isObject(source)) {\n        _.each(source, (value, key) => {\n            if (_.isFunction(source[key])) {\n                target[key] = source[key];\n            } else if (_.isObject(source[key])) {\n                if (!target[key]) Object.assign(target, { [key]: {} });\n                mergeDeep(target[key], source[key]);\n            } else {\n                Object.assign(target, { [key]: source[key] });\n            }\n        });\n    }\n\n    return target;\n}","import deepClone from 'lodash.clonedeep';\nimport {check} from 'meteor/check';\n\nexport default class QueryBase {\n    isGlobalQuery = true;\n\n    constructor(collection, body, options = {}) {\n        this.collection = collection;\n\n        this.body = deepClone(body);\n\n        this.params = options.params || {};\n        this.options = options;\n    }\n\n    clone(newParams) {\n        const params = _.extend({}, deepClone(this.params), newParams);\n\n        return new this.constructor(\n            this.collection,\n            deepClone(this.body),\n            {\n                params,\n                ...this.options\n            }\n        );\n    }\n\n    get name() {\n        return `exposure_${this.collection._name}`;\n    }\n\n    /**\n     * Validates the parameters\n     */\n    doValidateParams() {\n        const {validateParams} = this.options;\n        if (!validateParams) return;\n\n        if (_.isFunction(validateParams)) {\n            validateParams.call(null, this.params)\n        } else {\n            check(this.params)\n        }\n    }\n\n    /**\n     * Merges the params with previous params.\n     *\n     * @param params\n     * @returns {Query}\n     */\n    setParams(params) {\n        this.params = _.extend({}, this.params, params);\n\n        return this;\n    }\n}","import { _ } from 'meteor/underscore';\nimport CountSubscription from './counts/countSubscription';\nimport createGraph from './lib/createGraph.js';\nimport recursiveFetch from './lib/recursiveFetch.js';\nimport prepareForProcess from './lib/prepareForProcess.js';\nimport callWithPromise from './lib/callWithPromise';\nimport Base from './query.base';\n\nexport default class Query extends Base {\n    /**\n     * Subscribe\n     *\n     * @param callback {Function} optional\n     * @returns {null|any|*}\n     */\n    subscribe(callback) {\n        this.doValidateParams();\n\n        this.subscriptionHandle = Meteor.subscribe(\n            this.name,\n            prepareForProcess(this.body, this.params),\n            callback\n        );\n\n        return this.subscriptionHandle;\n    }\n\n    /**\n     * Subscribe to the counts for this query\n     *\n     * @param callback\n     * @returns {Object}\n     */\n    subscribeCount(callback) {\n        this.doValidateParams();\n\n        if (!this._counter) {\n            this._counter = new CountSubscription(this);\n        }\n\n        return this._counter.subscribe(\n            prepareForProcess(this.body, this.params),\n            callback\n        );\n    }\n\n    /**\n     * Unsubscribe if an existing subscription exists\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.subscriptionHandle.stop();\n        }\n\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Unsubscribe to the counts if a subscription exists.\n     */\n    unsubscribeCount() {\n        if (this._counter) {\n            this._counter.unsubscribe();\n            this._counter = null;\n        }\n    }\n\n    /**\n     * Fetches elements in sync using promises\n     * @return {*}\n     */\n    async fetchSync() {\n        this.doValidateParams();\n\n        if (this.subscriptionHandle) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name, prepareForProcess(this.body, this.params));\n    }\n\n    /**\n     * Fetches one element in sync\n     * @return {*}\n     */\n    async fetchOneSync() {\n        return _.first(await this.fetchSync())\n    }\n\n    /**\n     * Retrieves the data.\n     * @param callbackOrOptions\n     * @returns {*}\n     */\n    fetch(callbackOrOptions) {\n        this.doValidateParams();\n\n        if (!this.subscriptionHandle) {\n            return this._fetchStatic(callbackOrOptions)\n        } else {\n            return this._fetchReactive(callbackOrOptions);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        if (!this.subscriptionHandle) {\n            const callback = args[0];\n            if (!_.isFunction(callback)) {\n                throw new Meteor.Error('You did not provide a valid callback');\n            }\n\n            this.fetch((err, res) => {\n                callback(err, res ? _.first(res) : null);\n            })\n        } else {\n            return _.first(this.fetch(...args));\n        }\n    }\n\n    /**\n     * Gets the count of matching elements in sync.\n     * @returns {any}\n     */\n    async getCountSync() {\n        if (this._counter) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name + '.count', prepareForProcess(this.body, this.params));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @param callback\n     * @returns {any}\n     */\n    getCount(callback) {\n        if (this._counter) {\n            return this._counter.getCount();\n        } else {\n            if (!callback) {\n                throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n            } else {\n                return Meteor.call(\n                    this.name + '.count',\n                    prepareForProcess(this.body, this.params),\n                    callback\n                );\n            }\n        }\n    }\n\n    /**\n     * Fetching non-reactive queries\n     * @param callback\n     * @private\n     */\n    _fetchStatic(callback) {\n        if (!callback) {\n            throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n        }\n\n        Meteor.call(this.name, prepareForProcess(this.body, this.params), callback);\n    }\n\n    /**\n     * Fetching when we've got an active publication\n     *\n     * @param options\n     * @returns {*}\n     * @private\n     */\n    _fetchReactive(options = {}) {\n        let body = prepareForProcess(this.body, this.params);\n        if (!options.allowSkip && body.$options && body.$options.skip) {\n            delete body.$options.skip;\n        }\n\n        return recursiveFetch(\n            createGraph(this.collection, body),\n            this.params\n        );\n    }\n}\n","import QueryClient from './query.client';\nimport QueryServer from './query.server';\n\nlet Query;\n\nif (Meteor.isServer) {\n    Query = QueryServer;\n} else {\n    Query = QueryClient;\n}\n\nexport default Query;","import createGraph from './lib/createGraph.js';\nimport prepareForProcess from './lib/prepareForProcess.js';\nimport hypernova from './hypernova/hypernova.js';\nimport Base from './query.base';\n\nexport default class Query extends Base {\n    /**\n     * Retrieves the data.\n     * @param context\n     * @returns {*}\n     */\n    fetch(context = {}) {\n        const node = createGraph(\n            this.collection,\n            prepareForProcess(this.body, this.params)\n        );\n\n        return hypernova(node, context.userId, {params: this.params});\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        return _.first(this.fetch(...args));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @returns {integer}\n     */\n    getCount() {\n        return this.collection.find(this.body.$filters || {}, {}).count();\n    }\n}","import { Mongo } from 'meteor/mongo';\nimport { COUNTS_COLLECTION_CLIENT } from './constants';\n\n/**\n * Internal collection used to store counts on the client.\n */\nexport default new Mongo.Collection(COUNTS_COLLECTION_CLIENT);\n","export const COUNTS_COLLECTION_CLIENT = 'grapher_counts';\n","import { EJSON } from 'meteor/ejson';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport Counts from './collection';\nimport createFauxSubscription from './createFauxSubscription';\nimport prepareForProcess from '../lib/prepareForProcess.js';\nimport NamedQueryBase from '../../namedQuery/namedQuery.base';\n\nexport default class CountSubscription {\n    /**\n     * @param {*} query - The query to use when fetching counts\n     */\n    constructor(query) {\n        this.accessToken = new ReactiveVar(null);\n        this.fauxHandle = null;\n        this.query = query;\n    }\n\n    /**\n     * Starts a subscription request for reactive counts.\n     *\n     * @param {*} arg - The argument to pass to {name}.count.subscribe\n     * @param {*} callback\n     */\n    subscribe(arg, callback) {\n        // Don't try to resubscribe if arg hasn't changed\n        if (EJSON.equals(this.lastArgs, arg) && this.fauxHandle) {\n            return this.fauxHandle;\n        }\n\n        this.accessToken.set(null);\n        this.lastArgs = arg;\n\n        Meteor.call(this.query.name + '.count.subscribe', arg, (error, token) => {\n            if (!this._markedForUnsubscribe) {\n                this.subscriptionHandle = Meteor.subscribe(this.query.name + '.count', token, callback);\n                this.accessToken.set(token);\n\n                this.disconnectComputation = Tracker.autorun(() => this.handleDisconnect());\n            }\n\n            this._markedForUnsubscribe = false;\n        });\n\n        this.fauxHandle = createFauxSubscription(this);\n        return this.fauxHandle;\n    }\n\n    /**\n     * Unsubscribes from the count endpoint, if there is such a subscription.\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.disconnectComputation.stop();\n            this.subscriptionHandle.stop();\n        } else {\n            // If we hit this branch, then Meteor.call in subscribe hasn't finished yet\n            // so set a flag to stop the subscription from being created\n            this._markedForUnsubscribe = true;\n        }\n\n        this.accessToken.set(null);\n        this.fauxHandle = null;\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Reactively fetch current document count. Returns null if the subscription is not ready yet.\n     *\n     * @returns {Number|null} - Current document count\n     */\n    getCount() {\n        const id = this.accessToken.get();\n        if (id === null) return null;\n\n        const doc = Counts.findOne(id);\n        return doc.count;\n    }\n\n    /**\n     * All session info gets deleted when the server goes down, so when the client attempts to\n     * optimistically resume the '.count' publication, the server will throw a 'no-request' error.\n     *\n     * This function prevents that by manually stopping and restarting the subscription when the\n     * connection to the server is lost.\n     */\n    handleDisconnect() {\n        const status = Meteor.status();\n        if (!status.connected) {\n            this._markedForResume = true;\n            this.fauxHandle = null;\n            this.subscriptionHandle.stop();\n        }\n\n        if (status.connected && this._markedForResume) {\n            this._markedForResume = false;\n            this.subscribe(this.lastArgs);\n        }\n    }\n\n    /**\n     * Returns whether or not a subscription request has been made.\n     */\n    isSubscribed() {\n        return this.accessToken.get() !== null;\n    }\n}\n","/**\n * This method creates a \"fake\" subscription handle so that users of CountSubscription#subscribe\n * have an interface consistent with normal subscriptions.\n *\n * @param {CountSubscription} countManager\n */\nexport default (countManager) => ({\n    ready: () => countManager.accessToken.get() !== null && countManager.subscriptionHandle.ready(),\n    stop: () => countManager.unsubscribe(),\n});\n","import { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\n\nimport { COUNTS_COLLECTION_CLIENT } from './constants';\n\n// XXX: Should this persist between server restarts?\nconst collection = new Mongo.Collection(null);\n\n/**\n * This method generates a reactive count endpoint (a method and publication) for a collection or named query.\n *\n * @param {String} name - Name of the query or collection\n * @param {Function} getCursor - Takes in the user's session document as an argument, and turns that into a Mongo cursor.\n * @param {Function} getSession - Takes the subscribe method's argument as its parameter. Should enforce any necessary security constraints. The return value of this function is stored in the session document.\n */\nexport default (name, { getCursor, getSession }) => {\n    Meteor.methods({\n        [name + '.count.subscribe'](paramsOrBody) {\n            const session = getSession.call(this, paramsOrBody);\n            const sessionId = JSON.stringify(session);\n\n            const existingSession = collection.findOne({\n                session: sessionId,\n                userId: this.userId,\n            });\n\n            // Try to reuse sessions if the user subscribes multiple times with the same data\n            if (existingSession) {\n                return existingSession._id;\n            }\n\n            const token = collection.insert({\n                session: sessionId,\n                query: name,\n                userId: this.userId,\n            });\n\n            return token;\n        },\n    });\n\n    Meteor.publish(name + '.count', function(token) {\n        check(token, String);\n        const self = this;\n        const request = collection.findOne({ _id: token, userId: self.userId });\n\n        if (!request) {\n            throw new Error(\n                'no-request',\n                `You must acquire a request token via the \"${name}.count.subscribe\" method first.`\n            );\n        }\n\n        request.session = JSON.parse(request.session);\n        const cursor = getCursor.call(this, request);\n\n        // Start counting\n        let count = 0;\n\n        let isReady = false;\n        const handle = cursor.observe({\n            added() {\n                count++;\n                isReady &&\n                    self.changed(COUNTS_COLLECTION_CLIENT, token, { count });\n            },\n\n            removed() {\n                count--;\n                isReady &&\n                    self.changed(COUNTS_COLLECTION_CLIENT, token, { count });\n            },\n        });\n\n        isReady = true;\n        self.added(COUNTS_COLLECTION_CLIENT, token, { count });\n\n        self.onStop(() => {\n            handle.stop();\n            collection.remove(token);\n        });\n\n        self.ready();\n    });\n};\n","import sift from 'sift';\n\n/**\n * Its purpose is to create filters to get the related data in one request.\n */\nexport default class AggregateFilters {\n    constructor(collectionNode, metaFilters) {\n        this.collectionNode = collectionNode;\n        this.linker = collectionNode.linker;\n        this.metaFilters = metaFilters;\n        this.isVirtual = this.linker.isVirtual();\n\n        this.linkStorageField = this.linker.linkStorageField;\n    }\n\n    get parentObjects() {\n        return this.collectionNode.parent.results;\n    }\n\n    create() {\n        switch (this.linker.strategy) {\n            case 'one':\n                return this.createOne();\n            case 'one-meta':\n                return this.createOneMeta();\n            case 'many':\n                return this.createMany();\n            case 'many-meta':\n                return this.createManyMeta();\n            default:\n                throw new Meteor.Error(`Invalid linker type: ${this.linker.type}`);\n        }\n    }\n\n    createOne() {\n        if (!this.isVirtual) {\n            return {\n                _id: {\n                    $in: _.uniq(\n                        _.pluck(this.parentObjects, this.linkStorageField)\n                    )\n                }\n            };\n        } else {\n            return {\n                [this.linkStorageField]: {\n                    $in: _.uniq(\n                        _.pluck(this.parentObjects, '_id')\n                    )\n                }\n            };\n        }\n    }\n\n    createOneMeta() {\n        if (!this.isVirtual) {\n            let eligibleObjects = this.parentObjects;\n\n            if (this.metaFilters) {\n                eligibleObjects = _.filter(this.parentObjects, object => {\n                    return sift(this.metaFilters)(object[this.linkStorageField]);\n                });\n            }\n\n            const storages = _.pluck(eligibleObjects, this.linkStorageField);\n            let ids = [];\n            _.each(storages, storage => {\n                if (storage) {\n                    ids.push(storage._id);\n                }\n            });\n\n            return {\n                _id: {$in: _.uniq(ids)}\n            };\n        } else {\n            let filters = {};\n            if (this.metaFilters) {\n                _.each(this.metaFilters, (value, key) => {\n                    filters[this.linkStorageField + '.' + key] = value;\n                })\n            }\n\n            filters[this.linkStorageField + '._id'] = {\n                $in: _.uniq(\n                    _.pluck(this.parentObjects, '_id')\n                )\n            };\n\n            return filters;\n        }\n    }\n\n    createMany() {\n        if (!this.isVirtual) {\n            const arrayOfIds = _.pluck(this.parentObjects, this.linkStorageField);\n            return {\n                _id: {\n                    $in: _.uniq(\n                        _.union(...arrayOfIds)\n                    )\n                }\n            };\n        } else {\n            const arrayOfIds = _.pluck(this.parentObjects, '_id');\n            return {\n                [this.linkStorageField]: {\n                    $in: _.uniq(\n                        _.union(...arrayOfIds)\n                    )\n                }\n            };\n        }\n    }\n\n    createManyMeta() {\n        if (!this.isVirtual) {\n            let ids = [];\n\n            _.each(this.parentObjects, object => {\n                if (object[this.linkStorageField]) {\n                    if (this.metaFilters) {\n                        const isValid = sift(this.metaFilters);\n                        _.each(object[this.linkStorageField], object => {\n                            if (isValid(object)) {\n                                ids.push(object._id);\n                            }\n                        });\n                    } else {\n                        _.each(object[this.linkStorageField], object => {\n                            ids.push(object._id);\n                        });\n                    }\n                }\n            });\n\n            return {\n                _id: {$in: _.uniq(ids)}\n            };\n        } else {\n            let filters = {};\n            if (this.metaFilters) {\n                _.each(this.metaFilters, (value, key) => {\n                    filters[key] = value;\n                })\n            }\n\n            filters._id = {\n                $in: _.uniq(\n                    _.pluck(this.parentObjects, '_id')\n                )\n            };\n\n            return {\n                [this.linkStorageField]: {\n                    $elemMatch: filters\n                }\n            };\n        }\n    }\n}","import sift from 'sift';\nimport cleanObjectForMetaFilters from './lib/cleanObjectForMetaFilters';\n\n/**\n * This only applies to inversed links. It will assemble the data in a correct manner.\n */\nexport default function(childCollectionNode, aggregateResults, metaFilters) {\n    const linker = childCollectionNode.linker;\n    const linkStorageField = linker.linkStorageField;\n    const linkName = childCollectionNode.linkName;\n    const isMeta = linker.isMeta();\n    const isMany = linker.isMany();\n\n    let allResults = [];\n\n    if (isMeta && metaFilters) {\n        const metaFiltersTest = sift(metaFilters);\n        _.each(childCollectionNode.parent.results, parentResult => {\n            cleanObjectForMetaFilters(\n                parentResult,\n                linkStorageField,\n                metaFiltersTest\n            );\n        });\n    }\n\n    if (isMeta && isMany) {\n        // This case is treated differently because we get an array response from the pipeline.\n\n        _.each(childCollectionNode.parent.results, parentResult => {\n            parentResult[linkName] = parentResult[linkName] || [];\n\n            const eligibleAggregateResults = _.filter(\n                aggregateResults,\n                aggregateResult => {\n                    return _.contains(aggregateResult._id, parentResult._id);\n                }\n            );\n\n            if (eligibleAggregateResults.length) {\n                const datas = _.pluck(eligibleAggregateResults, 'data'); /// [ [x1, x2], [x2, x3] ]\n\n                _.each(datas, data => {\n                    _.each(data, item => {\n                        parentResult[linkName].push(item);\n                    });\n                });\n            }\n        });\n\n        _.each(aggregateResults, aggregateResult => {\n            _.each(aggregateResult.data, item => allResults.push(item));\n        });\n    } else {\n        let comparator;\n        if (isMany) {\n            comparator = (aggregateResult, result) =>\n                _.contains(aggregateResult._id, result._id);\n        } else {\n            comparator = (aggregateResult, result) =>\n                aggregateResult._id == result._id;\n        }\n\n        const childLinkName = childCollectionNode.linkName;\n        const parentResults = childCollectionNode.parent.results;\n\n        parentResults.forEach(parentResult => {\n            // We are now finding the data from the pipeline that is related to the _id of the parent\n            const eligibleAggregateResults = aggregateResults.filter(\n                aggregateResult => comparator(aggregateResult, parentResult)\n            );\n\n            eligibleAggregateResults.forEach(aggregateResult => {\n                if (Array.isArray(parentResult[childLinkName])) {\n                    parentResult[childLinkName].push(...aggregateResult.data);\n                } else {\n                    parentResult[childLinkName] = [...aggregateResult.data];\n                }\n            });\n        });\n\n        aggregateResults.forEach(aggregateResult => {\n            allResults.push(...aggregateResult.data);\n        });\n    }\n\n    childCollectionNode.results = allResults;\n}\n","import createSearchFilters from '../../links/lib/createSearchFilters';\nimport cleanObjectForMetaFilters from './lib/cleanObjectForMetaFilters';\nimport sift from 'sift';\n\nexport default (childCollectionNode, { limit, skip, metaFilters }) => {\n    if (childCollectionNode.results.length === 0) {\n        return;\n    }\n\n    const parent = childCollectionNode.parent;\n    const linker = childCollectionNode.linker;\n\n    const strategy = linker.strategy;\n    const isSingle = linker.isSingle();\n    const isMeta = linker.isMeta();\n    const fieldStorage = linker.linkStorageField;\n\n    // cleaning the parent results from a child\n    // this may be the wrong approach but it works for now\n    if (isMeta && metaFilters) {\n        const metaFiltersTest = sift(metaFilters);\n        _.each(parent.results, parentResult => {\n            cleanObjectForMetaFilters(\n                parentResult,\n                fieldStorage,\n                metaFiltersTest\n            );\n        });\n    }\n\n    const resultsByKeyId = _.groupBy(childCollectionNode.results, '_id');\n\n    if (strategy === 'one') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                resultsByKeyId[parentResult[fieldStorage]],\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'many') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            let data = [];\n            parentResult[fieldStorage].forEach(_id => {\n                data.push(_.first(resultsByKeyId[_id]));\n            });\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                data,\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'one-meta') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            const _id = parentResult[fieldStorage]._id;\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                resultsByKeyId[_id],\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'many-meta') {\n        parent.results.forEach(parentResult => {\n            const _ids = _.pluck(parentResult[fieldStorage], '_id');\n            let data = [];\n            _ids.forEach(_id => {\n                data.push(_.first(resultsByKeyId[_id]));\n            });\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                data,\n                { limit, skip }\n            );\n        });\n    }\n};\n\nfunction filterAssembledData(data, { limit, skip }) {\n    if (limit && Array.isArray(data)) {\n        return data.slice(skip, limit);\n    }\n\n    return data;\n}\n","import { _ } from 'meteor/underscore';\nimport {SAFE_DOTTED_FIELD_REPLACEMENT} from './constants';\n\nexport default function (childCollectionNode, filters, options, userId) {\n    let containsDottedFields = false;\n    const linker = childCollectionNode.linker;\n    const linkStorageField = linker.linkStorageField;\n    const collection = childCollectionNode.collection;\n\n    let pipeline = [];\n\n    if (collection.firewall) {\n        collection.firewall(filters, options, userId);\n    }\n\n    pipeline.push({$match: filters});\n\n    if (options.sort && _.keys(options.sort).length > 0) {\n        pipeline.push({$sort: options.sort})\n    }\n\n    let _id = linkStorageField;\n    if (linker.isMeta()) {\n        _id += '._id';\n    }\n\n    let dataPush = {\n        _id: '$_id'\n    };\n\n    _.each(options.fields, (value, field) => {\n        if (field.indexOf('.') >= 0) {\n            containsDottedFields = true;\n        }\n        const safeField = field.replace(/\\./g, SAFE_DOTTED_FIELD_REPLACEMENT);\n        dataPush[safeField] = '$' + field\n    });\n\n    if (linker.isMeta()) {\n        dataPush[linkStorageField] = '$' + linkStorageField;\n    }\n\n    pipeline.push({\n        $group: {\n            _id: \"$\" + _id,\n            data: {\n                $push: dataPush\n            }\n        }\n    });\n\n    if (options.limit || options.skip) {\n        let $slice = [\"$data\"];\n        if (options.skip) $slice.push(options.skip);\n        if (options.limit) $slice.push(options.limit);\n\n        pipeline.push({\n            $project: {\n                _id: 1,\n                data: {$slice}\n            }\n        })\n    }\n\n    return {pipeline, containsDottedFields};\n}","export const SAFE_DOTTED_FIELD_REPLACEMENT = '___';","import applyProps from '../lib/applyProps.js';\nimport prepareForDelivery from '../lib/prepareForDelivery.js';\nimport storeHypernovaResults from './storeHypernovaResults.js';\n\nfunction hypernova(collectionNode, userId) {\n    _.each(collectionNode.collectionNodes, childCollectionNode => {\n        let {filters, options} = applyProps(childCollectionNode);\n\n        storeHypernovaResults(childCollectionNode, userId);\n        hypernova(childCollectionNode, userId);\n    });\n}\n\nexport default function hypernovaInit(collectionNode, userId, config = {}) {\n    const bypassFirewalls = config.bypassFirewalls || false;\n    const params = config.params || {};\n\n    let {filters, options} = applyProps(collectionNode);\n\n    const collection = collectionNode.collection;\n\n    collectionNode.results = collection.find(filters, options, userId).fetch();\n\n    const userIdToPass = (config.bypassFirewalls) ? undefined : userId;\n    hypernova(collectionNode, userIdToPass);\n\n    prepareForDelivery(collectionNode, params);\n\n    return collectionNode.results;\n}\n","import applyProps from '../lib/applyProps.js';\nimport AggregateFilters from './aggregateSearchFilters.js';\nimport assemble from './assembler.js';\nimport assembleAggregateResults from './assembleAggregateResults.js';\nimport buildAggregatePipeline from './buildAggregatePipeline.js';\nimport snapBackDottedFields from './lib/snapBackDottedFields';\n\nexport default function storeHypernovaResults(childCollectionNode, userId) {\n    if (childCollectionNode.parent.results.length === 0) {\n        return (childCollectionNode.results = []);\n    }\n\n    let { filters, options } = applyProps(childCollectionNode);\n\n    const metaFilters = filters.$meta;\n    const aggregateFilters = new AggregateFilters(\n        childCollectionNode,\n        metaFilters\n    );\n    delete filters.$meta;\n\n    const linker = childCollectionNode.linker;\n    const isVirtual = linker.isVirtual();\n    const collection = childCollectionNode.collection;\n\n    _.extend(filters, aggregateFilters.create());\n\n    // if it's not virtual then we retrieve them and assemble them here.\n    if (!isVirtual) {\n        const filteredOptions = _.omit(options, 'limit');\n\n        childCollectionNode.results = collection\n            .find(filters, filteredOptions, userId)\n            .fetch();\n\n        assemble(childCollectionNode, {\n            ...options,\n            metaFilters,\n        });\n    } else {\n        // virtuals arrive here\n        let { pipeline, containsDottedFields } = buildAggregatePipeline(\n            childCollectionNode,\n            filters,\n            options,\n            userId\n        );\n\n        let aggregateResults = collection.aggregate(pipeline);\n\n        /**\n         * If in aggregation it contains '.', we replace it with a custom string '___'\n         * And then after aggregation is complete we need to snap-it back to how it was.\n         */\n        if (containsDottedFields) {\n            snapBackDottedFields(aggregateResults);\n        }\n\n        assembleAggregateResults(\n            childCollectionNode,\n            aggregateResults,\n            metaFilters\n        );\n    }\n}\n","export default function (object, field, metaFiltersTest) {\n    if (object[field]) {\n        if (_.isArray(object[field])) {\n            object[field] = object[field].filter(metaFiltersTest)\n        } else {\n            if (!metaFiltersTest(object[field])) {\n                object[field] = null;\n            }\n        }\n    }\n}","import {SAFE_DOTTED_FIELD_REPLACEMENT} from '../constants';\nimport dot from 'dot-object';\n\nexport default function (aggregationResult) {\n    aggregationResult.forEach(result => {\n        result.data = result.data.map(document => {\n            _.each(document, (value, key) => {\n                if (key.indexOf(SAFE_DOTTED_FIELD_REPLACEMENT) >= 0) {\n                    document[key.replace(new RegExp(SAFE_DOTTED_FIELD_REPLACEMENT, 'g'), '.')] = value;\n                    delete document[key];\n                }\n            });\n\n            return dot.object(document);\n        })\n    })\n}","const restrictOptions = [\n    'disableOplog',\n    'pollingIntervalMs',\n    'pollingThrottleMs'\n];\n\nexport default function applyProps(node) {\n    let filters = _.extend({}, node.props.$filters);\n    let options = _.extend({}, node.props.$options);\n\n    options = _.omit(options, ...restrictOptions);\n    options.fields = options.fields || {};\n\n    node.applyFields(filters, options);\n\n    return {filters, options};\n}\n","export default (method, myParameters) => {\n    return new Promise((resolve, reject) => {\n        Meteor.call(method, myParameters, (err, res) => {\n            if (err) reject(err.reason || 'Something went wrong.');\n\n            resolve(res);\n        });\n    });\n};","import CollectionNode from '../nodes/collectionNode.js';\nimport FieldNode from '../nodes/fieldNode.js';\nimport ReducerNode from '../nodes/reducerNode.js';\nimport dotize from './dotize.js';\nimport createReducers from '../reducers/lib/createReducers';\n\nexport const specialFields = [\n    '$filters',\n    '$options',\n    '$postFilters',\n    '$postOptions',\n    '$postFilter'\n];\n\n/**\n * Creates node objects from the body. The root is always a collection node.\n *\n * @param root\n */\nexport function createNodes(root) {\n    // this is a fix for phantomjs tests (don't really understand it.)\n    if (!_.isObject(root.body)) {\n        return;\n    }\n\n    _.each(root.body, (body, fieldName) => {\n        if (!body) {\n            return;\n        }\n\n        // if it's a prop\n        if (_.contains(specialFields, fieldName)) {\n            root.addProp(fieldName, body);\n\n            return;\n        }\n\n        // workaround, see https://github.com/cult-of-coders/grapher/issues/134\n        // TODO: find another way to do this\n        if (root.collection.default) {\n          root.collection = root.collection.default;\n        }\n\n        // checking if it is a link.\n        let linker = root.collection.getLinker(fieldName);\n\n        if (linker) {\n            // check if it is a cached link\n            // if yes, then we need to explicitly define this at collection level\n            // so when we transform the data for delivery, we move it to the link name\n            if (linker.isDenormalized()) {\n                if (linker.isSubBodyDenormalized(body)) {\n                    handleDenormalized(root, linker, body, fieldName);\n                    return;\n                }\n            }\n\n            let subroot = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n            root.add(subroot, linker);\n\n            createNodes(subroot);\n            return;\n        }\n\n        // checking if it's a reducer\n        const reducer = root.collection.getReducer(fieldName);\n\n        if (reducer) {\n            let reducerNode = new ReducerNode(fieldName, reducer);\n            root.add(reducerNode);\n        }\n\n        // it's most likely a field then\n        addFieldNode(body, fieldName, root);\n    });\n\n    createReducers(root);\n\n    if (root.fieldNodes.length === 0) {\n        root.add(new FieldNode('_id', 1));\n    }\n}\n\nfunction isProjectionOperatorExpression(body) {\n    if (_.isObject(body)) {\n        const keys = _.keys(body);\n        return keys.length === 1 && _.contains(['$elemMatch', '$meta', '$slice'], keys[0]);\n    }\n    return false;\n}\n\n/**\n * @param body\n * @param fieldName\n * @param root\n */\nexport function addFieldNode(body, fieldName, root) {\n    // it's not a link and not a special variable => we assume it's a field\n    if (_.isObject(body)) {\n        if (!isProjectionOperatorExpression(body)) {\n            let dotted = dotize.convert({[fieldName]: body});\n            _.each(dotted, (value, key) => {\n                root.add(new FieldNode(key, value));\n            });\n        }\n        else {\n            root.add(new FieldNode(fieldName, body, true));\n        }\n    } else {\n        let fieldNode = new FieldNode(fieldName, body);\n        root.add(fieldNode);\n    }\n}\n\n/**\n * Returns namespace for node when using query path scoping.\n *\n * @param node\n * @returns {String}\n */\nexport function getNodeNamespace(node) {\n    const parts = [];\n    let n = node;\n    while (n) {\n        const name = n.linker ? n.linker.linkName : n.collection._name;\n        parts.push(name);\n        // console.log('linker', node.linker ? node.linker.linkName : node.collection._name);\n        n = n.parent;\n    }\n    return parts.reverse().join('_');\n}\n\n/**\n * @param collection\n * @param body\n * @returns {CollectionNode}\n */\nexport default function (collection, body) {\n    let root = new CollectionNode(collection, body);\n    createNodes(root);\n\n    return root;\n};\n\n/**\n * Ads denormalization config properly, including _id\n *\n * @param root\n * @param linker\n * @param body\n * @param fieldName\n */\nfunction handleDenormalized(root, linker, body, fieldName) {\n    Object.assign(body, {_id: 1});\n\n    const cacheField = linker.linkConfig.denormalize.field;\n    root.snapCache(cacheField, fieldName);\n\n    // if it's one and direct also include the link storage\n    if (!linker.isMany() && !linker.isVirtual()) {\n        addFieldNode(1, linker.linkStorageField, root);\n    }\n\n    addFieldNode(body, cacheField, root);\n}","// https://github.com/vardars/dotize\nexport default dotize = {};\n\ndotize.convert = function(obj, prefix) {\n    if ((!obj || typeof obj != \"object\") && !Array.isArray(obj)) {\n        if (prefix) {\n            var newObj = {};\n            newObj[prefix] = obj;\n            return newObj;\n        } else {\n            return obj;\n        }\n    }\n\n    var newObj = {};\n\n    function recurse(o, p, isArrayItem) {\n        for (var f in o) {\n            if (o[f] && typeof o[f] === \"object\") {\n                if (Array.isArray(o[f])) {\n                    if (isEmptyArray(o[f])) {\n                        newObj[getFieldName(f, p, true)] = o[f]; // empty array\n                    } else {\n                        newObj = recurse(o[f], getFieldName(f, p, false, true), true); // array\n                    }\n                } else {\n                    if (isArrayItem) {\n                        if (isEmptyObj(o[f])) {\n                            newObj[getFieldName(f, p, true)] = o[f]; // empty object\n                        } else {\n                            newObj = recurse(o[f], getFieldName(f, p, true)); // array item object\n                        }\n                    } else {\n                        if (isEmptyObj(o[f])) {\n                            newObj[getFieldName(f, p)] = o[f]; // empty object\n                        } else {\n                            newObj = recurse(o[f], getFieldName(f, p)); // object\n                        }\n                    }\n                }\n            } else {\n                if (isArrayItem || isNumber(f)) {\n                    newObj[getFieldName(f, p, true)] = o[f]; // array item primitive\n                } else {\n                    newObj[getFieldName(f, p)] = o[f]; // primitive\n                }\n            }\n        }\n\n        if (isEmptyObj(newObj))\n            return obj;\n\n        return newObj;\n    }\n\n    function isNumber(f) {\n        return !isNaN(parseInt(f));\n    }\n\n    function isEmptyObj(obj) {\n        for (var prop in obj) {\n            if (Object.hasOwnProperty.call(obj, prop))\n                return false;\n        }\n\n        return true;\n    }\n\n    function isEmptyArray(o) {\n        if (Array.isArray(o) && o.length == 0)\n            return true;\n        return false;\n    }\n\n    function getFieldName(field, prefix, isArrayItem, isArray) {\n        if (isArray)\n            return (prefix ? prefix : \"\") + (isNumber(field) ? \"[\" + field + \"]\" : \".\" + field);\n        else if (isArrayItem)\n            return (prefix ? prefix : \"\") + \"[\" + field + \"]\";\n        else\n            return (prefix ? prefix + \".\" : \"\") + field;\n    }\n\n    return recurse(obj, prefix, Array.isArray(obj));\n};","import dot from 'dot-object';\nimport {_} from 'meteor/underscore';\n\n/**\n * Given a named query that has a specific body, you can query its subbody\n * This performs an intersection of the bodies allowed in each\n *\n * @param allowedBody\n * @param clientBody\n */\nexport default function (allowedBody, clientBody) {\n    const allowedBodyDot = _.keys(dot.dot(allowedBody));\n    const clientBodyDot = _.keys(dot.dot(clientBody));\n\n    const intersection = _.intersection(allowedBodyDot, clientBodyDot);\n\n    const build = {};\n    intersection.forEach(intersectedField => {\n        build[intersectedField] = 1;\n    });\n\n    return dot.object(build);\n}","// 1. Clone children with meta relationships\n// 2. Apply $metadata to children\n// 3. Removes link storage (if not specified)\n// 4. Stores oneResult links as a single object instead of array\nimport applyReducers from '../reducers/lib/applyReducers';\nimport cleanReducerLeftovers from '../reducers/lib/cleanReducerLeftovers';\nimport sift from 'sift';\nimport {Minimongo} from 'meteor/minimongo';\n\nexport default (node, params) => {\n    snapBackCaches(node);\n    storeOneResults(node, node.results);\n\n    applyReducers(node, params);\n\n    _.each(node.collectionNodes, collectionNode => {\n        cloneMetaChildren(collectionNode, node.results)\n    });\n\n    _.each(node.collectionNodes, collectionNode => {\n        assembleMetadata(collectionNode, node.results)\n    });\n\n    cleanReducerLeftovers(node, node.results);\n\n    removeLinkStorages(node, node.results);\n\n    applyPostFilters(node);\n    applyPostOptions(node);\n    applyPostFilter(node, params);\n}\n\nexport function applyPostFilters(node) {\n    const postFilters = node.props.$postFilters;\n    if (postFilters) {\n        node.results = sift(postFilters, node.results);\n    }\n}\n\nexport function applyPostOptions(node) {\n    const options = node.props.$postOptions;\n    if (options) {\n        if (options.sort) {\n            const sorter = new Minimongo.Sorter(options.sort);\n            node.results.sort(sorter.getComparator());\n        }\n        if (options.limit || options.skip) {\n            const start = options.skip || 0;\n            const end = options.limit ? options.limit + start : node.results.length;\n            node.results = node.results.slice(start, end);\n        }\n    }\n}\n\n\n/**\n * Optionally applies a post filtering option\n */\nfunction applyPostFilter(node, params) {\n    if (node.props.$postFilter) {\n        const filter = node.props.$postFilter;\n\n        if (_.isArray(filter)) {\n            filter.forEach(f => {\n                node.results = f(node.results, params);\n            })\n        } else {\n            node.results = filter(node.results, params);\n        }\n    }\n}\n\n/**\n *\n * Helper function which transforms results into the array.\n * Results are an object for 'one' links.\n *\n * @param results\n * @return array\n */\nexport function getResultsArray(results) {\n    if (_.isArray(results)) {\n        return results;\n    }\n    else if (_.isUndefined(results)) {\n        return [];\n    }\n    return [results];\n}\n\nexport function removeLinkStorages(node, sameLevelResults) {\n    if (!sameLevelResults) {\n        return;\n    }\n\n    sameLevelResults = getResultsArray(sameLevelResults);\n\n    _.each(node.collectionNodes, collectionNode => {\n        const removeStorageField = collectionNode.shouldCleanStorage;\n     \n        _.each(sameLevelResults, result => {\n            if (removeStorageField) {\n                if (collectionNode.isVirtual) {\n                    const childResults = getResultsArray(result[collectionNode.linkName]);\n                    _.each(childResults, childResult => {\n                        delete childResult[collectionNode.linkStorageField];\n                    });\n                } else {\n                    delete result[collectionNode.linkStorageField];\n                }\n            }\n\n            removeLinkStorages(collectionNode, result[collectionNode.linkName]);\n        })\n    })\n}\n\nexport function storeOneResults(node, sameLevelResults) {\n    if (!sameLevelResults) {\n        return;\n    }\n\n    node.collectionNodes.forEach(collectionNode => {\n        _.each(sameLevelResults, result => {\n            // The reason we are doing this is that if the requested link does not exist\n            // It will fail when we try to get undefined[something] below\n            if (result === undefined) {\n                return;\n            }\n\n            storeOneResults(collectionNode, result[collectionNode.linkName]);\n        });\n\n        if (collectionNode.isOneResult) {\n            _.each(sameLevelResults, result => {\n                if (result[collectionNode.linkName] && _.isArray(result[collectionNode.linkName])) {\n                    result[collectionNode.linkName] = result[collectionNode.linkName]\n                        ? _.first(result[collectionNode.linkName])\n                        : undefined;\n                }\n            })\n        }\n    })\n}\n\nfunction cloneMetaChildren(node, parentResults) {\n    if (!parentResults) {\n        return;\n    }\n\n    const linkName = node.linkName;\n    const isMeta = node.isMeta;\n\n    // parentResults might be an object (for type==one links)\n    parentResults = getResultsArray(parentResults);\n\n    parentResults.forEach(parentResult => {\n        if (isMeta && parentResult[linkName]) {\n            if (node.isOneResult) {\n                parentResult[linkName] = Object.assign({}, parentResult[linkName]);\n            }\n            else {\n                parentResult[linkName] = parentResult[linkName].map(object => {\n                    return Object.assign({}, object);\n                });\n            }\n        }\n\n        node.collectionNodes.forEach(collectionNode => {\n            cloneMetaChildren(collectionNode, parentResult[linkName]);\n        });\n    });\n}\n\nexport function assembleMetadata(node, parentResults) {\n    parentResults = getResultsArray(parentResults);\n\n    // assembling metadata is depth first\n    node.collectionNodes.forEach(collectionNode => {\n        _.each(parentResults, result => {\n            assembleMetadata(collectionNode, result[node.linkName])\n        });\n    });\n\n    if (node.isMeta) {\n        if (node.isVirtual) {\n            _.each(parentResults, parentResult => {\n                const childResult = parentResult[node.linkName];\n\n                if (node.isOneResult) {\n                    if (_.isObject(childResult)) {\n                        const storage = childResult[node.linkStorageField];\n                        storeMetadata(childResult, parentResult, storage, true);\n                    }\n                } else {\n                    _.each(childResult, object => {\n                        const storage = object[node.linkStorageField];\n                        storeMetadata(object, parentResult, storage, true);\n                    });\n                }\n            })\n        } else {\n            _.each(parentResults, parentResult => {\n                const childResult = parentResult[node.linkName];\n                const storage = parentResult[node.linkStorageField];\n\n                if (node.isOneResult) {\n                    if (childResult) {\n                        storeMetadata(childResult, parentResult, storage, false);\n                    }\n                } else {\n                    _.each(childResult, object => {\n                        storeMetadata(object, parentResult, storage, false);\n                    });\n                }\n            })\n        }\n    }\n}\n\nfunction storeMetadata(element, parentElement, storage, isVirtual) {\n    if (isVirtual) {\n        let $metadata;\n        if (_.isArray(storage)) {\n            $metadata = _.find(storage, storageItem => storageItem._id == parentElement._id);\n        } else {\n            $metadata = storage;\n        }\n\n        element.$metadata = _.omit($metadata, '_id')\n    } else {\n        let $metadata;\n        if (_.isArray(storage)) {\n            $metadata = _.find(storage, storageItem => storageItem._id == element._id);\n        } else {\n            $metadata = storage;\n        }\n\n        element.$metadata = _.omit($metadata, '_id');\n    }\n}\n\nfunction snapBackCaches(node) {\n    node.collectionNodes.forEach(collectionNode => {\n        snapBackCaches(collectionNode);\n    });\n\n    if (!_.isEmpty(node.snapCaches)) {\n        // process stuff\n        _.each(node.snapCaches, (linkName, cacheField) => {\n            const isSingle = _.contains(node.snapCachesSingles, cacheField);\n            const linker = node.collection.getLinker(linkName);\n            // we do this because for one direct and one meta direct, id is not stored\n            const shoudStoreLinkStorage = !linker.isMany() && !linker.isVirtual();\n\n            node.results.forEach(result => {\n                if (result[cacheField]) {\n                    if (shoudStoreLinkStorage) {\n                        Object.assign(result[cacheField], {\n                            _id: linker.isMeta()\n                                ? result[linker.linkStorageField]._id\n                                : result[linker.linkStorageField]\n                        });\n                    }\n\n                    if (isSingle && _.isArray(result[cacheField])) {\n                        result[linkName] = _.first(result[cacheField]);\n                    } else {\n                        result[linkName] = result[cacheField];\n                    }\n\n                    delete result[cacheField];\n                }\n            })\n        })\n    }\n}\n","import {check, Match} from 'meteor/check';\nimport deepClone from 'lodash.clonedeep';\n\nfunction defaultFilterFunction({\n    filters,\n    options,\n    params\n}) {\n    if (params.filters) {\n        Object.assign(filters, params.filters);\n    }\n    if (params.options) {\n        Object.assign(options, params.options);\n    }\n}\n\nfunction applyFilterRecursive(data, params = {}, isRoot = false) {\n    if (isRoot && !_.isFunction(data.$filter)) {\n        data.$filter = defaultFilterFunction;\n    }\n\n    if (data.$filter) {\n        check(data.$filter, Match.OneOf(Function, [Function]));\n\n        data.$filters = data.$filters || {};\n        data.$options = data.$options || {};\n\n        if (_.isArray(data.$filter)) {\n            data.$filter.forEach(filter => {\n                filter.call(null, {\n                    filters: data.$filters,\n                    options: data.$options,\n                    params: params\n                })\n            });\n        } else {\n            data.$filter({\n                filters: data.$filters,\n                options: data.$options,\n                params: params\n            });\n        }\n\n        data.$filter = null;\n        delete(data.$filter);\n    }\n\n    _.each(data, (value, key) => {\n        if (_.isObject(value)) {\n            return applyFilterRecursive(value, params);\n        }\n    })\n}\n\nfunction applyPagination(body, _params) {\n    if (body['$paginate'] && _params) {\n        if (!body.$options) {\n            body.$options = {};\n        }\n\n        if (_params.limit) {\n            _.extend(body.$options, {\n                limit: _params.limit\n            })\n        }\n\n        if (_params.skip) {\n            _.extend(body.$options, {\n                skip: _params.skip\n            })\n        }\n\n        delete body['$paginate'];\n    }\n}\n\nexport default (_body, _params = {}) => {\n    let body = deepClone(_body);\n    let params = deepClone(_params);\n\n    applyPagination(body, params);\n    applyFilterRecursive(body, params, true);\n\n    return body;\n}\n","import applyProps from './applyProps.js';\nimport {getNodeNamespace} from './createGraph';\n\n/**\n * Adds _query_path fields to the cursor docs which are used for scoped query filtering on the client.\n * \n * @param cursor \n * @param ns \n */\nfunction patchCursor(cursor, ns) {\n    const originalObserve = cursor.observe;\n    cursor.observe = function (callbacks) {\n        const newCallbacks = Object.assign({}, callbacks);\n        if (callbacks.added) {\n            newCallbacks.added = doc => {\n                doc = _.clone(doc);\n                doc[`_query_path_${ns}`] = 1;\n                callbacks.added(doc);\n            };\n        }\n        return originalObserve.call(cursor, newCallbacks);\n    };\n}\n\nfunction compose(node, userId, config) {\n    return {\n        find(parent) {\n            if (parent) {\n                let {filters, options} = applyProps(node);\n\n                // composition\n                let linker = node.linker;\n                let accessor = linker.createLink(parent);\n\n                // the rule is this, if a child I want to fetch is virtual, then I want to fetch the link storage of those fields\n                if (linker.isVirtual()) {\n                    options.fields = options.fields || {};\n                    _.extend(options.fields, {\n                        [linker.linkStorageField]: 1\n                    });\n                }\n\n                const cursor = accessor.find(filters, options, userId);\n                if (config.scoped) {\n                    patchCursor(cursor, getNodeNamespace(node));\n                }\n                return cursor;\n            }\n        },\n\n        children: _.map(node.collectionNodes, n => compose(n, userId, config))\n    }\n}\n\nexport default (node, userId, config = {bypassFirewalls: false, scoped: false}) => {\n    return {\n        find() {\n            let {filters, options} = applyProps(node);\n\n            const cursor = node.collection.find(filters, options, userId);\n            if (config.scoped) {\n                patchCursor(cursor, getNodeNamespace(node));\n            }\n            return cursor;\n        },\n\n        children: _.map(node.collectionNodes, n => {\n            const userIdToPass = (config.bypassFirewalls) ? undefined : userId;\n\n            return compose(n, userIdToPass, config);\n        })\n    }\n}\n","import applyProps from './applyProps.js';\nimport { assembleMetadata, removeLinkStorages, storeOneResults } from './prepareForDelivery';\nimport prepareForDelivery from './prepareForDelivery';\nimport {getNodeNamespace} from './createGraph';\n\n/**\n * This is always run client side to build the data graph out of client-side collections.\n *\n * @param node\n * @param parentObject\n * @param fetchOptions\n * @returns {*}\n */\nfunction fetch(node, parentObject, fetchOptions = {}) {\n    let {filters, options} = applyProps(node);\n    // add subscription filter\n    if (fetchOptions.scoped && fetchOptions.subscriptionHandle) {\n        _.extend(filters, fetchOptions.subscriptionHandle.scopeQuery());\n    }\n    // add query path filter\n    if (fetchOptions.scoped) {\n        _.extend(filters, {[`_query_path_${getNodeNamespace(node)}`]: {$exists: true}});\n    }\n\n    let results = [];\n\n    if (parentObject) {\n        let accessor = node.linker.createLink(parentObject, node.collection);\n\n        if (node.isVirtual) {\n            options.fields = options.fields || {};\n            _.extend(options.fields, {\n                [node.linkStorageField]: 1\n            });\n        }\n\n        results = accessor.find(filters, options).fetch();\n    } else {\n        results = node.collection.find(filters, options).fetch();\n    }\n\n    _.each(node.collectionNodes, collectionNode => {\n        _.each(results, result => {\n            const collectionNodeResults = fetch(collectionNode, result);\n            result[collectionNode.linkName] = collectionNodeResults;\n            //delete result[node.linker.linkStorageField];\n\n            /**\n             * Push into the results, because snapBackCaches() in prepareForDelivery does not work otherwise.\n             * This is non-optimal, can we be sure that every item in results contains _id and add only if not in\n             * the results?\n             *\n             * Other possible ways:\n             * - do something like assemble() in storeHypernovaResults\n             * - pass node.results to accessor above and find with sift\n             */\n\n            collectionNode.results.push(...collectionNodeResults);\n\n            // this was not working because all references must be replaced in snapBackCaches, not only the ones that are \n            // found first\n            // const currentIds = _.pluck(collectionNode.results, '_id');\n            // collectionNode.results.push(...collectionNodeResults.filter(res => !_.contains(currentIds, res._id)));\n        })\n    });\n\n    return results;\n}\n\nexport default (node, params, fetchOptions) => {\n    node.results = fetch(node, null, fetchOptions);\n\n    prepareForDelivery(node, params);\n\n    return node.results;\n}\n","import FieldNode from './fieldNode.js';\nimport ReducerNode from './reducerNode.js';\nimport deepClone from 'lodash.clonedeep';\nimport {check, Match} from 'meteor/check';\n\nexport default class CollectionNode {\n    constructor(collection, body = {}, linkName = null) {\n        if (collection && !_.isObject(body)) {\n            throw new Meteor.Error('invalid-body', `The field \"${linkName}\" is a collection link, and should have its body defined as an object.`);\n        }\n\n        this.body = deepClone(body);\n        this.linkName = linkName;\n        this.collection = collection;\n\n        this.nodes = [];\n        this.props = {};\n        this.parent = null;\n        this.linker = null;\n        this.linkStorageField = null;\n        this.scheduledForDeletion = false;\n        this.reducers = [];\n        this.results = [];\n        this.snapCaches = {}; // {cacheField: linkName}\n        this.snapCachesSingles = []; // [cacheField1, cacheField2]\n    }\n\n    get collectionNodes() {\n        return _.filter(this.nodes, n => n instanceof CollectionNode)\n    }\n\n    get fieldNodes() {\n        return _.filter(this.nodes, n => n instanceof FieldNode);\n    }\n\n    get reducerNodes() {\n        return _.filter(this.nodes, n => n instanceof ReducerNode);\n    }\n\n    /**\n     * Adds children to itself\n     *\n     * @param node\n     * @param linker\n     */\n    add(node, linker) {\n        node.parent = this;\n\n        if (node instanceof FieldNode) {\n            runFieldSanityChecks(node.name);\n        }\n        \n        if (linker) {\n            node.linker = linker;\n            node.linkStorageField = linker.linkStorageField;\n            node.isMeta = linker.isMeta();\n            node.isVirtual = linker.isVirtual();\n            node.isOneResult = linker.isOneResult();\n            node.shouldCleanStorage = this._shouldCleanStorage(node);\n        }\n\n        this.nodes.push(node);\n    }\n\n    /**\n     * @param prop\n     * @param value\n     */\n    addProp(prop, value) {\n        if (prop === '$postFilter') {\n            check(value, Match.OneOf(Function, [Function]))\n        }\n\n        _.extend(this.props, {\n            [prop]: value\n        });\n    }\n\n    /**\n     * @param _node\n     */\n    remove(_node) {\n        this.nodes = _.filter(this.nodes, node => _node !== node);\n    }\n\n    /**\n     * @param filters\n     * @param options\n     */\n    applyFields(filters, options) {\n        let hasAddedAnyField = false;\n\n        _.each(this.fieldNodes, n => {\n            /**\n             * $meta field should be added to the options.fields, but MongoDB does not exclude other fields.\n             * Therefore, we do not count this as a field addition.\n             * \n             * See: https://docs.mongodb.com/manual/reference/operator/projection/meta/\n             * The $meta expression specifies the inclusion of the field to the result set \n             * and does not specify the exclusion of the other fields.\n             */\n            if (n.projectionOperator !== '$meta') {\n                hasAddedAnyField = true;\n            }\n            n.applyFields(options.fields)\n        });\n\n        // it will only get here if it has collectionNodes children\n        _.each(this.collectionNodes, (collectionNode) => {\n            let linker = collectionNode.linker;\n\n            if (linker && !linker.isVirtual()) {\n                options.fields[linker.linkStorageField] = 1;\n                hasAddedAnyField = true;\n            }\n        });\n\n        // if he selected filters, we should automatically add those fields\n        _.each(filters, (value, field) => {\n            // special handling for the $meta filter, conditional operators and text search\n            if (!_.contains(['$or', '$nor', '$not', '$and', '$meta', '$text'], field)) {\n                // if the field or the parent of the field already exists, don't add it\n                if (!_.has(options.fields, field.split('.')[0])){\n                    hasAddedAnyField = true;\n                    options.fields[field] = 1;\n                }\n            }\n        });\n\n        if (!hasAddedAnyField) {\n            options.fields = {\n                _id: 1,\n                // fields might contain $meta expression, so it should be added here,\n                ...options.fields,\n            };\n        }\n    }\n\n    /**\n     * @param fieldName\n     * @returns {boolean}\n     */\n    hasField(fieldName, checkNested = false) {\n        // for checkNested flag it expands profile.phone.verified into \n        // ['profile', 'profile.phone', 'profile.phone.verified']\n        // if any of these fields match it means that field exists\n        const options = checkNested ? fieldName.split('.').reduce((acc, key) => {\n            if (acc.length === 0) {\n                return [key];\n            }\n            const [last] = acc;\n            return [...acc, `${last}.${key}`];\n        }, []) : [fieldName];\n\n        return !!_.find(this.fieldNodes, fieldNode => {\n            return _.contains(options, fieldNode.name);\n        });\n    }\n\n    /**\n     * @param fieldName\n     * @returns {FieldNode}\n     */\n    getField(fieldName) {\n        return _.find(this.fieldNodes, fieldNode => {\n            return fieldNode.name == fieldName\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {boolean}\n     */\n    hasCollectionNode(name) {\n        return !!_.find(this.collectionNodes, node => {\n            return node.linkName == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {boolean}\n     */\n    hasReducerNode(name) {\n        return !!_.find(this.reducerNodes, node => {\n            return node.name == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {ReducerNode}\n     */\n    getReducerNode(name) {\n        return _.find(this.reducerNodes, node => {\n            return node.name == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {CollectionNode}\n     */\n    getCollectionNode(name) {\n        return _.find(this.collectionNodes, node => {\n            return node.linkName == name\n        })\n    }\n\n    /**\n     * @returns {*}\n     */\n    getName() {\n        return this.linkName\n            ? this.linkName\n            : (this.collection ? this.collection._name : 'N/A');\n    }\n\n    /**\n     * This is used for caching links\n     *\n     * @param cacheField\n     * @param subLinkName\n     */\n    snapCache(cacheField, subLinkName) {\n        this.snapCaches[cacheField] = subLinkName;\n\n        if (this.collection.getLinker(subLinkName).isOneResult()) {\n            this.snapCachesSingles.push(cacheField);\n        }\n    }\n\n    /**\n     * This method verifies whether to remove the linkStorageField form the results\n     * unless you specify it in your query.\n     *\n     * @param node\n     * @returns {boolean}\n     * @private\n     */\n    _shouldCleanStorage(node) {\n        if (node.linkStorageField === '_id') {\n            return false;\n        } else {\n            if (node.isVirtual) {\n                return !node.hasField(node.linkStorageField);\n            } else {\n                return !this.hasField(node.linkStorageField);\n            }\n        }\n    }\n}\n\n/**\n * Make sure that the field is ok to be added\n * @param {*} fieldName \n */\nexport function runFieldSanityChecks(fieldName) {\n    // Run sanity checks on the field\n    if (fieldName[0] === '$') {\n        throw new Error(`You are not allowed to use fields that start with $ inside a reducer's body: ${fieldName}`);\n    }\n\n    return true;\n}\n","export default class FieldNode {\n    constructor(name, body, isProjectionOperator = false) {\n        this.name = name;\n        this.projectionOperator = isProjectionOperator ? _.keys(body)[0] : null;\n        this.body = !_.isObject(body) || isProjectionOperator ? body : 1;\n        this.scheduledForDeletion = false;\n    }\n\n    applyFields(fields) {\n        fields[this.name] = this.body;\n    }\n}","export default class ReducerNode {\n    constructor(name, {body, reduce}) {\n        this.name = name;\n        this.body = body;\n        this.reduceFunction = reduce;\n        this.dependencies = []; // This is a list of the reducer this reducer uses.\n    }\n\n    /**\n     * When computing we also pass the parameters\n     * \n     * @param {*} object \n     * @param {*} args \n     */\n    compute(object, ...args) {\n        object[this.name] = this.reduce.call(this, object, ...args);\n    }\n\n    reduce(object, ...args) {\n        return this.reduceFunction.call(this, object, ...args);\n    }\n}","import { check } from 'meteor/check';\nimport addFieldMap from './lib/addFieldMap';\n\nconst storage = '__reducers';\nObject.assign(Mongo.Collection.prototype, {\n    /**\n     * @param data\n     */\n    addReducers(data) {\n        if (!this[storage]) {\n            this[storage] = {};\n        }\n\n        _.each(data, (reducerConfig, reducerName) => {\n            if (!this[reducerConfig]) {\n                this[reducerConfig] = {};\n            }\n\n            if (this.getLinker(reducerName)) {\n                throw new Meteor.Error(\n                    `You cannot add the reducer with name: ${reducerName} because it is already defined as a link in ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            if (this[reducerConfig][reducerName]) {\n                throw new Meteor.Error(\n                    `You cannot add the reducer with name: ${reducerName} because it was already added to ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            check(reducerConfig, {\n                body: Object,\n                reduce: Function,\n            });\n\n            _.extend(this[storage], {\n                [reducerName]: reducerConfig,\n            });\n        });\n    },\n\n    /**\n     * @param name\n     * @returns {*}\n     */\n    getReducer(name) {\n        if (this[storage]) {\n            return this[storage][name];\n        }\n    },\n\n    /**\n     * This creates reducers that makes sort of aliases for the database fields we use\n     */\n    addFieldMap,\n});\n","/**\n * @param {[niceField: string]: dbField} map\n */\nexport default function addFieldMap(map) {\n    const collection = this;\n    let reducers = {};\n    for (let key in map) {\n        const dbField = map[key];\n        reducers[key] = {\n            body: {\n                [dbField]: 1,\n            },\n            reduce(obj) {\n                return obj[dbField];\n            },\n        };\n    }\n\n    collection.addReducers(reducers);\n}\n","export default function applyReducers(root, params) {\n    _.each(root.collectionNodes, node => {\n        applyReducers(node, params);\n    });\n\n    const processedReducers = [];\n    let reducersQueue = [...root.reducerNodes];\n\n    // TODO: find out if there's an infinite reducer inter-deendency\n\n    while (reducersQueue.length) {\n        const reducerNode = reducersQueue.shift();\n\n        // If this reducer depends on other reducers\n        if (reducerNode.dependencies.length) {\n            // If there is an unprocessed reducer, move it at the end of the queue\n            const allDependenciesComputed = _.all(reducerNode.dependencies, dep => processedReducers.includes(dep));\n            if (allDependenciesComputed) {\n                root.results.forEach(result => {\n                    reducerNode.compute(result, params);\n                });\n                processedReducers.push(reducerNode.name);\n            } else {\n                // Move it at the end of the queue\n                reducersQueue.push(reducerNode);\n            }\n        } else {\n            root.results.forEach(result => {\n                reducerNode.compute(result, params);\n            });\n\n            processedReducers.push(reducerNode.name);\n        }\n    }\n}\n","import dot from 'dot-object';\n\n/**\n * @param root\n */\nexport default function cleanReducerLeftovers(root, results) {\n    _.each(root.collectionNodes, node => {\n        if (node.scheduledForDeletion) {\n            results.forEach(result => {\n                delete result[node.linkName];\n            })\n        }\n    });\n\n    _.each(root.collectionNodes, node => {\n        let childResults;\n        if (node.isOneResult) {\n            childResults = results.map(result => result[node.linkName]).filter(element => !!element);\n        } else {\n            childResults = _.flatten(results.map(result => result[node.linkName]).filter(element => !!element));\n        }\n\n        cleanReducerLeftovers(node, childResults);\n    });\n\n    _.each(root.fieldNodes, node => {\n        if (node.scheduledForDeletion) {\n            cleanNestedFields(node.name.split('.'), results, root);\n        }\n    });\n\n    _.each(root.reducerNodes, node => {\n        if (node.scheduledForDeletion) {\n            results.forEach(result => {\n                delete result[node.name];\n            })\n        }\n    });\n}\n\n\n// if we store a field like: 'profile.firstName'\n// then we need to delete profile: { firstName }\n// if profile will have empty keys, we need to delete profile.\n\n/**\n * Cleans what reducers needed to be computed and not used.\n * @param parts\n * @param results\n */\nfunction cleanNestedFields(parts, results, root) {\n    const snapCacheField = root.snapCaches[parts[0]];\n    const fieldName = snapCacheField ? snapCacheField : parts[0];\n\n    if (parts.length === 1) {\n        results.forEach(result => {\n            if (_.isObject(result) && fieldName !== '_id') {\n                delete result[fieldName];\n            }\n        });\n\n        return;\n    }\n\n    parts.shift();\n    cleanNestedFields(\n        parts, \n        results\n            .filter(result => !!result[fieldName])\n            .map(result => result[fieldName]),\n        root\n    );\n    \n    results.forEach(result => {\n        if (_.isObject(result[fieldName]) && _.keys(result[fieldName]).length === 0) {\n            if (fieldName !== '_id') {\n                delete result[fieldName];\n            }\n        }\n    })\n}\n","import dot from 'dot-object';\nimport { createNodes } from '../../lib/createGraph';\nimport CollectionNode from '../../nodes/collectionNode';\nimport FieldNode from '../../nodes/fieldNode';\nimport ReducerNode from '../../nodes/reducerNode';\nimport embedReducerWithLink from './embedReducerWithLink';\nimport { specialFields } from '../../lib/createGraph';\n\nexport default function addReducers(root) {\n    // we add reducers last, after we have added all the fields.\n    root.reducerNodes.forEach(reducer => {\n        _.each(reducer.body, (body, fieldName) => {\n            handleAddElement(reducer, root, fieldName, body);\n        })\n    });\n}\n\n/**\n * @param root\n * @param fieldName\n * @param body\n */\nexport function handleAddElement(reducerNode, root, fieldName, body) {\n    // if it's a link\n    const collection = root.collection;\n    const linker = collection.getLinker(fieldName);\n    if (linker) {\n        return handleAddLink(reducerNode, fieldName, body, root, linker);\n    }\n\n    const reducer = collection.getReducer(fieldName);\n    if (reducer) {\n        reducerNode.dependencies.push(fieldName);\n        return handleAddReducer(fieldName, reducer, root);\n    }\n\n    // we assume it's a field in this case\n    return handleAddField(fieldName, body, root);\n}\n\n/**\n * @param fieldName\n * @param reducer\n * @param root\n */\nexport function handleAddReducer(fieldName, {body, reduce}, root) {\n    if (!root.hasReducerNode(fieldName)) {\n        let childReducerNode = new ReducerNode(fieldName, {body, reduce});\n        root.add(childReducerNode);\n        childReducerNode.scheduledForDeletion = true;\n\n        _.each(childReducerNode.body, (body, fieldName) => {\n            handleAddElement(childReducerNode, root, fieldName, body);\n        })\n    }\n}\n\n/**\n * @param fieldName\n * @param body\n * @param root\n * @param linker\n */\nexport function handleAddLink(reducerNode, fieldName, body, parent, linker) {\n    if (parent.hasCollectionNode(fieldName)) {\n        const collectionNode = parent.getCollectionNode(fieldName);\n\n        embedReducerWithLink(reducerNode, body, collectionNode);\n    } else {\n        // add\n        let collectionNode = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n        collectionNode.scheduledForDeletion = true;\n        parent.add(collectionNode, linker);\n\n        createNodes(collectionNode);\n    }\n}\n\n/**\n * @param fieldName\n * @param body\n * @param root\n */\nexport function handleAddField(fieldName, body, root) {\n    if (_.contains(specialFields, fieldName)) {\n        root.addProp(fieldName, body);\n\n        return;\n    }\n\n    if (_.isObject(body)) {\n        // if reducer specifies a nested field\n        // if it's a prop\n        const dots = dot.dot({\n            [fieldName]: body\n        });\n\n        _.each(dots, (value, key) => {\n            addFieldIfRequired(root, key, value);\n        });\n    } else {\n        // if reducer does not specify a nested field, and the field does not exist.\n        addFieldIfRequired(root, fieldName, body);\n    }\n}\n\nfunction addFieldIfRequired(root, fieldName, body) {\n    if (!root.hasField(fieldName, true)) {\n        /**\n         * Check if there are any nested fields for this field.\n         * Adding root field here and scheduling for deletion would not work if there is already nested field, \n         * for example:\n         * when trying to add meta: 1, it should be checked that there are no meta.* fields\n         * */\n\n        const nestedFields = root.fieldNodes.filter(({name}) => name.startsWith(`${fieldName}.`));\n        // remove nested fields - important for minimongo which complains for these situations\n        // TODO: excess fields are not removed (caused by adding the root field and removing nested fields) but there\n        // should probably be a way to handle this in post-processing - for example by keeping a whitelist of fields\n        // and removing anything else\n        nestedFields.forEach(node => root.remove(node));\n \n        let fieldNode = new FieldNode(fieldName, body);\n        // delete only if all nested fields are scheduled for deletion (that includes the case of 0 nested fields)\n        fieldNode.scheduledForDeletion = nestedFields.every(field => field.scheduledForDeletion);\n\n        root.add(fieldNode);\n    }\n}\n","import {handleAddField, handleAddElement, handleAddReducer} from './createReducers';\n\n/**\n * Embeds the reducer body with a collection body\n * @param reducerBody\n * @param collectionNode\n */\nexport default function embedReducerWithLink(reducerNode, reducerBody, collectionNode) {\n    _.each(reducerBody, (value, key) => {\n        const collection = collectionNode.collection;\n\n        if (_.isObject(value)) {\n            // nested field or link\n            if (collectionNode.body[key]) {\n                // if it exists\n                const linker = collection.getLinker(key);\n\n                // if it's a link\n                if (linker) {\n                    if (linker.isDenormalized()) {\n                        if (linker.isSubBodyDenormalized(value)) {\n                            const cacheField = linker.linkConfig.denormalize.field;\n                            handleAddField(cacheField, value, collectionNode);\n                            return;\n                        }\n                    }\n\n                    embedReducerWithLink(reducerNode, value, collectionNode.getCollectionNode(key));\n                    return;\n                }\n\n                handleAddField(key, value, collectionNode);\n            } else {\n                // does not exist, so it may be a link/reducer/field\n                handleAddElement(reducerNode, collectionNode, key, value);\n            }\n        } else {\n            // if this field or other reducer exists within the collection\n\n            if (!collectionNode.body[key]) {\n                // can only be field or another reducer for this.\n                const reducer = collection.getReducer(key);\n                if (reducer) {\n                    // if it's another reducer\n                    return handleAddReducer(key, reducer, collectionNode);\n                }\n\n                return handleAddField(key, value, collectionNode);\n            }\n        }\n    })\n}"]}