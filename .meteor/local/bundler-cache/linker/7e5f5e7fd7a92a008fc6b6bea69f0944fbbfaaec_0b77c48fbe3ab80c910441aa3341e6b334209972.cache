[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar _ = Package.underscore._;\nvar Promise = Package.promise.Promise;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar ReactiveVar = Package['reactive-var'].ReactiveVar;\nvar Mongo = Package.mongo.Mongo;\nvar CollectionHooks = Package['matb33:collection-hooks'].CollectionHooks;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nvar Symbol = Package['ecmascript-runtime-client'].Symbol;\nvar Map = Package['ecmascript-runtime-client'].Map;\nvar Set = Package['ecmascript-runtime-client'].Set;\n\n/* Package-scope variables */\nvar body, dotize;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"cultofcoders:grapher\":{\"main.client.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/main.client.js                                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.watch(require(\"./lib/extension.js\"));\nmodule.watch(require(\"./lib/links/extension.js\"));\nmodule.watch(require(\"./lib/query/reducers/extension.js\"));\nmodule.watch(require(\"./lib/createQuery.js\"), {\n  \"default\": function (v) {\n    exports.createQuery = v;\n  }\n}, 0);\nmodule.watch(require(\"./lib/query/lib/prepareForProcess\"), {\n  \"default\": function (v) {\n    exports.prepareForProcess = v;\n  }\n}, 1);\nmodule.watch(require(\"./lib/query/query.client\"), {\n  \"default\": function (v) {\n    exports.Query = v;\n  }\n}, 2);\nmodule.watch(require(\"./lib/namedQuery/namedQuery.client\"), {\n  \"default\": function (v) {\n    exports.NamedQuery = v;\n  }\n}, 3);\nmodule.watch(require(\"./lib/compose\"), {\n  \"default\": function (v) {\n    exports.compose = v;\n  }\n}, 4);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"compose.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/compose.js                                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar deepExtend;\nmodule.watch(require(\"deep-extend\"), {\n  \"default\": function (v) {\n    deepExtend = v;\n  }\n}, 0);\nmodule.exportDefault(function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return deepExtend.apply(void 0, [{}].concat(args));\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"createQuery.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/createQuery.js                                                                   //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar Query;\nmodule.watch(require(\"./query/query.js\"), {\n  \"default\": function (v) {\n    Query = v;\n  }\n}, 0);\nvar NamedQuery;\nmodule.watch(require(\"./namedQuery/namedQuery.js\"), {\n  \"default\": function (v) {\n    NamedQuery = v;\n  }\n}, 1);\nvar NamedQueryStore;\nmodule.watch(require(\"./namedQuery/store.js\"), {\n  \"default\": function (v) {\n    NamedQueryStore = v;\n  }\n}, 2);\nmodule.exportDefault(function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  if (typeof args[0] === 'string') {\n    var name = args[0],\n        body = args[1],\n        options = args[2];\n    options = options || {}; // It's a resolver query\n\n    if (_.isFunction(body)) {\n      return createNamedQuery(name, null, body, options);\n    }\n\n    var entryPointName = _.first(_.keys(body));\n\n    var collection = Mongo.Collection.get(entryPointName);\n\n    if (!collection) {\n      throw new Meteor.Error('invalid-name', \"We could not find any collection with the name \\\"\" + entryPointName + \"\\\". Make sure it is imported prior to using this\");\n    }\n\n    return createNamedQuery(name, collection, body[entryPointName], options);\n  } else {\n    // Query Creation, it can have an endpoint as collection or as a NamedQuery\n    var _body = args[0],\n        _options = args[1];\n    _options = _options || {};\n\n    var _entryPointName = _.first(_.keys(_body));\n\n    var _collection = Mongo.Collection.get(_entryPointName);\n\n    if (!_collection) {\n      if (Meteor.isDevelopment && !NamedQueryStore.get(_entryPointName)) {\n        console.warn(\"You are creating a query with the entry point \\\"\" + _entryPointName + \"\\\", but there was no collection found for it (maybe you forgot to import it client-side?). It's assumed that it's referencing a NamedQuery.\");\n      }\n\n      return createNamedQuery(_entryPointName, null, {}, {\n        params: _body[_entryPointName]\n      });\n    } else {\n      return createNormalQuery(_collection, _body[_entryPointName], _options);\n    }\n  }\n});\n\nfunction createNamedQuery(name, collection, body) {\n  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  // if it exists already, we re-use it\n  var namedQuery = NamedQueryStore.get(name);\n  var query;\n\n  if (!namedQuery) {\n    query = new NamedQuery(name, collection, body, options);\n    NamedQueryStore.add(name, query);\n  } else {\n    query = namedQuery.clone(options.params);\n  }\n\n  return query;\n}\n\nfunction createNormalQuery(collection, body, options) {\n  return new Query(collection, body, options);\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"extension.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/extension.js                                                                     //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar Query;\nmodule.watch(require(\"./query/query.js\"), {\n  \"default\": function (v) {\n    Query = v;\n  }\n}, 0);\nvar NamedQuery;\nmodule.watch(require(\"./namedQuery/namedQuery.js\"), {\n  \"default\": function (v) {\n    NamedQuery = v;\n  }\n}, 1);\nvar NamedQueryStore;\nmodule.watch(require(\"./namedQuery/store.js\"), {\n  \"default\": function (v) {\n    NamedQueryStore = v;\n  }\n}, 2);\n\n_.extend(Mongo.Collection.prototype, {\n  createQuery: function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (typeof args[0] === 'string') {\n      //NamedQuery\n      var name = args[0],\n          body = args[1],\n          options = args[2];\n      var query = new NamedQuery(name, this, body, options);\n      NamedQueryStore.add(name, query);\n      return query;\n    } else {\n      var _body = args[0],\n          _options = args[1];\n      return new Query(this, _body, _options);\n    }\n  }\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"links\":{\"config.schema.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/config.schema.js                                                           //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  DenormalizeSchema: function () {\n    return DenormalizeSchema;\n  },\n  LinkConfigDefaults: function () {\n    return LinkConfigDefaults;\n  },\n  LinkConfigSchema: function () {\n    return LinkConfigSchema;\n  }\n});\nvar Match;\nmodule.watch(require(\"meteor/check\"), {\n  Match: function (v) {\n    Match = v;\n  }\n}, 0);\nvar Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 1);\nvar DenormalizeSchema = {\n  field: String,\n  body: Object,\n  bypassSchema: Match.Maybe(Boolean)\n};\nvar LinkConfigDefaults = {\n  type: 'one'\n};\nvar LinkConfigSchema = {\n  type: Match.Maybe(Match.OneOf('one', 'many', '1', '*')),\n  collection: Match.Maybe(Match.Where(function (collection) {\n    // We do like this so it works with other types of collections \n    // like FS.Collection\n    return _.isObject(collection) && (collection instanceof Mongo.Collection || !!collection._collection);\n  })),\n  field: Match.Maybe(String),\n  metadata: Match.Maybe(Boolean),\n  inversedBy: Match.Maybe(String),\n  index: Match.Maybe(Boolean),\n  unique: Match.Maybe(Boolean),\n  autoremove: Match.Maybe(Boolean),\n  denormalize: Match.Maybe(Match.ObjectIncluding(DenormalizeSchema))\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"constants.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/constants.js                                                               //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  LINK_STORAGE: function () {\n    return LINK_STORAGE;\n  }\n});\nvar LINK_STORAGE = '__links';\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"extension.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/extension.js                                                               //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 0);\nvar LINK_STORAGE;\nmodule.watch(require(\"./constants.js\"), {\n  LINK_STORAGE: function (v) {\n    LINK_STORAGE = v;\n  }\n}, 1);\nvar Linker;\nmodule.watch(require(\"./linker.js\"), {\n  \"default\": function (v) {\n    Linker = v;\n  }\n}, 2);\nObject.assign(Mongo.Collection.prototype, {\n  /**\n   * The data we add should be valid for config.schema.js\n   */\n  addLinks: function (data) {\n    var _this = this;\n\n    if (!this[LINK_STORAGE]) {\n      this[LINK_STORAGE] = {};\n    }\n\n    _.each(data, function (linkConfig, linkName) {\n      var _$extend;\n\n      if (_this[LINK_STORAGE][linkName]) {\n        throw new Meteor.Error(\"You cannot add the link with name: \" + linkName + \" because it was already added to \" + _this._name + \" collection\");\n      }\n\n      var linker = new Linker(_this, linkName, linkConfig);\n\n      _.extend(_this[LINK_STORAGE], (_$extend = {}, _$extend[linkName] = linker, _$extend));\n    });\n  },\n  getLinks: function () {\n    return this[LINK_STORAGE];\n  },\n  getLinker: function (name) {\n    if (this[LINK_STORAGE]) {\n      return this[LINK_STORAGE][name];\n    }\n  },\n  hasLink: function (name) {\n    if (!this[LINK_STORAGE]) {\n      return false;\n    }\n\n    return !!this[LINK_STORAGE][name];\n  },\n  getLink: function (objectOrId, name) {\n    var linkData = this[LINK_STORAGE];\n\n    if (!linkData) {\n      throw new Meteor.Error(\"There are no links defined for collection: \" + this._name);\n    }\n\n    if (!linkData[name]) {\n      throw new Meteor.Error(\"There is no link \" + name + \" for collection: \" + this._name);\n    }\n\n    var linker = linkData[name];\n    var object = objectOrId;\n\n    if (typeof objectOrId == 'string') {\n      if (!linker.isVirtual()) {\n        var _fields;\n\n        object = this.findOne(objectOrId, {\n          fields: (_fields = {}, _fields[linker.linkStorageField] = 1, _fields)\n        });\n      } else {\n        object = {\n          _id: objectOrId\n        };\n      }\n\n      if (!object) {\n        throw new Meteor.Error(\"We could not find any object with _id: \\\"\" + objectOrId + \"\\\" within the collection: \" + this._name);\n      }\n    }\n\n    return linkData[name].createLink(object);\n  }\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"linker.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linker.js                                                                  //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nmodule.export({\n  \"default\": function () {\n    return Linker;\n  }\n});\nvar LinkMany;\nmodule.watch(require(\"./linkTypes/linkMany.js\"), {\n  \"default\": function (v) {\n    LinkMany = v;\n  }\n}, 0);\nvar LinkManyMeta;\nmodule.watch(require(\"./linkTypes/linkManyMeta.js\"), {\n  \"default\": function (v) {\n    LinkManyMeta = v;\n  }\n}, 1);\nvar LinkOne;\nmodule.watch(require(\"./linkTypes/linkOne.js\"), {\n  \"default\": function (v) {\n    LinkOne = v;\n  }\n}, 2);\nvar LinkOneMeta;\nmodule.watch(require(\"./linkTypes/linkOneMeta.js\"), {\n  \"default\": function (v) {\n    LinkOneMeta = v;\n  }\n}, 3);\nvar LinkConfigSchema, LinkConfigDefaults;\nmodule.watch(require(\"./config.schema.js\"), {\n  LinkConfigSchema: function (v) {\n    LinkConfigSchema = v;\n  },\n  LinkConfigDefaults: function (v) {\n    LinkConfigDefaults = v;\n  }\n}, 4);\nvar smartArguments;\nmodule.watch(require(\"./linkTypes/lib/smartArguments\"), {\n  \"default\": function (v) {\n    smartArguments = v;\n  }\n}, 5);\nvar dot;\nmodule.watch(require(\"dot-object\"), {\n  \"default\": function (v) {\n    dot = v;\n  }\n}, 6);\nvar check;\nmodule.watch(require(\"meteor/check\"), {\n  check: function (v) {\n    check = v;\n  }\n}, 7);\n\nvar _;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function (v) {\n    _ = v;\n  }\n}, 8);\n\nvar Linker =\n/*#__PURE__*/\nfunction () {\n  /**\n   * @param mainCollection\n   * @param linkName\n   * @param linkConfig\n   */\n  function Linker(mainCollection, linkName, linkConfig) {\n    this.mainCollection = mainCollection;\n    this.linkConfig = Object.assign({}, LinkConfigDefaults, linkConfig);\n    this.linkName = linkName; // check linkName must not exist in schema\n\n    this._validateAndClean(); // initialize cascade removal hooks.\n\n\n    this._initAutoremove();\n\n    this._initDenormalization();\n\n    if (this.isVirtual()) {\n      // if it's a virtual field make sure that when this is deleted, it will be removed from the references\n      if (!linkConfig.autoremove) {\n        this._handleReferenceRemovalForVirtualLinks();\n      }\n    } else {\n      this._initIndex();\n    }\n  }\n  /**\n   * Values which represent for the relation a single link\n   * @returns {string[]}\n   */\n\n\n  var _proto = Linker.prototype;\n\n  /**\n   * The collection that is linked with the current collection\n   * @returns Mongo.Collection\n   */\n  _proto.getLinkedCollection = function () {\n    function getLinkedCollection() {\n      return this.linkConfig.collection;\n    }\n\n    return getLinkedCollection;\n  }();\n  /**\n   * If the relationship for this link is of \"many\" type.\n   */\n\n\n  _proto.isMany = function () {\n    function isMany() {\n      return !this.isSingle();\n    }\n\n    return isMany;\n  }();\n  /**\n   * If the relationship for this link contains metadata\n   */\n\n\n  _proto.isMeta = function () {\n    function isMeta() {\n      if (this.isVirtual()) {\n        return this.linkConfig.relatedLinker.isMeta();\n      }\n\n      return !!this.linkConfig.metadata;\n    }\n\n    return isMeta;\n  }();\n  /**\n   * @returns {boolean}\n   */\n\n\n  _proto.isSingle = function () {\n    function isSingle() {\n      if (this.isVirtual()) {\n        return this.linkConfig.relatedLinker.isSingle();\n      }\n\n      return _.contains(this.oneTypes, this.linkConfig.type);\n    }\n\n    return isSingle;\n  }();\n  /**\n   * @returns {boolean}\n   */\n\n\n  _proto.isVirtual = function () {\n    function isVirtual() {\n      return !!this.linkConfig.inversedBy;\n    }\n\n    return isVirtual;\n  }();\n  /**\n   * Should return a single result.\n   */\n\n\n  _proto.isOneResult = function () {\n    function isOneResult() {\n      return this.isVirtual() && this.linkConfig.relatedLinker.linkConfig.unique || !this.isVirtual() && this.isSingle();\n    }\n\n    return isOneResult;\n  }();\n  /**\n   * @param object\n   * @param collection To impersonate the getLinkedCollection() of the \"Linker\"\n   *\n   * @returns {LinkOne|LinkMany|LinkManyMeta|LinkOneMeta|LinkResolve}\n   */\n\n\n  _proto.createLink = function () {\n    function createLink(object) {\n      var collection = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      var helperClass = this._getHelperClass();\n\n      return new helperClass(this, object, collection);\n    }\n\n    return createLink;\n  }();\n  /**\n   * @returns {*}\n   * @private\n   */\n\n\n  _proto._validateAndClean = function () {\n    function _validateAndClean() {\n      if (!this.linkConfig.collection) {\n        throw new Meteor.Error('invalid-config', \"For the link \" + this.linkName + \" you did not provide a collection.\");\n      }\n\n      if (typeof this.linkConfig.collection === 'string') {\n        var collectionName = this.linkConfig.collection;\n        this.linkConfig.collection = Mongo.Collection.get(collectionName);\n\n        if (!this.linkConfig.collection) {\n          throw new Meteor.Error('invalid-collection', \"Could not find a collection with the name: \" + collectionName);\n        }\n      }\n\n      if (this.isVirtual()) {\n        return this._prepareVirtual();\n      } else {\n        if (!this.linkConfig.type) {\n          this.linkConfig.type = 'one';\n        }\n\n        if (!this.linkConfig.field) {\n          this.linkConfig.field = this._generateFieldName();\n        } else {\n          if (this.linkConfig.field == this.linkName) {\n            throw new Meteor.Error('invalid-config', \"For the link \" + this.linkName + \" you must not use the same name for the field, otherwise it will cause conflicts when fetching data\");\n          }\n        }\n      }\n\n      check(this.linkConfig, LinkConfigSchema);\n    }\n\n    return _validateAndClean;\n  }();\n  /**\n   * We need to apply same type of rules in this case.\n   * @private\n   */\n\n\n  _proto._prepareVirtual = function () {\n    function _prepareVirtual() {\n      var _this = this;\n\n      var _this$linkConfig = this.linkConfig,\n          collection = _this$linkConfig.collection,\n          inversedBy = _this$linkConfig.inversedBy;\n      var linker = collection.getLinker(inversedBy);\n\n      if (!linker) {\n        // it is possible that the collection doesn't have a linker created yet.\n        // so we will create it on startup after all links have been defined\n        Meteor.startup(function () {\n          linker = collection.getLinker(inversedBy);\n\n          if (!linker) {\n            throw new Meteor.Error(\"You tried setting up an inversed link in \\\"\" + _this.mainCollection._name + \"\\\" pointing to collection: \\\"\" + collection._name + \"\\\" link: \\\"\" + inversedBy + \"\\\", but no such link was found. Maybe a typo ?\");\n          } else {\n            _this._setupVirtualConfig(linker);\n          }\n        });\n      } else {\n        this._setupVirtualConfig(linker);\n      }\n    }\n\n    return _prepareVirtual;\n  }();\n  /**\n   * @param linker\n   * @private\n   */\n\n\n  _proto._setupVirtualConfig = function () {\n    function _setupVirtualConfig(linker) {\n      var virtualLinkConfig = linker.linkConfig;\n\n      if (!virtualLinkConfig) {\n        throw new Meteor.Error(\"There is no link-config for the related collection on \" + inversedBy + \". Make sure you added the direct links before specifying virtual ones.\");\n      }\n\n      _.extend(this.linkConfig, {\n        metadata: virtualLinkConfig.metadata,\n        relatedLinker: linker\n      });\n    }\n\n    return _setupVirtualConfig;\n  }();\n  /**\n   * Depending on the strategy, we create the proper helper class\n   * @private\n   */\n\n\n  _proto._getHelperClass = function () {\n    function _getHelperClass() {\n      switch (this.strategy) {\n        case 'many-meta':\n          return LinkManyMeta;\n\n        case 'many':\n          return LinkMany;\n\n        case 'one-meta':\n          return LinkOneMeta;\n\n        case 'one':\n          return LinkOne;\n      }\n\n      throw new Meteor.Error('invalid-strategy', this.strategy + \" is not a valid strategy\");\n    }\n\n    return _getHelperClass;\n  }();\n  /**\n   * If field name not present, we generate it.\n   * @private\n   */\n\n\n  _proto._generateFieldName = function () {\n    function _generateFieldName() {\n      var cleanedCollectionName = this.linkConfig.collection._name.replace(/\\./g, '_');\n\n      var defaultFieldPrefix = this.linkName + '_' + cleanedCollectionName;\n\n      switch (this.strategy) {\n        case 'many-meta':\n          return defaultFieldPrefix + \"_metas\";\n\n        case 'many':\n          return defaultFieldPrefix + \"_ids\";\n\n        case 'one-meta':\n          return defaultFieldPrefix + \"_meta\";\n\n        case 'one':\n          return defaultFieldPrefix + \"_id\";\n      }\n    }\n\n    return _generateFieldName;\n  }();\n  /**\n   * When a link that is declared virtual is removed, the reference will be removed from every other link.\n   * @private\n   */\n\n\n  _proto._handleReferenceRemovalForVirtualLinks = function () {\n    function _handleReferenceRemovalForVirtualLinks() {\n      var _this2 = this;\n\n      this.mainCollection.after.remove(function (userId, doc) {\n        // this problem may occur when you do a .remove() before Meteor.startup()\n        if (!_this2.linkConfig.relatedLinker) {\n          console.warn(\"There was an error finding the link for removal for collection: \\\"\" + _this2.mainCollection._name + \"\\\" with link: \\\"\" + _this2.linkName + \"\\\". This may occur when you do a .remove() before Meteor.startup()\");\n          return;\n        }\n\n        var accessor = _this2.createLink(doc);\n\n        _.each(accessor.fetch(), function (linkedObj) {\n          var relatedLinker = _this2.linkConfig.relatedLinker; // We do this check, to avoid self-referencing hell when defining virtual links\n          // Virtual links if not found \"compile-time\", we will try again to reprocess them on Meteor.startup\n          // if a removal happens before Meteor.startup this may fail\n\n          if (relatedLinker) {\n            var link = relatedLinker.createLink(linkedObj);\n\n            if (relatedLinker.isSingle()) {\n              link.unset();\n            } else {\n              link.remove(doc);\n            }\n          }\n        });\n      });\n    }\n\n    return _handleReferenceRemovalForVirtualLinks;\n  }();\n\n  _proto._initIndex = function () {\n    function _initIndex() {\n      if (Meteor.isServer) {\n        var field = this.linkConfig.field;\n\n        if (this.linkConfig.metadata) {\n          field = field + '._id';\n        }\n\n        if (this.linkConfig.index) {\n          var _this$mainCollection$;\n\n          if (this.isVirtual()) {\n            throw new Meteor.Error('You cannot set index on an inversed link.');\n          }\n\n          var options;\n\n          if (this.linkConfig.unique) {\n            if (this.isMany()) {\n              throw new Meteor.Error('You cannot set unique property on a multi field.');\n            }\n\n            options = {\n              unique: true\n            };\n          }\n\n          this.mainCollection._ensureIndex((_this$mainCollection$ = {}, _this$mainCollection$[field] = 1, _this$mainCollection$), options);\n        } else {\n          if (this.linkConfig.unique) {\n            var _this$mainCollection$2;\n\n            if (this.isVirtual()) {\n              throw new Meteor.Error('You cannot set unique property on an inversed link.');\n            }\n\n            if (this.isMany()) {\n              throw new Meteor.Error('You cannot set unique property on a multi field.');\n            }\n\n            this.mainCollection._ensureIndex((_this$mainCollection$2 = {}, _this$mainCollection$2[field] = 1, _this$mainCollection$2), {\n              unique: true\n            });\n          }\n        }\n      }\n    }\n\n    return _initIndex;\n  }();\n\n  _proto._initAutoremove = function () {\n    function _initAutoremove() {\n      var _this3 = this;\n\n      if (!this.linkConfig.autoremove) {\n        return;\n      }\n\n      if (!this.isVirtual()) {\n        this.mainCollection.after.remove(function (userId, doc) {\n          _this3.getLinkedCollection().remove({\n            _id: {\n              $in: smartArguments.getIds(doc[_this3.linkStorageField])\n            }\n          });\n        });\n      } else {\n        this.mainCollection.after.remove(function (userId, doc) {\n          var linker = _this3.mainCollection.getLink(doc, _this3.linkName);\n\n          var ids = linker.find({}, {\n            fields: {\n              _id: 1\n            }\n          }).fetch().map(function (item) {\n            return item._id;\n          });\n\n          _this3.getLinkedCollection().remove({\n            _id: {\n              $in: ids\n            }\n          });\n        });\n      }\n    }\n\n    return _initAutoremove;\n  }();\n  /**\n   * Initializes denormalization using herteby:denormalize\n   * @private\n   */\n\n\n  _proto._initDenormalization = function () {\n    function _initDenormalization() {\n      var _this4 = this;\n\n      if (!this.linkConfig.denormalize || !Meteor.isServer) {\n        return;\n      }\n\n      var packageExists = !!Package['herteby:denormalize'];\n\n      if (!packageExists) {\n        throw new Meteor.Error('missing-package', \"Please add the herteby:denormalize package to your Meteor application in order to make caching work\");\n      }\n\n      var _this$linkConfig$deno = this.linkConfig.denormalize,\n          field = _this$linkConfig$deno.field,\n          body = _this$linkConfig$deno.body,\n          bypassSchema = _this$linkConfig$deno.bypassSchema;\n      var cacheConfig;\n      var referenceFieldSuffix = '';\n\n      if (this.isMeta()) {\n        referenceFieldSuffix = this.isSingle() ? '._id' : ':_id';\n      }\n\n      if (this.isVirtual()) {\n        var inversedLink = this.linkConfig.relatedLinker.linkConfig;\n        var type = inversedLink.type == 'many' ? 'many-inverse' : 'inversed';\n        cacheConfig = {\n          type: type,\n          collection: this.linkConfig.collection,\n          fields: body,\n          referenceField: inversedLink.field + referenceFieldSuffix,\n          cacheField: field,\n          bypassSchema: !!bypassSchema\n        };\n      } else {\n        cacheConfig = {\n          type: this.linkConfig.type,\n          collection: this.linkConfig.collection,\n          fields: body,\n          referenceField: this.linkConfig.field + referenceFieldSuffix,\n          cacheField: field,\n          bypassSchema: !!bypassSchema\n        };\n      }\n\n      if (this.isVirtual()) {\n        Meteor.startup(function () {\n          _this4.mainCollection.cache(cacheConfig);\n        });\n      } else {\n        this.mainCollection.cache(cacheConfig);\n      }\n    }\n\n    return _initDenormalization;\n  }();\n  /**\n   * Verifies if this linker is denormalized. It can be denormalized from the inverse side as well.\n   *\n   * @returns {boolean}\n   * @private\n   */\n\n\n  _proto.isDenormalized = function () {\n    function isDenormalized() {\n      return !!this.linkConfig.denormalize;\n    }\n\n    return isDenormalized;\n  }();\n  /**\n   * Verifies if the body of the linked element does not contain fields outside the cache body\n   *\n   * @param body\n   * @returns {boolean}\n   * @private\n   */\n\n\n  _proto.isSubBodyDenormalized = function () {\n    function isSubBodyDenormalized(body) {\n      var cacheBody = this.linkConfig.denormalize.body;\n\n      var cacheBodyFields = _.keys(dot.dot(cacheBody));\n\n      var bodyFields = _.keys(dot.dot(_.omit(body, '_id')));\n\n      return _.difference(bodyFields, cacheBodyFields).length === 0;\n    }\n\n    return isSubBodyDenormalized;\n  }();\n\n  (0, _createClass2.default)(Linker, [{\n    key: \"oneTypes\",\n    get: function () {\n      return ['one', '1'];\n    }\n    /**\n     * Returns the strategies: one, many, one-meta, many-meta\n     * @returns {string}\n     */\n\n  }, {\n    key: \"strategy\",\n    get: function () {\n      var strategy = this.isMany() ? 'many' : 'one';\n\n      if (this.linkConfig.metadata) {\n        strategy += '-meta';\n      }\n\n      return strategy;\n    }\n    /**\n     * Returns the field name in the document where the actual relationships are stored.\n     * @returns string\n     */\n\n  }, {\n    key: \"linkStorageField\",\n    get: function () {\n      if (this.isVirtual()) {\n        return this.linkConfig.relatedLinker.linkStorageField;\n      }\n\n      return this.linkConfig.field;\n    }\n  }]);\n  return Linker;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"createSearchFilters.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/lib/createSearchFilters.js                                                 //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return createSearchFilters;\n  },\n  createOne: function () {\n    return createOne;\n  },\n  createOneVirtual: function () {\n    return createOneVirtual;\n  },\n  createOneMeta: function () {\n    return createOneMeta;\n  },\n  createOneMetaVirtual: function () {\n    return createOneMetaVirtual;\n  },\n  createMany: function () {\n    return createMany;\n  },\n  createManyVirtual: function () {\n    return createManyVirtual;\n  },\n  createManyMeta: function () {\n    return createManyMeta;\n  },\n  createManyMetaVirtual: function () {\n    return createManyMetaVirtual;\n  }\n});\nvar sift;\nmodule.watch(require(\"sift\"), {\n  \"default\": function (v) {\n    sift = v;\n  }\n}, 0);\n\nfunction createSearchFilters(object, fieldStorage, strategy, isVirtual, metaFilters) {\n  if (!isVirtual) {\n    switch (strategy) {\n      case 'one':\n        return createOne(object, fieldStorage);\n\n      case 'one-meta':\n        return createOneMeta(object, fieldStorage, metaFilters);\n\n      case 'many':\n        return createMany(object, fieldStorage);\n\n      case 'many-meta':\n        return createManyMeta(object, fieldStorage, metaFilters);\n\n      default:\n        throw new Meteor.Error(\"Invalid linking strategy: \" + strategy);\n    }\n  } else {\n    switch (strategy) {\n      case 'one':\n        return createOneVirtual(object, fieldStorage);\n\n      case 'one-meta':\n        return createOneMetaVirtual(object, fieldStorage, metaFilters);\n\n      case 'many':\n        return createManyVirtual(object, fieldStorage);\n\n      case 'many-meta':\n        return createManyMetaVirtual(object, fieldStorage, metaFilters);\n\n      default:\n        throw new Meteor.Error(\"Invalid linking strategy: \" + strategy);\n    }\n  }\n}\n\nfunction createOne(object, fieldStorage) {\n  return {\n    _id: object[fieldStorage]\n  };\n}\n\nfunction createOneVirtual(object, fieldStorage) {\n  var _ref;\n\n  return _ref = {}, _ref[fieldStorage] = object._id, _ref;\n}\n\nfunction createOneMeta(object, fieldStorage, metaFilters) {\n  var value = object[fieldStorage];\n\n  if (metaFilters) {\n    if (!sift(metaFilters)(value)) {\n      return {\n        _id: undefined\n      };\n    }\n  }\n\n  return {\n    _id: value ? value._id : value\n  };\n}\n\nfunction createOneMetaVirtual(object, fieldStorage, metaFilters) {\n  var filters = {};\n\n  if (metaFilters) {\n    _.each(metaFilters, function (value, key) {\n      filters[fieldStorage + '.' + key] = value;\n    });\n  }\n\n  filters[fieldStorage + '._id'] = object._id;\n  return filters;\n}\n\nfunction createMany(object, fieldStorage) {\n  return {\n    _id: {\n      $in: object[fieldStorage] || []\n    }\n  };\n}\n\nfunction createManyVirtual(object, fieldStorage) {\n  var _ref2;\n\n  return _ref2 = {}, _ref2[fieldStorage] = object._id, _ref2;\n}\n\nfunction createManyMeta(object, fieldStorage, metaFilters) {\n  var value = object[fieldStorage];\n\n  if (metaFilters) {\n    value = sift(metaFilters, value);\n  }\n\n  return {\n    _id: {\n      $in: _.pluck(value, '_id') || []\n    }\n  };\n}\n\nfunction createManyMetaVirtual(object, fieldStorage, metaFilters) {\n  var _ref3;\n\n  var filters = {};\n\n  if (metaFilters) {\n    _.each(metaFilters, function (value, key) {\n      filters[key] = value;\n    });\n  }\n\n  filters._id = object._id;\n  return _ref3 = {}, _ref3[fieldStorage] = {\n    $elemMatch: filters\n  }, _ref3;\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"linkTypes\":{\"base.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linkTypes/base.js                                                          //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nmodule.export({\n  \"default\": function () {\n    return Link;\n  }\n});\nvar SmartArgs;\nmodule.watch(require(\"./lib/smartArguments.js\"), {\n  \"default\": function (v) {\n    SmartArgs = v;\n  }\n}, 0);\nvar createSearchFilters;\nmodule.watch(require(\"../lib/createSearchFilters\"), {\n  \"default\": function (v) {\n    createSearchFilters = v;\n  }\n}, 1);\n\nvar Link =\n/*#__PURE__*/\nfunction () {\n  (0, _createClass2.default)(Link, [{\n    key: \"config\",\n    get: function () {\n      return this.linker.linkConfig;\n    }\n  }, {\n    key: \"isVirtual\",\n    get: function () {\n      return this.linker.isVirtual();\n    }\n  }]);\n\n  function Link(linker, object, collection) {\n    this.linker = linker;\n    this.object = object;\n    this.linkedCollection = collection ? collection : linker.getLinkedCollection();\n\n    if (this.linker.isVirtual()) {\n      this.linkStorageField = this.config.relatedLinker.linkConfig.field;\n    } else {\n      this.linkStorageField = this.config.field;\n    }\n  }\n  /**\n   * Gets the stored link information value\n   * @returns {*}\n   */\n\n\n  var _proto = Link.prototype;\n\n  _proto.value = function () {\n    function value() {\n      if (this.isVirtual) {\n        throw new Meteor.Error('You can only take the value from the main link.');\n      }\n\n      return this.object[this.linkStorageField];\n    }\n\n    return value;\n  }();\n  /**\n   * Finds linked data.\n   *\n   * @param filters\n   * @param options\n   * @returns {*}\n   * @param userId\n   */\n\n\n  _proto.find = function () {\n    function find() {\n      var filters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var userId = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;\n      var linker = this.linker;\n      var linkedCollection = this.linkedCollection;\n      var $metaFilters;\n\n      if (filters.$meta) {\n        $metaFilters = filters.$meta;\n        delete filters.$meta;\n      }\n\n      var searchFilters = createSearchFilters(this.object, this.linkStorageField, linker.strategy, linker.isVirtual(), $metaFilters);\n\n      var appliedFilters = _.extend({}, filters, searchFilters); // see https://github.com/cult-of-coders/grapher/issues/134\n      // happens due to recursive importing of modules\n      // TODO: find another way to do this\n\n\n      if (linkedCollection.find) {\n        return linkedCollection.find(appliedFilters, options, userId);\n      } else {\n        return linkedCollection.default.find(appliedFilters, options, userId);\n      }\n    }\n\n    return find;\n  }();\n  /**\n   * @param filters\n   * @param options\n   * @param others\n   * @returns {*|{content}|any}\n   */\n\n\n  _proto.fetch = function () {\n    function fetch(filters, options) {\n      for (var _len = arguments.length, others = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        others[_key - 2] = arguments[_key];\n      }\n\n      var result = this.find.apply(this, [filters, options].concat(others)).fetch();\n\n      if (this.linker.isOneResult()) {\n        return _.first(result);\n      }\n\n      return result;\n    }\n\n    return fetch;\n  }();\n  /**\n   * When we are dealing with multiple type relationships, $in would require an array. If the field value is null, it will fail\n   * We use clean to make it an empty array by default.\n   */\n\n\n  _proto.clean = function () {\n    function clean() {}\n\n    return clean;\n  }();\n  /**\n   * Extracts a single id\n   */\n\n\n  _proto.identifyId = function () {\n    function identifyId(what, saveToDatabase) {\n      return SmartArgs.getId(what, {\n        saveToDatabase: saveToDatabase,\n        collection: this.linkedCollection\n      });\n    }\n\n    return identifyId;\n  }();\n  /**\n   * Extracts the ids of object(s) or strings and returns an array.\n   */\n\n\n  _proto.identifyIds = function () {\n    function identifyIds(what, saveToDatabase) {\n      return SmartArgs.getIds(what, {\n        saveToDatabase: saveToDatabase,\n        collection: this.linkedCollection\n      });\n    }\n\n    return identifyIds;\n  }();\n  /**\n   * Checks when linking data, if the ids are valid with the linked collection.\n   * @throws Meteor.Error\n   * @param ids\n   *\n   * @protected\n   */\n\n\n  _proto._validateIds = function () {\n    function _validateIds(ids) {\n      if (!_.isArray(ids)) {\n        ids = [ids];\n      }\n\n      var validIds = this.linkedCollection.find({\n        _id: {\n          $in: ids\n        }\n      }, {\n        fields: {\n          _id: 1\n        }\n      }).fetch().map(function (doc) {\n        return doc._id;\n      });\n\n      if (validIds.length != ids.length) {\n        throw new Meteor.Error('not-found', \"You tried to create links with non-existing id(s) inside \\\"\" + this.linkedCollection._name + \"\\\": \" + _.difference(ids, validIds).join(', '));\n      }\n    }\n\n    return _validateIds;\n  }();\n  /**\n   * This is for allowing commands such as set/unset/add/remove/metadata from the virtual link.\n   *\n   * @param action\n   * @param what\n   * @param metadata\n   *\n   * @protected\n   */\n\n\n  _proto._virtualAction = function () {\n    function _virtualAction(action, what, metadata) {\n      var _this = this;\n\n      var linker = this.linker.linkConfig.relatedLinker; // its an unset operation most likely.\n\n      if (what === undefined) {\n        var reversedLink = linker.createLink(this.fetch());\n        reversedLink.unset();\n        return;\n      }\n\n      if (!_.isArray(what)) {\n        what = [what];\n      }\n\n      what = _.map(what, function (element) {\n        if (!_.isObject(element)) {\n          return linker.mainCollection.findOne(element);\n        } else {\n          if (!element._id) {\n            var elementId = linker.mainCollection.insert(element);\n\n            _.extend(element, linker.mainCollection.findOne(elementId));\n          }\n\n          return element;\n        }\n      });\n      return _.map(what, function (element) {\n        var reversedLink = linker.createLink(element);\n\n        if (action == 'metadata') {\n          if (linker.isSingle()) {\n            return reversedLink.metadata(metadata);\n          } else {\n            return reversedLink.metadata(_this.object, metadata);\n          }\n        } else if (action == 'add' || action == 'set') {\n          if (linker.isSingle()) {\n            reversedLink.set(_this.object, metadata);\n          } else {\n            reversedLink.add(_this.object, metadata);\n          }\n        } else {\n          if (linker.isSingle()) {\n            reversedLink.unset();\n          } else {\n            reversedLink.remove(_this.object);\n          }\n        }\n      });\n    }\n\n    return _virtualAction;\n  }();\n\n  return Link;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"linkMany.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linkTypes/linkMany.js                                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return LinkMany;\n  }\n});\nvar Link;\nmodule.watch(require(\"./base.js\"), {\n  \"default\": function (v) {\n    Link = v;\n  }\n}, 0);\nvar SmartArgs;\nmodule.watch(require(\"./lib/smartArguments.js\"), {\n  \"default\": function (v) {\n    SmartArgs = v;\n  }\n}, 1);\n\nvar LinkMany =\n/*#__PURE__*/\nfunction (_Link) {\n  (0, _inheritsLoose2.default)(LinkMany, _Link);\n\n  function LinkMany() {\n    return _Link.apply(this, arguments) || this;\n  }\n\n  var _proto = LinkMany.prototype;\n\n  _proto.clean = function () {\n    function clean() {\n      if (!this.object[this.linkStorageField]) {\n        this.object[this.linkStorageField] = [];\n      }\n    }\n\n    return clean;\n  }();\n  /**\n   * Ads the _ids to the object.\n   * @param what\n   */\n\n\n  _proto.add = function () {\n    function add(what) {\n      var _$addToSet;\n\n      if (this.isVirtual) {\n        this._virtualAction('add', what);\n\n        return this;\n      } //if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/remove operations must be done from the owning-link of the relationship');\n\n\n      this.clean();\n\n      var _ids = this.identifyIds(what, true);\n\n      this._validateIds(_ids);\n\n      var field = this.linkStorageField; // update the field\n\n      this.object[field] = _.union(this.object[field], _ids); // update the db\n\n      var modifier = {\n        $addToSet: (_$addToSet = {}, _$addToSet[field] = {\n          $each: _ids\n        }, _$addToSet)\n      };\n      this.linker.mainCollection.update(this.object._id, modifier);\n      return this;\n    }\n\n    return add;\n  }();\n  /**\n   * @param what\n   */\n\n\n  _proto.remove = function () {\n    function remove(what) {\n      var _$pullAll;\n\n      if (this.isVirtual) {\n        this._virtualAction('remove', what);\n\n        return this;\n      }\n\n      if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/Remove operations should be done from the owner of the relationship');\n      this.clean();\n      var field = this.linkStorageField;\n\n      var _ids = this.identifyIds(what); // update the field\n\n\n      this.object[field] = _.filter(this.object[field], function (_id) {\n        return !_.contains(_ids, _id);\n      }); // update the db\n\n      var modifier = {\n        $pullAll: (_$pullAll = {}, _$pullAll[field] = _ids, _$pullAll)\n      };\n      this.linker.mainCollection.update(this.object._id, modifier);\n      return this;\n    }\n\n    return remove;\n  }();\n\n  _proto.set = function () {\n    function set(what) {\n      if (this.isVirtual) {\n        this._virtualAction('set', what);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    return set;\n  }();\n\n  _proto.unset = function () {\n    function unset(what) {\n      if (this.isVirtual) {\n        this._virtualAction('unset', what);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    return unset;\n  }();\n\n  return LinkMany;\n}(Link);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"linkManyMeta.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linkTypes/linkManyMeta.js                                                  //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return LinkManyMeta;\n  }\n});\nvar Link;\nmodule.watch(require(\"./base.js\"), {\n  \"default\": function (v) {\n    Link = v;\n  }\n}, 0);\nvar SmartArgs;\nmodule.watch(require(\"./lib/smartArguments.js\"), {\n  \"default\": function (v) {\n    SmartArgs = v;\n  }\n}, 1);\n\nvar LinkManyMeta =\n/*#__PURE__*/\nfunction (_Link) {\n  (0, _inheritsLoose2.default)(LinkManyMeta, _Link);\n\n  function LinkManyMeta() {\n    return _Link.apply(this, arguments) || this;\n  }\n\n  var _proto = LinkManyMeta.prototype;\n\n  _proto.clean = function () {\n    function clean() {\n      if (!this.object[this.linkStorageField]) {\n        this.object[this.linkStorageField] = [];\n      }\n    }\n\n    return clean;\n  }();\n  /**\n   * @param what\n   * @param metadata\n   */\n\n\n  _proto.add = function () {\n    function add(what) {\n      var _this = this,\n          _$addToSet;\n\n      var metadata = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (this.isVirtual) {\n        this._virtualAction('add', what, metadata);\n\n        return this;\n      }\n\n      var _ids = this.identifyIds(what, true);\n\n      this._validateIds(_ids);\n\n      var field = this.linkStorageField;\n      this.object[field] = this.object[field] || [];\n      var metadatas = [];\n\n      _.each(_ids, function (_id) {\n        var localMetadata = _.clone(metadata);\n\n        localMetadata._id = _id;\n\n        _this.object[field].push(localMetadata);\n\n        metadatas.push(localMetadata);\n      });\n\n      var modifier = {\n        $addToSet: (_$addToSet = {}, _$addToSet[field] = {\n          $each: metadatas\n        }, _$addToSet)\n      };\n      this.linker.mainCollection.update(this.object._id, modifier);\n      return this;\n    }\n\n    return add;\n  }();\n  /**\n   * @param what\n   * @param extendMetadata\n   */\n\n\n  _proto.metadata = function () {\n    function metadata(what, extendMetadata) {\n      if (this.isVirtual) {\n        this._virtualAction('metadata', what, extendMetadata);\n\n        return this;\n      }\n\n      var field = this.linkStorageField;\n\n      if (what === undefined) {\n        return this.object[field];\n      }\n\n      if (_.isArray(what)) {\n        throw new Meteor.Error('not-allowed', 'Metadata updates should be made for one entity only, not multiple');\n      }\n\n      var _id = this.identifyId(what);\n\n      var existingMetadata = _.find(this.object[field], function (metadata) {\n        return metadata._id == _id;\n      });\n\n      if (extendMetadata === undefined) {\n        return existingMetadata;\n      } else {\n        var _this$linker$mainColl, _$set;\n\n        _.extend(existingMetadata, extendMetadata);\n\n        var subfield = field + '._id';\n        var subfieldUpdate = field + '.$';\n        this.linker.mainCollection.update((_this$linker$mainColl = {\n          _id: this.object._id\n        }, _this$linker$mainColl[subfield] = _id, _this$linker$mainColl), {\n          $set: (_$set = {}, _$set[subfieldUpdate] = existingMetadata, _$set)\n        });\n      }\n\n      return this;\n    }\n\n    return metadata;\n  }();\n\n  _proto.remove = function () {\n    function remove(what) {\n      var _$pull;\n\n      if (this.isVirtual) {\n        this._virtualAction('remove', what);\n\n        return this;\n      }\n\n      var _ids = this.identifyIds(what);\n\n      var field = this.linkStorageField;\n      this.object[field] = _.filter(this.object[field], function (link) {\n        return !_.contains(_ids, link._id);\n      });\n      var modifier = {\n        $pull: (_$pull = {}, _$pull[field] = {\n          $elemMatch: {\n            _id: {\n              $in: _ids\n            }\n          }\n        }, _$pull)\n      };\n      this.linker.mainCollection.update(this.object._id, modifier);\n      return this;\n    }\n\n    return remove;\n  }();\n\n  _proto.set = function () {\n    function set(what, metadata) {\n      if (this.isVirtual) {\n        this._virtualAction('set', what, metadata);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    return set;\n  }();\n\n  _proto.unset = function () {\n    function unset(what) {\n      if (this.isVirtual) {\n        this._virtualAction('unset', what);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    return unset;\n  }();\n\n  return LinkManyMeta;\n}(Link);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"linkOne.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linkTypes/linkOne.js                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return LinkOne;\n  }\n});\nvar Link;\nmodule.watch(require(\"./base.js\"), {\n  \"default\": function (v) {\n    Link = v;\n  }\n}, 0);\nvar SmartArgs;\nmodule.watch(require(\"./lib/smartArguments.js\"), {\n  \"default\": function (v) {\n    SmartArgs = v;\n  }\n}, 1);\n\nvar LinkOne =\n/*#__PURE__*/\nfunction (_Link) {\n  (0, _inheritsLoose2.default)(LinkOne, _Link);\n\n  function LinkOne() {\n    return _Link.apply(this, arguments) || this;\n  }\n\n  var _proto = LinkOne.prototype;\n\n  _proto.set = function () {\n    function set(what) {\n      var _$set;\n\n      if (this.isVirtual) {\n        this._virtualAction('set', what);\n\n        return this;\n      }\n\n      var field = this.linkStorageField;\n\n      var _id = this.identifyId(what, true);\n\n      this._validateIds([_id]);\n\n      this.object[field] = _id;\n      this.linker.mainCollection.update(this.object._id, {\n        $set: (_$set = {}, _$set[field] = _id, _$set)\n      });\n      return this;\n    }\n\n    return set;\n  }();\n\n  _proto.unset = function () {\n    function unset() {\n      var _$set2;\n\n      if (this.isVirtual) {\n        this._virtualAction('unset', what);\n\n        return this;\n      }\n\n      var field = this.linkStorageField;\n      this.object[field] = null;\n      this.linker.mainCollection.update(this.object._id, {\n        $set: (_$set2 = {}, _$set2[field] = null, _$set2)\n      });\n      return this;\n    }\n\n    return unset;\n  }();\n\n  _proto.add = function () {\n    function add(what) {\n      if (this.isVirtual) {\n        this._virtualAction('add', what);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    return add;\n  }();\n\n  _proto.remove = function () {\n    function remove(what) {\n      if (this.isVirtual) {\n        this._virtualAction('remove', what);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    return remove;\n  }();\n\n  return LinkOne;\n}(Link);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"linkOneMeta.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linkTypes/linkOneMeta.js                                                   //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return LinkOneMeta;\n  }\n});\nvar Link;\nmodule.watch(require(\"./base.js\"), {\n  \"default\": function (v) {\n    Link = v;\n  }\n}, 0);\nvar SmartArgs;\nmodule.watch(require(\"./lib/smartArguments.js\"), {\n  \"default\": function (v) {\n    SmartArgs = v;\n  }\n}, 1);\n\nvar LinkOneMeta =\n/*#__PURE__*/\nfunction (_Link) {\n  (0, _inheritsLoose2.default)(LinkOneMeta, _Link);\n\n  function LinkOneMeta() {\n    return _Link.apply(this, arguments) || this;\n  }\n\n  var _proto = LinkOneMeta.prototype;\n\n  _proto.set = function () {\n    function set(what) {\n      var _$set;\n\n      var metadata = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (this.isVirtual) {\n        this._virtualAction('set', what);\n\n        return this;\n      }\n\n      var field = this.linkStorageField;\n      metadata._id = this.identifyId(what, true);\n\n      this._validateIds([metadata._id]);\n\n      this.object[field] = metadata;\n      this.linker.mainCollection.update(this.object._id, {\n        $set: (_$set = {}, _$set[field] = metadata, _$set)\n      });\n      return this;\n    }\n\n    return set;\n  }();\n\n  _proto.metadata = function () {\n    function metadata(extendMetadata) {\n      if (this.isVirtual) {\n        this._virtualAction('metadata', undefined, extendMetadata);\n\n        return this;\n      }\n\n      var field = this.linkStorageField;\n\n      if (!extendMetadata) {\n        return this.object[field];\n      } else {\n        var _$set2;\n\n        _.extend(this.object[field], extendMetadata);\n\n        this.linker.mainCollection.update(this.object._id, {\n          $set: (_$set2 = {}, _$set2[field] = this.object[field], _$set2)\n        });\n      }\n\n      return this;\n    }\n\n    return metadata;\n  }();\n\n  _proto.unset = function () {\n    function unset() {\n      var _$set3;\n\n      if (this.isVirtual) {\n        this._virtualAction('unset');\n\n        return this;\n      }\n\n      var field = this.linkStorageField;\n      this.object[field] = {};\n      this.linker.mainCollection.update(this.object._id, {\n        $set: (_$set3 = {}, _$set3[field] = {}, _$set3)\n      });\n      return this;\n    }\n\n    return unset;\n  }();\n\n  _proto.add = function () {\n    function add(what, metadata) {\n      if (this.isVirtual) {\n        this._virtualAction('add', what, metadata);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    return add;\n  }();\n\n  _proto.remove = function () {\n    function remove(what) {\n      if (this.isVirtual) {\n        this._virtualAction('remove', what);\n\n        return this;\n      }\n\n      throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    return remove;\n  }();\n\n  return LinkOneMeta;\n}(Link);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"smartArguments.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/links/linkTypes/lib/smartArguments.js                                            //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nmodule.exportDefault(new (\n/*#__PURE__*/\nfunction () {\n  function _class() {}\n\n  var _proto = _class.prototype;\n\n  _proto.getIds = function () {\n    function getIds(what, options) {\n      var _this = this;\n\n      if (_.isArray(what)) {\n        return _.map(what, function (subWhat) {\n          return _this.getId(subWhat, options);\n        });\n      } else {\n        return [this.getId(what, options)];\n      }\n\n      throw new Meteor.Error('invalid-type', \"Unrecognized type: \" + (0, _typeof2.default)(what) + \" for managing links\");\n    }\n\n    return getIds;\n  }();\n\n  _proto.getId = function () {\n    function getId(what, options) {\n      if (typeof what === 'string') {\n        return what;\n      }\n\n      if ((0, _typeof2.default)(what) === 'object') {\n        if (!what._id && options.saveToDatabase) {\n          what._id = options.collection.insert(what);\n        }\n\n        return what._id;\n      }\n    }\n\n    return getId;\n  }();\n\n  return _class;\n}())());\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}},\"namedQuery\":{\"namedQuery.base.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/namedQuery.base.js                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nmodule.export({\n  \"default\": function () {\n    return NamedQueryBase;\n  }\n});\nvar deepClone;\nmodule.watch(require(\"lodash.clonedeep\"), {\n  \"default\": function (v) {\n    deepClone = v;\n  }\n}, 0);\n\nvar NamedQueryBase =\n/*#__PURE__*/\nfunction () {\n  function NamedQueryBase(name, collection, body) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    this.isNamedQuery = true;\n    this.queryName = name;\n\n    if (_.isFunction(body)) {\n      this.resolver = body;\n    } else {\n      this.body = deepClone(body);\n    }\n\n    this.subscriptionHandle = null;\n    this.params = options.params || {};\n    this.options = options;\n    this.collection = collection;\n    this.isExposed = false;\n  }\n\n  var _proto = NamedQueryBase.prototype;\n\n  _proto.setParams = function () {\n    function setParams(params) {\n      this.params = _.extend({}, this.params, params);\n      return this;\n    }\n\n    return setParams;\n  }();\n  /**\n   * Validates the parameters\n   */\n\n\n  _proto.doValidateParams = function () {\n    function doValidateParams(params) {\n      params = params || this.params;\n      var validateParams = this.options.validateParams;\n      if (!validateParams) return;\n\n      try {\n        this._validate(validateParams, params);\n      } catch (validationError) {\n        console.error(\"Invalid parameters supplied to the query \\\"\" + this.queryName + \"\\\"\\n\", validationError);\n        throw validationError; // rethrow\n      }\n    }\n\n    return doValidateParams;\n  }();\n\n  _proto.clone = function () {\n    function clone(newParams) {\n      var params = _.extend({}, deepClone(this.params), newParams);\n\n      var clone = new this.constructor(this.queryName, this.collection, this.isResolver ? this.resolver : deepClone(this.body), (0, _objectSpread2.default)({}, this.options, {\n        params: params\n      }));\n      clone.cacher = this.cacher;\n\n      if (this.exposeConfig) {\n        clone.exposeConfig = this.exposeConfig;\n      }\n\n      return clone;\n    }\n\n    return clone;\n  }();\n  /**\n   * @param {function|object} validator\n   * @param {object} params\n   * @private\n   */\n\n\n  _proto._validate = function () {\n    function _validate(validator, params) {\n      if (_.isFunction(validator)) {\n        validator.call(null, params);\n      } else {\n        check(params, validator);\n      }\n    }\n\n    return _validate;\n  }();\n\n  (0, _createClass2.default)(NamedQueryBase, [{\n    key: \"name\",\n    get: function () {\n      return \"named_query_\" + this.queryName;\n    }\n  }, {\n    key: \"isResolver\",\n    get: function () {\n      return !!this.resolver;\n    }\n  }]);\n  return NamedQueryBase;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"namedQuery.client.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/namedQuery.client.js                                                  //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar CountSubscription;\nmodule.watch(require(\"../query/counts/countSubscription\"), {\n  \"default\": function (v) {\n    CountSubscription = v;\n  }\n}, 0);\nvar createGraph;\nmodule.watch(require(\"../query/lib/createGraph.js\"), {\n  \"default\": function (v) {\n    createGraph = v;\n  }\n}, 1);\nvar recursiveFetch;\nmodule.watch(require(\"../query/lib/recursiveFetch.js\"), {\n  \"default\": function (v) {\n    recursiveFetch = v;\n  }\n}, 2);\nvar prepareForProcess;\nmodule.watch(require(\"../query/lib/prepareForProcess.js\"), {\n  \"default\": function (v) {\n    prepareForProcess = v;\n  }\n}, 3);\n\nvar _;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function (v) {\n    _ = v;\n  }\n}, 4);\nvar callWithPromise;\nmodule.watch(require(\"../query/lib/callWithPromise\"), {\n  \"default\": function (v) {\n    callWithPromise = v;\n  }\n}, 5);\nvar Base;\nmodule.watch(require(\"./namedQuery.base\"), {\n  \"default\": function (v) {\n    Base = v;\n  }\n}, 6);\nmodule.exportDefault(\n/*#__PURE__*/\nfunction (_Base) {\n  (0, _inheritsLoose2.default)(_class, _Base);\n\n  function _class() {\n    return _Base.apply(this, arguments) || this;\n  }\n\n  var _proto = _class.prototype;\n\n  /**\n   * Subscribe\n   *\n   * @param callback\n   * @returns {null|any|*}\n   */\n  _proto.subscribe = function () {\n    function subscribe(callback) {\n      if (this.isResolver) {\n        throw new Meteor.Error('not-allowed', \"You cannot subscribe to a resolver query\");\n      }\n\n      this.subscriptionHandle = Meteor.subscribe(this.name, this.params, callback);\n      return this.subscriptionHandle;\n    }\n\n    return subscribe;\n  }();\n  /**\n   * Subscribe to the counts for this query\n   *\n   * @param callback\n   * @returns {Object}\n   */\n\n\n  _proto.subscribeCount = function () {\n    function subscribeCount(callback) {\n      if (this.isResolver) {\n        throw new Meteor.Error('not-allowed', \"You cannot subscribe to a resolver query\");\n      }\n\n      if (!this._counter) {\n        this._counter = new CountSubscription(this);\n      }\n\n      return this._counter.subscribe(this.params, callback);\n    }\n\n    return subscribeCount;\n  }();\n  /**\n   * Unsubscribe if an existing subscription exists\n   */\n\n\n  _proto.unsubscribe = function () {\n    function unsubscribe() {\n      if (this.subscriptionHandle) {\n        this.subscriptionHandle.stop();\n      }\n\n      this.subscriptionHandle = null;\n    }\n\n    return unsubscribe;\n  }();\n  /**\n   * Unsubscribe to the counts if a subscription exists.\n   */\n\n\n  _proto.unsubscribeCount = function () {\n    function unsubscribeCount() {\n      if (this._counter) {\n        this._counter.unsubscribe();\n\n        this._counter = null;\n      }\n    }\n\n    return unsubscribeCount;\n  }();\n  /**\n   * Fetches elements in sync using promises\n   * @return {*}\n   */\n\n\n  _proto.fetchSync = function () {\n    function fetchSync() {\n      return _regenerator.default.async(function () {\n        function fetchSync$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.subscriptionHandle) {\n                  _context.next = 2;\n                  break;\n                }\n\n                throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n\n              case 2:\n                _context.next = 4;\n                return _regenerator.default.awrap(callWithPromise(this.name, this.params));\n\n              case 4:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return fetchSync$;\n      }(), null, this);\n    }\n\n    return fetchSync;\n  }();\n  /**\n   * Fetches one element in sync\n   * @return {*}\n   */\n\n\n  _proto.fetchOneSync = function () {\n    function fetchOneSync() {\n      return _regenerator.default.async(function () {\n        function fetchOneSync$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.t0 = _;\n                _context2.next = 3;\n                return _regenerator.default.awrap(this.fetchSync());\n\n              case 3:\n                _context2.t1 = _context2.sent;\n                return _context2.abrupt(\"return\", _context2.t0.first.call(_context2.t0, _context2.t1));\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return fetchOneSync$;\n      }(), null, this);\n    }\n\n    return fetchOneSync;\n  }();\n  /**\n   * Retrieves the data.\n   * @param callbackOrOptions\n   * @returns {*}\n   */\n\n\n  _proto.fetch = function () {\n    function fetch(callbackOrOptions) {\n      if (!this.subscriptionHandle) {\n        return this._fetchStatic(callbackOrOptions);\n      } else {\n        return this._fetchReactive(callbackOrOptions);\n      }\n    }\n\n    return fetch;\n  }();\n  /**\n   * @param args\n   * @returns {*}\n   */\n\n\n  _proto.fetchOne = function () {\n    function fetchOne() {\n      if (!this.subscriptionHandle) {\n        var callback = arguments.length <= 0 ? undefined : arguments[0];\n\n        if (!_.isFunction(callback)) {\n          throw new Meteor.Error('You did not provide a valid callback');\n        }\n\n        this.fetch(function (err, res) {\n          callback(err, res ? _.first(res) : null);\n        });\n      } else {\n        return _.first(this.fetch.apply(this, arguments));\n      }\n    }\n\n    return fetchOne;\n  }();\n  /**\n   * Gets the count of matching elements in sync.\n   * @returns {any}\n   */\n\n\n  _proto.getCountSync = function () {\n    function getCountSync() {\n      return _regenerator.default.async(function () {\n        function getCountSync$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!this._counter) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n\n              case 2:\n                _context3.next = 4;\n                return _regenerator.default.awrap(callWithPromise(this.name + '.count', this.params));\n\n              case 4:\n                return _context3.abrupt(\"return\", _context3.sent);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }\n\n        return getCountSync$;\n      }(), null, this);\n    }\n\n    return getCountSync;\n  }();\n  /**\n   * Gets the count of matching elements.\n   * @param callback\n   * @returns {any}\n   */\n\n\n  _proto.getCount = function () {\n    function getCount(callback) {\n      if (this._counter) {\n        return this._counter.getCount();\n      } else {\n        if (!callback) {\n          throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n        } else {\n          return Meteor.call(this.name + '.count', this.params, callback);\n        }\n      }\n    }\n\n    return getCount;\n  }();\n  /**\n   * Fetching non-reactive queries\n   * @param callback\n   * @private\n   */\n\n\n  _proto._fetchStatic = function () {\n    function _fetchStatic(callback) {\n      if (!callback) {\n        throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n      }\n\n      Meteor.call(this.name, this.params, callback);\n    }\n\n    return _fetchStatic;\n  }();\n  /**\n   * Fetching when we've got an active publication\n   *\n   * @param options\n   * @returns {*}\n   * @private\n   */\n\n\n  _proto._fetchReactive = function () {\n    function _fetchReactive() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var body = this.body;\n\n      if (this.params.$body) {\n        body = intersectDeep(body, this.params.$body);\n      }\n\n      body = prepareForProcess(body, this.params);\n\n      if (!options.allowSkip && body.$options && body.$options.skip) {\n        delete body.$options.skip;\n      }\n\n      return recursiveFetch(createGraph(this.collection, body));\n    }\n\n    return _fetchReactive;\n  }();\n\n  return _class;\n}(Base));\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"namedQuery.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/namedQuery.js                                                         //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar NamedQueryClient;\nmodule.watch(require(\"./namedQuery.client\"), {\n  \"default\": function (v) {\n    NamedQueryClient = v;\n  }\n}, 0);\nvar NamedQueryServer;\nmodule.watch(require(\"./namedQuery.server\"), {\n  \"default\": function (v) {\n    NamedQueryServer = v;\n  }\n}, 1);\nvar NamedQuery;\n\nif (Meteor.isServer) {\n  NamedQuery = NamedQueryServer;\n} else {\n  NamedQuery = NamedQueryClient;\n}\n\nmodule.exportDefault(NamedQuery);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"namedQuery.server.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/namedQuery.server.js                                                  //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar prepareForProcess;\nmodule.watch(require(\"../query/lib/prepareForProcess.js\"), {\n  \"default\": function (v) {\n    prepareForProcess = v;\n  }\n}, 0);\nvar Base;\nmodule.watch(require(\"./namedQuery.base\"), {\n  \"default\": function (v) {\n    Base = v;\n  }\n}, 1);\nvar deepClone;\nmodule.watch(require(\"lodash.clonedeep\"), {\n  \"default\": function (v) {\n    deepClone = v;\n  }\n}, 2);\nvar MemoryResultCacher;\nmodule.watch(require(\"./cache/MemoryResultCacher\"), {\n  \"default\": function (v) {\n    MemoryResultCacher = v;\n  }\n}, 3);\nvar intersectDeep;\nmodule.watch(require(\"../query/lib/intersectDeep\"), {\n  \"default\": function (v) {\n    intersectDeep = v;\n  }\n}, 4);\nmodule.exportDefault(\n/*#__PURE__*/\nfunction (_Base) {\n  (0, _inheritsLoose2.default)(_class, _Base);\n\n  function _class() {\n    return _Base.apply(this, arguments) || this;\n  }\n\n  var _proto = _class.prototype;\n\n  /**\n   * Retrieves the data.\n   * @returns {*}\n   */\n  _proto.fetch = function () {\n    function fetch(context) {\n      this._performSecurityChecks(context, this.params);\n\n      if (this.isResolver) {\n        return this._fetchResolverData(context);\n      } else {\n        body = deepClone(this.body);\n\n        if (this.params.$body) {\n          body = intersectDeep(body, this.params.$body);\n        } // we must apply emobdyment here\n\n\n        this.doEmbodimentIfItApplies(body);\n        var query = this.collection.createQuery(deepClone(body), {\n          params: deepClone(this.params)\n        });\n\n        if (this.cacher) {\n          var cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n          return this.cacher.fetch(cacheId, {\n            query: query\n          });\n        }\n\n        return query.fetch();\n      }\n    }\n\n    return fetch;\n  }();\n  /**\n   * @param args\n   * @returns {*}\n   */\n\n\n  _proto.fetchOne = function () {\n    function fetchOne() {\n      return _.first(this.fetch.apply(this, arguments));\n    }\n\n    return fetchOne;\n  }();\n  /**\n   * Gets the count of matching elements.\n   *\n   * @returns {any}\n   */\n\n\n  _proto.getCount = function () {\n    function getCount(context) {\n      this._performSecurityChecks(context, this.params);\n\n      var countCursor = this.getCursorForCounting();\n\n      if (this.cacher) {\n        var cacheId = 'count::' + this.cacher.generateQueryId(this.queryName, this.params);\n        return this.cacher.fetch(cacheId, {\n          countCursor: countCursor\n        });\n      }\n\n      return countCursor.count();\n    }\n\n    return getCount;\n  }();\n  /**\n   * Returns the cursor for counting\n   * This is most likely used for counts cursor\n   */\n\n\n  _proto.getCursorForCounting = function () {\n    function getCursorForCounting() {\n      var body = deepClone(this.body);\n      this.doEmbodimentIfItApplies(body);\n      body = prepareForProcess(body, this.params);\n      return this.collection.find(body.$filters || {}, {\n        fields: {\n          _id: 1\n        }\n      });\n    }\n\n    return getCursorForCounting;\n  }();\n  /**\n   * @param cacher\n   */\n\n\n  _proto.cacheResults = function () {\n    function cacheResults(cacher) {\n      if (!cacher) {\n        cacher = new MemoryResultCacher();\n      }\n\n      this.cacher = cacher;\n    }\n\n    return cacheResults;\n  }();\n  /**\n   * Configure resolve. This doesn't actually call the resolver, it just sets it\n   * @param fn\n   */\n\n\n  _proto.resolve = function () {\n    function resolve(fn) {\n      if (!this.isResolver) {\n        throw new Meteor.Error('invalid-call', \"You cannot use resolve() on a non resolver NamedQuery\");\n      }\n\n      this.resolver = fn;\n    }\n\n    return resolve;\n  }();\n  /**\n   * @returns {*}\n   * @private\n   */\n\n\n  _proto._fetchResolverData = function () {\n    function _fetchResolverData(context) {\n      var resolver = this.resolver;\n      var self = this;\n      var query = {\n        fetch: function () {\n          return resolver.call(context, self.params);\n        }\n      };\n\n      if (this.cacher) {\n        var cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n        return this.cacher.fetch(cacheId, {\n          query: query\n        });\n      }\n\n      return query.fetch();\n    }\n\n    return _fetchResolverData;\n  }();\n  /**\n   * @param context Meteor method/publish context\n   * @param params\n   *\n   * @private\n   */\n\n\n  _proto._performSecurityChecks = function () {\n    function _performSecurityChecks(context, params) {\n      if (context && this.exposeConfig) {\n        this._callFirewall(context, context.userId, params);\n      }\n\n      this.doValidateParams(params);\n    }\n\n    return _performSecurityChecks;\n  }();\n\n  return _class;\n}(Base));\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"store.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/store.js                                                              //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.exportDefault(new (\n/*#__PURE__*/\nfunction () {\n  function _class() {\n    this.storage = {};\n  }\n\n  var _proto = _class.prototype;\n\n  _proto.add = function () {\n    function add(key, value) {\n      if (this.storage[key]) {\n        throw new Meteor.Error('invalid-name', \"You have previously defined another namedQuery with the same name: \\\"\" + key + \"\\\". Named Query names should be unique.\");\n      }\n\n      this.storage[key] = value;\n    }\n\n    return add;\n  }();\n\n  _proto.get = function () {\n    function get(key) {\n      return this.storage[key];\n    }\n\n    return get;\n  }();\n\n  _proto.getAll = function () {\n    function getAll() {\n      return this.storage;\n    }\n\n    return getAll;\n  }();\n\n  return _class;\n}())());\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"cache\":{\"BaseResultCacher.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/cache/BaseResultCacher.js                                             //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return BaseResultCacher;\n  }\n});\nvar EJSON;\nmodule.watch(require(\"meteor/ejson\"), {\n  EJSON: function (v) {\n    EJSON = v;\n  }\n}, 0);\n\nvar BaseResultCacher =\n/*#__PURE__*/\nfunction () {\n  function BaseResultCacher() {\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.config = config;\n  }\n  /**\n   * @param queryName\n   * @param params\n   * @returns {string}\n   */\n\n\n  var _proto = BaseResultCacher.prototype;\n\n  _proto.generateQueryId = function () {\n    function generateQueryId(queryName, params) {\n      return queryName + \"::\" + EJSON.stringify(params);\n    }\n\n    return generateQueryId;\n  }();\n  /**\n   * Dummy function\n   */\n\n\n  _proto.fetch = function () {\n    function fetch(cacheId, _ref) {\n      var query = _ref.query,\n          countCursor = _ref.countCursor;\n      throw 'Not implemented';\n    }\n\n    return fetch;\n  }();\n  /**\n   * @param query\n   * @param countCursor\n   * @returns {*}\n   */\n\n\n  BaseResultCacher.fetchData = function () {\n    function fetchData(_ref2) {\n      var query = _ref2.query,\n          countCursor = _ref2.countCursor;\n\n      if (query) {\n        return query.fetch();\n      } else {\n        return countCursor.count();\n      }\n    }\n\n    return fetchData;\n  }();\n\n  return BaseResultCacher;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"MemoryResultCacher.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/namedQuery/cache/MemoryResultCacher.js                                           //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return MemoryResultCacher;\n  }\n});\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar cloneDeep;\nmodule.watch(require(\"lodash.clonedeep\"), {\n  \"default\": function (v) {\n    cloneDeep = v;\n  }\n}, 1);\nvar BaseResultCacher;\nmodule.watch(require(\"./BaseResultCacher\"), {\n  \"default\": function (v) {\n    BaseResultCacher = v;\n  }\n}, 2);\nvar DEFAULT_TTL = 60000;\n/**\n * This is a very basic in-memory result caching functionality\n */\n\nvar MemoryResultCacher =\n/*#__PURE__*/\nfunction (_BaseResultCacher) {\n  (0, _inheritsLoose2.default)(MemoryResultCacher, _BaseResultCacher);\n\n  function MemoryResultCacher() {\n    var _this;\n\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _this = _BaseResultCacher.call(this, config) || this;\n    _this.store = {};\n    return _this;\n  }\n  /**\n   * @param cacheId\n   * @param query\n   * @param countCursor\n   * @returns {*}\n   */\n\n\n  var _proto = MemoryResultCacher.prototype;\n\n  _proto.fetch = function () {\n    function fetch(cacheId, _ref) {\n      var query = _ref.query,\n          countCursor = _ref.countCursor;\n      var cacheData = this.store[cacheId];\n\n      if (cacheData !== undefined) {\n        return cloneDeep(cacheData);\n      }\n\n      var data = BaseResultCacher.fetchData({\n        query: query,\n        countCursor: countCursor\n      });\n      this.storeData(cacheId, data);\n      return data;\n    }\n\n    return fetch;\n  }();\n  /**\n   * @param cacheId\n   * @param data\n   */\n\n\n  _proto.storeData = function () {\n    function storeData(cacheId, data) {\n      var _this2 = this;\n\n      var ttl = this.config.ttl || DEFAULT_TTL;\n      this.store[cacheId] = cloneDeep(data);\n      Meteor.setTimeout(function () {\n        delete _this2.store[cacheId];\n      }, ttl);\n    }\n\n    return storeData;\n  }();\n\n  return MemoryResultCacher;\n}(BaseResultCacher);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"query\":{\"query.base.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/query.base.js                                                              //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nmodule.export({\n  \"default\": function () {\n    return QueryBase;\n  }\n});\nvar deepClone;\nmodule.watch(require(\"lodash.clonedeep\"), {\n  \"default\": function (v) {\n    deepClone = v;\n  }\n}, 0);\nvar check;\nmodule.watch(require(\"meteor/check\"), {\n  check: function (v) {\n    check = v;\n  }\n}, 1);\n\nvar QueryBase =\n/*#__PURE__*/\nfunction () {\n  function QueryBase(collection, body) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    this.isGlobalQuery = true;\n    this.collection = collection;\n    this.body = deepClone(body);\n    this.params = options.params || {};\n    this.options = options;\n  }\n\n  var _proto = QueryBase.prototype;\n\n  _proto.clone = function () {\n    function clone(newParams) {\n      var params = _.extend({}, deepClone(this.params), newParams);\n\n      return new this.constructor(this.collection, deepClone(this.body), (0, _objectSpread2.default)({\n        params: params\n      }, this.options));\n    }\n\n    return clone;\n  }();\n\n  /**\n   * Validates the parameters\n   */\n  _proto.doValidateParams = function () {\n    function doValidateParams() {\n      var validateParams = this.options.validateParams;\n      if (!validateParams) return;\n\n      if (_.isFunction(validateParams)) {\n        validateParams.call(null, this.params);\n      } else {\n        check(this.params);\n      }\n    }\n\n    return doValidateParams;\n  }();\n  /**\n   * Merges the params with previous params.\n   *\n   * @param params\n   * @returns {Query}\n   */\n\n\n  _proto.setParams = function () {\n    function setParams(params) {\n      this.params = _.extend({}, this.params, params);\n      return this;\n    }\n\n    return setParams;\n  }();\n\n  (0, _createClass2.default)(QueryBase, [{\n    key: \"name\",\n    get: function () {\n      return \"exposure_\" + this.collection._name;\n    }\n  }]);\n  return QueryBase;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"query.client.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/query.client.js                                                            //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return Query;\n  }\n});\n\nvar _;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function (v) {\n    _ = v;\n  }\n}, 0);\nvar CountSubscription;\nmodule.watch(require(\"./counts/countSubscription\"), {\n  \"default\": function (v) {\n    CountSubscription = v;\n  }\n}, 1);\nvar createGraph;\nmodule.watch(require(\"./lib/createGraph.js\"), {\n  \"default\": function (v) {\n    createGraph = v;\n  }\n}, 2);\nvar recursiveFetch;\nmodule.watch(require(\"./lib/recursiveFetch.js\"), {\n  \"default\": function (v) {\n    recursiveFetch = v;\n  }\n}, 3);\nvar prepareForProcess;\nmodule.watch(require(\"./lib/prepareForProcess.js\"), {\n  \"default\": function (v) {\n    prepareForProcess = v;\n  }\n}, 4);\nvar callWithPromise;\nmodule.watch(require(\"./lib/callWithPromise\"), {\n  \"default\": function (v) {\n    callWithPromise = v;\n  }\n}, 5);\nvar Base;\nmodule.watch(require(\"./query.base\"), {\n  \"default\": function (v) {\n    Base = v;\n  }\n}, 6);\n\nvar Query =\n/*#__PURE__*/\nfunction (_Base) {\n  (0, _inheritsLoose2.default)(Query, _Base);\n\n  function Query() {\n    return _Base.apply(this, arguments) || this;\n  }\n\n  var _proto = Query.prototype;\n\n  /**\n   * Subscribe\n   *\n   * @param callback {Function} optional\n   * @returns {null|any|*}\n   */\n  _proto.subscribe = function () {\n    function subscribe(callback) {\n      this.doValidateParams();\n      this.subscriptionHandle = Meteor.subscribe(this.name, prepareForProcess(this.body, this.params), callback);\n      return this.subscriptionHandle;\n    }\n\n    return subscribe;\n  }();\n  /**\n   * Subscribe to the counts for this query\n   *\n   * @param callback\n   * @returns {Object}\n   */\n\n\n  _proto.subscribeCount = function () {\n    function subscribeCount(callback) {\n      this.doValidateParams();\n\n      if (!this._counter) {\n        this._counter = new CountSubscription(this);\n      }\n\n      return this._counter.subscribe(prepareForProcess(this.body, this.params), callback);\n    }\n\n    return subscribeCount;\n  }();\n  /**\n   * Unsubscribe if an existing subscription exists\n   */\n\n\n  _proto.unsubscribe = function () {\n    function unsubscribe() {\n      if (this.subscriptionHandle) {\n        this.subscriptionHandle.stop();\n      }\n\n      this.subscriptionHandle = null;\n    }\n\n    return unsubscribe;\n  }();\n  /**\n   * Unsubscribe to the counts if a subscription exists.\n   */\n\n\n  _proto.unsubscribeCount = function () {\n    function unsubscribeCount() {\n      if (this._counter) {\n        this._counter.unsubscribe();\n\n        this._counter = null;\n      }\n    }\n\n    return unsubscribeCount;\n  }();\n  /**\n   * Fetches elements in sync using promises\n   * @return {*}\n   */\n\n\n  _proto.fetchSync = function () {\n    function fetchSync() {\n      return _regenerator.default.async(function () {\n        function fetchSync$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.doValidateParams();\n\n                if (!this.subscriptionHandle) {\n                  _context.next = 3;\n                  break;\n                }\n\n                throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n\n              case 3:\n                _context.next = 5;\n                return _regenerator.default.awrap(callWithPromise(this.name, prepareForProcess(this.body, this.params)));\n\n              case 5:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }\n\n        return fetchSync$;\n      }(), null, this);\n    }\n\n    return fetchSync;\n  }();\n  /**\n   * Fetches one element in sync\n   * @return {*}\n   */\n\n\n  _proto.fetchOneSync = function () {\n    function fetchOneSync() {\n      return _regenerator.default.async(function () {\n        function fetchOneSync$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.t0 = _;\n                _context2.next = 3;\n                return _regenerator.default.awrap(this.fetchSync());\n\n              case 3:\n                _context2.t1 = _context2.sent;\n                return _context2.abrupt(\"return\", _context2.t0.first.call(_context2.t0, _context2.t1));\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }\n\n        return fetchOneSync$;\n      }(), null, this);\n    }\n\n    return fetchOneSync;\n  }();\n  /**\n   * Retrieves the data.\n   * @param callbackOrOptions\n   * @returns {*}\n   */\n\n\n  _proto.fetch = function () {\n    function fetch(callbackOrOptions) {\n      this.doValidateParams();\n\n      if (!this.subscriptionHandle) {\n        return this._fetchStatic(callbackOrOptions);\n      } else {\n        return this._fetchReactive(callbackOrOptions);\n      }\n    }\n\n    return fetch;\n  }();\n  /**\n   * @param args\n   * @returns {*}\n   */\n\n\n  _proto.fetchOne = function () {\n    function fetchOne() {\n      if (!this.subscriptionHandle) {\n        var callback = arguments.length <= 0 ? undefined : arguments[0];\n\n        if (!_.isFunction(callback)) {\n          throw new Meteor.Error('You did not provide a valid callback');\n        }\n\n        this.fetch(function (err, res) {\n          callback(err, res ? _.first(res) : null);\n        });\n      } else {\n        return _.first(this.fetch.apply(this, arguments));\n      }\n    }\n\n    return fetchOne;\n  }();\n  /**\n   * Gets the count of matching elements in sync.\n   * @returns {any}\n   */\n\n\n  _proto.getCountSync = function () {\n    function getCountSync() {\n      return _regenerator.default.async(function () {\n        function getCountSync$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!this._counter) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n\n              case 2:\n                _context3.next = 4;\n                return _regenerator.default.awrap(callWithPromise(this.name + '.count', prepareForProcess(this.body, this.params)));\n\n              case 4:\n                return _context3.abrupt(\"return\", _context3.sent);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }\n\n        return getCountSync$;\n      }(), null, this);\n    }\n\n    return getCountSync;\n  }();\n  /**\n   * Gets the count of matching elements.\n   * @param callback\n   * @returns {any}\n   */\n\n\n  _proto.getCount = function () {\n    function getCount(callback) {\n      if (this._counter) {\n        return this._counter.getCount();\n      } else {\n        if (!callback) {\n          throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n        } else {\n          return Meteor.call(this.name + '.count', prepareForProcess(this.body, this.params), callback);\n        }\n      }\n    }\n\n    return getCount;\n  }();\n  /**\n   * Fetching non-reactive queries\n   * @param callback\n   * @private\n   */\n\n\n  _proto._fetchStatic = function () {\n    function _fetchStatic(callback) {\n      if (!callback) {\n        throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n      }\n\n      Meteor.call(this.name, prepareForProcess(this.body, this.params), callback);\n    }\n\n    return _fetchStatic;\n  }();\n  /**\n   * Fetching when we've got an active publication\n   *\n   * @param options\n   * @returns {*}\n   * @private\n   */\n\n\n  _proto._fetchReactive = function () {\n    function _fetchReactive() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var body = prepareForProcess(this.body, this.params);\n\n      if (!options.allowSkip && body.$options && body.$options.skip) {\n        delete body.$options.skip;\n      }\n\n      return recursiveFetch(createGraph(this.collection, body), this.params);\n    }\n\n    return _fetchReactive;\n  }();\n\n  return Query;\n}(Base);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"query.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/query.js                                                                   //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar QueryClient;\nmodule.watch(require(\"./query.client\"), {\n  \"default\": function (v) {\n    QueryClient = v;\n  }\n}, 0);\nvar QueryServer;\nmodule.watch(require(\"./query.server\"), {\n  \"default\": function (v) {\n    QueryServer = v;\n  }\n}, 1);\nvar Query;\n\nif (Meteor.isServer) {\n  Query = QueryServer;\n} else {\n  Query = QueryClient;\n}\n\nmodule.exportDefault(Query);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"query.server.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/query.server.js                                                            //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nmodule.export({\n  \"default\": function () {\n    return Query;\n  }\n});\nvar createGraph;\nmodule.watch(require(\"./lib/createGraph.js\"), {\n  \"default\": function (v) {\n    createGraph = v;\n  }\n}, 0);\nvar prepareForProcess;\nmodule.watch(require(\"./lib/prepareForProcess.js\"), {\n  \"default\": function (v) {\n    prepareForProcess = v;\n  }\n}, 1);\nvar hypernova;\nmodule.watch(require(\"./hypernova/hypernova.js\"), {\n  \"default\": function (v) {\n    hypernova = v;\n  }\n}, 2);\nvar Base;\nmodule.watch(require(\"./query.base\"), {\n  \"default\": function (v) {\n    Base = v;\n  }\n}, 3);\n\nvar Query =\n/*#__PURE__*/\nfunction (_Base) {\n  (0, _inheritsLoose2.default)(Query, _Base);\n\n  function Query() {\n    return _Base.apply(this, arguments) || this;\n  }\n\n  var _proto = Query.prototype;\n\n  /**\n   * Retrieves the data.\n   * @param context\n   * @returns {*}\n   */\n  _proto.fetch = function () {\n    function fetch() {\n      var context = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var node = createGraph(this.collection, prepareForProcess(this.body, this.params));\n      return hypernova(node, context.userId, {\n        params: this.params\n      });\n    }\n\n    return fetch;\n  }();\n  /**\n   * @param args\n   * @returns {*}\n   */\n\n\n  _proto.fetchOne = function () {\n    function fetchOne() {\n      return _.first(this.fetch.apply(this, arguments));\n    }\n\n    return fetchOne;\n  }();\n  /**\n   * Gets the count of matching elements.\n   * @returns {integer}\n   */\n\n\n  _proto.getCount = function () {\n    function getCount() {\n      return this.collection.find(this.body.$filters || {}, {}).count();\n    }\n\n    return getCount;\n  }();\n\n  return Query;\n}(Base);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"counts\":{\"collection.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/counts/collection.js                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 0);\nvar COUNTS_COLLECTION_CLIENT;\nmodule.watch(require(\"./constants\"), {\n  COUNTS_COLLECTION_CLIENT: function (v) {\n    COUNTS_COLLECTION_CLIENT = v;\n  }\n}, 1);\nmodule.exportDefault(new Mongo.Collection(COUNTS_COLLECTION_CLIENT));\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"constants.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/counts/constants.js                                                        //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  COUNTS_COLLECTION_CLIENT: function () {\n    return COUNTS_COLLECTION_CLIENT;\n  }\n});\nvar COUNTS_COLLECTION_CLIENT = 'grapher_counts';\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"countSubscription.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/counts/countSubscription.js                                                //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return CountSubscription;\n  }\n});\nvar EJSON;\nmodule.watch(require(\"meteor/ejson\"), {\n  EJSON: function (v) {\n    EJSON = v;\n  }\n}, 0);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.watch(require(\"meteor/reactive-var\"), {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar Tracker;\nmodule.watch(require(\"meteor/tracker\"), {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar Counts;\nmodule.watch(require(\"./collection\"), {\n  \"default\": function (v) {\n    Counts = v;\n  }\n}, 4);\nvar createFauxSubscription;\nmodule.watch(require(\"./createFauxSubscription\"), {\n  \"default\": function (v) {\n    createFauxSubscription = v;\n  }\n}, 5);\nvar prepareForProcess;\nmodule.watch(require(\"../lib/prepareForProcess.js\"), {\n  \"default\": function (v) {\n    prepareForProcess = v;\n  }\n}, 6);\nvar NamedQueryBase;\nmodule.watch(require(\"../../namedQuery/namedQuery.base\"), {\n  \"default\": function (v) {\n    NamedQueryBase = v;\n  }\n}, 7);\n\nvar CountSubscription =\n/*#__PURE__*/\nfunction () {\n  /**\n   * @param {*} query - The query to use when fetching counts\n   */\n  function CountSubscription(query) {\n    this.accessToken = new ReactiveVar(null);\n    this.fauxHandle = null;\n    this.query = query;\n  }\n  /**\n   * Starts a subscription request for reactive counts.\n   *\n   * @param {*} arg - The argument to pass to {name}.count.subscribe\n   * @param {*} callback\n   */\n\n\n  var _proto = CountSubscription.prototype;\n\n  _proto.subscribe = function () {\n    function subscribe(arg, callback) {\n      var _this = this;\n\n      // Don't try to resubscribe if arg hasn't changed\n      if (EJSON.equals(this.lastArgs, arg) && this.fauxHandle) {\n        return this.fauxHandle;\n      }\n\n      this.accessToken.set(null);\n      this.lastArgs = arg;\n      Meteor.call(this.query.name + '.count.subscribe', arg, function (error, token) {\n        if (!_this._markedForUnsubscribe) {\n          _this.subscriptionHandle = Meteor.subscribe(_this.query.name + '.count', token, callback);\n\n          _this.accessToken.set(token);\n\n          _this.disconnectComputation = Tracker.autorun(function () {\n            return _this.handleDisconnect();\n          });\n        }\n\n        _this._markedForUnsubscribe = false;\n      });\n      this.fauxHandle = createFauxSubscription(this);\n      return this.fauxHandle;\n    }\n\n    return subscribe;\n  }();\n  /**\n   * Unsubscribes from the count endpoint, if there is such a subscription.\n   */\n\n\n  _proto.unsubscribe = function () {\n    function unsubscribe() {\n      if (this.subscriptionHandle) {\n        this.disconnectComputation.stop();\n        this.subscriptionHandle.stop();\n      } else {\n        // If we hit this branch, then Meteor.call in subscribe hasn't finished yet\n        // so set a flag to stop the subscription from being created\n        this._markedForUnsubscribe = true;\n      }\n\n      this.accessToken.set(null);\n      this.fauxHandle = null;\n      this.subscriptionHandle = null;\n    }\n\n    return unsubscribe;\n  }();\n  /**\n   * Reactively fetch current document count. Returns null if the subscription is not ready yet.\n   *\n   * @returns {Number|null} - Current document count\n   */\n\n\n  _proto.getCount = function () {\n    function getCount() {\n      var id = this.accessToken.get();\n      if (id === null) return null;\n      var doc = Counts.findOne(id);\n      return doc.count;\n    }\n\n    return getCount;\n  }();\n  /**\n   * All session info gets deleted when the server goes down, so when the client attempts to\n   * optimistically resume the '.count' publication, the server will throw a 'no-request' error.\n   *\n   * This function prevents that by manually stopping and restarting the subscription when the\n   * connection to the server is lost.\n   */\n\n\n  _proto.handleDisconnect = function () {\n    function handleDisconnect() {\n      var status = Meteor.status();\n\n      if (!status.connected) {\n        this._markedForResume = true;\n        this.fauxHandle = null;\n        this.subscriptionHandle.stop();\n      }\n\n      if (status.connected && this._markedForResume) {\n        this._markedForResume = false;\n        this.subscribe(this.lastArgs);\n      }\n    }\n\n    return handleDisconnect;\n  }();\n  /**\n   * Returns whether or not a subscription request has been made.\n   */\n\n\n  _proto.isSubscribed = function () {\n    function isSubscribed() {\n      return this.accessToken.get() !== null;\n    }\n\n    return isSubscribed;\n  }();\n\n  return CountSubscription;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"createFauxSubscription.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/counts/createFauxSubscription.js                                           //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.exportDefault(function (countManager) {\n  return {\n    ready: function () {\n      return countManager.accessToken.get() !== null && countManager.subscriptionHandle.ready();\n    },\n    stop: function () {\n      return countManager.unsubscribe();\n    }\n  };\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"hypernova\":{\"aggregateSearchFilters.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/aggregateSearchFilters.js                                        //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nmodule.export({\n  \"default\": function () {\n    return AggregateFilters;\n  }\n});\nvar sift;\nmodule.watch(require(\"sift\"), {\n  \"default\": function (v) {\n    sift = v;\n  }\n}, 0);\n\nvar AggregateFilters =\n/*#__PURE__*/\nfunction () {\n  function AggregateFilters(collectionNode, metaFilters) {\n    this.collectionNode = collectionNode;\n    this.linker = collectionNode.linker;\n    this.metaFilters = metaFilters;\n    this.isVirtual = this.linker.isVirtual();\n    this.linkStorageField = this.linker.linkStorageField;\n  }\n\n  var _proto = AggregateFilters.prototype;\n\n  _proto.create = function () {\n    function create() {\n      switch (this.linker.strategy) {\n        case 'one':\n          return this.createOne();\n\n        case 'one-meta':\n          return this.createOneMeta();\n\n        case 'many':\n          return this.createMany();\n\n        case 'many-meta':\n          return this.createManyMeta();\n\n        default:\n          throw new Meteor.Error(\"Invalid linker type: \" + this.linker.type);\n      }\n    }\n\n    return create;\n  }();\n\n  _proto.createOne = function () {\n    function createOne() {\n      if (!this.isVirtual) {\n        return {\n          _id: {\n            $in: _.uniq(_.pluck(this.parentObjects, this.linkStorageField))\n          }\n        };\n      } else {\n        var _ref;\n\n        return _ref = {}, _ref[this.linkStorageField] = {\n          $in: _.uniq(_.pluck(this.parentObjects, '_id'))\n        }, _ref;\n      }\n    }\n\n    return createOne;\n  }();\n\n  _proto.createOneMeta = function () {\n    function createOneMeta() {\n      var _this = this;\n\n      if (!this.isVirtual) {\n        var eligibleObjects = this.parentObjects;\n\n        if (this.metaFilters) {\n          eligibleObjects = _.filter(this.parentObjects, function (object) {\n            return sift(_this.metaFilters)(object[_this.linkStorageField]);\n          });\n        }\n\n        var storages = _.pluck(eligibleObjects, this.linkStorageField);\n\n        var ids = [];\n\n        _.each(storages, function (storage) {\n          if (storage) {\n            ids.push(storage._id);\n          }\n        });\n\n        return {\n          _id: {\n            $in: _.uniq(ids)\n          }\n        };\n      } else {\n        var filters = {};\n\n        if (this.metaFilters) {\n          _.each(this.metaFilters, function (value, key) {\n            filters[_this.linkStorageField + '.' + key] = value;\n          });\n        }\n\n        filters[this.linkStorageField + '._id'] = {\n          $in: _.uniq(_.pluck(this.parentObjects, '_id'))\n        };\n        return filters;\n      }\n    }\n\n    return createOneMeta;\n  }();\n\n  _proto.createMany = function () {\n    function createMany() {\n      if (!this.isVirtual) {\n        var _ref2;\n\n        var arrayOfIds = _.pluck(this.parentObjects, this.linkStorageField);\n\n        return {\n          _id: {\n            $in: _.uniq((_ref2 = _).union.apply(_ref2, (0, _toConsumableArray2.default)(arrayOfIds)))\n          }\n        };\n      } else {\n        var _ref3, _ref4;\n\n        var _arrayOfIds = _.pluck(this.parentObjects, '_id');\n\n        return _ref4 = {}, _ref4[this.linkStorageField] = {\n          $in: _.uniq((_ref3 = _).union.apply(_ref3, (0, _toConsumableArray2.default)(_arrayOfIds)))\n        }, _ref4;\n      }\n    }\n\n    return createMany;\n  }();\n\n  _proto.createManyMeta = function () {\n    function createManyMeta() {\n      var _this2 = this;\n\n      if (!this.isVirtual) {\n        var ids = [];\n\n        _.each(this.parentObjects, function (object) {\n          if (object[_this2.linkStorageField]) {\n            if (_this2.metaFilters) {\n              var isValid = sift(_this2.metaFilters);\n\n              _.each(object[_this2.linkStorageField], function (object) {\n                if (isValid(object)) {\n                  ids.push(object._id);\n                }\n              });\n            } else {\n              _.each(object[_this2.linkStorageField], function (object) {\n                ids.push(object._id);\n              });\n            }\n          }\n        });\n\n        return {\n          _id: {\n            $in: _.uniq(ids)\n          }\n        };\n      } else {\n        var _ref5;\n\n        var filters = {};\n\n        if (this.metaFilters) {\n          _.each(this.metaFilters, function (value, key) {\n            filters[key] = value;\n          });\n        }\n\n        filters._id = {\n          $in: _.uniq(_.pluck(this.parentObjects, '_id'))\n        };\n        return _ref5 = {}, _ref5[this.linkStorageField] = {\n          $elemMatch: filters\n        }, _ref5;\n      }\n    }\n\n    return createManyMeta;\n  }();\n\n  (0, _createClass2.default)(AggregateFilters, [{\n    key: \"parentObjects\",\n    get: function () {\n      return this.collectionNode.parent.results;\n    }\n  }]);\n  return AggregateFilters;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"assembleAggregateResults.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/assembleAggregateResults.js                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar sift;\nmodule.watch(require(\"sift\"), {\n  \"default\": function (v) {\n    sift = v;\n  }\n}, 0);\nvar cleanObjectForMetaFilters;\nmodule.watch(require(\"./lib/cleanObjectForMetaFilters\"), {\n  \"default\": function (v) {\n    cleanObjectForMetaFilters = v;\n  }\n}, 1);\nmodule.exportDefault(function (childCollectionNode, aggregateResults, metaFilters) {\n  var linker = childCollectionNode.linker;\n  var linkStorageField = linker.linkStorageField;\n  var linkName = childCollectionNode.linkName;\n  var isMeta = linker.isMeta();\n  var isMany = linker.isMany();\n  var allResults = [];\n\n  if (isMeta && metaFilters) {\n    var metaFiltersTest = sift(metaFilters);\n\n    _.each(childCollectionNode.parent.results, function (parentResult) {\n      cleanObjectForMetaFilters(parentResult, linkStorageField, metaFiltersTest);\n    });\n  }\n\n  if (isMeta && isMany) {\n    // This case is treated differently because we get an array response from the pipeline.\n    _.each(childCollectionNode.parent.results, function (parentResult) {\n      parentResult[linkName] = parentResult[linkName] || [];\n\n      var eligibleAggregateResults = _.filter(aggregateResults, function (aggregateResult) {\n        return _.contains(aggregateResult._id, parentResult._id);\n      });\n\n      if (eligibleAggregateResults.length) {\n        var datas = _.pluck(eligibleAggregateResults, 'data'); /// [ [x1, x2], [x2, x3] ]\n\n\n        _.each(datas, function (data) {\n          _.each(data, function (item) {\n            parentResult[linkName].push(item);\n          });\n        });\n      }\n    });\n\n    _.each(aggregateResults, function (aggregateResult) {\n      _.each(aggregateResult.data, function (item) {\n        return allResults.push(item);\n      });\n    });\n  } else {\n    var comparator;\n\n    if (isMany) {\n      comparator = function (aggregateResult, result) {\n        return _.contains(aggregateResult._id, result._id);\n      };\n    } else {\n      comparator = function (aggregateResult, result) {\n        return aggregateResult._id == result._id;\n      };\n    }\n\n    var childLinkName = childCollectionNode.linkName;\n    var parentResults = childCollectionNode.parent.results;\n    parentResults.forEach(function (parentResult) {\n      // We are now finding the data from the pipeline that is related to the _id of the parent\n      var eligibleAggregateResults = aggregateResults.filter(function (aggregateResult) {\n        return comparator(aggregateResult, parentResult);\n      });\n      eligibleAggregateResults.forEach(function (aggregateResult) {\n        if (Array.isArray(parentResult[childLinkName])) {\n          var _parentResult$childLi;\n\n          (_parentResult$childLi = parentResult[childLinkName]).push.apply(_parentResult$childLi, (0, _toConsumableArray2.default)(aggregateResult.data));\n        } else {\n          parentResult[childLinkName] = (0, _toConsumableArray2.default)(aggregateResult.data);\n        }\n      });\n    });\n    aggregateResults.forEach(function (aggregateResult) {\n      allResults.push.apply(allResults, (0, _toConsumableArray2.default)(aggregateResult.data));\n    });\n  }\n\n  childCollectionNode.results = allResults;\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"assembler.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/assembler.js                                                     //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar createSearchFilters;\nmodule.watch(require(\"../../links/lib/createSearchFilters\"), {\n  \"default\": function (v) {\n    createSearchFilters = v;\n  }\n}, 0);\nvar cleanObjectForMetaFilters;\nmodule.watch(require(\"./lib/cleanObjectForMetaFilters\"), {\n  \"default\": function (v) {\n    cleanObjectForMetaFilters = v;\n  }\n}, 1);\nvar sift;\nmodule.watch(require(\"sift\"), {\n  \"default\": function (v) {\n    sift = v;\n  }\n}, 2);\nmodule.exportDefault(function (childCollectionNode, _ref) {\n  var limit = _ref.limit,\n      skip = _ref.skip,\n      metaFilters = _ref.metaFilters;\n\n  if (childCollectionNode.results.length === 0) {\n    return;\n  }\n\n  var parent = childCollectionNode.parent;\n  var linker = childCollectionNode.linker;\n  var strategy = linker.strategy;\n  var isSingle = linker.isSingle();\n  var isMeta = linker.isMeta();\n  var fieldStorage = linker.linkStorageField; // cleaning the parent results from a child\n  // this may be the wrong approach but it works for now\n\n  if (isMeta && metaFilters) {\n    var metaFiltersTest = sift(metaFilters);\n\n    _.each(parent.results, function (parentResult) {\n      cleanObjectForMetaFilters(parentResult, fieldStorage, metaFiltersTest);\n    });\n  }\n\n  var resultsByKeyId = _.groupBy(childCollectionNode.results, '_id');\n\n  if (strategy === 'one') {\n    parent.results.forEach(function (parentResult) {\n      if (!parentResult[fieldStorage]) {\n        return;\n      }\n\n      parentResult[childCollectionNode.linkName] = filterAssembledData(resultsByKeyId[parentResult[fieldStorage]], {\n        limit: limit,\n        skip: skip\n      });\n    });\n  }\n\n  if (strategy === 'many') {\n    parent.results.forEach(function (parentResult) {\n      if (!parentResult[fieldStorage]) {\n        return;\n      }\n\n      var data = [];\n      parentResult[fieldStorage].forEach(function (_id) {\n        data.push(_.first(resultsByKeyId[_id]));\n      });\n      parentResult[childCollectionNode.linkName] = filterAssembledData(data, {\n        limit: limit,\n        skip: skip\n      });\n    });\n  }\n\n  if (strategy === 'one-meta') {\n    parent.results.forEach(function (parentResult) {\n      if (!parentResult[fieldStorage]) {\n        return;\n      }\n\n      var _id = parentResult[fieldStorage]._id;\n      parentResult[childCollectionNode.linkName] = filterAssembledData(resultsByKeyId[_id], {\n        limit: limit,\n        skip: skip\n      });\n    });\n  }\n\n  if (strategy === 'many-meta') {\n    parent.results.forEach(function (parentResult) {\n      var _ids = _.pluck(parentResult[fieldStorage], '_id');\n\n      var data = [];\n\n      _ids.forEach(function (_id) {\n        data.push(_.first(resultsByKeyId[_id]));\n      });\n\n      parentResult[childCollectionNode.linkName] = filterAssembledData(data, {\n        limit: limit,\n        skip: skip\n      });\n    });\n  }\n});\n\nfunction filterAssembledData(data, _ref2) {\n  var limit = _ref2.limit,\n      skip = _ref2.skip;\n\n  if (limit && Array.isArray(data)) {\n    return data.slice(skip, limit);\n  }\n\n  return data;\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"buildAggregatePipeline.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/buildAggregatePipeline.js                                        //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function (v) {\n    _ = v;\n  }\n}, 0);\nvar SAFE_DOTTED_FIELD_REPLACEMENT;\nmodule.watch(require(\"./constants\"), {\n  SAFE_DOTTED_FIELD_REPLACEMENT: function (v) {\n    SAFE_DOTTED_FIELD_REPLACEMENT = v;\n  }\n}, 1);\nmodule.exportDefault(function (childCollectionNode, filters, options, userId) {\n  var containsDottedFields = false;\n  var linker = childCollectionNode.linker;\n  var linkStorageField = linker.linkStorageField;\n  var collection = childCollectionNode.collection;\n  var pipeline = [];\n\n  if (collection.firewall) {\n    collection.firewall(filters, options, userId);\n  }\n\n  pipeline.push({\n    $match: filters\n  });\n\n  if (options.sort && _.keys(options.sort).length > 0) {\n    pipeline.push({\n      $sort: options.sort\n    });\n  }\n\n  var _id = linkStorageField;\n\n  if (linker.isMeta()) {\n    _id += '._id';\n  }\n\n  var dataPush = {\n    _id: '$_id'\n  };\n\n  _.each(options.fields, function (value, field) {\n    if (field.indexOf('.') >= 0) {\n      containsDottedFields = true;\n    }\n\n    var safeField = field.replace(/\\./g, SAFE_DOTTED_FIELD_REPLACEMENT);\n    dataPush[safeField] = '$' + field;\n  });\n\n  if (linker.isMeta()) {\n    dataPush[linkStorageField] = '$' + linkStorageField;\n  }\n\n  pipeline.push({\n    $group: {\n      _id: \"$\" + _id,\n      data: {\n        $push: dataPush\n      }\n    }\n  });\n\n  if (options.limit || options.skip) {\n    var $slice = [\"$data\"];\n    if (options.skip) $slice.push(options.skip);\n    if (options.limit) $slice.push(options.limit);\n    pipeline.push({\n      $project: {\n        _id: 1,\n        data: {\n          $slice: $slice\n        }\n      }\n    });\n  }\n\n  return {\n    pipeline: pipeline,\n    containsDottedFields: containsDottedFields\n  };\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"constants.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/constants.js                                                     //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  SAFE_DOTTED_FIELD_REPLACEMENT: function () {\n    return SAFE_DOTTED_FIELD_REPLACEMENT;\n  }\n});\nvar SAFE_DOTTED_FIELD_REPLACEMENT = '___';\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"hypernova.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/hypernova.js                                                     //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return hypernovaInit;\n  }\n});\nvar applyProps;\nmodule.watch(require(\"../lib/applyProps.js\"), {\n  \"default\": function (v) {\n    applyProps = v;\n  }\n}, 0);\nvar prepareForDelivery;\nmodule.watch(require(\"../lib/prepareForDelivery.js\"), {\n  \"default\": function (v) {\n    prepareForDelivery = v;\n  }\n}, 1);\nvar storeHypernovaResults;\nmodule.watch(require(\"./storeHypernovaResults.js\"), {\n  \"default\": function (v) {\n    storeHypernovaResults = v;\n  }\n}, 2);\n\nfunction hypernova(collectionNode, userId) {\n  _.each(collectionNode.collectionNodes, function (childCollectionNode) {\n    var _applyProps = applyProps(childCollectionNode),\n        filters = _applyProps.filters,\n        options = _applyProps.options;\n\n    storeHypernovaResults(childCollectionNode, userId);\n    hypernova(childCollectionNode, userId);\n  });\n}\n\nfunction hypernovaInit(collectionNode, userId) {\n  var config = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var bypassFirewalls = config.bypassFirewalls || false;\n  var params = config.params || {};\n\n  var _applyProps2 = applyProps(collectionNode),\n      filters = _applyProps2.filters,\n      options = _applyProps2.options;\n\n  var collection = collectionNode.collection;\n  collectionNode.results = collection.find(filters, options, userId).fetch();\n  var userIdToPass = config.bypassFirewalls ? undefined : userId;\n  hypernova(collectionNode, userIdToPass);\n  prepareForDelivery(collectionNode, params);\n  return collectionNode.results;\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"storeHypernovaResults.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/storeHypernovaResults.js                                         //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nmodule.export({\n  \"default\": function () {\n    return storeHypernovaResults;\n  }\n});\nvar applyProps;\nmodule.watch(require(\"../lib/applyProps.js\"), {\n  \"default\": function (v) {\n    applyProps = v;\n  }\n}, 0);\nvar AggregateFilters;\nmodule.watch(require(\"./aggregateSearchFilters.js\"), {\n  \"default\": function (v) {\n    AggregateFilters = v;\n  }\n}, 1);\nvar assemble;\nmodule.watch(require(\"./assembler.js\"), {\n  \"default\": function (v) {\n    assemble = v;\n  }\n}, 2);\nvar assembleAggregateResults;\nmodule.watch(require(\"./assembleAggregateResults.js\"), {\n  \"default\": function (v) {\n    assembleAggregateResults = v;\n  }\n}, 3);\nvar buildAggregatePipeline;\nmodule.watch(require(\"./buildAggregatePipeline.js\"), {\n  \"default\": function (v) {\n    buildAggregatePipeline = v;\n  }\n}, 4);\nvar snapBackDottedFields;\nmodule.watch(require(\"./lib/snapBackDottedFields\"), {\n  \"default\": function (v) {\n    snapBackDottedFields = v;\n  }\n}, 5);\n\nfunction storeHypernovaResults(childCollectionNode, userId) {\n  if (childCollectionNode.parent.results.length === 0) {\n    return childCollectionNode.results = [];\n  }\n\n  var _applyProps = applyProps(childCollectionNode),\n      filters = _applyProps.filters,\n      options = _applyProps.options;\n\n  var metaFilters = filters.$meta;\n  var aggregateFilters = new AggregateFilters(childCollectionNode, metaFilters);\n  delete filters.$meta;\n  var linker = childCollectionNode.linker;\n  var isVirtual = linker.isVirtual();\n  var collection = childCollectionNode.collection;\n\n  _.extend(filters, aggregateFilters.create()); // if it's not virtual then we retrieve them and assemble them here.\n\n\n  if (!isVirtual) {\n    var filteredOptions = _.omit(options, 'limit');\n\n    childCollectionNode.results = collection.find(filters, filteredOptions, userId).fetch();\n    assemble(childCollectionNode, (0, _objectSpread2.default)({}, options, {\n      metaFilters: metaFilters\n    }));\n  } else {\n    // virtuals arrive here\n    var _buildAggregatePipeli = buildAggregatePipeline(childCollectionNode, filters, options, userId),\n        pipeline = _buildAggregatePipeli.pipeline,\n        containsDottedFields = _buildAggregatePipeli.containsDottedFields;\n\n    var aggregateResults = collection.aggregate(pipeline);\n    /**\n     * If in aggregation it contains '.', we replace it with a custom string '___'\n     * And then after aggregation is complete we need to snap-it back to how it was.\n     */\n\n    if (containsDottedFields) {\n      snapBackDottedFields(aggregateResults);\n    }\n\n    assembleAggregateResults(childCollectionNode, aggregateResults, metaFilters);\n  }\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"cleanObjectForMetaFilters.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/lib/cleanObjectForMetaFilters.js                                 //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.exportDefault(function (object, field, metaFiltersTest) {\n  if (object[field]) {\n    if (_.isArray(object[field])) {\n      object[field] = object[field].filter(metaFiltersTest);\n    } else {\n      if (!metaFiltersTest(object[field])) {\n        object[field] = null;\n      }\n    }\n  }\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"snapBackDottedFields.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/hypernova/lib/snapBackDottedFields.js                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar SAFE_DOTTED_FIELD_REPLACEMENT;\nmodule.watch(require(\"../constants\"), {\n  SAFE_DOTTED_FIELD_REPLACEMENT: function (v) {\n    SAFE_DOTTED_FIELD_REPLACEMENT = v;\n  }\n}, 0);\nvar dot;\nmodule.watch(require(\"dot-object\"), {\n  \"default\": function (v) {\n    dot = v;\n  }\n}, 1);\nmodule.exportDefault(function (aggregationResult) {\n  aggregationResult.forEach(function (result) {\n    result.data = result.data.map(function (document) {\n      _.each(document, function (value, key) {\n        if (key.indexOf(SAFE_DOTTED_FIELD_REPLACEMENT) >= 0) {\n          document[key.replace(new RegExp(SAFE_DOTTED_FIELD_REPLACEMENT, 'g'), '.')] = value;\n          delete document[key];\n        }\n      });\n\n      return dot.object(document);\n    });\n  });\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"lib\":{\"applyProps.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/applyProps.js                                                          //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return applyProps;\n  }\n});\nvar restrictOptions = ['disableOplog', 'pollingIntervalMs', 'pollingThrottleMs'];\n\nfunction applyProps(node) {\n  var _ref;\n\n  var filters = _.extend({}, node.props.$filters);\n\n  var options = _.extend({}, node.props.$options);\n\n  options = (_ref = _).omit.apply(_ref, [options].concat(restrictOptions));\n  options.fields = options.fields || {};\n  node.applyFields(filters, options);\n  return {\n    filters: filters,\n    options: options\n  };\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"callWithPromise.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/callWithPromise.js                                                     //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.exportDefault(function (method, myParameters) {\n  return new Promise(function (resolve, reject) {\n    Meteor.call(method, myParameters, function (err, res) {\n      if (err) reject(err.reason || 'Something went wrong.');\n      resolve(res);\n    });\n  });\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"createGraph.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/createGraph.js                                                         //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  createNodes: function () {\n    return createNodes;\n  },\n  addFieldNode: function () {\n    return addFieldNode;\n  }\n});\nvar CollectionNode;\nmodule.watch(require(\"../nodes/collectionNode.js\"), {\n  \"default\": function (v) {\n    CollectionNode = v;\n  }\n}, 0);\nvar FieldNode;\nmodule.watch(require(\"../nodes/fieldNode.js\"), {\n  \"default\": function (v) {\n    FieldNode = v;\n  }\n}, 1);\nvar ReducerNode;\nmodule.watch(require(\"../nodes/reducerNode.js\"), {\n  \"default\": function (v) {\n    ReducerNode = v;\n  }\n}, 2);\nvar dotize;\nmodule.watch(require(\"./dotize.js\"), {\n  \"default\": function (v) {\n    dotize = v;\n  }\n}, 3);\nvar createReducers;\nmodule.watch(require(\"../reducers/lib/createReducers\"), {\n  \"default\": function (v) {\n    createReducers = v;\n  }\n}, 4);\nvar specialFields = ['$filters', '$options', '$postFilters', '$postOptions', '$postFilter'];\n/**\n * Creates node objects from the body. The root is always a collection node.\n *\n * @param root\n */\n\nfunction createNodes(root) {\n  // this is a fix for phantomjs tests (don't really understand it.)\n  if (!_.isObject(root.body)) {\n    return;\n  }\n\n  _.each(root.body, function (body, fieldName) {\n    if (!body) {\n      return;\n    } // if it's a prop\n\n\n    if (_.contains(specialFields, fieldName)) {\n      root.addProp(fieldName, body);\n      return;\n    } // workaround, see https://github.com/cult-of-coders/grapher/issues/134\n    // TODO: find another way to do this\n\n\n    if (root.collection.default) {\n      root.collection = root.collection.default;\n    } // checking if it is a link.\n\n\n    var linker = root.collection.getLinker(fieldName);\n\n    if (linker) {\n      // check if it is a cached link\n      // if yes, then we need to explicitly define this at collection level\n      // so when we transform the data for delivery, we move it to the link name\n      if (linker.isDenormalized()) {\n        if (linker.isSubBodyDenormalized(body)) {\n          handleDenormalized(root, linker, body, fieldName);\n          return;\n        }\n      }\n\n      var subroot = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n      root.add(subroot, linker);\n      createNodes(subroot);\n      return;\n    } // checking if it's a reducer\n\n\n    var reducer = root.collection.getReducer(fieldName);\n\n    if (reducer) {\n      var reducerNode = new ReducerNode(fieldName, reducer);\n      root.add(reducerNode);\n    } // it's most likely a field then\n\n\n    addFieldNode(body, fieldName, root);\n  });\n\n  createReducers(root);\n\n  if (root.fieldNodes.length === 0) {\n    root.add(new FieldNode('_id', 1));\n  }\n}\n\nfunction addFieldNode(body, fieldName, root) {\n  // it's not a link and not a special variable => we assume it's a field\n  if (_.isObject(body)) {\n    var _dotize$convert;\n\n    var dotted = dotize.convert((_dotize$convert = {}, _dotize$convert[fieldName] = body, _dotize$convert));\n\n    _.each(dotted, function (value, key) {\n      root.add(new FieldNode(key, value));\n    });\n  } else {\n    var fieldNode = new FieldNode(fieldName, body);\n    root.add(fieldNode);\n  }\n}\n\nmodule.exportDefault(function (collection, body) {\n  var root = new CollectionNode(collection, body);\n  createNodes(root);\n  return root;\n});\n;\n/**\n * Ads denormalization config properly, including _id\n *\n * @param root\n * @param linker\n * @param body\n * @param fieldName\n */\n\nfunction handleDenormalized(root, linker, body, fieldName) {\n  Object.assign(body, {\n    _id: 1\n  });\n  var cacheField = linker.linkConfig.denormalize.field;\n  root.snapCache(cacheField, fieldName); // if it's one and direct also include the link storage\n\n  if (!linker.isMany() && !linker.isVirtual()) {\n    addFieldNode(1, linker.linkStorageField, root);\n  }\n\n  addFieldNode(body, cacheField, root);\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"dotize.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/dotize.js                                                              //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nmodule.exportDefault(dotize = {});\n\ndotize.convert = function (obj, prefix) {\n  if ((!obj || (0, _typeof2.default)(obj) != \"object\") && !Array.isArray(obj)) {\n    if (prefix) {\n      var newObj = {};\n      newObj[prefix] = obj;\n      return newObj;\n    } else {\n      return obj;\n    }\n  }\n\n  var newObj = {};\n\n  function recurse(o, p, isArrayItem) {\n    for (var f in meteorBabelHelpers.sanitizeForInObject(o)) {\n      if (o[f] && (0, _typeof2.default)(o[f]) === \"object\") {\n        if (Array.isArray(o[f])) {\n          if (isEmptyArray(o[f])) {\n            newObj[getFieldName(f, p, true)] = o[f]; // empty array\n          } else {\n            newObj = recurse(o[f], getFieldName(f, p, false, true), true); // array\n          }\n        } else {\n          if (isArrayItem) {\n            if (isEmptyObj(o[f])) {\n              newObj[getFieldName(f, p, true)] = o[f]; // empty object\n            } else {\n              newObj = recurse(o[f], getFieldName(f, p, true)); // array item object\n            }\n          } else {\n            if (isEmptyObj(o[f])) {\n              newObj[getFieldName(f, p)] = o[f]; // empty object\n            } else {\n              newObj = recurse(o[f], getFieldName(f, p)); // object\n            }\n          }\n        }\n      } else {\n        if (isArrayItem || isNumber(f)) {\n          newObj[getFieldName(f, p, true)] = o[f]; // array item primitive\n        } else {\n          newObj[getFieldName(f, p)] = o[f]; // primitive\n        }\n      }\n    }\n\n    if (isEmptyObj(newObj)) return obj;\n    return newObj;\n  }\n\n  function isNumber(f) {\n    return !isNaN(parseInt(f));\n  }\n\n  function isEmptyObj(obj) {\n    for (var prop in meteorBabelHelpers.sanitizeForInObject(obj)) {\n      if (Object.hasOwnProperty.call(obj, prop)) return false;\n    }\n\n    return true;\n  }\n\n  function isEmptyArray(o) {\n    if (Array.isArray(o) && o.length == 0) return true;\n    return false;\n  }\n\n  function getFieldName(field, prefix, isArrayItem, isArray) {\n    if (isArray) return (prefix ? prefix : \"\") + (isNumber(field) ? \"[\" + field + \"]\" : \".\" + field);else if (isArrayItem) return (prefix ? prefix : \"\") + \"[\" + field + \"]\";else return (prefix ? prefix + \".\" : \"\") + field;\n  }\n\n  return recurse(obj, prefix, Array.isArray(obj));\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"intersectDeep.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/intersectDeep.js                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar dot;\nmodule.watch(require(\"dot-object\"), {\n  \"default\": function (v) {\n    dot = v;\n  }\n}, 0);\n\nvar _;\n\nmodule.watch(require(\"meteor/underscore\"), {\n  _: function (v) {\n    _ = v;\n  }\n}, 1);\nmodule.exportDefault(function (allowedBody, clientBody) {\n  var allowedBodyDot = _.keys(dot.dot(allowedBody));\n\n  var clientBodyDot = _.keys(dot.dot(clientBody));\n\n  var intersection = _.intersection(allowedBodyDot, clientBodyDot);\n\n  var build = {};\n  intersection.forEach(function (intersectedField) {\n    build[intersectedField] = 1;\n  });\n  return dot.object(build);\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"prepareForDelivery.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/prepareForDelivery.js                                                  //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  applyPostFilters: function () {\n    return applyPostFilters;\n  },\n  applyPostOptions: function () {\n    return applyPostOptions;\n  },\n  getResultsArray: function () {\n    return getResultsArray;\n  },\n  removeLinkStorages: function () {\n    return removeLinkStorages;\n  },\n  storeOneResults: function () {\n    return storeOneResults;\n  },\n  assembleMetadata: function () {\n    return assembleMetadata;\n  }\n});\nvar applyReducers;\nmodule.watch(require(\"../reducers/lib/applyReducers\"), {\n  \"default\": function (v) {\n    applyReducers = v;\n  }\n}, 0);\nvar cleanReducerLeftovers;\nmodule.watch(require(\"../reducers/lib/cleanReducerLeftovers\"), {\n  \"default\": function (v) {\n    cleanReducerLeftovers = v;\n  }\n}, 1);\nvar sift;\nmodule.watch(require(\"sift\"), {\n  \"default\": function (v) {\n    sift = v;\n  }\n}, 2);\nvar Minimongo;\nmodule.watch(require(\"meteor/minimongo\"), {\n  Minimongo: function (v) {\n    Minimongo = v;\n  }\n}, 3);\nmodule.exportDefault(function (node, params) {\n  snapBackCaches(node);\n  storeOneResults(node, node.results);\n  applyReducers(node, params);\n  cleanReducerLeftovers(node);\n\n  _.each(node.collectionNodes, function (collectionNode) {\n    cloneMetaChildren(collectionNode, node.results);\n  });\n\n  _.each(node.collectionNodes, function (collectionNode) {\n    assembleMetadata(collectionNode, node.results);\n  });\n\n  removeLinkStorages(node, node.results);\n  applyPostFilters(node);\n  applyPostOptions(node);\n  applyPostFilter(node, params);\n});\n\nfunction applyPostFilters(node) {\n  var postFilters = node.props.$postFilters;\n\n  if (postFilters) {\n    node.results = sift(postFilters, node.results);\n  }\n}\n\nfunction applyPostOptions(node) {\n  var options = node.props.$postOptions;\n\n  if (options) {\n    if (options.sort) {\n      var sorter = new Minimongo.Sorter(options.sort);\n      node.results.sort(sorter.getComparator());\n    }\n\n    if (options.limit || options.skip) {\n      var start = options.skip || 0;\n      var end = options.limit ? options.limit + start : node.results.length;\n      node.results = node.results.slice(start, end);\n    }\n  }\n}\n\n/**\n * Optionally applies a post filtering option\n */\nfunction applyPostFilter(node, params) {\n  if (node.props.$postFilter) {\n    var filter = node.props.$postFilter;\n\n    if (_.isArray(filter)) {\n      filter.forEach(function (f) {\n        node.results = f(node.results, params);\n      });\n    } else {\n      node.results = filter(node.results, params);\n    }\n  }\n}\n/**\n *\n * Helper function which transforms results into the array.\n * Results are an object for 'one' links.\n *\n * @param results\n * @return array\n */\n\n\nfunction getResultsArray(results) {\n  if (_.isArray(results)) {\n    return results;\n  } else if (_.isUndefined(results)) {\n    return [];\n  }\n\n  return [results];\n}\n\nfunction removeLinkStorages(node, sameLevelResults) {\n  if (!sameLevelResults) {\n    return;\n  }\n\n  sameLevelResults = getResultsArray(sameLevelResults);\n\n  _.each(node.collectionNodes, function (collectionNode) {\n    var removeStorageField = collectionNode.shouldCleanStorage;\n\n    _.each(sameLevelResults, function (result) {\n      if (removeStorageField) {\n        delete result[collectionNode.linkStorageField];\n      }\n\n      removeLinkStorages(collectionNode, result[collectionNode.linkName]);\n    });\n  });\n}\n\nfunction storeOneResults(node, sameLevelResults) {\n  if (!sameLevelResults) {\n    return;\n  }\n\n  node.collectionNodes.forEach(function (collectionNode) {\n    _.each(sameLevelResults, function (result) {\n      storeOneResults(collectionNode, result[collectionNode.linkName]);\n    });\n\n    if (collectionNode.isOneResult) {\n      _.each(sameLevelResults, function (result) {\n        if (result[collectionNode.linkName] && _.isArray(result[collectionNode.linkName])) {\n          result[collectionNode.linkName] = result[collectionNode.linkName] ? _.first(result[collectionNode.linkName]) : undefined;\n        }\n      });\n    }\n  });\n}\n\nfunction cloneMetaChildren(node, parentResults) {\n  if (!parentResults) {\n    return;\n  }\n\n  var linkName = node.linkName;\n  var isMeta = node.isMeta; // parentResults might be an object (for type==one links)\n\n  parentResults = getResultsArray(parentResults);\n  parentResults.forEach(function (parentResult) {\n    if (isMeta && parentResult[linkName]) {\n      if (node.isOneResult) {\n        parentResult[linkName] = Object.assign({}, parentResult[linkName]);\n      } else {\n        parentResult[linkName] = parentResult[linkName].map(function (object) {\n          return Object.assign({}, object);\n        });\n      }\n    }\n\n    node.collectionNodes.forEach(function (collectionNode) {\n      cloneMetaChildren(collectionNode, parentResult[linkName]);\n    });\n  });\n}\n\nfunction assembleMetadata(node, parentResults) {\n  parentResults = getResultsArray(parentResults); // assembling metadata is depth first\n\n  node.collectionNodes.forEach(function (collectionNode) {\n    _.each(parentResults, function (result) {\n      assembleMetadata(collectionNode, result[node.linkName]);\n    });\n  });\n\n  if (node.isMeta) {\n    if (node.isVirtual) {\n      _.each(parentResults, function (parentResult) {\n        var childResult = parentResult[node.linkName];\n\n        if (node.isOneResult) {\n          var storage = childResult[node.linkStorageField];\n          storeMetadata(childResult, parentResult, storage, true);\n        } else {\n          _.each(childResult, function (object) {\n            var storage = object[node.linkStorageField];\n            storeMetadata(object, parentResult, storage, true);\n          });\n        }\n      });\n    } else {\n      _.each(parentResults, function (parentResult) {\n        var childResult = parentResult[node.linkName];\n        var storage = parentResult[node.linkStorageField];\n\n        if (node.isOneResult) {\n          if (childResult) {\n            storeMetadata(childResult, parentResult, storage, false);\n          }\n        } else {\n          _.each(childResult, function (object) {\n            storeMetadata(object, parentResult, storage, false);\n          });\n        }\n      });\n    }\n  }\n}\n\nfunction storeMetadata(element, parentElement, storage, isVirtual) {\n  if (isVirtual) {\n    var $metadata;\n\n    if (_.isArray(storage)) {\n      $metadata = _.find(storage, function (storageItem) {\n        return storageItem._id == parentElement._id;\n      });\n    } else {\n      $metadata = storage;\n    }\n\n    element.$metadata = _.omit($metadata, '_id');\n  } else {\n    var _$metadata;\n\n    if (_.isArray(storage)) {\n      _$metadata = _.find(storage, function (storageItem) {\n        return storageItem._id == element._id;\n      });\n    } else {\n      _$metadata = storage;\n    }\n\n    element.$metadata = _.omit(_$metadata, '_id');\n  }\n}\n\nfunction snapBackCaches(node) {\n  node.collectionNodes.forEach(function (collectionNode) {\n    snapBackCaches(collectionNode);\n  });\n\n  if (!_.isEmpty(node.snapCaches)) {\n    // process stuff\n    _.each(node.snapCaches, function (linkName, cacheField) {\n      var isSingle = _.contains(node.snapCachesSingles, cacheField);\n\n      var linker = node.collection.getLinker(linkName); // we do this because for one direct and one meta direct, id is not stored\n\n      var shoudStoreLinkStorage = !linker.isMany() && !linker.isVirtual();\n      node.results.forEach(function (result) {\n        if (result[cacheField]) {\n          if (shoudStoreLinkStorage) {\n            Object.assign(result[cacheField], {\n              _id: linker.isMeta() ? result[linker.linkStorageField]._id : result[linker.linkStorageField]\n            });\n          }\n\n          if (isSingle && _.isArray(result[cacheField])) {\n            result[linkName] = _.first(result[cacheField]);\n          } else {\n            result[linkName] = result[cacheField];\n          }\n\n          delete result[cacheField];\n        }\n      });\n    });\n  }\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"prepareForProcess.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/prepareForProcess.js                                                   //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar check, Match;\nmodule.watch(require(\"meteor/check\"), {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 0);\nvar deepClone;\nmodule.watch(require(\"lodash.clonedeep\"), {\n  \"default\": function (v) {\n    deepClone = v;\n  }\n}, 1);\n\nfunction defaultFilterFunction(_ref) {\n  var filters = _ref.filters,\n      options = _ref.options,\n      params = _ref.params;\n\n  if (params.filters) {\n    Object.assign(filters, params.filters);\n  }\n\n  if (params.options) {\n    Object.assign(options, params.options);\n  }\n}\n\nfunction applyFilterRecursive(data) {\n  var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var isRoot = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (isRoot && !_.isFunction(data.$filter)) {\n    data.$filter = defaultFilterFunction;\n  }\n\n  if (data.$filter) {\n    check(data.$filter, Match.OneOf(Function, [Function]));\n    data.$filters = data.$filters || {};\n    data.$options = data.$options || {};\n\n    if (_.isArray(data.$filter)) {\n      data.$filter.forEach(function (filter) {\n        filter.call(null, {\n          filters: data.$filters,\n          options: data.$options,\n          params: params\n        });\n      });\n    } else {\n      data.$filter({\n        filters: data.$filters,\n        options: data.$options,\n        params: params\n      });\n    }\n\n    data.$filter = null;\n    delete data.$filter;\n  }\n\n  _.each(data, function (value, key) {\n    if (_.isObject(value)) {\n      return applyFilterRecursive(value, params);\n    }\n  });\n}\n\nfunction applyPagination(body, _params) {\n  if (body['$paginate'] && _params) {\n    if (!body.$options) {\n      body.$options = {};\n    }\n\n    if (_params.limit) {\n      _.extend(body.$options, {\n        limit: _params.limit\n      });\n    }\n\n    if (_params.skip) {\n      _.extend(body.$options, {\n        skip: _params.skip\n      });\n    }\n\n    delete body['$paginate'];\n  }\n}\n\nmodule.exportDefault(function (_body) {\n  var _params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var body = deepClone(_body);\n  var params = deepClone(_params);\n  applyPagination(body, params);\n  applyFilterRecursive(body, params, true);\n  return body;\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"recursiveFetch.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/lib/recursiveFetch.js                                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar applyProps;\nmodule.watch(require(\"./applyProps.js\"), {\n  \"default\": function (v) {\n    applyProps = v;\n  }\n}, 0);\nvar assembleMetadata, removeLinkStorages, storeOneResults;\nmodule.watch(require(\"./prepareForDelivery\"), {\n  assembleMetadata: function (v) {\n    assembleMetadata = v;\n  },\n  removeLinkStorages: function (v) {\n    removeLinkStorages = v;\n  },\n  storeOneResults: function (v) {\n    storeOneResults = v;\n  }\n}, 1);\nvar prepareForDelivery;\nmodule.watch(require(\"./prepareForDelivery\"), {\n  \"default\": function (v) {\n    prepareForDelivery = v;\n  }\n}, 2);\n\n/**\n * This is always run client side to build the data graph out of client-side collections.\n *\n * @param node\n * @param parentObject\n * @returns {*}\n */\nfunction fetch(node, parentObject) {\n  var _applyProps = applyProps(node),\n      filters = _applyProps.filters,\n      options = _applyProps.options;\n\n  var results = [];\n\n  if (parentObject) {\n    var accessor = node.linker.createLink(parentObject, node.collection);\n\n    if (node.isVirtual) {\n      var _$extend;\n\n      options.fields = options.fields || {};\n\n      _.extend(options.fields, (_$extend = {}, _$extend[node.linkStorageField] = 1, _$extend));\n    }\n\n    results = accessor.find(filters, options).fetch();\n  } else {\n    results = node.collection.find(filters, options).fetch();\n  }\n\n  _.each(node.collectionNodes, function (collectionNode) {\n    _.each(results, function (result) {\n      var _collectionNode$resul;\n\n      var collectionNodeResults = fetch(collectionNode, result);\n      result[collectionNode.linkName] = collectionNodeResults; //delete result[node.linker.linkStorageField];\n\n      /**\n       * Push into the results, because snapBackCaches() in prepareForDelivery does not work otherwise.\n       * This is non-optimal, can we be sure that every item in results contains _id and add only if not in\n       * the results?\n       *\n       * Other possible ways:\n       * - do something like assemble() in storeHypernovaResults\n       * - pass node.results to accessor above and find with sift\n       */\n\n      var currentIds = _.pluck(collectionNode.results, '_id');\n\n      (_collectionNode$resul = collectionNode.results).push.apply(_collectionNode$resul, (0, _toConsumableArray2.default)(collectionNodeResults.filter(function (res) {\n        return !_.contains(currentIds, res._id);\n      })));\n    });\n  });\n\n  return results;\n}\n\nmodule.exportDefault(function (node, params) {\n  node.results = fetch(node);\n  prepareForDelivery(node, params);\n  return node.results;\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"nodes\":{\"collectionNode.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/nodes/collectionNode.js                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nmodule.export({\n  \"default\": function () {\n    return CollectionNode;\n  }\n});\nvar FieldNode;\nmodule.watch(require(\"./fieldNode.js\"), {\n  \"default\": function (v) {\n    FieldNode = v;\n  }\n}, 0);\nvar ReducerNode;\nmodule.watch(require(\"./reducerNode.js\"), {\n  \"default\": function (v) {\n    ReducerNode = v;\n  }\n}, 1);\nvar deepClone;\nmodule.watch(require(\"lodash.clonedeep\"), {\n  \"default\": function (v) {\n    deepClone = v;\n  }\n}, 2);\nvar check, Match;\nmodule.watch(require(\"meteor/check\"), {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 3);\n\nvar CollectionNode =\n/*#__PURE__*/\nfunction () {\n  function CollectionNode(collection) {\n    var body = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var linkName = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    if (collection && !_.isObject(body)) {\n      throw new Meteor.Error('invalid-body', 'Every collection link should have its body defined as an object.');\n    }\n\n    this.body = deepClone(body);\n    this.linkName = linkName;\n    this.collection = collection;\n    this.nodes = [];\n    this.props = {};\n    this.parent = null;\n    this.linker = null;\n    this.linkStorageField = null;\n    this.scheduledForDeletion = false;\n    this.reducers = [];\n    this.results = [];\n    this.snapCaches = {}; // {cacheField: linkName}\n\n    this.snapCachesSingles = []; // [cacheField1, cacheField2]\n  }\n\n  var _proto = CollectionNode.prototype;\n\n  /**\n   * Adds children to itself\n   *\n   * @param node\n   * @param linker\n   */\n  _proto.add = function () {\n    function add(node, linker) {\n      node.parent = this;\n\n      if (linker) {\n        node.linker = linker;\n        node.linkStorageField = linker.linkStorageField;\n        node.isMeta = linker.isMeta();\n        node.isVirtual = linker.isVirtual();\n        node.isOneResult = linker.isOneResult();\n        node.shouldCleanStorage = this._shouldCleanStorage(node);\n      }\n\n      this.nodes.push(node);\n    }\n\n    return add;\n  }();\n  /**\n   * @param prop\n   * @param value\n   */\n\n\n  _proto.addProp = function () {\n    function addProp(prop, value) {\n      var _$extend;\n\n      if (prop === '$postFilter') {\n        check(value, Match.OneOf(Function, [Function]));\n      }\n\n      _.extend(this.props, (_$extend = {}, _$extend[prop] = value, _$extend));\n    }\n\n    return addProp;\n  }();\n  /**\n   * @param _node\n   */\n\n\n  _proto.remove = function () {\n    function remove(_node) {\n      this.nodes = _.filter(this.nodes, function (node) {\n        return _node !== node;\n      });\n    }\n\n    return remove;\n  }();\n  /**\n   * @param filters\n   * @param options\n   */\n\n\n  _proto.applyFields = function () {\n    function applyFields(filters, options) {\n      var hasAddedAnyField = false;\n\n      _.each(this.fieldNodes, function (n) {\n        hasAddedAnyField = true;\n        n.applyFields(options.fields);\n      }); // it will only get here if it has collectionNodes children\n\n\n      _.each(this.collectionNodes, function (collectionNode) {\n        var linker = collectionNode.linker;\n\n        if (linker && !linker.isVirtual()) {\n          options.fields[linker.linkStorageField] = 1;\n          hasAddedAnyField = true;\n        }\n      }); // if he selected filters, we should automatically add those fields\n\n\n      _.each(filters, function (value, field) {\n        // special handling for the $meta filter and conditional operators\n        if (!_.contains(['$or', '$nor', '$not', '$and', '$meta'], field)) {\n          // if the field or the parent of the field already exists, don't add it\n          if (!_.has(options.fields, field.split('.')[0])) {\n            hasAddedAnyField = true;\n            options.fields[field] = 1;\n          }\n        }\n      });\n\n      if (!hasAddedAnyField) {\n        options.fields = {\n          _id: 1\n        };\n      }\n    }\n\n    return applyFields;\n  }();\n  /**\n   * @param fieldName\n   * @returns {boolean}\n   */\n\n\n  _proto.hasField = function () {\n    function hasField(fieldName) {\n      return !!_.find(this.fieldNodes, function (fieldNode) {\n        return fieldNode.name == fieldName;\n      });\n    }\n\n    return hasField;\n  }();\n  /**\n   * @param fieldName\n   * @returns {FieldNode}\n   */\n\n\n  _proto.getField = function () {\n    function getField(fieldName) {\n      return _.find(this.fieldNodes, function (fieldNode) {\n        return fieldNode.name == fieldName;\n      });\n    }\n\n    return getField;\n  }();\n  /**\n   * @param name\n   * @returns {boolean}\n   */\n\n\n  _proto.hasCollectionNode = function () {\n    function hasCollectionNode(name) {\n      return !!_.find(this.collectionNodes, function (node) {\n        return node.linkName == name;\n      });\n    }\n\n    return hasCollectionNode;\n  }();\n  /**\n   * @param name\n   * @returns {boolean}\n   */\n\n\n  _proto.hasReducerNode = function () {\n    function hasReducerNode(name) {\n      return !!_.find(this.reducerNodes, function (node) {\n        return node.name == name;\n      });\n    }\n\n    return hasReducerNode;\n  }();\n  /**\n   * @param name\n   * @returns {ReducerNode}\n   */\n\n\n  _proto.getReducerNode = function () {\n    function getReducerNode(name) {\n      return _.find(this.reducerNodes, function (node) {\n        return node.name == name;\n      });\n    }\n\n    return getReducerNode;\n  }();\n  /**\n   * @param name\n   * @returns {CollectionNode}\n   */\n\n\n  _proto.getCollectionNode = function () {\n    function getCollectionNode(name) {\n      return _.find(this.collectionNodes, function (node) {\n        return node.linkName == name;\n      });\n    }\n\n    return getCollectionNode;\n  }();\n  /**\n   * @returns {*}\n   */\n\n\n  _proto.getName = function () {\n    function getName() {\n      return this.linkName ? this.linkName : this.collection ? this.collection._name : 'N/A';\n    }\n\n    return getName;\n  }();\n  /**\n   * This is used for caching links\n   *\n   * @param cacheField\n   * @param subLinkName\n   */\n\n\n  _proto.snapCache = function () {\n    function snapCache(cacheField, subLinkName) {\n      this.snapCaches[cacheField] = subLinkName;\n\n      if (this.collection.getLinker(subLinkName).isOneResult()) {\n        this.snapCachesSingles.push(cacheField);\n      }\n    }\n\n    return snapCache;\n  }();\n  /**\n   * This method verifies whether to remove the linkStorageField form the results\n   * unless you specify it in your query.\n   *\n   * @param node\n   * @returns {boolean}\n   * @private\n   */\n\n\n  _proto._shouldCleanStorage = function () {\n    function _shouldCleanStorage(node) {\n      if (node.linkStorageField === '_id') {\n        return false;\n      } else {\n        if (node.isVirtual) {\n          return !node.hasField(node.linkStorageField);\n        } else {\n          return !this.hasField(node.linkStorageField);\n        }\n      }\n    }\n\n    return _shouldCleanStorage;\n  }();\n\n  (0, _createClass2.default)(CollectionNode, [{\n    key: \"collectionNodes\",\n    get: function () {\n      return _.filter(this.nodes, function (n) {\n        return n instanceof CollectionNode;\n      });\n    }\n  }, {\n    key: \"fieldNodes\",\n    get: function () {\n      return _.filter(this.nodes, function (n) {\n        return n instanceof FieldNode;\n      });\n    }\n  }, {\n    key: \"reducerNodes\",\n    get: function () {\n      return _.filter(this.nodes, function (n) {\n        return n instanceof ReducerNode;\n      });\n    }\n  }]);\n  return CollectionNode;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"fieldNode.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/nodes/fieldNode.js                                                         //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return FieldNode;\n  }\n});\n\nvar FieldNode =\n/*#__PURE__*/\nfunction () {\n  function FieldNode(name, body) {\n    this.name = name;\n    this.body = _.isObject(body) ? 1 : body;\n    this.scheduledForDeletion = false;\n  }\n\n  var _proto = FieldNode.prototype;\n\n  _proto.applyFields = function () {\n    function applyFields(fields) {\n      fields[this.name] = this.body;\n    }\n\n    return applyFields;\n  }();\n\n  return FieldNode;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"reducerNode.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/nodes/reducerNode.js                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return ReducerNode;\n  }\n});\n\nvar ReducerNode =\n/*#__PURE__*/\nfunction () {\n  function ReducerNode(name, _ref) {\n    var body = _ref.body,\n        reduce = _ref.reduce;\n    this.name = name;\n    this.body = body;\n    this.reduceFunction = reduce;\n  }\n  /**\n   * When computing we also pass the parameters\n   * \n   * @param {*} object \n   * @param {*} args \n   */\n\n\n  var _proto = ReducerNode.prototype;\n\n  _proto.compute = function () {\n    function compute(object) {\n      var _this$reduce;\n\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      object[this.name] = (_this$reduce = this.reduce).call.apply(_this$reduce, [this, object].concat(args));\n    }\n\n    return compute;\n  }();\n\n  _proto.reduce = function () {\n    function reduce(object) {\n      var _this$reduceFunction;\n\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      return (_this$reduceFunction = this.reduceFunction).call.apply(_this$reduceFunction, [this, object].concat(args));\n    }\n\n    return reduce;\n  }();\n\n  return ReducerNode;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"reducers\":{\"extension.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/reducers/extension.js                                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar check;\nmodule.watch(require(\"meteor/check\"), {\n  check: function (v) {\n    check = v;\n  }\n}, 0);\nvar addFieldMap;\nmodule.watch(require(\"./lib/addFieldMap\"), {\n  \"default\": function (v) {\n    addFieldMap = v;\n  }\n}, 1);\nvar storage = '__reducers';\nObject.assign(Mongo.Collection.prototype, {\n  /**\n   * @param data\n   */\n  addReducers: function (data) {\n    var _this = this;\n\n    if (!this[storage]) {\n      this[storage] = {};\n    }\n\n    _.each(data, function (reducerConfig, reducerName) {\n      var _$extend;\n\n      if (!_this[reducerConfig]) {\n        _this[reducerConfig] = {};\n      }\n\n      if (_this.getLinker(reducerName)) {\n        throw new Meteor.Error(\"You cannot add the reducer with name: \" + reducerName + \" because it is already defined as a link in \" + _this._name + \" collection\");\n      }\n\n      if (_this[reducerConfig][reducerName]) {\n        throw new Meteor.Error(\"You cannot add the reducer with name: \" + reducerName + \" because it was already added to \" + _this._name + \" collection\");\n      }\n\n      check(reducerConfig, {\n        body: Object,\n        reduce: Function\n      });\n\n      _.extend(_this[storage], (_$extend = {}, _$extend[reducerName] = reducerConfig, _$extend));\n    });\n  },\n\n  /**\n   * @param name\n   * @returns {*}\n   */\n  getReducer: function (name) {\n    if (this[storage]) {\n      return this[storage][name];\n    }\n  },\n\n  /**\n   * This creates reducers that makes sort of aliases for the database fields we use\n   */\n  addFieldMap: addFieldMap\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"addFieldMap.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/reducers/lib/addFieldMap.js                                                //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return addFieldMap;\n  }\n});\n\nfunction addFieldMap(map) {\n  var collection = this;\n  var reducers = {};\n\n  var _loop = function (key) {\n    var _body;\n\n    var dbField = map[key];\n    reducers[key] = {\n      body: (_body = {}, _body[dbField] = 1, _body),\n      reduce: function (obj) {\n        return obj[dbField];\n      }\n    };\n  };\n\n  for (var key in meteorBabelHelpers.sanitizeForInObject(map)) {\n    _loop(key);\n  }\n\n  collection.addReducers(reducers);\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"applyReducers.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/reducers/lib/applyReducers.js                                              //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return applyReducers;\n  }\n});\n\nfunction applyReducers(root, params) {\n  _.each(root.collectionNodes, function (node) {\n    applyReducers(node, params);\n  });\n\n  _.each(root.reducerNodes, function (reducerNode) {\n    root.results.forEach(function (result) {\n      reducerNode.compute(result, params);\n    });\n  });\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"cleanReducerLeftovers.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/reducers/lib/cleanReducerLeftovers.js                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return cleanReducerLeftovers;\n  }\n});\nvar dot;\nmodule.watch(require(\"dot-object\"), {\n  \"default\": function (v) {\n    dot = v;\n  }\n}, 0);\n\nfunction cleanReducerLeftovers(root) {\n  _.each(root.collectionNodes, function (node) {\n    if (node.scheduledForDeletion) {\n      root.results.forEach(function (result) {\n        delete result[node.linkName];\n      });\n    }\n  });\n\n  _.each(root.collectionNodes, function (node) {\n    cleanReducerLeftovers(node);\n  });\n\n  _.each(root.fieldNodes, function (node) {\n    if (node.scheduledForDeletion) {\n      cleanNestedFields(node.name.split('.'), root.results, root);\n    }\n  });\n\n  _.each(root.reducerNodes, function (node) {\n    if (node.scheduledForDeletion) {\n      root.results.forEach(function (result) {\n        delete result[node.name];\n      });\n    }\n  });\n}\n\n// if we store a field like: 'profile.firstName'\n// then we need to delete profile: { firstName }\n// if profile will have empty keys, we need to delete profile.\n\n/**\n *\n * @param parts\n * @param results\n */\nfunction cleanNestedFields(parts, results, root) {\n  var snapCacheField = root.snapCaches[parts[0]];\n  var fieldName = snapCacheField ? snapCacheField : parts[0];\n\n  if (parts.length === 1) {\n    results.forEach(function (result) {\n      if (_.isObject(result) && fieldName !== '_id') {\n        delete result[fieldName];\n      }\n    });\n    return;\n  }\n\n  parts.shift();\n  cleanNestedFields(parts, results.map(function (result) {\n    return result[fieldName];\n  }), root);\n  results.forEach(function (result) {\n    if (_.isObject(result[fieldName]) && _.keys(result[fieldName]).length === 0) {\n      if (fieldName !== '_id') {\n        delete result[fieldName];\n      }\n    }\n  });\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"createReducers.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/reducers/lib/createReducers.js                                             //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return addReducers;\n  },\n  handleAddElement: function () {\n    return handleAddElement;\n  },\n  handleAddReducer: function () {\n    return handleAddReducer;\n  },\n  handleAddLink: function () {\n    return handleAddLink;\n  },\n  handleAddField: function () {\n    return handleAddField;\n  }\n});\nvar dot;\nmodule.watch(require(\"dot-object\"), {\n  \"default\": function (v) {\n    dot = v;\n  }\n}, 0);\nvar createNodes;\nmodule.watch(require(\"../../lib/createGraph\"), {\n  createNodes: function (v) {\n    createNodes = v;\n  }\n}, 1);\nvar CollectionNode;\nmodule.watch(require(\"../../nodes/collectionNode\"), {\n  \"default\": function (v) {\n    CollectionNode = v;\n  }\n}, 2);\nvar FieldNode;\nmodule.watch(require(\"../../nodes/fieldNode\"), {\n  \"default\": function (v) {\n    FieldNode = v;\n  }\n}, 3);\nvar ReducerNode;\nmodule.watch(require(\"../../nodes/reducerNode\"), {\n  \"default\": function (v) {\n    ReducerNode = v;\n  }\n}, 4);\nvar embedReducerWithLink;\nmodule.watch(require(\"./embedReducerWithLink\"), {\n  \"default\": function (v) {\n    embedReducerWithLink = v;\n  }\n}, 5);\n\nfunction addReducers(root) {\n  // we add reducers last, after we have added all the fields.\n  root.reducerNodes.forEach(function (reducer) {\n    _.each(reducer.body, function (body, fieldName) {\n      handleAddElement(root, fieldName, body);\n    });\n  });\n}\n\nfunction handleAddElement(root, fieldName, body) {\n  // if it's a link\n  var collection = root.collection;\n  var linker = collection.getLinker(fieldName);\n\n  if (linker) {\n    return handleAddLink(fieldName, body, root, linker);\n  }\n\n  var reducer = collection.getReducer(fieldName);\n\n  if (reducer) {\n    return handleAddReducer(fieldName, reducer, root);\n  } // we assume it's a field in this case\n\n\n  return handleAddField(fieldName, body, root);\n}\n\nfunction handleAddReducer(fieldName, reducer, root) {\n  if (!root.hasReducerNode(fieldName)) {\n    var reducerNode = new ReducerNode(fieldName, reducer);\n    root.add(reducerNode);\n    reducerNode.scheduledForDeletion = true;\n\n    _.each(reducer.body, function (body, fieldName) {\n      handleAddElement(root, fieldName, body);\n    });\n  }\n}\n\nfunction handleAddLink(fieldName, body, root, linker) {\n  if (root.hasCollectionNode(fieldName)) {\n    var collectionNode = root.getCollectionNode(fieldName);\n    embedReducerWithLink(body, collectionNode);\n  } else {\n    // add\n    var _collectionNode = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n\n    _collectionNode.scheduledForDeletion = true;\n    root.add(_collectionNode, linker);\n    createNodes(_collectionNode);\n  }\n}\n\nfunction handleAddField(fieldName, body, root) {\n  if (_.isObject(body)) {\n    var _dot$dot;\n\n    // if reducer specifies a nested field\n    var dots = dot.dot((_dot$dot = {}, _dot$dot[fieldName] = body, _dot$dot));\n\n    _.each(dots, function (value, key) {\n      if (!root.hasField(key)) {\n        var fieldNode = new FieldNode(key, value);\n        fieldNode.scheduledForDeletion = true;\n        root.add(fieldNode);\n      }\n    });\n  } else {\n    // if reducer does not specify a nested field, and the field does not exist.\n    if (!root.hasField(fieldName)) {\n      var fieldNode = new FieldNode(fieldName, body);\n      fieldNode.scheduledForDeletion = true;\n      root.add(fieldNode);\n    }\n  }\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"embedReducerWithLink.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/cultofcoders_grapher/lib/query/reducers/lib/embedReducerWithLink.js                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  \"default\": function () {\n    return embedReducerWithLink;\n  }\n});\nvar handleAddField, handleAddElement, handleAddReducer;\nmodule.watch(require(\"./createReducers\"), {\n  handleAddField: function (v) {\n    handleAddField = v;\n  },\n  handleAddElement: function (v) {\n    handleAddElement = v;\n  },\n  handleAddReducer: function (v) {\n    handleAddReducer = v;\n  }\n}, 0);\n\nfunction embedReducerWithLink(reducerBody, collectionNode) {\n  _.each(reducerBody, function (value, key) {\n    var collection = collectionNode.collection;\n\n    if (_.isObject(value)) {\n      // nested field or link\n      if (collectionNode.body[key]) {\n        // if it exists\n        var linker = collection.getLinker(key); // if it's a link\n\n        if (linker) {\n          if (linker.isDenormalized()) {\n            if (linker.isSubBodyDenormalized(value)) {\n              var cacheField = linker.linkConfig.denormalize.field;\n              handleAddField(cacheField, value, collectionNode);\n              return;\n            }\n          }\n\n          embedReducerWithLink(value, collectionNode.getCollectionNode(key));\n          return;\n        }\n\n        handleAddField(key, value, collectionNode);\n      } else {\n        // does not exist, so it may be a link/reducer/field\n        handleAddElement(collectionNode, key, value);\n      }\n    } else {\n      // if this field or other reducer exists within the collection\n      if (!collectionNode.body[key]) {\n        // can only be field or another reducer for this.\n        var reducer = collection.getReducer(key);\n\n        if (reducer) {\n          // if it's another reducer\n          return handleAddReducer(key, reducer, collectionNode);\n        }\n\n        return handleAddField(key, value, collectionNode);\n      }\n    }\n  });\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}},\"node_modules\":{\"lodash.clonedeep\":{\"package.json\":function(require,exports){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/lodash.clonedeep/package.json                                //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nexports.name = \"lodash.clonedeep\";\nexports.version = \"4.5.0\";\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"index.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/lodash.clonedeep/index.js                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\n/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/**\n * Adds the key-value `pair` to `map`.\n *\n * @private\n * @param {Object} map The map to modify.\n * @param {Array} pair The key-value pair to add.\n * @returns {Object} Returns `map`.\n */\nfunction addMapEntry(map, pair) {\n  // Don't return `map.set` because it's not chainable in IE 11.\n  map.set(pair[0], pair[1]);\n  return map;\n}\n\n/**\n * Adds `value` to `set`.\n *\n * @private\n * @param {Object} set The set to modify.\n * @param {*} value The value to add.\n * @returns {Object} Returns `set`.\n */\nfunction addSetEntry(set, value) {\n  // Don't return `set.add` because it's not chainable in IE 11.\n  set.add(value);\n  return set;\n}\n\n/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/**\n * A specialized version of `_.reduce` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @param {*} [accumulator] The initial value.\n * @param {boolean} [initAccum] Specify using the first element of `array` as\n *  the initial value.\n * @returns {*} Returns the accumulated value.\n */\nfunction arrayReduce(array, iteratee, accumulator, initAccum) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  if (initAccum && length) {\n    accumulator = array[++index];\n  }\n  while (++index < length) {\n    accumulator = iteratee(accumulator, array[index], index, array);\n  }\n  return accumulator;\n}\n\n/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    Symbol = root.Symbol,\n    Uint8Array = root.Uint8Array,\n    getPrototype = overArg(Object.getPrototypeOf, Object),\n    objectCreate = Object.create,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols,\n    nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,\n    nativeKeys = overArg(Object.keys, Object);\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView'),\n    Map = getNative(root, 'Map'),\n    Promise = getNative(root, 'Promise'),\n    Set = getNative(root, 'Set'),\n    WeakMap = getNative(root, 'WeakMap'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  this.__data__ = new ListCache(entries);\n}\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n}\n\n/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  return this.__data__['delete'](key);\n}\n\n/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\n/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var cache = this.__data__;\n  if (cache instanceof ListCache) {\n    var pairs = cache.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      return this;\n    }\n    cache = this.__data__ = new MapCache(pairs);\n  }\n  cache.set(key, value);\n  return this;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  // Safari 9 makes `arguments.length` enumerable in strict mode.\n  var result = (isArray(value) || isArguments(value))\n    ? baseTimes(value.length, String)\n    : [];\n\n  var length = result.length,\n      skipIndexes = !!length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    object[key] = value;\n  }\n}\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @param {boolean} [isFull] Specify a clone including symbols.\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, isDeep, isFull, customizer, key, object, stack) {\n  var result;\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      if (isHostObject(value)) {\n        return object ? value : {};\n      }\n      result = initCloneObject(isFunc ? {} : value);\n      if (!isDeep) {\n        return copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, baseClone, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (!isArr) {\n    var props = isFull ? getAllKeys(value) : keys(value);\n  }\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, isDeep, isFull, customizer, key, value, stack));\n  });\n  return result;\n}\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} prototype The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nfunction baseCreate(proto) {\n  return isObject(proto) ? objectCreate(proto) : {};\n}\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\n/**\n * The base implementation of `getTag`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  return objectToString.call(value);\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var result = new buffer.constructor(buffer.length);\n  buffer.copy(result);\n  return result;\n}\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\n/**\n * Creates a clone of `map`.\n *\n * @private\n * @param {Object} map The map to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned map.\n */\nfunction cloneMap(map, isDeep, cloneFunc) {\n  var array = isDeep ? cloneFunc(mapToArray(map), true) : mapToArray(map);\n  return arrayReduce(array, addMapEntry, new map.constructor);\n}\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\n/**\n * Creates a clone of `set`.\n *\n * @private\n * @param {Object} set The set to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned set.\n */\nfunction cloneSet(set, isDeep, cloneFunc) {\n  var array = isDeep ? cloneFunc(setToArray(set), true) : setToArray(set);\n  return arrayReduce(array, addSetEntry, new set.constructor);\n}\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\n/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    assignValue(object, key, newValue === undefined ? source[key] : newValue);\n  }\n  return object;\n}\n\n/**\n * Copies own symbol properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Creates an array of the own enumerable symbol properties of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = nativeGetSymbols ? overArg(nativeGetSymbols, Object) : stubArray;\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11,\n// for data views in Edge < 14, and promises in Node.js.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = objectToString.call(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : undefined;\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {Function} cloneFunc The function to clone values.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, cloneFunc, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return cloneMap(object, isDeep, cloneFunc);\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return cloneSet(object, isDeep, cloneFunc);\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, true, true);\n}\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\n/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\n/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nmodule.exports = cloneDeep;\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"dot-object\":{\"package.json\":function(require,exports){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/dot-object/package.json                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nexports.name = \"dot-object\";\nexports.version = \"1.5.4\";\nexports.main = \"index\";\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"index.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/dot-object/index.js                                          //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\n'use strict'\n\nfunction _process (v, mod) {\n  var i\n  var r\n\n  if (typeof mod === 'function') {\n    r = mod(v)\n    if (r !== undefined) {\n      v = r\n    }\n  } else if (Array.isArray(mod)) {\n    for (i = 0; i < mod.length; i++) {\n      r = mod[i](v)\n      if (r !== undefined) {\n        v = r\n      }\n    }\n  }\n\n  return v\n}\n\nfunction parseKey (key, val) {\n  // detect negative index notation\n  if (key[0] === '-' && Array.isArray(val) && /^-\\d+$/.test(key)) {\n    return val.length + parseInt(key, 10)\n  }\n  return key\n}\n\nfunction isIndex (k) {\n  return /^\\d+/.test(k)\n}\n\nfunction parsePath (path, sep) {\n  if (path.indexOf('[') >= 0) {\n    path = path.replace(/\\[/g, '.').replace(/]/g, '')\n  }\n  return path.split(sep)\n}\n\nfunction DotObject (seperator, override, useArray) {\n  if (!(this instanceof DotObject)) {\n    return new DotObject(seperator, override, useArray)\n  }\n\n  if (typeof seperator === 'undefined') seperator = '.'\n  if (typeof override === 'undefined') override = false\n  if (typeof useArray === 'undefined') useArray = true\n  this.seperator = seperator\n  this.override = override\n  this.useArray = useArray\n\n  // contains touched arrays\n  this.cleanup = []\n}\n\nvar dotDefault = new DotObject('.', false, true)\nfunction wrap (method) {\n  return function () {\n    return dotDefault[method].apply(dotDefault, arguments)\n  }\n}\n\nDotObject.prototype._fill = function (a, obj, v, mod) {\n  var k = a.shift()\n\n  if (a.length > 0) {\n    obj[k] = obj[k] ||\n      (this.useArray && isIndex(a[0]) ? [] : {})\n\n    if (obj[k] !== Object(obj[k])) {\n      if (this.override) {\n        obj[k] = {}\n      } else {\n        throw new Error(\n          'Trying to redefine `' + k + '` which is a ' + typeof obj[k]\n        )\n      }\n    }\n\n    this._fill(a, obj[k], v, mod)\n  } else {\n    if (!this.override &&\n      obj[k] === Object(obj[k]) && Object.keys(obj[k]).length) {\n      throw new Error(\"Trying to redefine non-empty obj['\" + k + \"']\")\n    }\n\n    obj[k] = _process(v, mod)\n  }\n}\n\n/**\n *\n * Converts an object with dotted-key/value pairs to it's expanded version\n *\n * Optionally transformed by a set of modifiers.\n *\n * Usage:\n *\n *   var row = {\n *     'nr': 200,\n *     'doc.name': '  My Document  '\n *   }\n *\n *   var mods = {\n *     'doc.name': [_s.trim, _s.underscored]\n *   }\n *\n *   dot.object(row, mods)\n *\n * @param {Object} obj\n * @param {Object} mods\n */\nDotObject.prototype.object = function (obj, mods) {\n  var self = this\n\n  Object.keys(obj).forEach(function (k) {\n    var mod = mods === undefined ? null : mods[k]\n    // normalize array notation.\n    var ok = parsePath(k, self.seperator).join(self.seperator)\n\n    if (ok.indexOf(self.seperator) !== -1) {\n      self._fill(ok.split(self.seperator), obj, obj[k], mod)\n      delete obj[k]\n    } else if (self.override) {\n      obj[k] = _process(obj[k], mod)\n    }\n  })\n\n  return obj\n}\n\n/**\n * @param {String} path dotted path\n * @param {String} v value to be set\n * @param {Object} obj object to be modified\n * @param {Function|Array} mod optional modifier\n */\nDotObject.prototype.str = function (path, v, obj, mod) {\n  if (path.indexOf(this.seperator) !== -1) {\n    this._fill(path.split(this.seperator), obj, v, mod)\n  } else if (!obj.hasOwnProperty(path) || this.override) {\n    obj[path] = _process(v, mod)\n  }\n\n  return obj\n}\n\n/**\n *\n * Pick a value from an object using dot notation.\n *\n * Optionally remove the value\n *\n * @param {String} path\n * @param {Object} obj\n * @param {Boolean} remove\n */\nDotObject.prototype.pick = function (path, obj, remove) {\n  var i\n  var keys\n  var val\n  var key\n  var cp\n\n  keys = parsePath(path, this.seperator)\n  for (i = 0; i < keys.length; i++) {\n    key = parseKey(keys[i], obj)\n    if (obj && typeof obj === 'object' && key in obj) {\n      if (i === (keys.length - 1)) {\n        if (remove) {\n          val = obj[key]\n          delete obj[key]\n          if (Array.isArray(obj)) {\n            cp = keys.slice(0, -1).join('.')\n            if (this.cleanup.indexOf(cp) === -1) {\n              this.cleanup.push(cp)\n            }\n          }\n          return val\n        } else {\n          return obj[key]\n        }\n      } else {\n        obj = obj[key]\n      }\n    } else {\n      return undefined\n    }\n  }\n  if (remove && Array.isArray(obj)) {\n    obj = obj.filter(function (n) { return n !== undefined })\n  }\n  return obj\n}\n\n/**\n *\n * Remove value from an object using dot notation.\n *\n * @param {String} path\n * @param {Object} obj\n * @return {Mixed} The removed value\n */\nDotObject.prototype.remove = function (path, obj) {\n  var i\n\n  this.cleanup = []\n  if (Array.isArray(path)) {\n    for (i = 0; i < path.length; i++) {\n      this.pick(path[i], obj, true)\n    }\n    this._cleanup(obj)\n    return obj\n  } else {\n    return this.pick(path, obj, true)\n  }\n}\n\nDotObject.prototype._cleanup = function (obj) {\n  var ret\n  var i\n  var keys\n  var root\n  if (this.cleanup.length) {\n    for (i = 0; i < this.cleanup.length; i++) {\n      keys = this.cleanup[i].split('.')\n      root = keys.splice(0, -1).join('.')\n      ret = root ? this.pick(root, obj) : obj\n      ret = ret[keys[0]].filter(function (v) { return v !== undefined })\n      this.set(this.cleanup[i], ret, obj)\n    }\n    this.cleanup = []\n  }\n}\n\n// alias method\nDotObject.prototype.del = DotObject.prototype.remove\n\n/**\n *\n * Move a property from one place to the other.\n *\n * If the source path does not exist (undefined)\n * the target property will not be set.\n *\n * @param {String} source\n * @param {String} target\n * @param {Object} obj\n * @param {Function|Array} mods\n * @param {Boolean} merge\n */\nDotObject.prototype.move = function (source, target, obj, mods, merge) {\n  if (typeof mods === 'function' || Array.isArray(mods)) {\n    this.set(target, _process(this.pick(source, obj, true), mods), obj, merge)\n  } else {\n    merge = mods\n    this.set(target, this.pick(source, obj, true), obj, merge)\n  }\n\n  return obj\n}\n\n/**\n *\n * Transfer a property from one object to another object.\n *\n * If the source path does not exist (undefined)\n * the property on the other object will not be set.\n *\n * @param {String} source\n * @param {String} target\n * @param {Object} obj1\n * @param {Object} obj2\n * @param {Function|Array} mods\n * @param {Boolean} merge\n */\nDotObject.prototype.transfer = function (source, target, obj1, obj2, mods, merge) {\n  if (typeof mods === 'function' || Array.isArray(mods)) {\n    this.set(target,\n      _process(\n        this.pick(source, obj1, true),\n        mods\n      ), obj2, merge)\n  } else {\n    merge = mods\n    this.set(target, this.pick(source, obj1, true), obj2, merge)\n  }\n\n  return obj2\n}\n\n/**\n *\n * Copy a property from one object to another object.\n *\n * If the source path does not exist (undefined)\n * the property on the other object will not be set.\n *\n * @param {String} source\n * @param {String} target\n * @param {Object} obj1\n * @param {Object} obj2\n * @param {Function|Array} mods\n * @param {Boolean} merge\n */\nDotObject.prototype.copy = function (source, target, obj1, obj2, mods, merge) {\n  if (typeof mods === 'function' || Array.isArray(mods)) {\n    this.set(target,\n      _process(\n        // clone what is picked\n        JSON.parse(\n          JSON.stringify(\n            this.pick(source, obj1, false)\n          )\n        ),\n        mods\n      ), obj2, merge)\n  } else {\n    merge = mods\n    this.set(target, this.pick(source, obj1, false), obj2, merge)\n  }\n\n  return obj2\n}\n\nfunction isObject (val) {\n  return Object.prototype.toString.call(val) === '[object Object]'\n}\n\n/**\n *\n * Set a property on an object using dot notation.\n *\n * @param {String} path\n * @param {Mixed} val\n * @param {Object} obj\n * @param {Boolean} merge\n */\nDotObject.prototype.set = function (path, val, obj, merge) {\n  var i\n  var k\n  var keys\n  var key\n\n  // Do not operate if the value is undefined.\n  if (typeof val === 'undefined') {\n    return obj\n  }\n  keys = parsePath(path, this.seperator)\n\n  for (i = 0; i < keys.length; i++) {\n    key = keys[i]\n    if (i === (keys.length - 1)) {\n      if (merge && isObject(val) && isObject(obj[key])) {\n        for (k in val) {\n          if (val.hasOwnProperty(k)) {\n            obj[key][k] = val[k]\n          }\n        }\n      } else if (merge && Array.isArray(obj[key]) && Array.isArray(val)) {\n        for (var j = 0; j < val.length; j++) {\n          obj[keys[i]].push(val[j])\n        }\n      } else {\n        obj[key] = val\n      }\n    } else if (\n      // force the value to be an object\n      !obj.hasOwnProperty(key) ||\n      (!isObject(obj[key]) && !Array.isArray(obj[key]))\n    ) {\n      // initialize as array if next key is numeric\n      if (/^\\d+$/.test(keys[i + 1])) {\n        obj[key] = []\n      } else {\n        obj[key] = {}\n      }\n    }\n    obj = obj[key]\n  }\n  return obj\n}\n\n/**\n *\n * Transform an object\n *\n * Usage:\n *\n *   var obj = {\n *     \"id\": 1,\n  *    \"some\": {\n  *      \"thing\": \"else\"\n  *    }\n *   }\n *\n *   var transform = {\n *     \"id\": \"nr\",\n  *    \"some.thing\": \"name\"\n *   }\n *\n *   var tgt = dot.transform(transform, obj)\n *\n * @param {Object} recipe Transform recipe\n * @param {Object} obj Object to be transformed\n * @param {Array} mods modifiers for the target\n */\nDotObject.prototype.transform = function (recipe, obj, tgt) {\n  obj = obj || {}\n  tgt = tgt || {}\n  Object.keys(recipe).forEach(function (key) {\n    this.set(recipe[key], this.pick(key, obj), tgt)\n  }.bind(this))\n  return tgt\n}\n\n/**\n *\n * Convert object to dotted-key/value pair\n *\n * Usage:\n *\n *   var tgt = dot.dot(obj)\n *\n *   or\n *\n *   var tgt = {}\n *   dot.dot(obj, tgt)\n *\n * @param {Object} obj source object\n * @param {Object} tgt target object\n * @param {Array} path path array (internal)\n */\nDotObject.prototype.dot = function (obj, tgt, path) {\n  tgt = tgt || {}\n  path = path || []\n  Object.keys(obj).forEach(function (key) {\n    if (Object(obj[key]) === obj[key] && (Object.prototype.toString.call(obj[key]) === '[object Object]') || Object.prototype.toString.call(obj[key]) === '[object Array]') {\n      return this.dot(obj[key], tgt, path.concat(key))\n    } else {\n      tgt[path.concat(key).join(this.seperator)] = obj[key]\n    }\n  }.bind(this))\n  return tgt\n}\n\nDotObject.pick = wrap('pick')\nDotObject.move = wrap('move')\nDotObject.transfer = wrap('transfer')\nDotObject.transform = wrap('transform')\nDotObject.copy = wrap('copy')\nDotObject.object = wrap('object')\nDotObject.str = wrap('str')\nDotObject.set = wrap('set')\nDotObject.del = DotObject.remove = wrap('remove')\nDotObject.dot = wrap('dot')\n\n;['override', 'overwrite'].forEach(function (prop) {\n  Object.defineProperty(DotObject, prop, {\n    get: function () {\n      return dotDefault.override\n    },\n    set: function (val) {\n      dotDefault.override = !!val\n    }\n  })\n})\n\nObject.defineProperty(DotObject, 'useArray', {\n  get: function () {\n    return dotDefault.useArray\n  },\n  set: function (val) {\n    dotDefault.useArray = val\n  }\n})\n\nDotObject._process = _process\n\nmodule.exports = DotObject;\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"sift\":{\"package.json\":function(require,exports){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/sift/package.json                                            //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nexports.name = \"sift\";\nexports.version = \"3.2.6\";\nexports.main = \"./sift.js\";\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"sift.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/sift/sift.js                                                 //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\n/*\n * Sift 3.x\n *\n * Copryright 2015, Craig Condon\n * Licensed under MIT\n *\n * Filter JavaScript objects with mongodb queries\n */\n\n(function() {\n\n  'use strict';\n\n  /**\n   */\n\n  function isFunction(value) {\n    return typeof value === 'function';\n  }\n\n  /**\n   */\n\n  function isArray(value) {\n    return Object.prototype.toString.call(value) === '[object Array]';\n  }\n\n  /**\n   */\n\n  function comparable(value) {\n    if (value instanceof Date) {\n      return value.getTime();\n    } else if (value instanceof Array) {\n      return value.map(comparable);\n    } else {\n      return value;\n    }\n  }\n\n  function get(obj, key) {\n    if (obj.get) return obj.get(key);\n    return obj[key];\n  }\n\n  /**\n   */\n\n  function or(validator) {\n    return function(a, b) {\n      if (!isArray(b) || !b.length) return validator(a, b);\n      for (var i = 0, n = b.length; i < n; i++) if (validator(a, get(b,i))) return true;\n      return false;\n    }\n  }\n\n  /**\n   */\n\n  function and(validator) {\n    return function(a, b) {\n      if (!isArray(b) || !b.length) return validator(a, b);\n      for (var i = 0, n = b.length; i < n; i++) if (!validator(a, get(b, i))) return false;\n      return true;\n    };\n  }\n\n  function validate(validator, b) {\n    return validator.v(validator.a, b);\n  }\n\n\n  var operator = {\n\n    /**\n     */\n\n    $eq: or(function(a, b) {\n      return a(b);\n    }),\n\n    /**\n     */\n\n    $ne: and(function(a, b) {\n      return !a(b);\n    }),\n\n    /**\n     */\n\n    $or: function(a, b) {\n      for (var i = 0, n = a.length; i < n; i++) if (validate(get(a, i), b)) return true;\n      return false;\n    },\n\n    /**\n     */\n\n    $gt: or(function(a, b) {\n      return sift.compare(comparable(b), a) > 0;\n    }),\n\n    /**\n     */\n\n    $gte: or(function(a, b) {\n      return sift.compare(comparable(b), a) >= 0;\n    }),\n\n    /**\n     */\n\n    $lt: or(function(a, b) {\n      return sift.compare(comparable(b), a) < 0;\n    }),\n\n    /**\n     */\n\n    $lte: or(function(a, b) {\n      return sift.compare(comparable(b), a) <= 0;\n    }),\n\n    /**\n     */\n\n    $mod: or(function(a, b) {\n      return b % a[0] == a[1];\n    }),\n\n    /**\n     */\n\n    $in: function(a, b) {\n\n      if (b instanceof Array) {\n        for (var i = b.length; i--;) {\n          if (~a.indexOf(comparable(get(b, i)))) return true;\n        }\n      } else {\n        return !!~a.indexOf(comparable(b));\n      }\n\n      return false;\n    },\n\n    /**\n     */\n\n    $nin: function(a, b) {\n      return !operator.$in(a, b);\n    },\n\n    /**\n     */\n\n    $not: function(a, b) {\n      return !validate(a, b);\n    },\n\n    /**\n     */\n\n    $type: function(a, b) {\n      return b != void 0 ? b instanceof a || b.constructor == a : false;\n     },\n\n    /**\n     */\n\n    $all: function(a, b) {\n      if (!b) b = [];\n      for (var i = a.length; i--;) {\n        if (!~comparable(b).indexOf(get(a, i))) return false;\n      }\n      return true;\n    },\n\n    /**\n     */\n\n    $size: function(a, b) {\n      return b ? a === b.length : false;\n    },\n\n    /**\n     */\n\n    $nor: function(a, b) {\n      // todo - this suffice? return !operator.$in(a)\n      for (var i = 0, n = a.length; i < n; i++) if (validate(get(a, i), b)) return false;\n      return true;\n    },\n\n    /**\n     */\n\n    $and: function(a, b) {\n      for (var i = 0, n = a.length; i < n; i++) if (!validate(get(a, i), b)) return false;\n      return true;\n    },\n\n    /**\n     */\n\n    $regex: or(function(a, b) {\n      return typeof b === 'string' && a.test(b);\n    }),\n\n    /**\n     */\n\n    $where: function(a, b) {\n      return a.call(b, b);\n    },\n\n    /**\n     */\n\n    $elemMatch: function(a, b) {\n      if (isArray(b)) return !!~search(b, a);\n      return validate(a, b);\n    },\n\n    /**\n     */\n\n    $exists: function(a, b) {\n      return (b != void 0) === a;\n    }\n  };\n\n  /**\n   */\n\n  var prepare = {\n\n    /**\n     */\n\n    $eq: function(a) {\n\n      if (a instanceof RegExp) {\n        return function(b) {\n          return typeof b === 'string' && a.test(b);\n        };\n      } else if (a instanceof Function) {\n        return a;\n      } else if (isArray(a) && !a.length) {\n        // Special case of a == []\n        return function(b) {\n          return (isArray(b) && !b.length);\n        };\n      } else if (a === null){\n        return function(b){\n          //will match both null and undefined\n          return b == null;\n        }\n      }\n\n      return function(b) {\n        return sift.compare(comparable(b), a) === 0;\n      };\n    },\n\n    /**\n     */\n\n    $ne: function(a) {\n      return prepare.$eq(a);\n    },\n\n    /**\n     */\n\n    $and: function(a) {\n      return a.map(parse);\n    },\n\n    /**\n     */\n\n    $or: function(a) {\n      return a.map(parse);\n    },\n\n    /**\n     */\n\n    $nor: function(a) {\n      return a.map(parse);\n    },\n\n    /**\n     */\n\n    $not: function(a) {\n      return parse(a);\n    },\n\n    /**\n     */\n\n    $regex: function(a, query) {\n      return new RegExp(a, query.$options);\n    },\n\n    /**\n     */\n\n    $where: function(a) {\n      return typeof a === 'string' ? new Function('obj', 'return ' + a) : a;\n    },\n\n    /**\n     */\n\n    $elemMatch: function(a) {\n      return parse(a);\n    },\n\n    /**\n     */\n\n    $exists: function(a) {\n      return !!a;\n    }\n  };\n\n  /**\n   */\n\n  function search(array, validator) {\n\n    for (var i = 0; i < array.length; i++) {\n      if (validate(validator, get(array, i))) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /**\n   */\n\n  function createValidator(a, validate) {\n    return { a: a, v: validate };\n  }\n\n  /**\n   */\n\n  function nestedValidator(a, b) {\n    var values  = [];\n    findValues(b, a.k, 0, values);\n\n    if (values.length === 1) {\n      return validate(a.nv, values[0]);\n    }\n\n    return !!~search(values, a.nv);\n  }\n\n  /**\n   */\n\n  function findValues(current, keypath, index, values) {\n\n    if (index === keypath.length || current == void 0) {\n      values.push(current);\n      return;\n    }\n\n    var k = get(keypath, index);\n\n    // ensure that if current is an array, that the current key\n    // is NOT an array index. This sort of thing needs to work:\n    // sift({'foo.0':42}, [{foo: [42]}]);\n    if (isArray(current) && isNaN(Number(k))) {\n      for (var i = 0, n = current.length; i < n; i++) {\n        findValues(get(current, i), keypath, index, values);\n      }\n    } else {\n      findValues(get(current, k), keypath, index + 1, values);\n    }\n  }\n\n  /**\n   */\n\n  function createNestedValidator(keypath, a) {\n    return { a: { k: keypath, nv: a }, v: nestedValidator };\n  }\n\n  /**\n   * flatten the query\n   */\n\n  function parse(query) {\n    query = comparable(query);\n\n    if (!query || (query.constructor.toString() !== 'Object' &&\n        query.constructor.toString().replace(/\\n/g,'').replace(/ /g, '') !== 'functionObject(){[nativecode]}')) { // cross browser support\n      query = { $eq: query };\n    }\n\n    var validators = [];\n\n    for (var key in query) {\n      var a = query[key];\n\n      if (key === '$options') continue;\n\n      if (operator[key]) {\n        if (prepare[key]) a = prepare[key](a, query);\n        validators.push(createValidator(comparable(a), operator[key]));\n      } else {\n\n        if (key.charCodeAt(0) === 36) {\n          throw new Error('Unknown operation ' + key);\n        }\n\n        validators.push(createNestedValidator(key.split('.'), parse(a)));\n      }\n    }\n\n    return validators.length === 1 ? validators[0] : createValidator(validators, operator.$and);\n  }\n\n  /**\n   */\n\n  function createRootValidator(query, getter) {\n    var validator = parse(query);\n    if (getter) {\n      validator = {\n        a: validator,\n        v: function(a, b) {\n          return validate(a, getter(b));\n        }\n      };\n    }\n    return validator;\n  }\n\n  /**\n   */\n\n  function sift(query, array, getter) {\n\n    if (isFunction(array)) {\n      getter = array;\n      array  = void 0;\n    }\n\n    var validator = createRootValidator(query, getter);\n\n    function filter(b) {\n      return validate(validator, b);\n    }\n\n    if (array) {\n      return array.filter(filter);\n    }\n\n    return filter;\n  }\n\n  /**\n   */\n\n  sift.use = function(plugin) {\n    if (isFunction(plugin)) return plugin(sift);\n    for (var key in plugin) {\n      if (key.charCodeAt(0) === 36) operator[key] = plugin[key];\n    }\n  };\n\n  /**\n   */\n\n  sift.indexOf = function(query, array, getter) {\n    return search(array, createRootValidator(query, getter));\n  };\n\n  /**\n   */\n\n  sift.compare = function(a, b) {\n    if(a===b) return 0;\n    if(typeof a === typeof b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n    }\n  };\n\n  /* istanbul ignore next */\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = sift;\n  }\n\n  if (typeof window !== 'undefined') {\n    window.sift = sift;\n  }\n})();\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"deep-extend\":{\"package.json\":function(require,exports){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/deep-extend/package.json                                     //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nexports.name = \"deep-extend\";\nexports.version = \"0.5.0\";\nexports.main = \"lib/deep-extend.js\";\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib\":{\"deep-extend.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/cultofcoders_grapher/node_modules/deep-extend/lib/deep-extend.js                               //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\n/*!\n * @description Recursive object extending\n * @author Viacheslav Lotsmanov <lotsmanov89@gmail.com>\n * @license MIT\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2013-2015 Viacheslav Lotsmanov\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n * the Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n'use strict';\n\nfunction isSpecificValue(val) {\n\treturn (\n\t\tval instanceof Buffer\n\t\t|| val instanceof Date\n\t\t|| val instanceof RegExp\n\t) ? true : false;\n}\n\nfunction cloneSpecificValue(val) {\n\tif (val instanceof Buffer) {\n\t\tvar x = new Buffer(val.length);\n\t\tval.copy(x);\n\t\treturn x;\n\t} else if (val instanceof Date) {\n\t\treturn new Date(val.getTime());\n\t} else if (val instanceof RegExp) {\n\t\treturn new RegExp(val);\n\t} else {\n\t\tthrow new Error('Unexpected situation');\n\t}\n}\n\n/**\n * Recursive cloning array.\n */\nfunction deepCloneArray(arr) {\n\tvar clone = [];\n\tarr.forEach(function (item, index) {\n\t\tif (typeof item === 'object' && item !== null) {\n\t\t\tif (Array.isArray(item)) {\n\t\t\t\tclone[index] = deepCloneArray(item);\n\t\t\t} else if (isSpecificValue(item)) {\n\t\t\t\tclone[index] = cloneSpecificValue(item);\n\t\t\t} else {\n\t\t\t\tclone[index] = deepExtend({}, item);\n\t\t\t}\n\t\t} else {\n\t\t\tclone[index] = item;\n\t\t}\n\t});\n\treturn clone;\n}\n\n/**\n * Extening object that entered in first argument.\n *\n * Returns extended object or false if have no target object or incorrect type.\n *\n * If you wish to clone source object (without modify it), just use empty new\n * object as first argument, like this:\n *   deepExtend({}, yourObj_1, [yourObj_N]);\n */\nvar deepExtend = module.exports = function (/*obj_1, [obj_2], [obj_N]*/) {\n\tif (arguments.length < 1 || typeof arguments[0] !== 'object') {\n\t\treturn false;\n\t}\n\n\tif (arguments.length < 2) {\n\t\treturn arguments[0];\n\t}\n\n\tvar target = arguments[0];\n\n\t// convert arguments to array and cut off target object\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tvar val, src, clone;\n\n\targs.forEach(function (obj) {\n\t\t// skip argument if isn't an object, is null, or is an array\n\t\tif (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n\t\t\treturn;\n\t\t}\n\n\t\tObject.keys(obj).forEach(function (key) {\n\t\t\tsrc = target[key]; // source value\n\t\t\tval = obj[key]; // new value\n\n\t\t\t// recursion prevention\n\t\t\tif (val === target) {\n\t\t\t\treturn;\n\n\t\t\t/**\n\t\t\t * if new value isn't object then just overwrite by new value\n\t\t\t * instead of extending.\n\t\t\t */\n\t\t\t} else if (typeof val !== 'object' || val === null) {\n\t\t\t\ttarget[key] = val;\n\t\t\t\treturn;\n\n\t\t\t// just clone arrays (and recursive clone objects inside)\n\t\t\t} else if (Array.isArray(val)) {\n\t\t\t\ttarget[key] = deepCloneArray(val);\n\t\t\t\treturn;\n\n\t\t\t// custom cloning and overwrite for specific objects\n\t\t\t} else if (isSpecificValue(val)) {\n\t\t\t\ttarget[key] = cloneSpecificValue(val);\n\t\t\t\treturn;\n\n\t\t\t// overwrite by new value if source isn't object or array\n\t\t\t} else if (typeof src !== 'object' || src === null || Array.isArray(src)) {\n\t\t\t\ttarget[key] = deepExtend({}, val);\n\t\t\t\treturn;\n\n\t\t\t// source value and new value is objects both, extending...\n\t\t\t} else {\n\t\t\t\ttarget[key] = deepExtend(src, val);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t});\n\n\treturn target;\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\nvar exports = require(\"/node_modules/meteor/cultofcoders:grapher/main.client.js\");\n\n/* Exports */\nPackage._define(\"cultofcoders:grapher\", exports);\n\n})();\n","servePath":"/packages/cultofcoders_grapher.js","sourceMap":{"version":3,"sources":["packages/cultofcoders:grapher/main.client.js","packages/cultofcoders:grapher/lib/compose.js","packages/cultofcoders:grapher/lib/createQuery.js","packages/cultofcoders:grapher/lib/extension.js","packages/cultofcoders:grapher/lib/links/config.schema.js","packages/cultofcoders:grapher/lib/links/constants.js","packages/cultofcoders:grapher/lib/links/extension.js","packages/cultofcoders:grapher/lib/links/linker.js","packages/cultofcoders:grapher/lib/links/lib/createSearchFilters.js","packages/cultofcoders:grapher/lib/links/linkTypes/base.js","packages/cultofcoders:grapher/lib/links/linkTypes/linkMany.js","packages/cultofcoders:grapher/lib/links/linkTypes/linkManyMeta.js","packages/cultofcoders:grapher/lib/links/linkTypes/linkOne.js","packages/cultofcoders:grapher/lib/links/linkTypes/linkOneMeta.js","packages/cultofcoders:grapher/lib/links/linkTypes/lib/smartArguments.js","packages/cultofcoders:grapher/lib/namedQuery/namedQuery.base.js","packages/cultofcoders:grapher/lib/namedQuery/namedQuery.client.js","packages/cultofcoders:grapher/lib/namedQuery/namedQuery.js","packages/cultofcoders:grapher/lib/namedQuery/namedQuery.server.js","packages/cultofcoders:grapher/lib/namedQuery/store.js","packages/cultofcoders:grapher/lib/namedQuery/cache/BaseResultCacher.js","packages/cultofcoders:grapher/lib/namedQuery/cache/MemoryResultCacher.js","packages/cultofcoders:grapher/lib/query/query.base.js","packages/cultofcoders:grapher/lib/query/query.client.js","packages/cultofcoders:grapher/lib/query/query.js","packages/cultofcoders:grapher/lib/query/query.server.js","packages/cultofcoders:grapher/lib/query/counts/collection.js","packages/cultofcoders:grapher/lib/query/counts/constants.js","packages/cultofcoders:grapher/lib/query/counts/countSubscription.js","packages/cultofcoders:grapher/lib/query/counts/createFauxSubscription.js","packages/cultofcoders:grapher/lib/query/hypernova/aggregateSearchFilters.js","packages/cultofcoders:grapher/lib/query/hypernova/assembleAggregateResults.js","packages/cultofcoders:grapher/lib/query/hypernova/assembler.js","packages/cultofcoders:grapher/lib/query/hypernova/buildAggregatePipeline.js","packages/cultofcoders:grapher/lib/query/hypernova/constants.js","packages/cultofcoders:grapher/lib/query/hypernova/hypernova.js","packages/cultofcoders:grapher/lib/query/hypernova/storeHypernovaResults.js","packages/cultofcoders:grapher/lib/query/hypernova/lib/cleanObjectForMetaFilters.js","packages/cultofcoders:grapher/lib/query/hypernova/lib/snapBackDottedFields.js","packages/cultofcoders:grapher/lib/query/lib/applyProps.js","packages/cultofcoders:grapher/lib/query/lib/callWithPromise.js","packages/cultofcoders:grapher/lib/query/lib/createGraph.js","packages/cultofcoders:grapher/lib/query/lib/dotize.js","packages/cultofcoders:grapher/lib/query/lib/intersectDeep.js","packages/cultofcoders:grapher/lib/query/lib/prepareForDelivery.js","packages/cultofcoders:grapher/lib/query/lib/prepareForProcess.js","packages/cultofcoders:grapher/lib/query/lib/recursiveFetch.js","packages/cultofcoders:grapher/lib/query/nodes/collectionNode.js","packages/cultofcoders:grapher/lib/query/nodes/fieldNode.js","packages/cultofcoders:grapher/lib/query/nodes/reducerNode.js","packages/cultofcoders:grapher/lib/query/reducers/extension.js","packages/cultofcoders:grapher/lib/query/reducers/lib/addFieldMap.js","packages/cultofcoders:grapher/lib/query/reducers/lib/applyReducers.js","packages/cultofcoders:grapher/lib/query/reducers/lib/cleanReducerLeftovers.js","packages/cultofcoders:grapher/lib/query/reducers/lib/createReducers.js","packages/cultofcoders:grapher/lib/query/reducers/lib/embedReducerWithLink.js"],"names":["module","watch","require","v","exports","createQuery","prepareForProcess","Query","NamedQuery","compose","deepExtend","exportDefault","args","NamedQueryStore","name","body","options","_","isFunction","createNamedQuery","entryPointName","first","keys","collection","Mongo","Collection","get","Meteor","Error","isDevelopment","console","warn","params","createNormalQuery","namedQuery","query","add","clone","extend","prototype","export","DenormalizeSchema","LinkConfigDefaults","LinkConfigSchema","Match","field","String","Object","bypassSchema","Maybe","Boolean","type","OneOf","Where","isObject","_collection","metadata","inversedBy","index","unique","autoremove","denormalize","ObjectIncluding","LINK_STORAGE","Linker","assign","addLinks","data","each","linkConfig","linkName","_name","linker","getLinks","getLinker","hasLink","getLink","objectOrId","linkData","object","isVirtual","findOne","fields","linkStorageField","_id","createLink","LinkMany","LinkManyMeta","LinkOne","LinkOneMeta","smartArguments","dot","check","mainCollection","_validateAndClean","_initAutoremove","_initDenormalization","_handleReferenceRemovalForVirtualLinks","_initIndex","getLinkedCollection","isMany","isSingle","isMeta","relatedLinker","contains","oneTypes","isOneResult","helperClass","_getHelperClass","collectionName","_prepareVirtual","_generateFieldName","startup","_setupVirtualConfig","virtualLinkConfig","strategy","cleanedCollectionName","replace","defaultFieldPrefix","after","remove","userId","doc","accessor","fetch","link","linkedObj","unset","isServer","_ensureIndex","$in","getIds","ids","find","map","item","packageExists","Package","cacheConfig","referenceFieldSuffix","inversedLink","referenceField","cacheField","cache","isDenormalized","isSubBodyDenormalized","cacheBody","cacheBodyFields","bodyFields","omit","difference","length","createSearchFilters","createOne","createOneVirtual","createOneMeta","createOneMetaVirtual","createMany","createManyVirtual","createManyMeta","createManyMetaVirtual","sift","fieldStorage","metaFilters","value","undefined","filters","key","pluck","$elemMatch","Link","SmartArgs","linkedCollection","config","$metaFilters","$meta","searchFilters","appliedFilters","default","others","result","clean","identifyId","what","saveToDatabase","getId","identifyIds","_validateIds","isArray","validIds","join","_virtualAction","action","reversedLink","element","elementId","insert","set","_ids","union","modifier","$addToSet","$each","update","filter","$pullAll","metadatas","localMetadata","push","extendMetadata","existingMetadata","subfield","subfieldUpdate","$set","$pull","subWhat","NamedQueryBase","deepClone","isNamedQuery","queryName","resolver","subscriptionHandle","isExposed","setParams","doValidateParams","validateParams","_validate","validationError","error","newParams","constructor","isResolver","cacher","exposeConfig","validator","call","CountSubscription","createGraph","recursiveFetch","callWithPromise","Base","subscribe","callback","subscribeCount","_counter","unsubscribe","stop","unsubscribeCount","fetchSync","fetchOneSync","callbackOrOptions","_fetchStatic","_fetchReactive","fetchOne","err","res","getCountSync","getCount","$body","intersectDeep","allowSkip","$options","skip","NamedQueryClient","NamedQueryServer","MemoryResultCacher","context","_performSecurityChecks","_fetchResolverData","doEmbodimentIfItApplies","cacheId","generateQueryId","countCursor","getCursorForCounting","count","$filters","cacheResults","resolve","fn","self","_callFirewall","storage","getAll","BaseResultCacher","EJSON","stringify","fetchData","cloneDeep","DEFAULT_TTL","store","cacheData","storeData","ttl","setTimeout","QueryBase","isGlobalQuery","QueryClient","QueryServer","hypernova","node","COUNTS_COLLECTION_CLIENT","ReactiveVar","Tracker","Counts","createFauxSubscription","accessToken","fauxHandle","arg","equals","lastArgs","token","_markedForUnsubscribe","disconnectComputation","autorun","handleDisconnect","id","status","connected","_markedForResume","isSubscribed","countManager","ready","AggregateFilters","collectionNode","create","uniq","parentObjects","eligibleObjects","storages","arrayOfIds","isValid","parent","results","cleanObjectForMetaFilters","childCollectionNode","aggregateResults","allResults","metaFiltersTest","parentResult","eligibleAggregateResults","aggregateResult","datas","comparator","childLinkName","parentResults","forEach","Array","limit","resultsByKeyId","groupBy","filterAssembledData","slice","SAFE_DOTTED_FIELD_REPLACEMENT","containsDottedFields","pipeline","firewall","$match","sort","$sort","dataPush","indexOf","safeField","$group","$push","$slice","$project","hypernovaInit","applyProps","prepareForDelivery","storeHypernovaResults","collectionNodes","bypassFirewalls","userIdToPass","assemble","assembleAggregateResults","buildAggregatePipeline","snapBackDottedFields","aggregateFilters","filteredOptions","aggregate","aggregationResult","document","RegExp","restrictOptions","props","applyFields","method","myParameters","Promise","reject","reason","createNodes","addFieldNode","CollectionNode","FieldNode","ReducerNode","dotize","createReducers","specialFields","root","fieldName","addProp","handleDenormalized","subroot","reducer","getReducer","reducerNode","fieldNodes","dotted","convert","fieldNode","snapCache","obj","prefix","newObj","recurse","o","p","isArrayItem","f","isEmptyArray","getFieldName","isEmptyObj","isNumber","isNaN","parseInt","prop","hasOwnProperty","allowedBody","clientBody","allowedBodyDot","clientBodyDot","intersection","build","intersectedField","applyPostFilters","applyPostOptions","getResultsArray","removeLinkStorages","storeOneResults","assembleMetadata","applyReducers","cleanReducerLeftovers","Minimongo","snapBackCaches","cloneMetaChildren","applyPostFilter","postFilters","$postFilters","$postOptions","sorter","Sorter","getComparator","start","end","$postFilter","isUndefined","sameLevelResults","removeStorageField","shouldCleanStorage","childResult","storeMetadata","parentElement","$metadata","storageItem","isEmpty","snapCaches","snapCachesSingles","shoudStoreLinkStorage","defaultFilterFunction","applyFilterRecursive","isRoot","$filter","Function","applyPagination","_params","_body","parentObject","collectionNodeResults","currentIds","nodes","scheduledForDeletion","reducers","_shouldCleanStorage","_node","hasAddedAnyField","n","has","split","hasField","getField","hasCollectionNode","hasReducerNode","reducerNodes","getReducerNode","getCollectionNode","getName","subLinkName","reduce","reduceFunction","compute","addFieldMap","addReducers","reducerConfig","reducerName","dbField","cleanNestedFields","parts","snapCacheField","shift","handleAddElement","handleAddReducer","handleAddLink","handleAddField","embedReducerWithLink","dots","reducerBody"],"mappings":"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","file":"/packages/cultofcoders_grapher.js","sourcesContent":["import './lib/extension.js';\nimport './lib/links/extension.js';\nimport './lib/query/reducers/extension.js';\n\nexport { default as createQuery } from './lib/createQuery.js';\n\nexport {\n    default as prepareForProcess,\n} from './lib/query/lib/prepareForProcess';\n\nexport { default as Query } from './lib/query/query.client';\n\nexport { default as NamedQuery } from './lib/namedQuery/namedQuery.client';\n\nexport { default as compose } from './lib/compose';\n","import deepExtend from 'deep-extend';\n\nexport default function (...args) {\n    return deepExtend({}, ...args);\n}","import Query from './query/query.js';\nimport NamedQuery from './namedQuery/namedQuery.js';\nimport NamedQueryStore from './namedQuery/store.js';\n\n/**\n * This is a polymorphic function, it allows you to create a query as an object\n * or it also allows you to re-use an existing query if it's a named one\n *\n * @param args\n * @returns {*}\n */\nexport default (...args) => {\n    if (typeof args[0] === 'string') {\n        let [name, body, options] = args;\n        options = options || {};\n\n        // It's a resolver query\n        if (_.isFunction(body)) {\n            return createNamedQuery(name, null, body, options);\n        }\n\n        const entryPointName = _.first(_.keys(body));\n        const collection = Mongo.Collection.get(entryPointName);\n\n        if (!collection) {\n            throw new Meteor.Error('invalid-name', `We could not find any collection with the name \"${entryPointName}\". Make sure it is imported prior to using this`)\n        }\n\n        return createNamedQuery(name, collection, body[entryPointName], options);\n    } else {\n        // Query Creation, it can have an endpoint as collection or as a NamedQuery\n        let [body, options] = args;\n        options = options || {};\n\n        const entryPointName = _.first(_.keys(body));\n        const collection = Mongo.Collection.get(entryPointName);\n\n        if (!collection) {\n            if (Meteor.isDevelopment && !NamedQueryStore.get(entryPointName)) {\n                console.warn(`You are creating a query with the entry point \"${entryPointName}\", but there was no collection found for it (maybe you forgot to import it client-side?). It's assumed that it's referencing a NamedQuery.`)\n            }\n\n            return createNamedQuery(entryPointName, null, {}, {params: body[entryPointName]});\n        } else {\n            return createNormalQuery(collection, body[entryPointName], options);\n        }\n    }\n}\n\nfunction createNamedQuery(name, collection, body, options = {}) {\n    // if it exists already, we re-use it\n    const namedQuery = NamedQueryStore.get(name);\n    let query;\n\n    if (!namedQuery) {\n        query = new NamedQuery(name, collection, body, options);\n        NamedQueryStore.add(name, query);\n    } else {\n        query = namedQuery.clone(options.params);\n    }\n\n    return query;\n}\n\nfunction createNormalQuery(collection, body, options)  {\n    return new Query(collection, body, options);\n}\n","import Query from './query/query.js';\nimport NamedQuery from './namedQuery/namedQuery.js';\nimport NamedQueryStore from './namedQuery/store.js';\n\n_.extend(Mongo.Collection.prototype, {\n    createQuery(...args) {\n        if (typeof args[0] === 'string') {\n            //NamedQuery\n            const [name, body, options] = args;\n            const query = new NamedQuery(name, this, body, options);\n            NamedQueryStore.add(name, query);\n\n            return query;\n        } else {\n            const [body, options] = args;\n\n            return new Query(this, body, options);\n        }\n    },\n});\n","import {Match} from 'meteor/check';\nimport {Mongo} from 'meteor/mongo';\n\nexport const DenormalizeSchema = {\n    field: String,\n    body: Object,\n    bypassSchema: Match.Maybe(Boolean)\n};\n\nexport const LinkConfigDefaults = {\n    type: 'one',\n};\n\nexport const LinkConfigSchema = {\n    type: Match.Maybe(Match.OneOf('one', 'many', '1', '*')),\n    collection: Match.Maybe(\n        Match.Where(collection => {\n            // We do like this so it works with other types of collections \n            // like FS.Collection\n            return _.isObject(collection) && (\n                collection instanceof Mongo.Collection\n                || \n                !!collection._collection\n            );\n        })\n    ),\n    field: Match.Maybe(String),\n    metadata: Match.Maybe(Boolean),\n    inversedBy: Match.Maybe(String),\n    index: Match.Maybe(Boolean),\n    unique: Match.Maybe(Boolean),\n    autoremove: Match.Maybe(Boolean),\n    denormalize: Match.Maybe(Match.ObjectIncluding(DenormalizeSchema)),\n};","export const LINK_STORAGE = '__links';\n","import { Mongo } from 'meteor/mongo';\nimport { LINK_STORAGE } from './constants.js';\nimport Linker from './linker.js';\n\nObject.assign(Mongo.Collection.prototype, {\n    /**\n     * The data we add should be valid for config.schema.js\n     */\n    addLinks(data) {\n        if (!this[LINK_STORAGE]) {\n            this[LINK_STORAGE] = {};\n        }\n\n        _.each(data, (linkConfig, linkName) => {\n            if (this[LINK_STORAGE][linkName]) {\n                throw new Meteor.Error(\n                    `You cannot add the link with name: ${linkName} because it was already added to ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            const linker = new Linker(this, linkName, linkConfig);\n\n            _.extend(this[LINK_STORAGE], {\n                [linkName]: linker,\n            });\n        });\n    },\n\n    getLinks() {\n        return this[LINK_STORAGE];\n    },\n\n    getLinker(name) {\n        if (this[LINK_STORAGE]) {\n            return this[LINK_STORAGE][name];\n        }\n    },\n\n    hasLink(name) {\n        if (!this[LINK_STORAGE]) {\n            return false;\n        }\n\n        return !!this[LINK_STORAGE][name];\n    },\n\n    getLink(objectOrId, name) {\n        let linkData = this[LINK_STORAGE];\n\n        if (!linkData) {\n            throw new Meteor.Error(\n                `There are no links defined for collection: ${this._name}`\n            );\n        }\n\n        if (!linkData[name]) {\n            throw new Meteor.Error(\n                `There is no link ${name} for collection: ${this._name}`\n            );\n        }\n\n        const linker = linkData[name];\n        let object = objectOrId;\n        if (typeof objectOrId == 'string') {\n            if (!linker.isVirtual()) {\n                object = this.findOne(objectOrId, {\n                    fields: {\n                        [linker.linkStorageField]: 1,\n                    },\n                });\n            } else {\n                object = { _id: objectOrId };\n            }\n\n            if (!object) {\n                throw new Meteor.Error(\n                    `We could not find any object with _id: \"${objectOrId}\" within the collection: ${\n                        this._name\n                    }`\n                );\n            }\n        }\n\n        return linkData[name].createLink(object);\n    },\n});\n","import LinkMany from './linkTypes/linkMany.js';\nimport LinkManyMeta from './linkTypes/linkManyMeta.js';\nimport LinkOne from './linkTypes/linkOne.js';\nimport LinkOneMeta from './linkTypes/linkOneMeta.js';\nimport {LinkConfigSchema, LinkConfigDefaults} from './config.schema.js';\nimport smartArguments from './linkTypes/lib/smartArguments';\nimport dot from 'dot-object';\nimport {check} from 'meteor/check';\nimport {_} from 'meteor/underscore';\n\nexport default class Linker {\n    /**\n     * @param mainCollection\n     * @param linkName\n     * @param linkConfig\n     */\n    constructor(mainCollection, linkName, linkConfig) {\n        this.mainCollection = mainCollection;\n        this.linkConfig = Object.assign({}, LinkConfigDefaults, linkConfig);\n        this.linkName = linkName;\n\n        // check linkName must not exist in schema\n        this._validateAndClean();\n\n        // initialize cascade removal hooks.\n        this._initAutoremove();\n        this._initDenormalization();\n\n        if (this.isVirtual()) {\n            // if it's a virtual field make sure that when this is deleted, it will be removed from the references\n            if (!linkConfig.autoremove) {\n                this._handleReferenceRemovalForVirtualLinks();\n            }\n        } else {\n            this._initIndex();\n        }\n    }\n\n    /**\n     * Values which represent for the relation a single link\n     * @returns {string[]}\n     */\n    get oneTypes() {\n        return ['one', '1'];\n    }\n\n    /**\n     * Returns the strategies: one, many, one-meta, many-meta\n     * @returns {string}\n     */\n    get strategy() {\n        let strategy = this.isMany() ? 'many' : 'one';\n        if (this.linkConfig.metadata) {\n            strategy += '-meta';\n        }\n\n        return strategy;\n    }\n\n    /**\n     * Returns the field name in the document where the actual relationships are stored.\n     * @returns string\n     */\n    get linkStorageField() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.linkStorageField;\n        }\n\n        return this.linkConfig.field;\n    }\n\n    /**\n     * The collection that is linked with the current collection\n     * @returns Mongo.Collection\n     */\n    getLinkedCollection() {\n        return this.linkConfig.collection;\n    }\n\n    /**\n     * If the relationship for this link is of \"many\" type.\n     */\n    isMany() {\n        return !this.isSingle();\n    }\n\n    /**\n     * If the relationship for this link contains metadata\n     */\n    isMeta() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.isMeta();\n        }\n\n        return !!this.linkConfig.metadata;\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    isSingle() {\n        if (this.isVirtual()) {\n            return this.linkConfig.relatedLinker.isSingle();\n        }\n\n        return _.contains(this.oneTypes, this.linkConfig.type);\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    isVirtual() {\n        return !!this.linkConfig.inversedBy;\n    }\n\n    /**\n     * Should return a single result.\n     */\n    isOneResult() {\n        return (\n            (this.isVirtual() && this.linkConfig.relatedLinker.linkConfig.unique)\n            || (!this.isVirtual() && this.isSingle())\n        );\n    }\n\n    /**\n     * @param object\n     * @param collection To impersonate the getLinkedCollection() of the \"Linker\"\n     *\n     * @returns {LinkOne|LinkMany|LinkManyMeta|LinkOneMeta|LinkResolve}\n     */\n    createLink(object, collection = null) {\n        let helperClass = this._getHelperClass();\n\n        return new helperClass(this, object, collection);\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _validateAndClean() {\n        if (!this.linkConfig.collection) {\n            throw new Meteor.Error('invalid-config', `For the link ${this.linkName} you did not provide a collection.`)\n        }\n\n        if (typeof(this.linkConfig.collection) === 'string') {\n            const collectionName = this.linkConfig.collection;\n            this.linkConfig.collection = Mongo.Collection.get(collectionName);\n\n            if (!this.linkConfig.collection) {\n                throw new Meteor.Error('invalid-collection', `Could not find a collection with the name: ${collectionName}`);\n            }\n        }\n\n        if (this.isVirtual()) {\n            return this._prepareVirtual();\n        } else {\n            if (!this.linkConfig.type) {\n                this.linkConfig.type = 'one';\n            }\n\n            if (!this.linkConfig.field) {\n                this.linkConfig.field = this._generateFieldName();\n            } else {\n                if (this.linkConfig.field == this.linkName) {\n                    throw new Meteor.Error('invalid-config', `For the link ${this.linkName} you must not use the same name for the field, otherwise it will cause conflicts when fetching data`);\n                }\n            }\n        }\n\n        check(this.linkConfig, LinkConfigSchema);\n    }\n\n    /**\n     * We need to apply same type of rules in this case.\n     * @private\n     */\n    _prepareVirtual() {\n        const {collection, inversedBy} = this.linkConfig;\n        let linker = collection.getLinker(inversedBy);\n\n        if (!linker) {\n            // it is possible that the collection doesn't have a linker created yet.\n            // so we will create it on startup after all links have been defined\n            Meteor.startup(() => {\n                linker = collection.getLinker(inversedBy);\n                if (!linker) {\n                    throw new Meteor.Error(`You tried setting up an inversed link in \"${this.mainCollection._name}\" pointing to collection: \"${collection._name}\" link: \"${inversedBy}\", but no such link was found. Maybe a typo ?`)\n                } else {\n                    this._setupVirtualConfig(linker);\n                }\n            })\n        } else {\n            this._setupVirtualConfig(linker);\n        }\n    }\n\n    /**\n     * @param linker\n     * @private\n     */\n    _setupVirtualConfig(linker) {\n        const virtualLinkConfig = linker.linkConfig;\n\n        if (!virtualLinkConfig) {\n            throw new Meteor.Error(`There is no link-config for the related collection on ${inversedBy}. Make sure you added the direct links before specifying virtual ones.`)\n        }\n\n        _.extend(this.linkConfig, {\n            metadata: virtualLinkConfig.metadata,\n            relatedLinker: linker\n        });\n    }\n\n    /**\n     * Depending on the strategy, we create the proper helper class\n     * @private\n     */\n    _getHelperClass() {\n        switch (this.strategy) {\n            case 'many-meta':\n                return LinkManyMeta;\n            case 'many':\n                return LinkMany;\n            case 'one-meta':\n                return LinkOneMeta;\n            case 'one':\n                return LinkOne;\n        }\n\n        throw new Meteor.Error('invalid-strategy', `${this.strategy} is not a valid strategy`);\n    }\n\n    /**\n     * If field name not present, we generate it.\n     * @private\n     */\n    _generateFieldName() {\n        let cleanedCollectionName = this.linkConfig.collection._name.replace(/\\./g, '_');\n        let defaultFieldPrefix = this.linkName + '_' + cleanedCollectionName;\n\n        switch (this.strategy) {\n            case 'many-meta':\n                return `${defaultFieldPrefix}_metas`;\n            case 'many':\n                return `${defaultFieldPrefix}_ids`;\n            case 'one-meta':\n                return `${defaultFieldPrefix}_meta`;\n            case 'one':\n                return `${defaultFieldPrefix}_id`;\n        }\n    }\n\n    /**\n     * When a link that is declared virtual is removed, the reference will be removed from every other link.\n     * @private\n     */\n    _handleReferenceRemovalForVirtualLinks() {\n        this.mainCollection.after.remove((userId, doc) => {\n            // this problem may occur when you do a .remove() before Meteor.startup()\n            if (!this.linkConfig.relatedLinker) {\n                console.warn(`There was an error finding the link for removal for collection: \"${this.mainCollection._name}\" with link: \"${this.linkName}\". This may occur when you do a .remove() before Meteor.startup()`);\n                return;\n            }\n\n            let accessor = this.createLink(doc);\n\n            _.each(accessor.fetch(), linkedObj => {\n                const {relatedLinker} = this.linkConfig;\n                // We do this check, to avoid self-referencing hell when defining virtual links\n                // Virtual links if not found \"compile-time\", we will try again to reprocess them on Meteor.startup\n                // if a removal happens before Meteor.startup this may fail\n                if (relatedLinker) {\n                    let link = relatedLinker.createLink(linkedObj);\n\n                    if (relatedLinker.isSingle()) {\n                        link.unset();\n                    } else {\n                        link.remove(doc);\n                    }\n                }\n            });\n        })\n    }\n\n    _initIndex() {\n        if (Meteor.isServer) {\n            let field = this.linkConfig.field;\n            if (this.linkConfig.metadata) {\n                field = field + '._id';\n            }\n\n            if (this.linkConfig.index) {\n                if (this.isVirtual()) {\n                    throw new Meteor.Error('You cannot set index on an inversed link.');\n                }\n\n                let options;\n                if (this.linkConfig.unique) {\n                    if (this.isMany()) {\n                        throw new Meteor.Error('You cannot set unique property on a multi field.');\n                    }\n\n                    options = {unique: true}\n                }\n\n                this.mainCollection._ensureIndex({[field]: 1}, options);\n            } else {\n                if (this.linkConfig.unique) {\n                    if (this.isVirtual()) {\n                        throw new Meteor.Error('You cannot set unique property on an inversed link.');\n                    }\n\n                    if (this.isMany()) {\n                        throw new Meteor.Error('You cannot set unique property on a multi field.');\n                    }\n\n                    this.mainCollection._ensureIndex({\n                        [field]: 1\n                    }, {unique: true})\n                }\n            }\n        }\n    }\n\n    _initAutoremove() {\n        if (!this.linkConfig.autoremove) {\n            return;\n        }\n\n        if (!this.isVirtual()) {\n            this.mainCollection.after.remove((userId, doc) => {\n                this.getLinkedCollection().remove({\n                    _id: {\n                        $in: smartArguments.getIds(doc[this.linkStorageField])\n                    }\n                })\n            })\n        } else {\n            this.mainCollection.after.remove((userId, doc) => {\n                const linker = this.mainCollection.getLink(doc, this.linkName);\n                const ids = linker.find({}, {fields: {_id: 1}}).fetch().map(item => item._id);\n\n                this.getLinkedCollection().remove({\n                    _id: {$in: ids}\n                })\n            })\n        }\n    }\n\n    /**\n     * Initializes denormalization using herteby:denormalize\n     * @private\n     */\n    _initDenormalization() {\n        if (!this.linkConfig.denormalize || !Meteor.isServer) {\n            return;\n        }\n\n        const packageExists = !!Package['herteby:denormalize'];\n        if (!packageExists) {\n            throw new Meteor.Error('missing-package', `Please add the herteby:denormalize package to your Meteor application in order to make caching work`)\n        }\n\n        const {field, body, bypassSchema} = this.linkConfig.denormalize;\n        let cacheConfig;\n\n        let referenceFieldSuffix = '';\n        if (this.isMeta()) {\n            referenceFieldSuffix = (this.isSingle() ? '._id' : ':_id');\n        }\n\n        if (this.isVirtual()) {\n            let inversedLink = this.linkConfig.relatedLinker.linkConfig;\n\n            let type = inversedLink.type == 'many' ? 'many-inverse' : 'inversed';\n\n            cacheConfig = {\n                type: type,\n                collection: this.linkConfig.collection,\n                fields: body,\n                referenceField: inversedLink.field + referenceFieldSuffix,\n                cacheField: field,\n                bypassSchema: !!bypassSchema\n            };\n        } else {\n            cacheConfig = {\n                type: this.linkConfig.type,\n                collection: this.linkConfig.collection,\n                fields: body,\n                referenceField: this.linkConfig.field + referenceFieldSuffix,\n                cacheField: field,\n                bypassSchema: !!bypassSchema\n            };\n        }\n\n        if (this.isVirtual()) {\n            Meteor.startup(() => {\n                this.mainCollection.cache(cacheConfig);\n            })\n        } else {\n            this.mainCollection.cache(cacheConfig);\n        }\n    }\n\n    /**\n     * Verifies if this linker is denormalized. It can be denormalized from the inverse side as well.\n     *\n     * @returns {boolean}\n     * @private\n     */\n    isDenormalized() {\n        return !!this.linkConfig.denormalize;\n    }\n\n    /**\n     * Verifies if the body of the linked element does not contain fields outside the cache body\n     *\n     * @param body\n     * @returns {boolean}\n     * @private\n     */\n    isSubBodyDenormalized(body) {\n        const cacheBody = this.linkConfig.denormalize.body;\n\n        const cacheBodyFields = _.keys(dot.dot(cacheBody));\n        const bodyFields = _.keys(\n            dot.dot(\n                _.omit(body, '_id')\n            )\n        );\n\n        return _.difference(bodyFields, cacheBodyFields).length === 0;\n    }\n}","import sift from 'sift';\n\nexport default function createSearchFilters(object, fieldStorage, strategy, isVirtual, metaFilters) {\n    if (!isVirtual) {\n        switch (strategy) {\n            case 'one': return createOne(object, fieldStorage);\n            case 'one-meta': return createOneMeta(object, fieldStorage, metaFilters);\n            case 'many': return createMany(object, fieldStorage);\n            case 'many-meta': return createManyMeta(object, fieldStorage, metaFilters);\n            default:\n                throw new Meteor.Error(`Invalid linking strategy: ${strategy}`)\n        }\n    } else {\n        switch (strategy) {\n            case 'one': return createOneVirtual(object, fieldStorage);\n            case 'one-meta': return createOneMetaVirtual(object, fieldStorage, metaFilters);\n            case 'many': return createManyVirtual(object, fieldStorage);\n            case 'many-meta': return createManyMetaVirtual(object, fieldStorage, metaFilters);\n            default:\n                throw new Meteor.Error(`Invalid linking strategy: ${strategy}`)\n        }\n    }\n}\n\nexport function createOne(object, fieldStorage) {\n    return {\n        _id: object[fieldStorage]\n    };\n}\n\nexport function createOneVirtual(object, fieldStorage) {\n    return {\n        [fieldStorage]: object._id\n    };\n}\n\nexport function createOneMeta(object, fieldStorage, metaFilters) {\n    const value = object[fieldStorage];\n\n    if (metaFilters) {\n        if (!sift(metaFilters)(value)) {\n            return {_id: undefined};\n        }\n    }\n\n    return {\n        _id: value ? value._id : value\n    };\n}\n\nexport function createOneMetaVirtual(object, fieldStorage, metaFilters) {\n    let filters = {};\n    if (metaFilters) {\n        _.each(metaFilters, (value, key) => {\n            filters[fieldStorage + '.' + key] = value;\n        })\n    }\n\n    filters[fieldStorage + '._id'] = object._id;\n\n    return filters;\n}\n\nexport function createMany(object, fieldStorage) {\n    return {\n        _id: {\n            $in: object[fieldStorage] || []\n        }\n    };\n}\n\nexport function createManyVirtual(object, fieldStorage) {\n    return {\n        [fieldStorage]: object._id\n    };\n}\n\nexport function createManyMeta(object, fieldStorage, metaFilters) {\n    let value = object[fieldStorage];\n\n    if (metaFilters) {\n        value = sift(metaFilters, value)\n    }\n\n    return {\n        _id: {\n            $in: _.pluck(value, '_id') || []\n        }\n    };\n}\n\nexport function createManyMetaVirtual(object, fieldStorage, metaFilters) {\n    let filters = {};\n    if (metaFilters) {\n        _.each(metaFilters, (value, key) => {\n            filters[key] = value;\n        })\n    }\n\n    filters._id = object._id;\n\n    return {\n        [fieldStorage]: {$elemMatch: filters}\n    };\n}","import SmartArgs from './lib/smartArguments.js';\nimport createSearchFilters from '../lib/createSearchFilters';\n\nexport default class Link {\n    get config() { return this.linker.linkConfig; }\n\n    get isVirtual() { return this.linker.isVirtual() }\n\n    constructor(linker, object, collection) {\n        this.linker = linker;\n        this.object = object;\n        this.linkedCollection = (collection) ? collection : linker.getLinkedCollection();\n\n        if (this.linker.isVirtual()) {\n            this.linkStorageField = this.config.relatedLinker.linkConfig.field;\n        } else {\n            this.linkStorageField = this.config.field;\n        }\n    }\n\n    /**\n     * Gets the stored link information value\n     * @returns {*}\n     */\n    value() {\n        if (this.isVirtual) {\n            throw new Meteor.Error('You can only take the value from the main link.');\n        }\n\n        return this.object[this.linkStorageField];\n    }\n\n    /**\n     * Finds linked data.\n     *\n     * @param filters\n     * @param options\n     * @returns {*}\n     * @param userId\n     */\n    find(filters = {}, options = {}, userId = undefined) {\n        let linker = this.linker;\n        const linkedCollection = this.linkedCollection;\n\n        let $metaFilters;\n        if (filters.$meta) {\n            $metaFilters = filters.$meta;\n            delete filters.$meta;\n        }\n\n        const searchFilters = createSearchFilters(\n            this.object,\n            this.linkStorageField,\n            linker.strategy,\n            linker.isVirtual(),\n            $metaFilters\n        );\n\n        let appliedFilters = _.extend({}, filters, searchFilters);\n\n        // see https://github.com/cult-of-coders/grapher/issues/134\n        // happens due to recursive importing of modules\n        // TODO: find another way to do this\n        if (linkedCollection.find) {\n            return linkedCollection.find(appliedFilters, options, userId)\n        } else {\n            return linkedCollection.default.find(appliedFilters, options, userId);\n        }\n    }\n\n    /**\n     * @param filters\n     * @param options\n     * @param others\n     * @returns {*|{content}|any}\n     */\n    fetch(filters, options, ...others) {\n        let result = this.find(filters, options, ...others).fetch();\n\n        if (this.linker.isOneResult()) {\n            return _.first(result);\n        }\n\n        return result;\n    }\n\n    /**\n     * When we are dealing with multiple type relationships, $in would require an array. If the field value is null, it will fail\n     * We use clean to make it an empty array by default.\n     */\n    clean() {}\n\n    /**\n     * Extracts a single id\n     */\n    identifyId(what, saveToDatabase) {\n        return SmartArgs.getId(what, {\n            saveToDatabase,\n            collection: this.linkedCollection\n        });\n    }\n\n    /**\n     * Extracts the ids of object(s) or strings and returns an array.\n     */\n    identifyIds(what, saveToDatabase) {\n        return SmartArgs.getIds(what, {\n            saveToDatabase,\n            collection: this.linkedCollection\n        });\n    }\n\n    /**\n     * Checks when linking data, if the ids are valid with the linked collection.\n     * @throws Meteor.Error\n     * @param ids\n     *\n     * @protected\n     */\n    _validateIds(ids) {\n        if (!_.isArray(ids)) {\n            ids = [ids];\n        }\n\n        const validIds = this.linkedCollection.find({\n            _id: {$in: ids}\n        }, {fields: {_id: 1}}).fetch().map(doc => doc._id);\n\n        if (validIds.length != ids.length) {\n            throw new Meteor.Error('not-found', `You tried to create links with non-existing id(s) inside \"${this.linkedCollection._name}\": ${_.difference(ids, validIds).join(', ')}`)\n        }\n    }\n\n    /**\n     * This is for allowing commands such as set/unset/add/remove/metadata from the virtual link.\n     *\n     * @param action\n     * @param what\n     * @param metadata\n     *\n     * @protected\n     */\n    _virtualAction(action, what, metadata) {\n        const linker = this.linker.linkConfig.relatedLinker;\n\n        // its an unset operation most likely.\n        if (what === undefined) {\n            const reversedLink = linker.createLink(this.fetch());\n            reversedLink.unset();\n\n            return;\n        }\n\n        if (!_.isArray(what)) {\n            what = [what];\n        }\n\n        what = _.map(what, element => {\n            if (!_.isObject(element)) {\n                return linker.mainCollection.findOne(element);\n            } else {\n                if (!element._id) {\n                    const elementId = linker.mainCollection.insert(element);\n                    _.extend(element, linker.mainCollection.findOne(elementId));\n                }\n\n                return element;\n            }\n        });\n\n        return _.map(what, element => {\n            const reversedLink = linker.createLink(element);\n\n            if (action == 'metadata') {\n                if (linker.isSingle()) {\n                    return reversedLink.metadata(metadata);\n                } else {\n                    return reversedLink.metadata(this.object, metadata);\n                }\n            } else if (action == 'add' || action == 'set') {\n                if (linker.isSingle()) {\n                    reversedLink.set(this.object, metadata);\n                } else {\n                    reversedLink.add(this.object, metadata);\n                }\n            } else {\n                if (linker.isSingle()) {\n                    reversedLink.unset();\n                } else {\n                    reversedLink.remove(this.object);\n                }\n            }\n        });\n    }\n}\n","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkMany extends Link {\n    clean() {\n        if (!this.object[this.linkStorageField]) {\n            this.object[this.linkStorageField] = [];\n        }\n    }\n\n    /**\n     * Ads the _ids to the object.\n     * @param what\n     */\n    add(what) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what);\n            return this;\n        }\n\n        //if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/remove operations must be done from the owning-link of the relationship');\n\n        this.clean();\n\n        const _ids = this.identifyIds(what, true);\n        this._validateIds(_ids);\n\n        const field = this.linkStorageField;\n\n        // update the field\n        this.object[field] = _.union(this.object[field], _ids);\n\n        // update the db\n        let modifier = {\n            $addToSet: {\n                [field]: {$each: _ids}\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    /**\n     * @param what\n     */\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        if (this.isVirtual) throw new Meteor.Error('not-allowed', 'Add/Remove operations should be done from the owner of the relationship');\n\n        this.clean();\n        const field = this.linkStorageField;\n\n        const _ids = this.identifyIds(what);\n\n        // update the field\n        this.object[field] = _.filter(this.object[field], _id => !_.contains(_ids, _id));\n\n        // update the db\n        let modifier = {\n            $pullAll: {\n                [field]: _ids\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    set(what) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    unset(what) {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkManyMeta extends Link {\n    clean() {\n        if (!this.object[this.linkStorageField]) {\n            this.object[this.linkStorageField] = [];\n        }\n    }\n\n    /**\n     * @param what\n     * @param metadata\n     */\n    add(what, metadata = {}) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what, metadata);\n            return this;\n        }\n\n        const _ids = this.identifyIds(what, true);\n        this._validateIds(_ids);\n\n        let field = this.linkStorageField;\n\n        this.object[field] = this.object[field] || [];\n        let metadatas = [];\n\n        _.each(_ids, _id => {\n            let localMetadata = _.clone(metadata);\n            localMetadata._id = _id;\n\n            this.object[field].push(localMetadata);\n            metadatas.push(localMetadata);\n        });\n\n        let modifier = {\n            $addToSet: {\n                [field]: {$each: metadatas}\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    /**\n     * @param what\n     * @param extendMetadata\n     */\n    metadata(what, extendMetadata) {\n        if (this.isVirtual) {\n            this._virtualAction('metadata', what, extendMetadata);\n\n            return this;\n        }\n\n        let field = this.linkStorageField;\n\n        if (what === undefined) {\n            return this.object[field];\n        }\n\n        if (_.isArray(what)) {\n            throw new Meteor.Error('not-allowed', 'Metadata updates should be made for one entity only, not multiple');\n        }\n\n        const _id = this.identifyId(what);\n\n        let existingMetadata = _.find(this.object[field], metadata => metadata._id == _id);\n        if (extendMetadata === undefined) {\n            return existingMetadata;\n        } else {\n            _.extend(existingMetadata, extendMetadata);\n            let subfield = field + '._id';\n            let subfieldUpdate = field + '.$';\n\n            this.linker.mainCollection.update({\n                _id: this.object._id,\n                [subfield]: _id\n            }, {\n               $set: {\n                   [subfieldUpdate]: existingMetadata\n               }\n            });\n        }\n\n        return this;\n    }\n\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        const _ids = this.identifyIds(what);\n        let field = this.linkStorageField;\n\n        this.object[field] = _.filter(this.object[field], link => !_.contains(_ids, link._id));\n\n        let modifier = {\n            $pull: {\n                [field]: {\n                    $elemMatch: {\n                        _id: {\n                            $in: _ids\n                        }\n                    }\n                }\n            }\n        };\n\n        this.linker.mainCollection.update(this.object._id, modifier);\n\n        return this;\n    }\n\n    set(what, metadata) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what, metadata);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *set* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n\n    unset(what) {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *unset* in a relationship that is single. Please use add/remove for *many* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkOne extends Link {\n    set(what) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        const _id = this.identifyId(what, true);\n        this._validateIds([_id]);\n\n        this.object[field] = _id;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: _id\n            }\n        });\n\n        return this;\n    }\n\n    unset() {\n        if (this.isVirtual) {\n            this._virtualAction('unset', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        this.object[field] = null;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: null\n            }\n        });\n\n        return this;\n    }\n\n    add(what) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n}","import Link from './base.js';\nimport SmartArgs from './lib/smartArguments.js';\n\nexport default class LinkOneMeta extends Link {\n    set(what, metadata = {}) {\n        if (this.isVirtual) {\n            this._virtualAction('set', what);\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        metadata._id = this.identifyId(what, true);\n        this._validateIds([metadata._id]);\n\n        this.object[field] = metadata;\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: metadata\n            }\n        });\n\n        return this;\n    }\n\n    metadata(extendMetadata) {\n        if (this.isVirtual) {\n            this._virtualAction('metadata', undefined, extendMetadata);\n\n            return this;\n        }\n\n        let field = this.linkStorageField;\n\n        if (!extendMetadata) {\n            return this.object[field];\n        } else {\n            _.extend(this.object[field], extendMetadata);\n\n            this.linker.mainCollection.update(this.object._id, {\n                $set: {\n                    [field]: this.object[field]\n                }\n            });\n        }\n\n        return this;\n    }\n\n    unset() {\n        if (this.isVirtual) {\n            this._virtualAction('unset');\n            return this;\n        }\n\n        let field = this.linkStorageField;\n        this.object[field] = {};\n\n        this.linker.mainCollection.update(this.object._id, {\n            $set: {\n                [field]: {}\n            }\n        });\n\n        return this;\n    }\n\n    add(what, metadata) {\n        if (this.isVirtual) {\n            this._virtualAction('add', what, metadata);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *add* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n\n    remove(what) {\n        if (this.isVirtual) {\n            this._virtualAction('remove', what);\n            return this;\n        }\n\n        throw new Meteor.Error('invalid-command', 'You are trying to *remove* in a relationship that is single. Please use set/unset for *single* relationships');\n    }\n}","/**\n * When you work with add/remove set/unset\n * You have the ability to pass strings, array of strings, objects, array of objects\n * If you are adding something and you want to save them in db, you can pass objects without ids.\n */\nexport default new class {\n    getIds(what, options) {\n        if (_.isArray(what)) {\n            return _.map(what, (subWhat) => {\n                return this.getId(subWhat, options)\n            })\n        } else {\n            return [this.getId(what, options)];\n        }\n\n        throw new Meteor.Error('invalid-type', `Unrecognized type: ${typeof what} for managing links`);\n    }\n\n    getId(what, options) {\n        if (typeof what === 'string') {\n            return what;\n        }\n\n        if (typeof what === 'object') {\n            if (!what._id && options.saveToDatabase) {\n                what._id = options.collection.insert(what);\n            }\n\n            return what._id\n        }\n    }\n}","import deepClone from 'lodash.clonedeep';\n\nexport default class NamedQueryBase {\n    isNamedQuery = true;\n\n    constructor(name, collection, body, options = {}) {\n        this.queryName = name;\n\n        if (_.isFunction(body)) {\n            this.resolver = body;\n        } else {\n            this.body = deepClone(body);\n        }\n\n        this.subscriptionHandle = null;\n        this.params = options.params || {};\n        this.options = options;\n        this.collection = collection;\n        this.isExposed = false;\n    }\n\n    get name() {\n        return `named_query_${this.queryName}`;\n    }\n\n    get isResolver() {\n        return !!this.resolver;\n    }\n\n    setParams(params) {\n        this.params = _.extend({}, this.params, params);\n\n        return this;\n    }\n\n    /**\n     * Validates the parameters\n     */\n    doValidateParams(params) {\n        params = params || this.params;\n\n        const {validateParams} = this.options;\n        if (!validateParams) return;\n\n        try {\n            this._validate(validateParams, params);\n        } catch (validationError) {\n            console.error(`Invalid parameters supplied to the query \"${this.queryName}\"\\n`, validationError);\n            throw validationError; // rethrow\n        }\n    }\n\n    clone(newParams) {\n        const params = _.extend({}, deepClone(this.params), newParams);\n\n        let clone = new this.constructor(\n            this.queryName,\n            this.collection,\n            this.isResolver ? this.resolver : deepClone(this.body),\n            {\n                ...this.options,\n                params,\n            }\n        );\n\n        clone.cacher = this.cacher;\n        if (this.exposeConfig) {\n            clone.exposeConfig = this.exposeConfig;\n        }\n\n        return clone;\n    }\n\n    /**\n     * @param {function|object} validator\n     * @param {object} params\n     * @private\n     */\n    _validate(validator, params) {\n        if (_.isFunction(validator)) {\n            validator.call(null, params)\n        } else {\n            check(params, validator)\n        }\n    }\n}","import CountSubscription from '../query/counts/countSubscription';\nimport createGraph from '../query/lib/createGraph.js';\nimport recursiveFetch from '../query/lib/recursiveFetch.js';\nimport prepareForProcess from '../query/lib/prepareForProcess.js';\nimport { _ } from 'meteor/underscore';\nimport callWithPromise from '../query/lib/callWithPromise';\nimport Base from './namedQuery.base';\n\nexport default class extends Base {\n    /**\n     * Subscribe\n     *\n     * @param callback\n     * @returns {null|any|*}\n     */\n    subscribe(callback) {\n        if (this.isResolver) {\n            throw new Meteor.Error('not-allowed', `You cannot subscribe to a resolver query`);\n        }\n\n        this.subscriptionHandle = Meteor.subscribe(\n            this.name,\n            this.params,\n            callback\n        );\n\n        return this.subscriptionHandle;\n    }\n\n    /**\n     * Subscribe to the counts for this query\n     *\n     * @param callback\n     * @returns {Object}\n     */\n    subscribeCount(callback) {\n        if (this.isResolver) {\n            throw new Meteor.Error('not-allowed', `You cannot subscribe to a resolver query`);\n        }\n\n        if (!this._counter) {\n            this._counter = new CountSubscription(this);\n        }\n\n        return this._counter.subscribe(this.params, callback);\n    }\n\n    /**\n     * Unsubscribe if an existing subscription exists\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.subscriptionHandle.stop();\n        }\n\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Unsubscribe to the counts if a subscription exists.\n     */\n    unsubscribeCount() {\n        if (this._counter) {\n            this._counter.unsubscribe();\n            this._counter = null;\n        }\n    }\n\n    /**\n     * Fetches elements in sync using promises\n     * @return {*}\n     */\n    async fetchSync() {\n        if (this.subscriptionHandle) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name, this.params);\n    }\n\n    /**\n     * Fetches one element in sync\n     * @return {*}\n     */\n    async fetchOneSync() {\n        return _.first(await this.fetchSync())\n    }\n\n    /**\n     * Retrieves the data.\n     * @param callbackOrOptions\n     * @returns {*}\n     */\n    fetch(callbackOrOptions) {\n        if (!this.subscriptionHandle) {\n            return this._fetchStatic(callbackOrOptions)\n        } else {\n            return this._fetchReactive(callbackOrOptions);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        if (!this.subscriptionHandle) {\n            const callback = args[0];\n            if (!_.isFunction(callback)) {\n                throw new Meteor.Error('You did not provide a valid callback');\n            }\n\n            this.fetch((err, res) => {\n                callback(err, res ? _.first(res) : null);\n            })\n        } else {\n            return _.first(this.fetch(...args));\n        }\n    }\n\n    /**\n     * Gets the count of matching elements in sync.\n     * @returns {any}\n     */\n    async getCountSync() {\n        if (this._counter) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name + '.count', this.params);\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @param callback\n     * @returns {any}\n     */\n    getCount(callback) {\n        if (this._counter) {\n            return this._counter.getCount();\n        } else {\n            if (!callback) {\n                throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n            } else {\n                return Meteor.call(this.name + '.count', this.params, callback);\n            }\n        }\n    }\n\n    /**\n     * Fetching non-reactive queries\n     * @param callback\n     * @private\n     */\n    _fetchStatic(callback) {\n        if (!callback) {\n            throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n        }\n\n        Meteor.call(this.name, this.params, callback);\n    }\n\n    /**\n     * Fetching when we've got an active publication\n     *\n     * @param options\n     * @returns {*}\n     * @private\n     */\n    _fetchReactive(options = {}) {\n        let body = this.body;\n        if (this.params.$body) {\n            body = intersectDeep(body, this.params.$body);\n        }\n\n        body = prepareForProcess(body, this.params);\n        if (!options.allowSkip && body.$options && body.$options.skip) {\n            delete body.$options.skip;\n        }\n\n        return recursiveFetch(\n            createGraph(this.collection, body)\n        );\n    }\n}\n","import NamedQueryClient from './namedQuery.client';\nimport NamedQueryServer from './namedQuery.server';\n\nlet NamedQuery;\n\nif (Meteor.isServer) {\n    NamedQuery = NamedQueryServer;\n} else {\n    NamedQuery = NamedQueryClient;\n}\n\nexport default NamedQuery;","import prepareForProcess from '../query/lib/prepareForProcess.js';\nimport Base from './namedQuery.base';\nimport deepClone from 'lodash.clonedeep';\nimport MemoryResultCacher from './cache/MemoryResultCacher';\nimport intersectDeep from '../query/lib/intersectDeep';\n\nexport default class extends Base {\n    /**\n     * Retrieves the data.\n     * @returns {*}\n     */\n    fetch(context) {\n        this._performSecurityChecks(context, this.params);\n\n        if (this.isResolver) {\n            return this._fetchResolverData(context);\n        } else {\n            body = deepClone(this.body);\n            if (this.params.$body) {\n                body = intersectDeep(body, this.params.$body);\n            }\n            \n            // we must apply emobdyment here\n            this.doEmbodimentIfItApplies(body);\n\n            const query = this.collection.createQuery(\n                deepClone(body),\n                {\n                    params: deepClone(this.params)\n                }\n            );\n\n            if (this.cacher) {\n                const cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n                return this.cacher.fetch(cacheId, {query});\n            }\n\n            return query.fetch();\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        return _.first(this.fetch(...args));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     *\n     * @returns {any}\n     */\n    getCount(context) {\n        this._performSecurityChecks(context, this.params);\n\n        const countCursor = this.getCursorForCounting();\n\n        if (this.cacher) {\n            const cacheId = 'count::' + this.cacher.generateQueryId(this.queryName, this.params);\n\n            return this.cacher.fetch(cacheId, {countCursor});\n        }\n\n        return countCursor.count();\n    }\n\n    /**\n     * Returns the cursor for counting\n     * This is most likely used for counts cursor\n     */\n    getCursorForCounting() {\n        let body = deepClone(this.body);\n        this.doEmbodimentIfItApplies(body);\n        body = prepareForProcess(body, this.params);\n\n        return this.collection.find(body.$filters || {}, {fields: {_id: 1}});\n    }\n\n    /**\n     * @param cacher\n     */\n    cacheResults(cacher) {\n        if (!cacher) {\n            cacher = new MemoryResultCacher();\n        }\n\n        this.cacher = cacher;\n    }\n\n    /**\n     * Configure resolve. This doesn't actually call the resolver, it just sets it\n     * @param fn\n     */\n    resolve(fn) {\n        if (!this.isResolver) {\n            throw new Meteor.Error('invalid-call', `You cannot use resolve() on a non resolver NamedQuery`);\n        }\n\n        this.resolver = fn;\n    }\n\n    /**\n     * @returns {*}\n     * @private\n     */\n    _fetchResolverData(context) {\n        const resolver = this.resolver;\n        const self = this;\n        const query = {\n            fetch() {\n                return resolver.call(context, self.params);\n            }\n        };\n\n        if (this.cacher) {\n            const cacheId = this.cacher.generateQueryId(this.queryName, this.params);\n            return this.cacher.fetch(cacheId, {query});\n        }\n\n        return query.fetch();\n    }\n\n    /**\n     * @param context Meteor method/publish context\n     * @param params\n     *\n     * @private\n     */\n    _performSecurityChecks(context, params) {\n        if (context && this.exposeConfig) {\n            this._callFirewall(context, context.userId, params);\n        }\n\n        this.doValidateParams(params);\n    }\n}","export default new class {\n    constructor() {\n        this.storage = {};\n    }\n\n    add(key, value) {\n        if (this.storage[key]) {\n            throw new Meteor.Error('invalid-name', `You have previously defined another namedQuery with the same name: \"${key}\". Named Query names should be unique.`);\n        }\n\n        this.storage[key] = value;\n    }\n\n    get(key) {\n        return this.storage[key];\n    }\n\n    getAll() {\n        return this.storage;\n    }\n}","import {EJSON} from 'meteor/ejson';\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class BaseResultCacher {\n    constructor(config = {}) {\n        this.config = config;\n    }\n\n    /**\n     * @param queryName\n     * @param params\n     * @returns {string}\n     */\n    generateQueryId(queryName, params) {\n        return `${queryName}::${EJSON.stringify(params)}`;\n    }\n\n    /**\n     * Dummy function\n     */\n    fetch(cacheId, {query, countCursor}) {\n        throw 'Not implemented';\n    }\n\n    /**\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    static fetchData({query, countCursor}) {\n        if (query) {\n            return query.fetch();\n        } else {\n            return countCursor.count();\n        }\n    }\n}\n","import {Meteor} from 'meteor/meteor';\nimport cloneDeep from 'lodash.clonedeep';\nimport BaseResultCacher from './BaseResultCacher';\n\nconst DEFAULT_TTL = 60000;\n\n/**\n * This is a very basic in-memory result caching functionality\n */\nexport default class MemoryResultCacher extends BaseResultCacher {\n    constructor(config = {}) {\n        super(config);\n        this.store = {};\n    }\n\n    /**\n     * @param cacheId\n     * @param query\n     * @param countCursor\n     * @returns {*}\n     */\n    fetch(cacheId, {query, countCursor}) {\n        const cacheData = this.store[cacheId];\n        if (cacheData !== undefined) {\n            return cloneDeep(cacheData);\n        }\n\n        const data = BaseResultCacher.fetchData({query, countCursor});\n        this.storeData(cacheId, data);\n\n        return data;\n    }\n\n\n    /**\n     * @param cacheId\n     * @param data\n     */\n    storeData(cacheId, data) {\n        const ttl = this.config.ttl || DEFAULT_TTL;\n        this.store[cacheId] = cloneDeep(data);\n\n        Meteor.setTimeout(() => {\n            delete this.store[cacheId];\n        }, ttl)\n    }\n}\n","import deepClone from 'lodash.clonedeep';\nimport {check} from 'meteor/check';\n\nexport default class QueryBase {\n    isGlobalQuery = true;\n\n    constructor(collection, body, options = {}) {\n        this.collection = collection;\n\n        this.body = deepClone(body);\n\n        this.params = options.params || {};\n        this.options = options;\n    }\n\n    clone(newParams) {\n        const params = _.extend({}, deepClone(this.params), newParams);\n\n        return new this.constructor(\n            this.collection,\n            deepClone(this.body),\n            {\n                params,\n                ...this.options\n            }\n        );\n    }\n\n    get name() {\n        return `exposure_${this.collection._name}`;\n    }\n\n    /**\n     * Validates the parameters\n     */\n    doValidateParams() {\n        const {validateParams} = this.options;\n        if (!validateParams) return;\n\n        if (_.isFunction(validateParams)) {\n            validateParams.call(null, this.params)\n        } else {\n            check(this.params)\n        }\n    }\n\n    /**\n     * Merges the params with previous params.\n     *\n     * @param params\n     * @returns {Query}\n     */\n    setParams(params) {\n        this.params = _.extend({}, this.params, params);\n\n        return this;\n    }\n}","import { _ } from 'meteor/underscore';\nimport CountSubscription from './counts/countSubscription';\nimport createGraph from './lib/createGraph.js';\nimport recursiveFetch from './lib/recursiveFetch.js';\nimport prepareForProcess from './lib/prepareForProcess.js';\nimport callWithPromise from './lib/callWithPromise';\nimport Base from './query.base';\n\nexport default class Query extends Base {\n    /**\n     * Subscribe\n     *\n     * @param callback {Function} optional\n     * @returns {null|any|*}\n     */\n    subscribe(callback) {\n        this.doValidateParams();\n\n        this.subscriptionHandle = Meteor.subscribe(\n            this.name,\n            prepareForProcess(this.body, this.params),\n            callback\n        );\n\n        return this.subscriptionHandle;\n    }\n\n    /**\n     * Subscribe to the counts for this query\n     *\n     * @param callback\n     * @returns {Object}\n     */\n    subscribeCount(callback) {\n        this.doValidateParams();\n\n        if (!this._counter) {\n            this._counter = new CountSubscription(this);\n        }\n\n        return this._counter.subscribe(\n            prepareForProcess(this.body, this.params),\n            callback\n        );\n    }\n\n    /**\n     * Unsubscribe if an existing subscription exists\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.subscriptionHandle.stop();\n        }\n\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Unsubscribe to the counts if a subscription exists.\n     */\n    unsubscribeCount() {\n        if (this._counter) {\n            this._counter.unsubscribe();\n            this._counter = null;\n        }\n    }\n\n    /**\n     * Fetches elements in sync using promises\n     * @return {*}\n     */\n    async fetchSync() {\n        this.doValidateParams();\n\n        if (this.subscriptionHandle) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name, prepareForProcess(this.body, this.params));\n    }\n\n    /**\n     * Fetches one element in sync\n     * @return {*}\n     */\n    async fetchOneSync() {\n        return _.first(await this.fetchSync())\n    }\n\n    /**\n     * Retrieves the data.\n     * @param callbackOrOptions\n     * @returns {*}\n     */\n    fetch(callbackOrOptions) {\n        this.doValidateParams();\n\n        if (!this.subscriptionHandle) {\n            return this._fetchStatic(callbackOrOptions)\n        } else {\n            return this._fetchReactive(callbackOrOptions);\n        }\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        if (!this.subscriptionHandle) {\n            const callback = args[0];\n            if (!_.isFunction(callback)) {\n                throw new Meteor.Error('You did not provide a valid callback');\n            }\n\n            this.fetch((err, res) => {\n                callback(err, res ? _.first(res) : null);\n            })\n        } else {\n            return _.first(this.fetch(...args));\n        }\n    }\n\n    /**\n     * Gets the count of matching elements in sync.\n     * @returns {any}\n     */\n    async getCountSync() {\n        if (this._counter) {\n            throw new Meteor.Error('This query is reactive, meaning you cannot use promises to fetch the data.');\n        }\n\n        return await callWithPromise(this.name + '.count', prepareForProcess(this.body, this.params));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @param callback\n     * @returns {any}\n     */\n    getCount(callback) {\n        if (this._counter) {\n            return this._counter.getCount();\n        } else {\n            if (!callback) {\n                throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the count or subscribe first.');\n            } else {\n                return Meteor.call(\n                    this.name + '.count',\n                    prepareForProcess(this.body, this.params),\n                    callback\n                );\n            }\n        }\n    }\n\n    /**\n     * Fetching non-reactive queries\n     * @param callback\n     * @private\n     */\n    _fetchStatic(callback) {\n        if (!callback) {\n            throw new Meteor.Error('not-allowed', 'You are on client so you must either provide a callback to get the data or subscribe first.');\n        }\n\n        Meteor.call(this.name, prepareForProcess(this.body, this.params), callback);\n    }\n\n    /**\n     * Fetching when we've got an active publication\n     *\n     * @param options\n     * @returns {*}\n     * @private\n     */\n    _fetchReactive(options = {}) {\n        let body = prepareForProcess(this.body, this.params);\n        if (!options.allowSkip && body.$options && body.$options.skip) {\n            delete body.$options.skip;\n        }\n\n        return recursiveFetch(\n            createGraph(this.collection, body),\n            this.params\n        );\n    }\n}\n","import QueryClient from './query.client';\nimport QueryServer from './query.server';\n\nlet Query;\n\nif (Meteor.isServer) {\n    Query = QueryServer;\n} else {\n    Query = QueryClient;\n}\n\nexport default Query;","import createGraph from './lib/createGraph.js';\nimport prepareForProcess from './lib/prepareForProcess.js';\nimport hypernova from './hypernova/hypernova.js';\nimport Base from './query.base';\n\nexport default class Query extends Base {\n    /**\n     * Retrieves the data.\n     * @param context\n     * @returns {*}\n     */\n    fetch(context = {}) {\n        const node = createGraph(\n            this.collection,\n            prepareForProcess(this.body, this.params)\n        );\n\n        return hypernova(node, context.userId, {params: this.params});\n    }\n\n    /**\n     * @param args\n     * @returns {*}\n     */\n    fetchOne(...args) {\n        return _.first(this.fetch(...args));\n    }\n\n    /**\n     * Gets the count of matching elements.\n     * @returns {integer}\n     */\n    getCount() {\n        return this.collection.find(this.body.$filters || {}, {}).count();\n    }\n}","import { Mongo } from 'meteor/mongo';\nimport { COUNTS_COLLECTION_CLIENT } from './constants';\n\n/**\n * Internal collection used to store counts on the client.\n */\nexport default new Mongo.Collection(COUNTS_COLLECTION_CLIENT);\n","export const COUNTS_COLLECTION_CLIENT = 'grapher_counts';\n","import { EJSON } from 'meteor/ejson';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport Counts from './collection';\nimport createFauxSubscription from './createFauxSubscription';\nimport prepareForProcess from '../lib/prepareForProcess.js';\nimport NamedQueryBase from '../../namedQuery/namedQuery.base';\n\nexport default class CountSubscription {\n    /**\n     * @param {*} query - The query to use when fetching counts\n     */\n    constructor(query) {\n        this.accessToken = new ReactiveVar(null);\n        this.fauxHandle = null;\n        this.query = query;\n    }\n\n    /**\n     * Starts a subscription request for reactive counts.\n     *\n     * @param {*} arg - The argument to pass to {name}.count.subscribe\n     * @param {*} callback\n     */\n    subscribe(arg, callback) {\n        // Don't try to resubscribe if arg hasn't changed\n        if (EJSON.equals(this.lastArgs, arg) && this.fauxHandle) {\n            return this.fauxHandle;\n        }\n\n        this.accessToken.set(null);\n        this.lastArgs = arg;\n\n        Meteor.call(this.query.name + '.count.subscribe', arg, (error, token) => {\n            if (!this._markedForUnsubscribe) {\n                this.subscriptionHandle = Meteor.subscribe(this.query.name + '.count', token, callback);\n                this.accessToken.set(token);\n\n                this.disconnectComputation = Tracker.autorun(() => this.handleDisconnect());\n            }\n\n            this._markedForUnsubscribe = false;\n        });\n\n        this.fauxHandle = createFauxSubscription(this);\n        return this.fauxHandle;\n    }\n\n    /**\n     * Unsubscribes from the count endpoint, if there is such a subscription.\n     */\n    unsubscribe() {\n        if (this.subscriptionHandle) {\n            this.disconnectComputation.stop();\n            this.subscriptionHandle.stop();\n        } else {\n            // If we hit this branch, then Meteor.call in subscribe hasn't finished yet\n            // so set a flag to stop the subscription from being created\n            this._markedForUnsubscribe = true;\n        }\n\n        this.accessToken.set(null);\n        this.fauxHandle = null;\n        this.subscriptionHandle = null;\n    }\n\n    /**\n     * Reactively fetch current document count. Returns null if the subscription is not ready yet.\n     *\n     * @returns {Number|null} - Current document count\n     */\n    getCount() {\n        const id = this.accessToken.get();\n        if (id === null) return null;\n\n        const doc = Counts.findOne(id);\n        return doc.count;\n    }\n\n    /**\n     * All session info gets deleted when the server goes down, so when the client attempts to\n     * optimistically resume the '.count' publication, the server will throw a 'no-request' error.\n     *\n     * This function prevents that by manually stopping and restarting the subscription when the\n     * connection to the server is lost.\n     */\n    handleDisconnect() {\n        const status = Meteor.status();\n        if (!status.connected) {\n            this._markedForResume = true;\n            this.fauxHandle = null;\n            this.subscriptionHandle.stop();\n        }\n\n        if (status.connected && this._markedForResume) {\n            this._markedForResume = false;\n            this.subscribe(this.lastArgs);\n        }\n    }\n\n    /**\n     * Returns whether or not a subscription request has been made.\n     */\n    isSubscribed() {\n        return this.accessToken.get() !== null;\n    }\n}\n","/**\n * This method creates a \"fake\" subscription handle so that users of CountSubscription#subscribe\n * have an interface consistent with normal subscriptions.\n *\n * @param {CountSubscription} countManager\n */\nexport default (countManager) => ({\n    ready: () => countManager.accessToken.get() !== null && countManager.subscriptionHandle.ready(),\n    stop: () => countManager.unsubscribe(),\n});\n","import sift from 'sift';\n\n/**\n * Its purpose is to create filters to get the related data in one request.\n */\nexport default class AggregateFilters {\n    constructor(collectionNode, metaFilters) {\n        this.collectionNode = collectionNode;\n        this.linker = collectionNode.linker;\n        this.metaFilters = metaFilters;\n        this.isVirtual = this.linker.isVirtual();\n\n        this.linkStorageField = this.linker.linkStorageField;\n    }\n\n    get parentObjects() {\n        return this.collectionNode.parent.results;\n    }\n\n    create() {\n        switch (this.linker.strategy) {\n            case 'one':\n                return this.createOne();\n            case 'one-meta':\n                return this.createOneMeta();\n            case 'many':\n                return this.createMany();\n            case 'many-meta':\n                return this.createManyMeta();\n            default:\n                throw new Meteor.Error(`Invalid linker type: ${this.linker.type}`);\n        }\n    }\n\n    createOne() {\n        if (!this.isVirtual) {\n            return {\n                _id: {\n                    $in: _.uniq(\n                        _.pluck(this.parentObjects, this.linkStorageField)\n                    )\n                }\n            };\n        } else {\n            return {\n                [this.linkStorageField]: {\n                    $in: _.uniq(\n                        _.pluck(this.parentObjects, '_id')\n                    )\n                }\n            };\n        }\n    }\n\n    createOneMeta() {\n        if (!this.isVirtual) {\n            let eligibleObjects = this.parentObjects;\n\n            if (this.metaFilters) {\n                eligibleObjects = _.filter(this.parentObjects, object => {\n                    return sift(this.metaFilters)(object[this.linkStorageField]);\n                });\n            }\n\n            const storages = _.pluck(eligibleObjects, this.linkStorageField);\n            let ids = [];\n            _.each(storages, storage => {\n                if (storage) {\n                    ids.push(storage._id);\n                }\n            });\n\n            return {\n                _id: {$in: _.uniq(ids)}\n            };\n        } else {\n            let filters = {};\n            if (this.metaFilters) {\n                _.each(this.metaFilters, (value, key) => {\n                    filters[this.linkStorageField + '.' + key] = value;\n                })\n            }\n\n            filters[this.linkStorageField + '._id'] = {\n                $in: _.uniq(\n                    _.pluck(this.parentObjects, '_id')\n                )\n            };\n\n            return filters;\n        }\n    }\n\n    createMany() {\n        if (!this.isVirtual) {\n            const arrayOfIds = _.pluck(this.parentObjects, this.linkStorageField);\n            return {\n                _id: {\n                    $in: _.uniq(\n                        _.union(...arrayOfIds)\n                    )\n                }\n            };\n        } else {\n            const arrayOfIds = _.pluck(this.parentObjects, '_id');\n            return {\n                [this.linkStorageField]: {\n                    $in: _.uniq(\n                        _.union(...arrayOfIds)\n                    )\n                }\n            };\n        }\n    }\n\n    createManyMeta() {\n        if (!this.isVirtual) {\n            let ids = [];\n\n            _.each(this.parentObjects, object => {\n                if (object[this.linkStorageField]) {\n                    if (this.metaFilters) {\n                        const isValid = sift(this.metaFilters);\n                        _.each(object[this.linkStorageField], object => {\n                            if (isValid(object)) {\n                                ids.push(object._id);\n                            }\n                        });\n                    } else {\n                        _.each(object[this.linkStorageField], object => {\n                            ids.push(object._id);\n                        });\n                    }\n                }\n            });\n\n            return {\n                _id: {$in: _.uniq(ids)}\n            };\n        } else {\n            let filters = {};\n            if (this.metaFilters) {\n                _.each(this.metaFilters, (value, key) => {\n                    filters[key] = value;\n                })\n            }\n\n            filters._id = {\n                $in: _.uniq(\n                    _.pluck(this.parentObjects, '_id')\n                )\n            };\n\n            return {\n                [this.linkStorageField]: {\n                    $elemMatch: filters\n                }\n            };\n        }\n    }\n}","import sift from 'sift';\nimport cleanObjectForMetaFilters from './lib/cleanObjectForMetaFilters';\n\n/**\n * This only applies to inversed links. It will assemble the data in a correct manner.\n */\nexport default function(childCollectionNode, aggregateResults, metaFilters) {\n    const linker = childCollectionNode.linker;\n    const linkStorageField = linker.linkStorageField;\n    const linkName = childCollectionNode.linkName;\n    const isMeta = linker.isMeta();\n    const isMany = linker.isMany();\n\n    let allResults = [];\n\n    if (isMeta && metaFilters) {\n        const metaFiltersTest = sift(metaFilters);\n        _.each(childCollectionNode.parent.results, parentResult => {\n            cleanObjectForMetaFilters(\n                parentResult,\n                linkStorageField,\n                metaFiltersTest\n            );\n        });\n    }\n\n    if (isMeta && isMany) {\n        // This case is treated differently because we get an array response from the pipeline.\n\n        _.each(childCollectionNode.parent.results, parentResult => {\n            parentResult[linkName] = parentResult[linkName] || [];\n\n            const eligibleAggregateResults = _.filter(\n                aggregateResults,\n                aggregateResult => {\n                    return _.contains(aggregateResult._id, parentResult._id);\n                }\n            );\n\n            if (eligibleAggregateResults.length) {\n                const datas = _.pluck(eligibleAggregateResults, 'data'); /// [ [x1, x2], [x2, x3] ]\n\n                _.each(datas, data => {\n                    _.each(data, item => {\n                        parentResult[linkName].push(item);\n                    });\n                });\n            }\n        });\n\n        _.each(aggregateResults, aggregateResult => {\n            _.each(aggregateResult.data, item => allResults.push(item));\n        });\n    } else {\n        let comparator;\n        if (isMany) {\n            comparator = (aggregateResult, result) =>\n                _.contains(aggregateResult._id, result._id);\n        } else {\n            comparator = (aggregateResult, result) =>\n                aggregateResult._id == result._id;\n        }\n\n        const childLinkName = childCollectionNode.linkName;\n        const parentResults = childCollectionNode.parent.results;\n\n        parentResults.forEach(parentResult => {\n            // We are now finding the data from the pipeline that is related to the _id of the parent\n            const eligibleAggregateResults = aggregateResults.filter(\n                aggregateResult => comparator(aggregateResult, parentResult)\n            );\n\n            eligibleAggregateResults.forEach(aggregateResult => {\n                if (Array.isArray(parentResult[childLinkName])) {\n                    parentResult[childLinkName].push(...aggregateResult.data);\n                } else {\n                    parentResult[childLinkName] = [...aggregateResult.data];\n                }\n            });\n        });\n\n        aggregateResults.forEach(aggregateResult => {\n            allResults.push(...aggregateResult.data);\n        });\n    }\n\n    childCollectionNode.results = allResults;\n}\n","import createSearchFilters from '../../links/lib/createSearchFilters';\nimport cleanObjectForMetaFilters from './lib/cleanObjectForMetaFilters';\nimport sift from 'sift';\n\nexport default (childCollectionNode, { limit, skip, metaFilters }) => {\n    if (childCollectionNode.results.length === 0) {\n        return;\n    }\n\n    const parent = childCollectionNode.parent;\n    const linker = childCollectionNode.linker;\n\n    const strategy = linker.strategy;\n    const isSingle = linker.isSingle();\n    const isMeta = linker.isMeta();\n    const fieldStorage = linker.linkStorageField;\n\n    // cleaning the parent results from a child\n    // this may be the wrong approach but it works for now\n    if (isMeta && metaFilters) {\n        const metaFiltersTest = sift(metaFilters);\n        _.each(parent.results, parentResult => {\n            cleanObjectForMetaFilters(\n                parentResult,\n                fieldStorage,\n                metaFiltersTest\n            );\n        });\n    }\n\n    const resultsByKeyId = _.groupBy(childCollectionNode.results, '_id');\n\n    if (strategy === 'one') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                resultsByKeyId[parentResult[fieldStorage]],\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'many') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            let data = [];\n            parentResult[fieldStorage].forEach(_id => {\n                data.push(_.first(resultsByKeyId[_id]));\n            });\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                data,\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'one-meta') {\n        parent.results.forEach(parentResult => {\n            if (!parentResult[fieldStorage]) {\n                return;\n            }\n\n            const _id = parentResult[fieldStorage]._id;\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                resultsByKeyId[_id],\n                { limit, skip }\n            );\n        });\n    }\n\n    if (strategy === 'many-meta') {\n        parent.results.forEach(parentResult => {\n            const _ids = _.pluck(parentResult[fieldStorage], '_id');\n            let data = [];\n            _ids.forEach(_id => {\n                data.push(_.first(resultsByKeyId[_id]));\n            });\n\n            parentResult[childCollectionNode.linkName] = filterAssembledData(\n                data,\n                { limit, skip }\n            );\n        });\n    }\n};\n\nfunction filterAssembledData(data, { limit, skip }) {\n    if (limit && Array.isArray(data)) {\n        return data.slice(skip, limit);\n    }\n\n    return data;\n}\n","import { _ } from 'meteor/underscore';\nimport {SAFE_DOTTED_FIELD_REPLACEMENT} from './constants';\n\nexport default function (childCollectionNode, filters, options, userId) {\n    let containsDottedFields = false;\n    const linker = childCollectionNode.linker;\n    const linkStorageField = linker.linkStorageField;\n    const collection = childCollectionNode.collection;\n\n    let pipeline = [];\n\n    if (collection.firewall) {\n        collection.firewall(filters, options, userId);\n    }\n\n    pipeline.push({$match: filters});\n\n    if (options.sort && _.keys(options.sort).length > 0) {\n        pipeline.push({$sort: options.sort})\n    }\n\n    let _id = linkStorageField;\n    if (linker.isMeta()) {\n        _id += '._id';\n    }\n\n    let dataPush = {\n        _id: '$_id'\n    };\n\n    _.each(options.fields, (value, field) => {\n        if (field.indexOf('.') >= 0) {\n            containsDottedFields = true;\n        }\n        const safeField = field.replace(/\\./g, SAFE_DOTTED_FIELD_REPLACEMENT);\n        dataPush[safeField] = '$' + field\n    });\n\n    if (linker.isMeta()) {\n        dataPush[linkStorageField] = '$' + linkStorageField;\n    }\n\n    pipeline.push({\n        $group: {\n            _id: \"$\" + _id,\n            data: {\n                $push: dataPush\n            }\n        }\n    });\n\n    if (options.limit || options.skip) {\n        let $slice = [\"$data\"];\n        if (options.skip) $slice.push(options.skip);\n        if (options.limit) $slice.push(options.limit);\n\n        pipeline.push({\n            $project: {\n                _id: 1,\n                data: {$slice}\n            }\n        })\n    }\n\n    return {pipeline, containsDottedFields};\n}","export const SAFE_DOTTED_FIELD_REPLACEMENT = '___';","import applyProps from '../lib/applyProps.js';\nimport prepareForDelivery from '../lib/prepareForDelivery.js';\nimport storeHypernovaResults from './storeHypernovaResults.js';\n\nfunction hypernova(collectionNode, userId) {\n    _.each(collectionNode.collectionNodes, childCollectionNode => {\n        let {filters, options} = applyProps(childCollectionNode);\n\n        storeHypernovaResults(childCollectionNode, userId);\n        hypernova(childCollectionNode, userId);\n    });\n}\n\nexport default function hypernovaInit(collectionNode, userId, config = {}) {\n    const bypassFirewalls = config.bypassFirewalls || false;\n    const params = config.params || {};\n\n    let {filters, options} = applyProps(collectionNode);\n\n    const collection = collectionNode.collection;\n\n    collectionNode.results = collection.find(filters, options, userId).fetch();\n\n    const userIdToPass = (config.bypassFirewalls) ? undefined : userId;\n    hypernova(collectionNode, userIdToPass);\n\n    prepareForDelivery(collectionNode, params);\n\n    return collectionNode.results;\n}\n","import applyProps from '../lib/applyProps.js';\nimport AggregateFilters from './aggregateSearchFilters.js';\nimport assemble from './assembler.js';\nimport assembleAggregateResults from './assembleAggregateResults.js';\nimport buildAggregatePipeline from './buildAggregatePipeline.js';\nimport snapBackDottedFields from './lib/snapBackDottedFields';\n\nexport default function storeHypernovaResults(childCollectionNode, userId) {\n    if (childCollectionNode.parent.results.length === 0) {\n        return (childCollectionNode.results = []);\n    }\n\n    let { filters, options } = applyProps(childCollectionNode);\n\n    const metaFilters = filters.$meta;\n    const aggregateFilters = new AggregateFilters(\n        childCollectionNode,\n        metaFilters\n    );\n    delete filters.$meta;\n\n    const linker = childCollectionNode.linker;\n    const isVirtual = linker.isVirtual();\n    const collection = childCollectionNode.collection;\n\n    _.extend(filters, aggregateFilters.create());\n\n    // if it's not virtual then we retrieve them and assemble them here.\n    if (!isVirtual) {\n        const filteredOptions = _.omit(options, 'limit');\n\n        childCollectionNode.results = collection\n            .find(filters, filteredOptions, userId)\n            .fetch();\n\n        assemble(childCollectionNode, {\n            ...options,\n            metaFilters,\n        });\n    } else {\n        // virtuals arrive here\n        let { pipeline, containsDottedFields } = buildAggregatePipeline(\n            childCollectionNode,\n            filters,\n            options,\n            userId\n        );\n\n        let aggregateResults = collection.aggregate(pipeline);\n\n        /**\n         * If in aggregation it contains '.', we replace it with a custom string '___'\n         * And then after aggregation is complete we need to snap-it back to how it was.\n         */\n        if (containsDottedFields) {\n            snapBackDottedFields(aggregateResults);\n        }\n\n        assembleAggregateResults(\n            childCollectionNode,\n            aggregateResults,\n            metaFilters\n        );\n    }\n}\n","export default function (object, field, metaFiltersTest) {\n    if (object[field]) {\n        if (_.isArray(object[field])) {\n            object[field] = object[field].filter(metaFiltersTest)\n        } else {\n            if (!metaFiltersTest(object[field])) {\n                object[field] = null;\n            }\n        }\n    }\n}","import {SAFE_DOTTED_FIELD_REPLACEMENT} from '../constants';\nimport dot from 'dot-object';\n\nexport default function (aggregationResult) {\n    aggregationResult.forEach(result => {\n        result.data = result.data.map(document => {\n            _.each(document, (value, key) => {\n                if (key.indexOf(SAFE_DOTTED_FIELD_REPLACEMENT) >= 0) {\n                    document[key.replace(new RegExp(SAFE_DOTTED_FIELD_REPLACEMENT, 'g'), '.')] = value;\n                    delete document[key];\n                }\n            });\n\n            return dot.object(document);\n        })\n    })\n}","const restrictOptions = [\n    'disableOplog',\n    'pollingIntervalMs',\n    'pollingThrottleMs'\n];\n\nexport default function applyProps(node) {\n    let filters = _.extend({}, node.props.$filters);\n    let options = _.extend({}, node.props.$options);\n\n    options = _.omit(options, ...restrictOptions);\n    options.fields = options.fields || {};\n\n    node.applyFields(filters, options);\n\n    return {filters, options};\n}\n","export default (method, myParameters) => {\n    return new Promise((resolve, reject) => {\n        Meteor.call(method, myParameters, (err, res) => {\n            if (err) reject(err.reason || 'Something went wrong.');\n\n            resolve(res);\n        });\n    });\n};","import CollectionNode from '../nodes/collectionNode.js';\nimport FieldNode from '../nodes/fieldNode.js';\nimport ReducerNode from '../nodes/reducerNode.js';\nimport dotize from './dotize.js';\nimport createReducers from '../reducers/lib/createReducers';\n\nconst specialFields = [\n    '$filters',\n    '$options',\n    '$postFilters',\n    '$postOptions',\n    '$postFilter'\n];\n\n/**\n * Creates node objects from the body. The root is always a collection node.\n *\n * @param root\n */\nexport function createNodes(root) {\n    // this is a fix for phantomjs tests (don't really understand it.)\n    if (!_.isObject(root.body)) {\n        return;\n    }\n\n    _.each(root.body, (body, fieldName) => {\n        if (!body) {\n            return;\n        }\n\n        // if it's a prop\n        if (_.contains(specialFields, fieldName)) {\n            root.addProp(fieldName, body);\n\n            return;\n        }\n\n        // workaround, see https://github.com/cult-of-coders/grapher/issues/134\n        // TODO: find another way to do this\n        if (root.collection.default) {\n          root.collection = root.collection.default;\n        }\n\n        // checking if it is a link.\n        let linker = root.collection.getLinker(fieldName);\n\n        if (linker) {\n            // check if it is a cached link\n            // if yes, then we need to explicitly define this at collection level\n            // so when we transform the data for delivery, we move it to the link name\n            if (linker.isDenormalized()) {\n                if (linker.isSubBodyDenormalized(body)) {\n                    handleDenormalized(root, linker, body, fieldName);\n                    return;\n                }\n            }\n\n            let subroot = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n            root.add(subroot, linker);\n\n            createNodes(subroot);\n            return;\n        }\n\n        // checking if it's a reducer\n        const reducer = root.collection.getReducer(fieldName);\n\n        if (reducer) {\n            let reducerNode = new ReducerNode(fieldName, reducer);\n            root.add(reducerNode);\n        }\n\n        // it's most likely a field then\n        addFieldNode(body, fieldName, root);\n    });\n\n    createReducers(root);\n\n    if (root.fieldNodes.length === 0) {\n        root.add(new FieldNode('_id', 1));\n    }\n}\n\n/**\n * @param body\n * @param fieldName\n * @param root\n */\nexport function addFieldNode(body, fieldName, root) {\n    // it's not a link and not a special variable => we assume it's a field\n    if (_.isObject(body)) {\n        let dotted = dotize.convert({[fieldName]: body});\n        _.each(dotted, (value, key) => {\n            root.add(new FieldNode(key, value));\n        });\n    } else {\n        let fieldNode = new FieldNode(fieldName, body);\n        root.add(fieldNode);\n    }\n}\n\n/**\n * @param collection\n * @param body\n * @returns {CollectionNode}\n */\nexport default function (collection, body) {\n    let root = new CollectionNode(collection, body);\n    createNodes(root);\n\n    return root;\n};\n\n/**\n * Ads denormalization config properly, including _id\n *\n * @param root\n * @param linker\n * @param body\n * @param fieldName\n */\nfunction handleDenormalized(root, linker, body, fieldName) {\n    Object.assign(body, {_id: 1});\n\n    const cacheField = linker.linkConfig.denormalize.field;\n    root.snapCache(cacheField, fieldName);\n\n    // if it's one and direct also include the link storage\n    if (!linker.isMany() && !linker.isVirtual()) {\n        addFieldNode(1, linker.linkStorageField, root);\n    }\n\n    addFieldNode(body, cacheField, root);\n}","// https://github.com/vardars/dotize\nexport default dotize = {};\n\ndotize.convert = function(obj, prefix) {\n    if ((!obj || typeof obj != \"object\") && !Array.isArray(obj)) {\n        if (prefix) {\n            var newObj = {};\n            newObj[prefix] = obj;\n            return newObj;\n        } else {\n            return obj;\n        }\n    }\n\n    var newObj = {};\n\n    function recurse(o, p, isArrayItem) {\n        for (var f in o) {\n            if (o[f] && typeof o[f] === \"object\") {\n                if (Array.isArray(o[f])) {\n                    if (isEmptyArray(o[f])) {\n                        newObj[getFieldName(f, p, true)] = o[f]; // empty array\n                    } else {\n                        newObj = recurse(o[f], getFieldName(f, p, false, true), true); // array\n                    }\n                } else {\n                    if (isArrayItem) {\n                        if (isEmptyObj(o[f])) {\n                            newObj[getFieldName(f, p, true)] = o[f]; // empty object\n                        } else {\n                            newObj = recurse(o[f], getFieldName(f, p, true)); // array item object\n                        }\n                    } else {\n                        if (isEmptyObj(o[f])) {\n                            newObj[getFieldName(f, p)] = o[f]; // empty object\n                        } else {\n                            newObj = recurse(o[f], getFieldName(f, p)); // object\n                        }\n                    }\n                }\n            } else {\n                if (isArrayItem || isNumber(f)) {\n                    newObj[getFieldName(f, p, true)] = o[f]; // array item primitive\n                } else {\n                    newObj[getFieldName(f, p)] = o[f]; // primitive\n                }\n            }\n        }\n\n        if (isEmptyObj(newObj))\n            return obj;\n\n        return newObj;\n    }\n\n    function isNumber(f) {\n        return !isNaN(parseInt(f));\n    }\n\n    function isEmptyObj(obj) {\n        for (var prop in obj) {\n            if (Object.hasOwnProperty.call(obj, prop))\n                return false;\n        }\n\n        return true;\n    }\n\n    function isEmptyArray(o) {\n        if (Array.isArray(o) && o.length == 0)\n            return true;\n        return false;\n    }\n\n    function getFieldName(field, prefix, isArrayItem, isArray) {\n        if (isArray)\n            return (prefix ? prefix : \"\") + (isNumber(field) ? \"[\" + field + \"]\" : \".\" + field);\n        else if (isArrayItem)\n            return (prefix ? prefix : \"\") + \"[\" + field + \"]\";\n        else\n            return (prefix ? prefix + \".\" : \"\") + field;\n    }\n\n    return recurse(obj, prefix, Array.isArray(obj));\n};","import dot from 'dot-object';\nimport {_} from 'meteor/underscore';\n\n/**\n * Given a named query that has a specific body, you can query its subbody\n * This performs an intersection of the bodies allowed in each\n *\n * @param allowedBody\n * @param clientBody\n */\nexport default function (allowedBody, clientBody) {\n    const allowedBodyDot = _.keys(dot.dot(allowedBody));\n    const clientBodyDot = _.keys(dot.dot(clientBody));\n\n    const intersection = _.intersection(allowedBodyDot, clientBodyDot);\n\n    const build = {};\n    intersection.forEach(intersectedField => {\n        build[intersectedField] = 1;\n    });\n\n    return dot.object(build);\n}","// 1. Clone children with meta relationships\n// 2. Apply $metadata to children\n// 3. Removes link storage (if not specified)\n// 4. Stores oneResult links as a single object instead of array\nimport applyReducers from '../reducers/lib/applyReducers';\nimport cleanReducerLeftovers from '../reducers/lib/cleanReducerLeftovers';\nimport sift from 'sift';\nimport {Minimongo} from 'meteor/minimongo';\n\nexport default (node, params) => {\n    snapBackCaches(node);\n    storeOneResults(node, node.results);\n    applyReducers(node, params);\n    cleanReducerLeftovers(node);\n\n    _.each(node.collectionNodes, collectionNode => {\n        cloneMetaChildren(collectionNode, node.results)\n    });\n\n    _.each(node.collectionNodes, collectionNode => {\n        assembleMetadata(collectionNode, node.results)\n    });\n\n    removeLinkStorages(node, node.results);\n    applyPostFilters(node);\n    applyPostOptions(node);\n    applyPostFilter(node, params);\n}\n\nexport function applyPostFilters(node) {\n    const postFilters = node.props.$postFilters;\n    if (postFilters) {\n        node.results = sift(postFilters, node.results);\n    }\n}\n\nexport function applyPostOptions(node) {\n    const options = node.props.$postOptions;\n    if (options) {\n        if (options.sort) {\n            const sorter = new Minimongo.Sorter(options.sort);\n            node.results.sort(sorter.getComparator());\n        }\n        if (options.limit || options.skip) {\n            const start = options.skip || 0;\n            const end = options.limit ? options.limit + start : node.results.length;\n            node.results = node.results.slice(start, end);\n        }\n    }\n}\n\n\n/**\n * Optionally applies a post filtering option\n */\nfunction applyPostFilter(node, params) {\n    if (node.props.$postFilter) {\n        const filter = node.props.$postFilter;\n\n        if (_.isArray(filter)) {\n            filter.forEach(f => {\n                node.results = f(node.results, params);\n            })\n        } else {\n            node.results = filter(node.results, params);\n        }\n    }\n}\n\n/**\n *\n * Helper function which transforms results into the array.\n * Results are an object for 'one' links.\n *\n * @param results\n * @return array\n */\nexport function getResultsArray(results) {\n    if (_.isArray(results)) {\n        return results;\n    }\n    else if (_.isUndefined(results)) {\n        return [];\n    }\n    return [results];\n}\n\nexport function removeLinkStorages(node, sameLevelResults) {\n    if (!sameLevelResults) {\n        return;\n    }\n\n    sameLevelResults = getResultsArray(sameLevelResults);\n\n    _.each(node.collectionNodes, collectionNode => {\n        const removeStorageField = collectionNode.shouldCleanStorage;\n        _.each(sameLevelResults, result => {\n            if (removeStorageField) {\n                delete result[collectionNode.linkStorageField];\n            }\n\n            removeLinkStorages(collectionNode, result[collectionNode.linkName]);\n        })\n    })\n}\n\nexport function storeOneResults(node, sameLevelResults) {\n    if (!sameLevelResults) {\n        return;\n    }\n\n    node.collectionNodes.forEach(collectionNode => {\n        _.each(sameLevelResults, result => {\n            storeOneResults(collectionNode, result[collectionNode.linkName]);\n        });\n\n        if (collectionNode.isOneResult) {\n            _.each(sameLevelResults, result => {\n                if (result[collectionNode.linkName] && _.isArray(result[collectionNode.linkName])) {\n                    result[collectionNode.linkName] = result[collectionNode.linkName]\n                        ? _.first(result[collectionNode.linkName])\n                        : undefined;\n                }\n            })\n        }\n    })\n}\n\nfunction cloneMetaChildren(node, parentResults) {\n    if (!parentResults) {\n        return;\n    }\n\n    const linkName = node.linkName;\n    const isMeta = node.isMeta;\n\n    // parentResults might be an object (for type==one links)\n    parentResults = getResultsArray(parentResults);\n\n    parentResults.forEach(parentResult => {\n        if (isMeta && parentResult[linkName]) {\n            if (node.isOneResult) {\n                parentResult[linkName] = Object.assign({}, parentResult[linkName]);\n            }\n            else {\n                parentResult[linkName] = parentResult[linkName].map(object => {\n                    return Object.assign({}, object);\n                });\n            }\n        }\n\n        node.collectionNodes.forEach(collectionNode => {\n            cloneMetaChildren(collectionNode, parentResult[linkName]);\n        });\n    });\n}\n\nexport function assembleMetadata(node, parentResults) {\n    parentResults = getResultsArray(parentResults);\n\n    // assembling metadata is depth first\n    node.collectionNodes.forEach(collectionNode => {\n        _.each(parentResults, result => {\n            assembleMetadata(collectionNode, result[node.linkName])\n        });\n    });\n\n    if (node.isMeta) {\n        if (node.isVirtual) {\n            _.each(parentResults, parentResult => {\n                const childResult = parentResult[node.linkName];\n\n                if (node.isOneResult) {\n                    const storage = childResult[node.linkStorageField];\n                    storeMetadata(childResult, parentResult, storage, true);\n                } else {\n                    _.each(childResult, object => {\n                        const storage = object[node.linkStorageField];\n\n                        storeMetadata(object, parentResult, storage, true);\n                    });\n                }\n            })\n        } else {\n            _.each(parentResults, parentResult => {\n                const childResult = parentResult[node.linkName];\n                const storage = parentResult[node.linkStorageField];\n\n                if (node.isOneResult) {\n                    if (childResult) {\n                        storeMetadata(childResult, parentResult, storage, false);\n                    }\n                } else {\n                    _.each(childResult, object => {\n                        storeMetadata(object, parentResult, storage, false);\n                    });\n                }\n            })\n        }\n    }\n}\n\nfunction storeMetadata(element, parentElement, storage, isVirtual) {\n    if (isVirtual) {\n        let $metadata;\n        if (_.isArray(storage)) {\n            $metadata = _.find(storage, storageItem => storageItem._id == parentElement._id);\n        } else {\n            $metadata = storage;\n        }\n\n        element.$metadata = _.omit($metadata, '_id')\n    } else {\n        let $metadata;\n        if (_.isArray(storage)) {\n            $metadata = _.find(storage, storageItem => storageItem._id == element._id);\n        } else {\n            $metadata = storage;\n        }\n\n        element.$metadata = _.omit($metadata, '_id');\n    }\n}\n\nfunction snapBackCaches(node) {\n    node.collectionNodes.forEach(collectionNode => {\n        snapBackCaches(collectionNode);\n    });\n\n    if (!_.isEmpty(node.snapCaches)) {\n        // process stuff\n        _.each(node.snapCaches, (linkName, cacheField) => {\n            const isSingle = _.contains(node.snapCachesSingles, cacheField);\n            const linker = node.collection.getLinker(linkName);\n            // we do this because for one direct and one meta direct, id is not stored\n            const shoudStoreLinkStorage = !linker.isMany() && !linker.isVirtual();\n\n            node.results.forEach(result => {\n                if (result[cacheField]) {\n                    if (shoudStoreLinkStorage) {\n                        Object.assign(result[cacheField], {\n                            _id: linker.isMeta()\n                                ? result[linker.linkStorageField]._id\n                                : result[linker.linkStorageField]\n                        });\n                    }\n\n                    if (isSingle && _.isArray(result[cacheField])) {\n                        result[linkName] = _.first(result[cacheField]);\n                    } else {\n                        result[linkName] = result[cacheField];\n                    }\n\n                    delete result[cacheField];\n                }\n            })\n        })\n    }\n}\n","import {check, Match} from 'meteor/check';\nimport deepClone from 'lodash.clonedeep';\n\nfunction defaultFilterFunction({\n    filters,\n    options,\n    params\n}) {\n    if (params.filters) {\n        Object.assign(filters, params.filters);\n    }\n    if (params.options) {\n        Object.assign(options, params.options);\n    }\n}\n\nfunction applyFilterRecursive(data, params = {}, isRoot = false) {\n    if (isRoot && !_.isFunction(data.$filter)) {\n        data.$filter = defaultFilterFunction;\n    }\n\n    if (data.$filter) {\n        check(data.$filter, Match.OneOf(Function, [Function]));\n\n        data.$filters = data.$filters || {};\n        data.$options = data.$options || {};\n\n        if (_.isArray(data.$filter)) {\n            data.$filter.forEach(filter => {\n                filter.call(null, {\n                    filters: data.$filters,\n                    options: data.$options,\n                    params: params\n                })\n            });\n        } else {\n            data.$filter({\n                filters: data.$filters,\n                options: data.$options,\n                params: params\n            });\n        }\n\n        data.$filter = null;\n        delete(data.$filter);\n    }\n\n    _.each(data, (value, key) => {\n        if (_.isObject(value)) {\n            return applyFilterRecursive(value, params);\n        }\n    })\n}\n\nfunction applyPagination(body, _params) {\n    if (body['$paginate'] && _params) {\n        if (!body.$options) {\n            body.$options = {};\n        }\n\n        if (_params.limit) {\n            _.extend(body.$options, {\n                limit: _params.limit\n            })\n        }\n\n        if (_params.skip) {\n            _.extend(body.$options, {\n                skip: _params.skip\n            })\n        }\n\n        delete body['$paginate'];\n    }\n}\n\nexport default (_body, _params = {}) => {\n    let body = deepClone(_body);\n    let params = deepClone(_params);\n\n    applyPagination(body, params);\n    applyFilterRecursive(body, params, true);\n\n    return body;\n}\n","import applyProps from './applyProps.js';\nimport { assembleMetadata, removeLinkStorages, storeOneResults } from './prepareForDelivery';\nimport prepareForDelivery from './prepareForDelivery';\n\n/**\n * This is always run client side to build the data graph out of client-side collections.\n *\n * @param node\n * @param parentObject\n * @returns {*}\n */\nfunction fetch(node, parentObject) {\n    let {filters, options} = applyProps(node);\n\n    let results = [];\n\n    if (parentObject) {\n        let accessor = node.linker.createLink(parentObject, node.collection);\n\n        if (node.isVirtual) {\n            options.fields = options.fields || {};\n            _.extend(options.fields, {\n                [node.linkStorageField]: 1\n            });\n        }\n\n        results = accessor.find(filters, options).fetch();\n    } else {\n        results = node.collection.find(filters, options).fetch();\n    }\n\n    _.each(node.collectionNodes, collectionNode => {\n        _.each(results, result => {\n            const collectionNodeResults = fetch(collectionNode, result);\n            result[collectionNode.linkName] = collectionNodeResults;\n            //delete result[node.linker.linkStorageField];\n\n            /**\n             * Push into the results, because snapBackCaches() in prepareForDelivery does not work otherwise.\n             * This is non-optimal, can we be sure that every item in results contains _id and add only if not in\n             * the results?\n             *\n             * Other possible ways:\n             * - do something like assemble() in storeHypernovaResults\n             * - pass node.results to accessor above and find with sift\n             */\n\n            const currentIds = _.pluck(collectionNode.results, '_id');\n            collectionNode.results.push(...collectionNodeResults.filter(res => !_.contains(currentIds, res._id)));\n        })\n    });\n\n    return results;\n}\n\nexport default (node, params) => {\n    node.results = fetch(node);\n\n    prepareForDelivery(node, params);\n\n    return node.results;\n}\n","import FieldNode from './fieldNode.js';\nimport ReducerNode from './reducerNode.js';\nimport deepClone from 'lodash.clonedeep';\nimport {check, Match} from 'meteor/check';\n\nexport default class CollectionNode {\n    constructor(collection, body = {}, linkName = null) {\n        if (collection && !_.isObject(body)) {\n            throw new Meteor.Error('invalid-body', 'Every collection link should have its body defined as an object.');\n        }\n\n        this.body = deepClone(body);\n        this.linkName = linkName;\n        this.collection = collection;\n\n        this.nodes = [];\n        this.props = {};\n        this.parent = null;\n        this.linker = null;\n        this.linkStorageField = null;\n        this.scheduledForDeletion = false;\n        this.reducers = [];\n        this.results = [];\n        this.snapCaches = {}; // {cacheField: linkName}\n        this.snapCachesSingles = []; // [cacheField1, cacheField2]\n    }\n\n    get collectionNodes() {\n        return _.filter(this.nodes, n => n instanceof CollectionNode)\n    }\n\n    get fieldNodes() {\n        return _.filter(this.nodes, n => n instanceof FieldNode);\n    }\n\n    get reducerNodes() {\n        return _.filter(this.nodes, n => n instanceof ReducerNode);\n    }\n\n    /**\n     * Adds children to itself\n     *\n     * @param node\n     * @param linker\n     */\n    add(node, linker) {\n        node.parent = this;\n\n        if (linker) {\n            node.linker = linker;\n            node.linkStorageField = linker.linkStorageField;\n            node.isMeta = linker.isMeta();\n            node.isVirtual = linker.isVirtual();\n            node.isOneResult = linker.isOneResult();\n            node.shouldCleanStorage = this._shouldCleanStorage(node);\n        }\n\n        this.nodes.push(node);\n    }\n\n    /**\n     * @param prop\n     * @param value\n     */\n    addProp(prop, value) {\n        if (prop === '$postFilter') {\n            check(value, Match.OneOf(Function, [Function]))\n        }\n\n        _.extend(this.props, {\n            [prop]: value\n        });\n    }\n\n    /**\n     * @param _node\n     */\n    remove(_node) {\n        this.nodes = _.filter(this.nodes, node => _node !== node);\n    }\n\n    /**\n     * @param filters\n     * @param options\n     */\n    applyFields(filters, options) {\n        let hasAddedAnyField = false;\n\n        _.each(this.fieldNodes, n => {\n            hasAddedAnyField = true;\n            n.applyFields(options.fields)\n        });\n\n        // it will only get here if it has collectionNodes children\n        _.each(this.collectionNodes, (collectionNode) => {\n            let linker = collectionNode.linker;\n\n            if (linker && !linker.isVirtual()) {\n                options.fields[linker.linkStorageField] = 1;\n                hasAddedAnyField = true;\n            }\n        });\n\n        // if he selected filters, we should automatically add those fields\n        _.each(filters, (value, field) => {\n            // special handling for the $meta filter and conditional operators\n            if (!_.contains(['$or', '$nor', '$not', '$and', '$meta'], field)) {\n                // if the field or the parent of the field already exists, don't add it\n                if (!_.has(options.fields, field.split('.')[0])){\n                    hasAddedAnyField = true;\n                    options.fields[field] = 1;\n                }\n            }\n        });\n\n        if (!hasAddedAnyField) {\n            options.fields = {_id: 1};\n        }\n    }\n\n    /**\n     * @param fieldName\n     * @returns {boolean}\n     */\n    hasField(fieldName) {\n        return !!_.find(this.fieldNodes, fieldNode => {\n            return fieldNode.name == fieldName\n        })\n    }\n\n    /**\n     * @param fieldName\n     * @returns {FieldNode}\n     */\n    getField(fieldName) {\n        return _.find(this.fieldNodes, fieldNode => {\n            return fieldNode.name == fieldName\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {boolean}\n     */\n    hasCollectionNode(name) {\n        return !!_.find(this.collectionNodes, node => {\n            return node.linkName == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {boolean}\n     */\n    hasReducerNode(name) {\n        return !!_.find(this.reducerNodes, node => {\n            return node.name == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {ReducerNode}\n     */\n    getReducerNode(name) {\n        return _.find(this.reducerNodes, node => {\n            return node.name == name\n        })\n    }\n\n    /**\n     * @param name\n     * @returns {CollectionNode}\n     */\n    getCollectionNode(name) {\n        return _.find(this.collectionNodes, node => {\n            return node.linkName == name\n        })\n    }\n\n    /**\n     * @returns {*}\n     */\n    getName() {\n        return this.linkName\n            ? this.linkName\n            : (this.collection ? this.collection._name : 'N/A');\n    }\n\n    /**\n     * This is used for caching links\n     *\n     * @param cacheField\n     * @param subLinkName\n     */\n    snapCache(cacheField, subLinkName) {\n        this.snapCaches[cacheField] = subLinkName;\n\n        if (this.collection.getLinker(subLinkName).isOneResult()) {\n            this.snapCachesSingles.push(cacheField);\n        }\n    }\n\n    /**\n     * This method verifies whether to remove the linkStorageField form the results\n     * unless you specify it in your query.\n     *\n     * @param node\n     * @returns {boolean}\n     * @private\n     */\n    _shouldCleanStorage(node) {\n        if (node.linkStorageField === '_id') {\n            return false;\n        } else {\n            if (node.isVirtual) {\n                return !node.hasField(node.linkStorageField);\n            } else {\n                return !this.hasField(node.linkStorageField);\n            }\n        }\n    }\n}\n","export default class FieldNode {\n    constructor(name, body) {\n        this.name = name;\n        this.body = _.isObject(body) ? 1 : body;\n        this.scheduledForDeletion = false;\n    }\n\n    applyFields(fields) {\n        fields[this.name] = this.body;\n    }\n}","export default class ReducerNode {\n    constructor(name, {body, reduce}) {\n        this.name = name;\n        this.body = body;\n        this.reduceFunction = reduce;\n    }\n\n    /**\n     * When computing we also pass the parameters\n     * \n     * @param {*} object \n     * @param {*} args \n     */\n    compute(object, ...args) {\n        object[this.name] = this.reduce.call(this, object, ...args);\n    }\n\n    reduce(object, ...args) {\n        return this.reduceFunction.call(this, object, ...args);\n    }\n}","import { check } from 'meteor/check';\nimport addFieldMap from './lib/addFieldMap';\n\nconst storage = '__reducers';\nObject.assign(Mongo.Collection.prototype, {\n    /**\n     * @param data\n     */\n    addReducers(data) {\n        if (!this[storage]) {\n            this[storage] = {};\n        }\n\n        _.each(data, (reducerConfig, reducerName) => {\n            if (!this[reducerConfig]) {\n                this[reducerConfig] = {};\n            }\n\n            if (this.getLinker(reducerName)) {\n                throw new Meteor.Error(\n                    `You cannot add the reducer with name: ${reducerName} because it is already defined as a link in ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            if (this[reducerConfig][reducerName]) {\n                throw new Meteor.Error(\n                    `You cannot add the reducer with name: ${reducerName} because it was already added to ${\n                        this._name\n                    } collection`\n                );\n            }\n\n            check(reducerConfig, {\n                body: Object,\n                reduce: Function,\n            });\n\n            _.extend(this[storage], {\n                [reducerName]: reducerConfig,\n            });\n        });\n    },\n\n    /**\n     * @param name\n     * @returns {*}\n     */\n    getReducer(name) {\n        if (this[storage]) {\n            return this[storage][name];\n        }\n    },\n\n    /**\n     * This creates reducers that makes sort of aliases for the database fields we use\n     */\n    addFieldMap,\n});\n","/**\n * @param {[niceField: string]: dbField} map\n */\nexport default function addFieldMap(map) {\n    const collection = this;\n    let reducers = {};\n    for (let key in map) {\n        const dbField = map[key];\n        reducers[key] = {\n            body: {\n                [dbField]: 1,\n            },\n            reduce(obj) {\n                return obj[dbField];\n            },\n        };\n    }\n\n    collection.addReducers(reducers);\n}\n","export default function applyReducers(root, params) {\n    _.each(root.collectionNodes, node => {\n        applyReducers(node, params);\n    });\n\n    _.each(root.reducerNodes, reducerNode => {\n        root.results.forEach(result => {\n            reducerNode.compute(result, params);\n        });\n    });\n}","import dot from 'dot-object';\n\n/**\n * @param root\n */\nexport default function cleanReducerLeftovers(root) {\n    _.each(root.collectionNodes, node => {\n        if (node.scheduledForDeletion) {\n            root.results.forEach(result => {\n                delete result[node.linkName];\n            })\n        }\n    });\n\n    _.each(root.collectionNodes, node => {\n        cleanReducerLeftovers(node);\n    });\n\n    _.each(root.fieldNodes, node => {\n        if (node.scheduledForDeletion) {\n            cleanNestedFields(node.name.split('.'), root.results, root);\n        }\n    });\n\n    _.each(root.reducerNodes, node => {\n        if (node.scheduledForDeletion) {\n            root.results.forEach(result => {\n                delete result[node.name];\n            })\n        }\n    });\n}\n\n// if we store a field like: 'profile.firstName'\n// then we need to delete profile: { firstName }\n// if profile will have empty keys, we need to delete profile.\n\n/**\n *\n * @param parts\n * @param results\n */\nfunction cleanNestedFields(parts, results, root) {\n    const snapCacheField = root.snapCaches[parts[0]];\n    const fieldName = snapCacheField ? snapCacheField : parts[0];\n\n    if (parts.length === 1) {\n\n        results.forEach(result => {\n            if (_.isObject(result) && fieldName !== '_id') {\n                delete result[fieldName];\n            }\n        });\n\n        return;\n    }\n\n    parts.shift();\n    cleanNestedFields(parts, results.map(result => result[fieldName]), root);\n\n    results.forEach(result => {\n        if (_.isObject(result[fieldName]) && _.keys(result[fieldName]).length === 0) {\n            if (fieldName !== '_id') {\n                delete result[fieldName];\n            }\n        }\n    })\n}\n","import dot from 'dot-object';\nimport { createNodes } from '../../lib/createGraph';\nimport CollectionNode from '../../nodes/collectionNode';\nimport FieldNode from '../../nodes/fieldNode';\nimport ReducerNode from '../../nodes/reducerNode';\nimport embedReducerWithLink from './embedReducerWithLink';\n\nexport default function addReducers(root) {\n    // we add reducers last, after we have added all the fields.\n    root.reducerNodes.forEach(reducer => {\n        _.each(reducer.body, (body, fieldName) => {\n            handleAddElement(root, fieldName, body);\n        })\n    });\n}\n\n/**\n * @param root\n * @param fieldName\n * @param body\n */\nexport function handleAddElement(root, fieldName, body) {\n    // if it's a link\n    const collection = root.collection;\n    const linker = collection.getLinker(fieldName);\n    if (linker) {\n        return handleAddLink(fieldName, body, root, linker);\n    }\n\n    const reducer = collection.getReducer(fieldName);\n    if (reducer) {\n        return handleAddReducer(fieldName, reducer, root);\n    }\n\n    // we assume it's a field in this case\n    return handleAddField(fieldName, body, root);\n}\n\n/**\n * @param fieldName\n * @param reducer\n * @param root\n */\nexport function handleAddReducer(fieldName, reducer, root) {\n    if (!root.hasReducerNode(fieldName)) {\n        let reducerNode = new ReducerNode(fieldName, reducer);\n        root.add(reducerNode);\n        reducerNode.scheduledForDeletion = true;\n\n        _.each(reducer.body, (body, fieldName) => {\n            handleAddElement(root, fieldName, body);\n        })\n    }\n}\n\n/**\n * @param fieldName\n * @param body\n * @param root\n * @param linker\n */\nexport function handleAddLink(fieldName, body, root, linker) {\n    if (root.hasCollectionNode(fieldName)) {\n        const collectionNode = root.getCollectionNode(fieldName);\n\n        embedReducerWithLink(body, collectionNode);\n    } else {\n        // add\n        let collectionNode = new CollectionNode(linker.getLinkedCollection(), body, fieldName);\n        collectionNode.scheduledForDeletion = true;\n        root.add(collectionNode, linker);\n\n        createNodes(collectionNode);\n    }\n}\n\n/**\n * @param fieldName\n * @param body\n * @param root\n */\nexport function handleAddField(fieldName, body, root) {\n    if (_.isObject(body)) {\n        // if reducer specifies a nested field\n        const dots = dot.dot({\n            [fieldName]: body\n        });\n\n        _.each(dots, (value, key) => {\n            if (!root.hasField(key)) {\n                let fieldNode = new FieldNode(key, value);\n                fieldNode.scheduledForDeletion = true;\n\n                root.add(fieldNode);\n            }\n        });\n    } else {\n        // if reducer does not specify a nested field, and the field does not exist.\n        if (!root.hasField(fieldName)) {\n            let fieldNode = new FieldNode(fieldName, body);\n            fieldNode.scheduledForDeletion = true;\n\n            root.add(fieldNode);\n        }\n    }\n}\n","import {handleAddField, handleAddElement, handleAddReducer} from './createReducers';\n\n/**\n * Embeds the reducer body with a collection body\n * @param reducerBody\n * @param collectionNode\n */\nexport default function embedReducerWithLink(reducerBody, collectionNode) {\n    _.each(reducerBody, (value, key) => {\n        const collection = collectionNode.collection;\n\n        if (_.isObject(value)) {\n            // nested field or link\n            if (collectionNode.body[key]) {\n                // if it exists\n                const linker = collection.getLinker(key);\n\n                // if it's a link\n                if (linker) {\n                    if (linker.isDenormalized()) {\n                        if (linker.isSubBodyDenormalized(value)) {\n                            const cacheField = linker.linkConfig.denormalize.field;\n                            handleAddField(cacheField, value, collectionNode);\n                            return;\n                        }\n                    }\n\n                    embedReducerWithLink(value, collectionNode.getCollectionNode(key));\n                    return;\n                }\n\n                handleAddField(key, value, collectionNode);\n            } else {\n                // does not exist, so it may be a link/reducer/field\n                handleAddElement(collectionNode, key, value);\n            }\n        } else {\n            // if this field or other reducer exists within the collection\n\n            if (!collectionNode.body[key]) {\n                // can only be field or another reducer for this.\n                const reducer = collection.getReducer(key);\n                if (reducer) {\n                    // if it's another reducer\n                    return handleAddReducer(key, reducer, collectionNode);\n                }\n\n                return handleAddField(key, value, collectionNode);\n            }\n        }\n    })\n}"]}}]